<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE AllowAmbiguousTypes #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE ApplicativeDo #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE DeriveGeneric #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE MultiWayIf #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE ViewPatterns #-}</span><span>
</span><span id="line-10"></span><span>
</span><span id="line-11"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Unison.Server.Backend</span><span>
</span><span id="line-12"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-comment">-- * Types</span></span><span>
</span><span id="line-13"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#BackendError"><span class="hs-identifier">BackendError</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-14"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#Backend"><span class="hs-identifier">Backend</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-15"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#ShallowListEntry"><span class="hs-identifier">ShallowListEntry</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#BackendEnv"><span class="hs-identifier">BackendEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#TypeEntry"><span class="hs-identifier">TypeEntry</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#FoundRef"><span class="hs-identifier">FoundRef</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#NameScoping"><span class="hs-identifier">NameScoping</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#IncludeCycles"><span class="hs-identifier">IncludeCycles</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#DefinitionResults"><span class="hs-identifier">DefinitionResults</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Endpoints</span></span><span>
</span><span id="line-24"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#prettyDefinitionsForHQName"><span class="hs-identifier">prettyDefinitionsForHQName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#fuzzyFind"><span class="hs-identifier">fuzzyFind</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-26"></span><span>
</span><span id="line-27"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Utilities</span></span><span>
</span><span id="line-28"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#basicSuffixifiedNames"><span class="hs-identifier">basicSuffixifiedNames</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-29"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#bestNameForTerm"><span class="hs-identifier">bestNameForTerm</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-30"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#bestNameForType"><span class="hs-identifier">bestNameForType</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-31"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#definitionsBySuffixes"><span class="hs-identifier">definitionsBySuffixes</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-32"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#displayType"><span class="hs-identifier">displayType</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-33"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#docsInBranchToHtmlFiles"><span class="hs-identifier">docsInBranchToHtmlFiles</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-34"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#expandShortCausalHash"><span class="hs-identifier">expandShortCausalHash</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-35"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#findDocInBranchAndRender"><span class="hs-identifier">findDocInBranchAndRender</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-36"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#formatSuffixedType"><span class="hs-identifier">formatSuffixedType</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-37"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#getCurrentParseNames"><span class="hs-identifier">getCurrentParseNames</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-38"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#getCurrentPrettyNames"><span class="hs-identifier">getCurrentPrettyNames</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-39"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#getShallowCausalAtPathFromRootHash"><span class="hs-identifier">getShallowCausalAtPathFromRootHash</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-40"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#getTermTag"><span class="hs-identifier">getTermTag</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-41"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#getTypeTag"><span class="hs-identifier">getTypeTag</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-42"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#hoistBackend"><span class="hs-identifier">hoistBackend</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-43"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#hqNameQuery"><span class="hs-identifier">hqNameQuery</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-44"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#loadReferentType"><span class="hs-identifier">loadReferentType</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-45"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#loadSearchResults"><span class="hs-identifier">loadSearchResults</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-46"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#lsAtPath"><span class="hs-identifier">lsAtPath</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-47"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#lsBranch"><span class="hs-identifier">lsBranch</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-48"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#mungeSyntaxText"><span class="hs-identifier">mungeSyntaxText</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-49"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#namesForBranch"><span class="hs-identifier">namesForBranch</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-50"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#parseNamesForBranch"><span class="hs-identifier">parseNamesForBranch</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-51"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#prettyNamesForBranch"><span class="hs-identifier">prettyNamesForBranch</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-52"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#resolveCausalHashV2"><span class="hs-identifier">resolveCausalHashV2</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-53"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#resolveRootBranchHashV2"><span class="hs-identifier">resolveRootBranchHashV2</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-54"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#scopedNamesForBranchHash"><span class="hs-identifier">scopedNamesForBranchHash</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-55"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#termEntryDisplayName"><span class="hs-identifier">termEntryDisplayName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-56"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#termEntryHQName"><span class="hs-identifier">termEntryHQName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-57"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#termEntryToNamedTerm"><span class="hs-identifier">termEntryToNamedTerm</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-58"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#%24sel%3AtermEntryType%3ATermEntry"><span class="hs-identifier">termEntryType</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-59"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#termListEntry"><span class="hs-identifier">termListEntry</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-60"></span><span>    </span><span class="annot"><a href="Unison.Server.NameSearch.Sqlite.html#termReferentsByShortHash"><span class="hs-identifier">termReferentsByShortHash</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-61"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#typeDeclHeader"><span class="hs-identifier">typeDeclHeader</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-62"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#typeEntryDisplayName"><span class="hs-identifier">typeEntryDisplayName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-63"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#typeEntryHQName"><span class="hs-identifier">typeEntryHQName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-64"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#typeEntryToNamedType"><span class="hs-identifier">typeEntryToNamedType</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-65"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#typeListEntry"><span class="hs-identifier">typeListEntry</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-66"></span><span>    </span><span class="annot"><a href="Unison.Server.NameSearch.Sqlite.html#typeReferencesByShortHash"><span class="hs-identifier">typeReferencesByShortHash</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-67"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#typeToSyntaxHeader"><span class="hs-identifier">typeToSyntaxHeader</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-68"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#renderDocRefs"><span class="hs-identifier">renderDocRefs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-69"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#docsForDefinitionName"><span class="hs-identifier">docsForDefinitionName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-70"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#normaliseRootCausalHash"><span class="hs-identifier">normaliseRootCausalHash</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-71"></span><span>
</span><span id="line-72"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Unused, could remove?</span></span><span>
</span><span id="line-73"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#resolveRootBranchHash"><span class="hs-identifier">resolveRootBranchHash</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-74"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#shallowPPE"><span class="hs-identifier">shallowPPE</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-75"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#isTestResultList"><span class="hs-identifier">isTestResultList</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-76"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#toAllNames"><span class="hs-identifier">toAllNames</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-77"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#fixupNamesRelative"><span class="hs-identifier">fixupNamesRelative</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-78"></span><span>
</span><span id="line-79"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Re-exported for Share Server</span></span><span>
</span><span id="line-80"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#termsToSyntax"><span class="hs-identifier">termsToSyntax</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-81"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#typesToSyntax"><span class="hs-identifier">typesToSyntax</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-82"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#definitionResultsDependencies"><span class="hs-identifier">definitionResultsDependencies</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-83"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#%24sel%3AtermEntryTag%3ATermEntry"><span class="hs-identifier">termEntryTag</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-84"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#evalDocRef"><span class="hs-identifier">evalDocRef</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-85"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#relocateToProjectRoot"><span class="hs-identifier">relocateToProjectRoot</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-86"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#mkTermDefinition"><span class="hs-identifier">mkTermDefinition</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-87"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#mkTypeDefinition"><span class="hs-identifier">mkTypeDefinition</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-88"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-89"></span><span class="hs-keyword">where</span><span>
</span><span id="line-90"></span><span>
</span><span id="line-91"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Error.Util</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">hush</span></span><span class="hs-special">)</span><span>
</span><span id="line-92"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Lens</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(??)</span></span><span class="hs-special">)</span><span>
</span><span id="line-93"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Lens.Cons</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Cons</span></span><span>
</span><span id="line-94"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Except</span></span><span>
</span><span id="line-95"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Reader</span></span><span>
</span><span id="line-96"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Containers.ListUtils</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">nubOrdOn</span></span><span class="hs-special">)</span><span>
</span><span id="line-97"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">List</span></span><span>
</span><span id="line-98"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-99"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-100"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Text</span></span><span>
</span><span id="line-101"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text.Encoding</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TextE</span></span><span>
</span><span id="line-102"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text.Lazy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">toStrict</span></span><span class="hs-special">)</span><span>
</span><span id="line-103"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Tuple.Extra</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">dupe</span></span><span class="hs-special">)</span><span>
</span><span id="line-104"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Yaml</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Yaml</span></span><span>
</span><span id="line-105"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Lucid</span></span><span> </span><span class="hs-keyword">qualified</span><span>
</span><span id="line-106"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Directory</span></span><span>
</span><span id="line-107"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.FilePath</span></span><span>
</span><span id="line-108"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Text.FuzzyFind</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">FZF</span></span><span>
</span><span id="line-109"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">U.Codebase.Branch</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">NamespaceStats</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-110"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">U.Codebase.Branch</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">V2Branch</span></span><span>
</span><span id="line-111"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">U.Codebase.Causal</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">V2Causal</span></span><span>
</span><span id="line-112"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">U.Codebase.HashTags</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">BranchHash</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">CausalHash</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-113"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">U.Codebase.Projects</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Projects</span></span><span>
</span><span id="line-114"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">U.Codebase.Referent</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">V2Referent</span></span><span>
</span><span id="line-115"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">U.Codebase.Sqlite.Operations</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Operations</span></span><span>
</span><span id="line-116"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">U.Codebase.Sqlite.Operations</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Ops</span></span><span>
</span><span id="line-117"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.ABT</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">ABT</span></span><span>
</span><span id="line-118"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Builtin</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">B</span></span><span>
</span><span id="line-119"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Builtin.Decls</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Decls</span></span><span>
</span><span id="line-120"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Codebase</span></span><span class="hs-special">)</span><span>
</span><span id="line-121"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Codebase</span></span><span>
</span><span id="line-122"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.Branch</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Branch</span></span><span class="hs-special">)</span><span>
</span><span id="line-123"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.Branch</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Branch</span></span><span>
</span><span id="line-124"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.Branch.Names</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Branch</span></span><span>
</span><span id="line-125"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.Editor.DisplayObject</span></span><span>
</span><span id="line-126"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.Editor.DisplayObject</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">DisplayObject</span></span><span>
</span><span id="line-127"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.Path</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Path</span></span><span class="hs-special">)</span><span>
</span><span id="line-128"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.Path</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Path</span></span><span>
</span><span id="line-129"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.Runtime</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Rt</span></span><span>
</span><span id="line-130"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.ShortCausalHash</span></span><span>
</span><span id="line-131"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">ShortCausalHash</span></span><span class="hs-special">,</span><span>
</span><span id="line-132"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-133"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.ShortCausalHash</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SCH</span></span><span>
</span><span id="line-134"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.SqliteCodebase.Conversions</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Cv</span></span><span>
</span><span id="line-135"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.ConstructorReference</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">GConstructorReference</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-136"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.ConstructorReference</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">ConstructorReference</span></span><span>
</span><span id="line-137"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.ConstructorType</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">CT</span></span><span>
</span><span id="line-138"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.DataDeclaration</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">DD</span></span><span>
</span><span id="line-139"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.HashQualified</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HQ</span></span><span>
</span><span id="line-140"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.HashQualified'</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HQ'</span></span><span>
</span><span id="line-141"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Hashing.V2.Convert</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Hashing</span></span><span>
</span><span id="line-142"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.LabeledDependency</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">LD</span></span><span>
</span><span id="line-143"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Name</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Name</span></span><span class="hs-special">)</span><span>
</span><span id="line-144"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Name</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Name</span></span><span>
</span><span id="line-145"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.NameSegment</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">NameSegment</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-146"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.NameSegment</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NameSegment</span></span><span>
</span><span id="line-147"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Names</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Names</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Names</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-148"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Names</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Names</span></span><span>
</span><span id="line-149"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Names.Scoped</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">ScopedNames</span></span><span>
</span><span id="line-150"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.NamesWithHistory</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">NamesWithHistory</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-151"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.NamesWithHistory</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NamesWithHistory</span></span><span>
</span><span id="line-152"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Parser.Ann</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Ann</span></span><span class="hs-special">)</span><span>
</span><span id="line-153"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Prelude</span></span><span>
</span><span id="line-154"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.PrettyPrintEnv</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PPE</span></span><span>
</span><span id="line-155"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.PrettyPrintEnv.Util</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PPE</span></span><span>
</span><span id="line-156"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.PrettyPrintEnvDecl</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PPED</span></span><span>
</span><span id="line-157"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.PrettyPrintEnvDecl.Names</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PPED</span></span><span>
</span><span id="line-158"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Reference</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Reference</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">TermReference</span></span><span class="hs-special">)</span><span>
</span><span id="line-159"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Reference</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Reference</span></span><span>
</span><span id="line-160"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Referent</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Referent</span></span><span class="hs-special">)</span><span>
</span><span id="line-161"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Referent</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Referent</span></span><span>
</span><span id="line-162"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Runtime.IOSource</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">DD</span></span><span>
</span><span id="line-163"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Server.Doc.html"><span class="hs-identifier">Unison.Server.Doc</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Doc</span></span><span>
</span><span id="line-164"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Server.Doc.AsHtml.html"><span class="hs-identifier">Unison.Server.Doc.AsHtml</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">DocHtml</span></span><span>
</span><span id="line-165"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Server.NameSearch.html"><span class="hs-identifier">Unison.Server.NameSearch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.NameSearch.html#NameSearch"><span class="hs-identifier">NameSearch</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Server.NameSearch.html#Search"><span class="hs-identifier">Search</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Server.NameSearch.html#applySearch"><span class="hs-identifier">applySearch</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-166"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Server.NameSearch.FromNames.html"><span class="hs-identifier">Unison.Server.NameSearch.FromNames</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.NameSearch.FromNames.html#makeNameSearch"><span class="hs-identifier">makeNameSearch</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-167"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Server.NameSearch.Sqlite.html"><span class="hs-identifier">Unison.Server.NameSearch.Sqlite</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.NameSearch.Sqlite.html#termReferentsByShortHash"><span class="hs-identifier">termReferentsByShortHash</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Server.NameSearch.Sqlite.html#typeReferencesByShortHash"><span class="hs-identifier">typeReferencesByShortHash</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-168"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Server.QueryResult.html"><span class="hs-identifier">Unison.Server.QueryResult</span></a></span><span>
</span><span id="line-169"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Server.SearchResult.html"><span class="hs-identifier">Unison.Server.SearchResult</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SR</span></span><span>
</span><span id="line-170"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Server.SearchResult'.html"><span class="hs-identifier">Unison.Server.SearchResult'</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SR'</span></span><span>
</span><span id="line-171"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Server.Syntax.html"><span class="hs-identifier">Unison.Server.Syntax</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Syntax</span></span><span>
</span><span id="line-172"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Server.Types.html"><span class="hs-identifier">Unison.Server.Types</span></a></span><span>
</span><span id="line-173"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.ShortHash</span></span><span>
</span><span id="line-174"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.ShortHash</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SH</span></span><span>
</span><span id="line-175"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Sqlite</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Sqlite</span></span><span>
</span><span id="line-176"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Symbol</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Symbol</span></span><span class="hs-special">)</span><span>
</span><span id="line-177"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Syntax.DeclPrinter</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">DeclPrinter</span></span><span>
</span><span id="line-178"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Syntax.HashQualified</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HQ</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">toText</span></span><span class="hs-special">)</span><span>
</span><span id="line-179"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Syntax.HashQualified'</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HQ'</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">toText</span></span><span class="hs-special">)</span><span>
</span><span id="line-180"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Syntax.Name</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Name</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">toText</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">unsafeFromText</span></span><span class="hs-special">)</span><span>
</span><span id="line-181"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Syntax.NamePrinter</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NP</span></span><span>
</span><span id="line-182"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Syntax.TermPrinter</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TermPrinter</span></span><span>
</span><span id="line-183"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Syntax.TypePrinter</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TypePrinter</span></span><span>
</span><span id="line-184"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Term</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Term</span></span><span class="hs-special">)</span><span>
</span><span id="line-185"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Term</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Term</span></span><span>
</span><span id="line-186"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Type</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Type</span></span><span class="hs-special">)</span><span>
</span><span id="line-187"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Type</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Type</span></span><span>
</span><span id="line-188"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Typechecker</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Typechecker</span></span><span>
</span><span id="line-189"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.AnnotatedText</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">AnnotatedText</span></span><span class="hs-special">)</span><span>
</span><span id="line-190"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.List</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">uniqueBy</span></span><span class="hs-special">)</span><span>
</span><span id="line-191"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.Map</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-192"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.Monoid</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">foldMapM</span></span><span class="hs-special">)</span><span>
</span><span id="line-193"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.Monoid</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Monoid</span></span><span>
</span><span id="line-194"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.Pretty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Width</span></span><span class="hs-special">)</span><span>
</span><span id="line-195"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.Pretty</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Pretty</span></span><span>
</span><span id="line-196"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.Relation</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">R</span></span><span>
</span><span id="line-197"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.Set</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-198"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.SyntaxText</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">UST</span></span><span>
</span><span id="line-199"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Var</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Var</span></span><span class="hs-special">)</span><span>
</span><span id="line-200"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.WatchKind</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">WK</span></span><span>
</span><span id="line-201"></span><span>
</span><span id="line-202"></span><span class="hs-keyword">type</span><span> </span><span id="SyntaxText"><span class="annot"><a href="Unison.Server.Backend.html#SyntaxText"><span class="hs-identifier hs-var">SyntaxText</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">UST.SyntaxText'</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span>
</span><span id="line-203"></span><span>
</span><span id="line-204"></span><span id="local-6989586621679379048"><span id="local-6989586621679379049"></span></span><span class="hs-keyword">data</span><span> </span><span id="ShallowListEntry"><span class="annot"><a href="Unison.Server.Backend.html#ShallowListEntry"><span class="hs-identifier hs-var">ShallowListEntry</span></a></span></span><span> </span><span id="local-6989586621679380283"><span class="annot"><a href="#local-6989586621679380283"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span id="local-6989586621679380282"><span class="annot"><a href="#local-6989586621679380282"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-205"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="ShallowTermEntry"><span class="annot"><a href="Unison.Server.Backend.html#ShallowTermEntry"><span class="hs-identifier hs-var">ShallowTermEntry</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.Backend.html#TermEntry"><span class="hs-identifier hs-type">TermEntry</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679380283"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679380282"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-206"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="ShallowTypeEntry"><span class="annot"><a href="Unison.Server.Backend.html#ShallowTypeEntry"><span class="hs-identifier hs-var">ShallowTypeEntry</span></a></span></span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#TypeEntry"><span class="hs-identifier hs-type">TypeEntry</span></a></span><span>
</span><span id="line-207"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="ShallowBranchEntry"><span class="annot"><a href="Unison.Server.Backend.html#ShallowBranchEntry"><span class="hs-identifier hs-var">ShallowBranchEntry</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NameSegment</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CausalHash</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NamespaceStats</span></span><span>
</span><span id="line-208"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="ShallowPatchEntry"><span class="annot"><a href="Unison.Server.Backend.html#ShallowPatchEntry"><span class="hs-identifier hs-var">ShallowPatchEntry</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NameSegment</span></span><span>
</span><span id="line-209"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679379031"><span id="local-6989586621679379042"><span class="annot"><span class="annottext">ShallowListEntry v a -&gt; ShallowListEntry v a -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
forall v a.
Var v =&gt;
ShallowListEntry v a -&gt; ShallowListEntry v a -&gt; Bool
/= :: ShallowListEntry v a -&gt; ShallowListEntry v a -&gt; Bool
$c/= :: forall v a.
Var v =&gt;
ShallowListEntry v a -&gt; ShallowListEntry v a -&gt; Bool
== :: ShallowListEntry v a -&gt; ShallowListEntry v a -&gt; Bool
$c== :: forall v a.
Var v =&gt;
ShallowListEntry v a -&gt; ShallowListEntry v a -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679379005"><span id="local-6989586621679379007"><span id="local-6989586621679379009"><span id="local-6989586621679379011"><span id="local-6989586621679379013"><span id="local-6989586621679379015"><span id="local-6989586621679379026"><span class="annot"><span class="annottext">ShallowListEntry v a -&gt; ShallowListEntry v a -&gt; Ordering
forall a.
Eq a
-&gt; (a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
forall v a. Var v =&gt; Eq (ShallowListEntry v a)
forall v a.
Var v =&gt;
ShallowListEntry v a -&gt; ShallowListEntry v a -&gt; Bool
forall v a.
Var v =&gt;
ShallowListEntry v a -&gt; ShallowListEntry v a -&gt; Ordering
forall v a.
Var v =&gt;
ShallowListEntry v a
-&gt; ShallowListEntry v a -&gt; ShallowListEntry v a
min :: ShallowListEntry v a
-&gt; ShallowListEntry v a -&gt; ShallowListEntry v a
$cmin :: forall v a.
Var v =&gt;
ShallowListEntry v a
-&gt; ShallowListEntry v a -&gt; ShallowListEntry v a
max :: ShallowListEntry v a
-&gt; ShallowListEntry v a -&gt; ShallowListEntry v a
$cmax :: forall v a.
Var v =&gt;
ShallowListEntry v a
-&gt; ShallowListEntry v a -&gt; ShallowListEntry v a
&gt;= :: ShallowListEntry v a -&gt; ShallowListEntry v a -&gt; Bool
$c&gt;= :: forall v a.
Var v =&gt;
ShallowListEntry v a -&gt; ShallowListEntry v a -&gt; Bool
&gt; :: ShallowListEntry v a -&gt; ShallowListEntry v a -&gt; Bool
$c&gt; :: forall v a.
Var v =&gt;
ShallowListEntry v a -&gt; ShallowListEntry v a -&gt; Bool
&lt;= :: ShallowListEntry v a -&gt; ShallowListEntry v a -&gt; Bool
$c&lt;= :: forall v a.
Var v =&gt;
ShallowListEntry v a -&gt; ShallowListEntry v a -&gt; Bool
&lt; :: ShallowListEntry v a -&gt; ShallowListEntry v a -&gt; Bool
$c&lt; :: forall v a.
Var v =&gt;
ShallowListEntry v a -&gt; ShallowListEntry v a -&gt; Bool
compare :: ShallowListEntry v a -&gt; ShallowListEntry v a -&gt; Ordering
$ccompare :: forall v a.
Var v =&gt;
ShallowListEntry v a -&gt; ShallowListEntry v a -&gt; Ordering
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679378985"><span id="local-6989586621679378987"><span id="local-6989586621679379002"><span class="annot"><span class="annottext">Int -&gt; ShallowListEntry v a -&gt; ShowS
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; WatchKind) -&gt; ([a] -&gt; ShowS) -&gt; Show a
forall v a. Show v =&gt; Int -&gt; ShallowListEntry v a -&gt; ShowS
forall v a. Show v =&gt; [ShallowListEntry v a] -&gt; ShowS
forall v a. Show v =&gt; ShallowListEntry v a -&gt; WatchKind
showList :: [ShallowListEntry v a] -&gt; ShowS
$cshowList :: forall v a. Show v =&gt; [ShallowListEntry v a] -&gt; ShowS
show :: ShallowListEntry v a -&gt; WatchKind
$cshow :: forall v a. Show v =&gt; ShallowListEntry v a -&gt; WatchKind
showsPrec :: Int -&gt; ShallowListEntry v a -&gt; ShowS
$cshowsPrec :: forall v a. Show v =&gt; Int -&gt; ShallowListEntry v a -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
forall v a x. Rep (ShallowListEntry v a) x -&gt; ShallowListEntry v a
forall v a x. ShallowListEntry v a -&gt; Rep (ShallowListEntry v a) x
$cto :: forall v a x. Rep (ShallowListEntry v a) x -&gt; ShallowListEntry v a
$cfrom :: forall v a x. ShallowListEntry v a -&gt; Rep (ShallowListEntry v a) x
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></span><span class="hs-special">)</span><span>
</span><span id="line-210"></span><span>
</span><span id="line-211"></span><span id="local-6989586621679380274"><span id="local-6989586621679380275"><span class="annot"><a href="Unison.Server.Backend.html#listEntryName"><span class="hs-identifier hs-type">listEntryName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#ShallowListEntry"><span class="hs-identifier hs-type">ShallowListEntry</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679380275"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679380274"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span></span></span><span>
</span><span id="line-212"></span><span id="listEntryName"><span class="annot"><span class="annottext">listEntryName :: forall v a. ShallowListEntry v a -&gt; Text
</span><a href="Unison.Server.Backend.html#listEntryName"><span class="hs-identifier hs-var hs-var">listEntryName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-213"></span><span>  </span><span class="annot"><a href="Unison.Server.Backend.html#ShallowTermEntry"><span class="hs-identifier hs-type">ShallowTermEntry</span></a></span><span> </span><span id="local-6989586621679378978"><span class="annot"><span class="annottext">TermEntry v a
</span><a href="#local-6989586621679378978"><span class="hs-identifier hs-var">te</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall v a. TermEntry v a -&gt; Text
</span><a href="Unison.Server.Backend.html#termEntryDisplayName"><span class="hs-identifier hs-var">termEntryDisplayName</span></a></span><span> </span><span class="annot"><span class="annottext">TermEntry v a
</span><a href="#local-6989586621679378978"><span class="hs-identifier hs-var">te</span></a></span><span>
</span><span id="line-214"></span><span>  </span><span class="annot"><a href="Unison.Server.Backend.html#ShallowTypeEntry"><span class="hs-identifier hs-type">ShallowTypeEntry</span></a></span><span> </span><span id="local-6989586621679378977"><span class="annot"><span class="annottext">TypeEntry
</span><a href="#local-6989586621679378977"><span class="hs-identifier hs-var">te</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeEntry -&gt; Text
</span><a href="Unison.Server.Backend.html#typeEntryDisplayName"><span class="hs-identifier hs-var">typeEntryDisplayName</span></a></span><span> </span><span class="annot"><span class="annottext">TypeEntry
</span><a href="#local-6989586621679378977"><span class="hs-identifier hs-var">te</span></a></span><span>
</span><span id="line-215"></span><span>  </span><span class="annot"><a href="Unison.Server.Backend.html#ShallowBranchEntry"><span class="hs-identifier hs-type">ShallowBranchEntry</span></a></span><span> </span><span id="local-6989586621679378976"><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621679378976"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><span class="annottext">CausalHash
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">NamespaceStats
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NameSegment -&gt; Text
</span><span class="hs-identifier hs-var">NameSegment.toText</span></span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621679378976"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-216"></span><span>  </span><span class="annot"><a href="Unison.Server.Backend.html#ShallowPatchEntry"><span class="hs-identifier hs-type">ShallowPatchEntry</span></a></span><span> </span><span id="local-6989586621679378974"><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621679378974"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NameSegment -&gt; Text
</span><span class="hs-identifier hs-var">NameSegment.toText</span></span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621679378974"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-217"></span><span>
</span><span id="line-218"></span><span class="hs-keyword">data</span><span> </span><span id="BackendError"><span class="annot"><a href="Unison.Server.Backend.html#BackendError"><span class="hs-identifier hs-var">BackendError</span></a></span></span><span>
</span><span id="line-219"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="NoSuchNamespace"><span class="annot"><a href="Unison.Server.Backend.html#NoSuchNamespace"><span class="hs-identifier hs-var">NoSuchNamespace</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Path.Absolute</span></span><span>
</span><span id="line-220"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- Failed to parse path</span><span>
</span><span id="line-221"></span><span>    </span><span id="BadNamespace"><span class="annot"><a href="Unison.Server.Backend.html#BadNamespace"><span class="hs-identifier hs-var">BadNamespace</span></a></span></span><span>
</span><span id="line-222"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-223"></span><span>      </span><span class="hs-comment">-- ^ error message</span><span>
</span><span id="line-224"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-225"></span><span>      </span><span class="hs-comment">-- ^ namespace</span><span>
</span><span id="line-226"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="CouldntExpandBranchHash"><span class="annot"><a href="Unison.Server.Backend.html#CouldntExpandBranchHash"><span class="hs-identifier hs-var">CouldntExpandBranchHash</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ShortCausalHash</span></span><span>
</span><span id="line-227"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="AmbiguousBranchHash"><span class="annot"><a href="Unison.Server.Backend.html#AmbiguousBranchHash"><span class="hs-identifier hs-var">AmbiguousBranchHash</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ShortCausalHash</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ShortCausalHash</span></span><span class="hs-special">)</span><span>
</span><span id="line-228"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="AmbiguousHashForDefinition"><span class="annot"><a href="Unison.Server.Backend.html#AmbiguousHashForDefinition"><span class="hs-identifier hs-var">AmbiguousHashForDefinition</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ShortHash</span></span><span>
</span><span id="line-229"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="NoBranchForHash"><span class="annot"><a href="Unison.Server.Backend.html#NoBranchForHash"><span class="hs-identifier hs-var">NoBranchForHash</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CausalHash</span></span><span>
</span><span id="line-230"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="CouldntLoadBranch"><span class="annot"><a href="Unison.Server.Backend.html#CouldntLoadBranch"><span class="hs-identifier hs-var">CouldntLoadBranch</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CausalHash</span></span><span>
</span><span id="line-231"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="MissingSignatureForTerm"><span class="annot"><a href="Unison.Server.Backend.html#MissingSignatureForTerm"><span class="hs-identifier hs-var">MissingSignatureForTerm</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span>
</span><span id="line-232"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="NoSuchDefinition"><span class="annot"><a href="Unison.Server.Backend.html#NoSuchDefinition"><span class="hs-identifier hs-var">NoSuchDefinition</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HQ.HashQualified</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span>
</span><span id="line-233"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- We needed a name lookup index we didn't have.</span><span>
</span><span id="line-234"></span><span>    </span><span id="ExpectedNameLookup"><span class="annot"><a href="Unison.Server.Backend.html#ExpectedNameLookup"><span class="hs-identifier hs-var">ExpectedNameLookup</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">BranchHash</span></span><span>
</span><span id="line-235"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- The inferred project root for a given perspective is neither a parent nor child</span><span>
</span><span id="line-236"></span><span>    </span><span class="hs-comment">-- of the perspective. This shouldn't happen and indicates a bug.</span><span>
</span><span id="line-237"></span><span>    </span><span class="hs-comment">-- (perspective, project root)</span><span>
</span><span id="line-238"></span><span>    </span><span id="DisjointProjectAndPerspective"><span class="annot"><a href="Unison.Server.Backend.html#DisjointProjectAndPerspective"><span class="hs-identifier hs-var">DisjointProjectAndPerspective</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Path</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Path</span></span><span>
</span><span id="line-239"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679378921"><span id="local-6989586621679378923"><span id="local-6989586621679378961"><span class="annot"><span class="annottext">Int -&gt; BackendError -&gt; ShowS
[BackendError] -&gt; ShowS
BackendError -&gt; WatchKind
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; WatchKind) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [BackendError] -&gt; ShowS
$cshowList :: [BackendError] -&gt; ShowS
show :: BackendError -&gt; WatchKind
$cshow :: BackendError -&gt; WatchKind
showsPrec :: Int -&gt; BackendError -&gt; ShowS
$cshowsPrec :: Int -&gt; BackendError -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-240"></span><span>
</span><span id="line-241"></span><span class="hs-keyword">newtype</span><span> </span><span id="BackendEnv"><span class="annot"><a href="Unison.Server.Backend.html#BackendEnv"><span class="hs-identifier hs-var">BackendEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="BackendEnv"><span class="annot"><a href="Unison.Server.Backend.html#BackendEnv"><span class="hs-identifier hs-var">BackendEnv</span></a></span></span><span>
</span><span id="line-242"></span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- | Whether to use the sqlite name-lookup table to generate Names objects rather than building Names from the root branch.</span><span>
</span><span id="line-243"></span><span>    </span><span id="%24sel%3AuseNamesIndex%3ABackendEnv"><span class="annot"><span class="annottext">BackendEnv -&gt; Bool
</span><a href="Unison.Server.Backend.html#%24sel%3AuseNamesIndex%3ABackendEnv"><span class="hs-identifier hs-var hs-var">useNamesIndex</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-244"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-245"></span><span>
</span><span id="line-246"></span><span class="hs-keyword">newtype</span><span> </span><span id="Backend"><span class="annot"><a href="Unison.Server.Backend.html#Backend"><span class="hs-identifier hs-var">Backend</span></a></span></span><span> </span><span id="local-6989586621679380290"><span class="annot"><a href="#local-6989586621679380290"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679380263"><span class="annot"><a href="#local-6989586621679380263"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Backend"><span class="annot"><a href="Unison.Server.Backend.html#Backend"><span class="hs-identifier hs-var">Backend</span></a></span></span><span> </span><span class="hs-special">{</span><span id="%24sel%3ArunBackend%3ABackend"><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
Backend m a -&gt; ReaderT BackendEnv (ExceptT BackendError m) a
</span><a href="Unison.Server.Backend.html#%24sel%3ArunBackend%3ABackend"><span class="hs-identifier hs-var hs-var">runBackend</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ReaderT</span></span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#BackendEnv"><span class="hs-identifier hs-type">BackendEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ExceptT</span></span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#BackendError"><span class="hs-identifier hs-type">BackendError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679380290"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679380263"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-247"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">newtype</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679378906"><span id="local-6989586621679378912"><span class="annot"><span class="annottext">forall a b. a -&gt; Backend m b -&gt; Backend m a
forall a b. (a -&gt; b) -&gt; Backend m a -&gt; Backend m b
forall (m :: * -&gt; *) a b.
Functor m =&gt;
a -&gt; Backend m b -&gt; Backend m a
forall (m :: * -&gt; *) a b.
Functor m =&gt;
(a -&gt; b) -&gt; Backend m a -&gt; Backend m b
forall (f :: * -&gt; *).
(forall a b. (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b. a -&gt; f b -&gt; f a) -&gt; Functor f
&lt;$ :: forall a b. a -&gt; Backend m b -&gt; Backend m a
$c&lt;$ :: forall (m :: * -&gt; *) a b.
Functor m =&gt;
a -&gt; Backend m b -&gt; Backend m a
fmap :: forall a b. (a -&gt; b) -&gt; Backend m a -&gt; Backend m b
$cfmap :: forall (m :: * -&gt; *) a b.
Functor m =&gt;
(a -&gt; b) -&gt; Backend m a -&gt; Backend m b
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Functor</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679378874"><span id="local-6989586621679378879"><span id="local-6989586621679378884"><span id="local-6989586621679378889"><span id="local-6989586621679378895"><span class="annot"><span class="annottext">forall a. a -&gt; Backend m a
forall a b. Backend m a -&gt; Backend m b -&gt; Backend m a
forall a b. Backend m a -&gt; Backend m b -&gt; Backend m b
forall a b. Backend m (a -&gt; b) -&gt; Backend m a -&gt; Backend m b
forall a b c.
(a -&gt; b -&gt; c) -&gt; Backend m a -&gt; Backend m b -&gt; Backend m c
forall {m :: * -&gt; *}. Monad m =&gt; Functor (Backend m)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; Backend m a
forall (m :: * -&gt; *) a b.
Monad m =&gt;
Backend m a -&gt; Backend m b -&gt; Backend m a
forall (m :: * -&gt; *) a b.
Monad m =&gt;
Backend m a -&gt; Backend m b -&gt; Backend m b
forall (m :: * -&gt; *) a b.
Monad m =&gt;
Backend m (a -&gt; b) -&gt; Backend m a -&gt; Backend m b
forall (m :: * -&gt; *) a b c.
Monad m =&gt;
(a -&gt; b -&gt; c) -&gt; Backend m a -&gt; Backend m b -&gt; Backend m c
forall (f :: * -&gt; *).
Functor f
-&gt; (forall a. a -&gt; f a)
-&gt; (forall a b. f (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b c. (a -&gt; b -&gt; c) -&gt; f a -&gt; f b -&gt; f c)
-&gt; (forall a b. f a -&gt; f b -&gt; f b)
-&gt; (forall a b. f a -&gt; f b -&gt; f a)
-&gt; Applicative f
&lt;* :: forall a b. Backend m a -&gt; Backend m b -&gt; Backend m a
$c&lt;* :: forall (m :: * -&gt; *) a b.
Monad m =&gt;
Backend m a -&gt; Backend m b -&gt; Backend m a
*&gt; :: forall a b. Backend m a -&gt; Backend m b -&gt; Backend m b
$c*&gt; :: forall (m :: * -&gt; *) a b.
Monad m =&gt;
Backend m a -&gt; Backend m b -&gt; Backend m b
liftA2 :: forall a b c.
(a -&gt; b -&gt; c) -&gt; Backend m a -&gt; Backend m b -&gt; Backend m c
$cliftA2 :: forall (m :: * -&gt; *) a b c.
Monad m =&gt;
(a -&gt; b -&gt; c) -&gt; Backend m a -&gt; Backend m b -&gt; Backend m c
&lt;*&gt; :: forall a b. Backend m (a -&gt; b) -&gt; Backend m a -&gt; Backend m b
$c&lt;*&gt; :: forall (m :: * -&gt; *) a b.
Monad m =&gt;
Backend m (a -&gt; b) -&gt; Backend m a -&gt; Backend m b
pure :: forall a. a -&gt; Backend m a
$cpure :: forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; Backend m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Applicative</span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679378850"><span id="local-6989586621679378855"><span id="local-6989586621679378861"><span class="annot"><span class="annottext">forall a. a -&gt; Backend m a
forall a b. Backend m a -&gt; Backend m b -&gt; Backend m b
forall a b. Backend m a -&gt; (a -&gt; Backend m b) -&gt; Backend m b
forall (m :: * -&gt; *). Monad m =&gt; Applicative (Backend m)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; Backend m a
forall (m :: * -&gt; *) a b.
Monad m =&gt;
Backend m a -&gt; Backend m b -&gt; Backend m b
forall (m :: * -&gt; *) a b.
Monad m =&gt;
Backend m a -&gt; (a -&gt; Backend m b) -&gt; Backend m b
forall (m :: * -&gt; *).
Applicative m
-&gt; (forall a b. m a -&gt; (a -&gt; m b) -&gt; m b)
-&gt; (forall a b. m a -&gt; m b -&gt; m b)
-&gt; (forall a. a -&gt; m a)
-&gt; Monad m
return :: forall a. a -&gt; Backend m a
$creturn :: forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; Backend m a
&gt;&gt; :: forall a b. Backend m a -&gt; Backend m b -&gt; Backend m b
$c&gt;&gt; :: forall (m :: * -&gt; *) a b.
Monad m =&gt;
Backend m a -&gt; Backend m b -&gt; Backend m b
&gt;&gt;= :: forall a b. Backend m a -&gt; (a -&gt; Backend m b) -&gt; Backend m b
$c&gt;&gt;= :: forall (m :: * -&gt; *) a b.
Monad m =&gt;
Backend m a -&gt; (a -&gt; Backend m b) -&gt; Backend m b
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Monad</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679378839"><span class="annot"><span class="annottext">forall a. IO a -&gt; Backend m a
forall (m :: * -&gt; *).
Monad m -&gt; (forall a. IO a -&gt; m a) -&gt; MonadIO m
forall {m :: * -&gt; *}. MonadIO m =&gt; Monad (Backend m)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; Backend m a
liftIO :: forall a. IO a -&gt; Backend m a
$cliftIO :: forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; Backend m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">MonadIO</span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679378816"><span id="local-6989586621679378821"><span id="local-6989586621679378827"><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#BackendEnv"><span class="hs-identifier hs-type">BackendEnv</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679378800"><span id="local-6989586621679378806"><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#BackendError"><span class="hs-identifier hs-type">BackendError</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-248"></span><span>
</span><span id="line-249"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadTrans</span></span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-250"></span><span>  </span><span id="local-6989586621679378785"><span class="annot"><span class="annottext">lift :: forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; Backend m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">lift</span></span></span><span> </span><span id="local-6989586621679378783"><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621679378783"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
ReaderT BackendEnv (ExceptT BackendError m) a -&gt; Backend m a
</span><a href="Unison.Server.Backend.html#Backend"><span class="hs-identifier hs-var">Backend</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621679378783"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-251"></span><span>
</span><span id="line-252"></span><span id="local-6989586621679380156"><span id="local-6989586621679380157"><span id="local-6989586621679380159"><span class="annot"><a href="Unison.Server.Backend.html#hoistBackend"><span class="hs-identifier hs-type">hoistBackend</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679380158"><span class="annot"><a href="#local-6989586621679380158"><span class="hs-identifier hs-type">x</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="#local-6989586621679380159"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679380158"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679380157"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679380158"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679380159"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679380156"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679380157"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679380156"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-253"></span><span id="hoistBackend"><span class="annot"><span class="annottext">hoistBackend :: forall (m :: * -&gt; *) (n :: * -&gt; *) a.
(forall x. m x -&gt; n x) -&gt; Backend m a -&gt; Backend n a
</span><a href="Unison.Server.Backend.html#hoistBackend"><span class="hs-identifier hs-var hs-var">hoistBackend</span></a></span></span><span> </span><span id="local-6989586621679378781"><span class="annot"><span class="annottext">forall x. m x -&gt; n x
</span><a href="#local-6989586621679378781"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span id="local-6989586621679378780"><span class="annot"><span class="annottext">ReaderT BackendEnv (ExceptT BackendError m) a
</span><a href="#local-6989586621679378780"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-254"></span><span>  </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
ReaderT BackendEnv (ExceptT BackendError m) a -&gt; Backend m a
</span><a href="Unison.Server.Backend.html#Backend"><span class="hs-identifier hs-var">Backend</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a (n :: * -&gt; *) b r.
(m a -&gt; n b) -&gt; ReaderT r m a -&gt; ReaderT r n b
</span><span class="hs-identifier hs-var">mapReaderT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) e a (n :: * -&gt; *) e' b.
(m (Either e a) -&gt; n (Either e' b))
-&gt; ExceptT e m a -&gt; ExceptT e' n b
</span><span class="hs-identifier hs-var">mapExceptT</span></span><span> </span><span class="annot"><span class="annottext">forall x. m x -&gt; n x
</span><a href="#local-6989586621679378781"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ReaderT BackendEnv (ExceptT BackendError m) a
</span><a href="#local-6989586621679378780"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-255"></span><span>
</span><span id="line-256"></span><span class="annot"><a href="Unison.Server.Backend.html#suffixifyNames"><span class="hs-identifier hs-type">suffixifyNames</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Names</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PPE.PrettyPrintEnv</span></span><span>
</span><span id="line-257"></span><span id="suffixifyNames"><span class="annot"><span class="annottext">suffixifyNames :: Int -&gt; Names -&gt; PrettyPrintEnv
</span><a href="Unison.Server.Backend.html#suffixifyNames"><span class="hs-identifier hs-var hs-var">suffixifyNames</span></a></span></span><span> </span><span id="local-6989586621679378776"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679378776"><span class="hs-identifier hs-var">hashLength</span></a></span></span><span> </span><span id="local-6989586621679378775"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679378775"><span class="hs-identifier hs-var">names</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-258"></span><span>  </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl -&gt; PrettyPrintEnv
</span><span class="hs-identifier hs-var">PPED.suffixifiedPPE</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; NamesWithHistory -&gt; PrettyPrintEnvDecl
</span><span class="hs-identifier hs-var">PPED.fromNamesDecl</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679378776"><span class="hs-identifier hs-var">hashLength</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Names -&gt; NamesWithHistory
</span><span class="hs-identifier hs-var">NamesWithHistory.fromCurrentNames</span></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679378775"><span class="hs-identifier hs-var">names</span></a></span><span>
</span><span id="line-259"></span><span>
</span><span id="line-260"></span><span class="hs-comment">-- implementation detail of parseNamesForBranch and prettyNamesForBranch</span><span>
</span><span id="line-261"></span><span class="hs-comment">-- Returns (parseNames, prettyNames, localNames)</span><span>
</span><span id="line-262"></span><span id="local-6989586621679380138"><span class="annot"><a href="Unison.Server.Backend.html#namesForBranch"><span class="hs-identifier hs-type">namesForBranch</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Branch</span></span><span> </span><span class="annot"><a href="#local-6989586621679380138"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#NameScoping"><span class="hs-identifier hs-type">NameScoping</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Names</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Names</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Names</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-263"></span><span id="namesForBranch"><span class="annot"><span class="annottext">namesForBranch :: forall (m :: * -&gt; *).
Branch m -&gt; NameScoping -&gt; (Names, Names, Names)
</span><a href="Unison.Server.Backend.html#namesForBranch"><span class="hs-identifier hs-var hs-var">namesForBranch</span></a></span></span><span> </span><span id="local-6989586621679378768"><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621679378768"><span class="hs-identifier hs-var">root</span></a></span></span><span> </span><span id="local-6989586621679378767"><span class="annot"><span class="annottext">NameScoping
</span><a href="#local-6989586621679378767"><span class="hs-identifier hs-var">scope</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-264"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679378766"><span class="hs-identifier hs-var">parseNames0</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679378765"><span class="hs-identifier hs-var">prettyPrintNames0</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679378764"><span class="hs-identifier hs-var">currentPathNames</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-265"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-266"></span><span>    </span><span class="annot"><a href="#local-6989586621679378763"><span class="hs-identifier hs-type">path</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Path</span></span><span>
</span><span id="line-267"></span><span>    </span><span class="annot"><a href="#local-6989586621679378762"><span class="hs-identifier hs-type">includeAllNames</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-268"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679378763"><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679378763"><span class="hs-identifier hs-var">path</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679378762"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679378762"><span class="hs-identifier hs-var">includeAllNames</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">NameScoping
</span><a href="#local-6989586621679378767"><span class="hs-identifier hs-var">scope</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-269"></span><span>      </span><span class="annot"><a href="Unison.Server.Backend.html#AllNames"><span class="hs-identifier hs-type">AllNames</span></a></span><span> </span><span id="local-6989586621679378760"><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679378760"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679378760"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span>
</span><span id="line-270"></span><span>      </span><span class="annot"><a href="Unison.Server.Backend.html#Within"><span class="hs-identifier hs-type">Within</span></a></span><span> </span><span id="local-6989586621679378758"><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679378758"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679378758"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span>
</span><span id="line-271"></span><span>      </span><span class="annot"><a href="Unison.Server.Backend.html#WithinStrict"><span class="hs-identifier hs-type">WithinStrict</span></a></span><span> </span><span id="local-6989586621679378756"><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679378756"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679378756"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span>
</span><span id="line-272"></span><span>    </span><span id="local-6989586621679378755"><span class="annot"><span class="annottext">root0 :: Branch0 m
</span><a href="#local-6989586621679378755"><span class="hs-identifier hs-var hs-var">root0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Branch m -&gt; Branch0 m
</span><span class="hs-identifier hs-var">Branch.head</span></span><span> </span><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621679378768"><span class="hs-identifier hs-var">root</span></a></span><span>
</span><span id="line-273"></span><span>    </span><span id="local-6989586621679378753"><span class="annot"><span class="annottext">currentBranch :: Branch m
</span><a href="#local-6989586621679378753"><span class="hs-identifier hs-var hs-var">currentBranch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Branch m
</span><span class="hs-identifier hs-var">Branch.empty</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Path -&gt; Branch m -&gt; Maybe (Branch m)
</span><span class="hs-identifier hs-var">Branch.getAt</span></span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679378763"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621679378768"><span class="hs-identifier hs-var">root</span></a></span><span>
</span><span id="line-274"></span><span>    </span><span id="local-6989586621679378749"><span class="annot"><span class="annottext">absoluteRootNames :: Names
</span><a href="#local-6989586621679378749"><span class="hs-identifier hs-var hs-var">absoluteRootNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Names -&gt; Names
</span><span class="hs-identifier hs-var">Names.makeAbsolute</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Branch0 m -&gt; Names
</span><span class="hs-identifier hs-var">Branch.toNames</span></span><span> </span><span class="annot"><span class="annottext">Branch0 m
</span><a href="#local-6989586621679378755"><span class="hs-identifier hs-var">root0</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-275"></span><span>    </span><span id="local-6989586621679378746"><span class="annot"><span class="annottext">currentBranch0 :: Branch0 m
</span><a href="#local-6989586621679378746"><span class="hs-identifier hs-var hs-var">currentBranch0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Branch m -&gt; Branch0 m
</span><span class="hs-identifier hs-var">Branch.head</span></span><span> </span><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621679378753"><span class="hs-identifier hs-var">currentBranch</span></a></span><span>
</span><span id="line-276"></span><span>    </span><span id="local-6989586621679378764"><span class="annot"><span class="annottext">currentPathNames :: Names
</span><a href="#local-6989586621679378764"><span class="hs-identifier hs-var hs-var">currentPathNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Branch0 m -&gt; Names
</span><span class="hs-identifier hs-var">Branch.toNames</span></span><span> </span><span class="annot"><span class="annottext">Branch0 m
</span><a href="#local-6989586621679378746"><span class="hs-identifier hs-var">currentBranch0</span></a></span><span>
</span><span id="line-277"></span><span>    </span><span class="hs-comment">-- all names, but with local names in their relative form only, rather</span><span>
</span><span id="line-278"></span><span>    </span><span class="hs-comment">-- than absolute; external names appear as absolute</span><span>
</span><span id="line-279"></span><span>    </span><span id="local-6989586621679378745"><span class="annot"><span class="annottext">currentAndExternalNames :: Names
</span><a href="#local-6989586621679378745"><span class="hs-identifier hs-var hs-var">currentAndExternalNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-280"></span><span>      </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679378764"><span class="hs-identifier hs-var">currentPathNames</span></a></span><span>
</span><span id="line-281"></span><span>        </span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; Names
</span><span class="hs-operator hs-var">`Names.unionLeft`</span></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Name) -&gt; Names -&gt; Names
</span><span class="hs-identifier hs-var">Names.mapNames</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name
</span><span class="hs-identifier hs-var">Name.makeAbsolute</span></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679378741"><span class="hs-identifier hs-var">externalNames</span></a></span><span>
</span><span id="line-282"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-283"></span><span>        </span><span id="local-6989586621679378741"><span class="annot"><span class="annottext">externalNames :: Names
</span><a href="#local-6989586621679378741"><span class="hs-identifier hs-var hs-var">externalNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679378740"><span class="hs-identifier hs-var">rootNames</span></a></span><span> </span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; Names
</span><span class="hs-operator hs-var">`Names.difference`</span></span><span> </span><span class="annot"><span class="annottext">Names -&gt; Names
</span><a href="#local-6989586621679378738"><span class="hs-identifier hs-var">pathPrefixed</span></a></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679378764"><span class="hs-identifier hs-var">currentPathNames</span></a></span><span>
</span><span id="line-284"></span><span>        </span><span id="local-6989586621679378740"><span class="annot"><span class="annottext">rootNames :: Names
</span><a href="#local-6989586621679378740"><span class="hs-identifier hs-var hs-var">rootNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Branch0 m -&gt; Names
</span><span class="hs-identifier hs-var">Branch.toNames</span></span><span> </span><span class="annot"><span class="annottext">Branch0 m
</span><a href="#local-6989586621679378755"><span class="hs-identifier hs-var">root0</span></a></span><span>
</span><span id="line-285"></span><span>        </span><span id="local-6989586621679378738"><span class="annot"><span class="annottext">pathPrefixed :: Names -&gt; Names
</span><a href="#local-6989586621679378738"><span class="hs-identifier hs-var hs-var">pathPrefixed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Path -&gt; Maybe Name
</span><span class="hs-identifier hs-var">Path.toName</span></span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679378763"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-286"></span><span>          </span><span class="annot"><span class="annottext">Maybe Name
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-287"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679378734"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679378734"><span class="hs-identifier hs-var">pathName</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Names -&gt; Names
</span><span class="hs-identifier hs-var">Names.prefix0</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679378734"><span class="hs-identifier hs-var">pathName</span></a></span><span>
</span><span id="line-288"></span><span>    </span><span class="hs-comment">-- parsing should respond to local and absolute names</span><span>
</span><span id="line-289"></span><span>    </span><span id="local-6989586621679378766"><span class="annot"><span class="annottext">parseNames0 :: Names
</span><a href="#local-6989586621679378766"><span class="hs-identifier hs-var hs-var">parseNames0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679378764"><span class="hs-identifier hs-var">currentPathNames</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; Bool -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">Monoid.whenM</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679378762"><span class="hs-identifier hs-var">includeAllNames</span></a></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679378749"><span class="hs-identifier hs-var">absoluteRootNames</span></a></span><span>
</span><span id="line-290"></span><span>    </span><span class="hs-comment">-- pretty-printing should use local names where available</span><span>
</span><span id="line-291"></span><span>    </span><span id="local-6989586621679378765"><span class="annot"><span class="annottext">prettyPrintNames0 :: Names
</span><a href="#local-6989586621679378765"><span class="hs-identifier hs-var hs-var">prettyPrintNames0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-292"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679378762"><span class="hs-identifier hs-var">includeAllNames</span></a></span><span>
</span><span id="line-293"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679378745"><span class="hs-identifier hs-var">currentAndExternalNames</span></a></span><span>
</span><span id="line-294"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679378764"><span class="hs-identifier hs-var">currentPathNames</span></a></span><span>
</span><span id="line-295"></span><span>
</span><span id="line-296"></span><span id="local-6989586621679380123"><span class="annot"><a href="Unison.Server.Backend.html#basicSuffixifiedNames"><span class="hs-identifier hs-type">basicSuffixifiedNames</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Branch</span></span><span> </span><span class="annot"><a href="#local-6989586621679380123"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#NameScoping"><span class="hs-identifier hs-type">NameScoping</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PPE.PrettyPrintEnv</span></span></span><span>
</span><span id="line-297"></span><span id="basicSuffixifiedNames"><span class="annot"><span class="annottext">basicSuffixifiedNames :: forall (m :: * -&gt; *).
Int -&gt; Branch m -&gt; NameScoping -&gt; PrettyPrintEnv
</span><a href="Unison.Server.Backend.html#basicSuffixifiedNames"><span class="hs-identifier hs-var hs-var">basicSuffixifiedNames</span></a></span></span><span> </span><span id="local-6989586621679378731"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679378731"><span class="hs-identifier hs-var">hashLength</span></a></span></span><span> </span><span id="local-6989586621679378730"><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621679378730"><span class="hs-identifier hs-var">root</span></a></span></span><span> </span><span id="local-6989586621679378729"><span class="annot"><span class="annottext">NameScoping
</span><a href="#local-6989586621679378729"><span class="hs-identifier hs-var">nameScope</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-298"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679378728"><span class="annot"><span class="annottext">names0 :: Names
</span><a href="#local-6989586621679378728"><span class="hs-identifier hs-var hs-var">names0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Branch m -&gt; NameScoping -&gt; Names
</span><a href="Unison.Server.Backend.html#prettyNamesForBranch"><span class="hs-identifier hs-var">prettyNamesForBranch</span></a></span><span> </span><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621679378730"><span class="hs-identifier hs-var">root</span></a></span><span> </span><span class="annot"><span class="annottext">NameScoping
</span><a href="#local-6989586621679378729"><span class="hs-identifier hs-var">nameScope</span></a></span><span>
</span><span id="line-299"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Names -&gt; PrettyPrintEnv
</span><a href="Unison.Server.Backend.html#suffixifyNames"><span class="hs-identifier hs-var">suffixifyNames</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679378731"><span class="hs-identifier hs-var">hashLength</span></a></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679378728"><span class="hs-identifier hs-var">names0</span></a></span><span>
</span><span id="line-300"></span><span>
</span><span id="line-301"></span><span id="local-6989586621679378727"><span class="annot"><a href="Unison.Server.Backend.html#parseNamesForBranch"><span class="hs-identifier hs-type">parseNamesForBranch</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Branch</span></span><span> </span><span class="annot"><a href="#local-6989586621679378727"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#NameScoping"><span class="hs-identifier hs-type">NameScoping</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Names</span></span></span><span>
</span><span id="line-302"></span><span id="parseNamesForBranch"><span class="annot"><span class="annottext">parseNamesForBranch :: forall (m :: * -&gt; *). Branch m -&gt; NameScoping -&gt; Names
</span><a href="Unison.Server.Backend.html#parseNamesForBranch"><span class="hs-identifier hs-var hs-var">parseNamesForBranch</span></a></span></span><span> </span><span id="local-6989586621679378724"><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621679378724"><span class="hs-identifier hs-var">root</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
Branch m -&gt; NameScoping -&gt; (Names, Names, Names)
</span><a href="Unison.Server.Backend.html#namesForBranch"><span class="hs-identifier hs-var">namesForBranch</span></a></span><span> </span><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621679378724"><span class="hs-identifier hs-var">root</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679378722"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679378722"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Names
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Names
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679378722"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-303"></span><span>
</span><span id="line-304"></span><span id="local-6989586621679380121"><span class="annot"><a href="Unison.Server.Backend.html#prettyNamesForBranch"><span class="hs-identifier hs-type">prettyNamesForBranch</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Branch</span></span><span> </span><span class="annot"><a href="#local-6989586621679380121"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#NameScoping"><span class="hs-identifier hs-type">NameScoping</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Names</span></span></span><span>
</span><span id="line-305"></span><span id="prettyNamesForBranch"><span class="annot"><span class="annottext">prettyNamesForBranch :: forall (m :: * -&gt; *). Branch m -&gt; NameScoping -&gt; Names
</span><a href="Unison.Server.Backend.html#prettyNamesForBranch"><span class="hs-identifier hs-var hs-var">prettyNamesForBranch</span></a></span></span><span> </span><span id="local-6989586621679378720"><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621679378720"><span class="hs-identifier hs-var">root</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
Branch m -&gt; NameScoping -&gt; (Names, Names, Names)
</span><a href="Unison.Server.Backend.html#namesForBranch"><span class="hs-identifier hs-var">namesForBranch</span></a></span><span> </span><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621679378720"><span class="hs-identifier hs-var">root</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Names
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679378719"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679378719"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Names
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679378719"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-306"></span><span>
</span><span id="line-307"></span><span id="local-6989586621679380112"><span id="local-6989586621679380113"><span id="local-6989586621679380114"><span class="annot"><a href="Unison.Server.Backend.html#shallowPPE"><span class="hs-identifier hs-type">shallowPPE</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679380114"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><a href="#local-6989586621679380114"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679380113"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679380112"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">V2Branch.Branch</span></span><span> </span><span class="annot"><a href="#local-6989586621679380114"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679380114"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">PPE.PrettyPrintEnv</span></span></span></span></span><span>
</span><span id="line-308"></span><span id="shallowPPE"><span class="annot"><span class="annottext">shallowPPE :: forall (m :: * -&gt; *) v a.
MonadIO m =&gt;
Codebase m v a -&gt; Branch m -&gt; m PrettyPrintEnv
</span><a href="Unison.Server.Backend.html#shallowPPE"><span class="hs-identifier hs-var hs-var">shallowPPE</span></a></span></span><span> </span><span id="local-6989586621679378708"><span class="annot"><span class="annottext">Codebase m v a
</span><a href="#local-6989586621679378708"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621679378707"><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621679378707"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-309"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679378706"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679378706"><span class="hs-identifier hs-var">hashLength</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679378705"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679378705"><span class="hs-identifier hs-var">names</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) v a b.
MonadIO m =&gt;
Codebase m v a -&gt; Transaction b -&gt; m b
</span><span class="hs-identifier hs-var">Codebase.runTransaction</span></span><span> </span><span class="annot"><span class="annottext">Codebase m v a
</span><a href="#local-6989586621679378708"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-310"></span><span>    </span><span id="local-6989586621679378703"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679378703"><span class="hs-identifier hs-var">hl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Transaction Int
</span><span class="hs-identifier hs-var">Codebase.hashLength</span></span><span>
</span><span id="line-311"></span><span>    </span><span id="local-6989586621679378701"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679378701"><span class="hs-identifier hs-var">names</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) v a.
Monad m =&gt;
Codebase m v a -&gt; Branch m -&gt; Transaction Names
</span><a href="Unison.Server.Backend.html#shallowNames"><span class="hs-identifier hs-var">shallowNames</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase m v a
</span><a href="#local-6989586621679378708"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621679378707"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-312"></span><span>    </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679378703"><span class="hs-identifier hs-var">hl</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679378701"><span class="hs-identifier hs-var">names</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-313"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl -&gt; PrettyPrintEnv
</span><span class="hs-identifier hs-var">PPED.suffixifiedPPE</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; NamesWithHistory -&gt; PrettyPrintEnvDecl
</span><span class="hs-identifier hs-var">PPED.fromNamesDecl</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679378706"><span class="hs-identifier hs-var">hashLength</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; NamesWithHistory
</span><span class="hs-identifier hs-var">NamesWithHistory</span></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679378705"><span class="hs-identifier hs-var">names</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-314"></span><span>
</span><span id="line-315"></span><span class="hs-comment">-- | A 'Names' which only includes mappings for things _directly_ accessible from the branch.</span><span>
</span><span id="line-316"></span><span class="hs-comment">--</span><span>
</span><span id="line-317"></span><span class="hs-comment">-- I.e. names in nested children are omitted.</span><span>
</span><span id="line-318"></span><span class="hs-comment">-- This should probably live elsewhere, but the package dependency graph makes it hard to find</span><span>
</span><span id="line-319"></span><span class="hs-comment">-- a good place.</span><span>
</span><span id="line-320"></span><span class="annot"><a href="Unison.Server.Backend.html#shallowNames"><span class="hs-identifier hs-type">shallowNames</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679380102"><span class="annot"><a href="#local-6989586621679380102"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679380101"><span class="annot"><a href="#local-6989586621679380101"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span id="local-6989586621679380100"><span class="annot"><a href="#local-6989586621679380100"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679380102"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><a href="#local-6989586621679380102"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679380101"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679380100"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">V2Branch.Branch</span></span><span> </span><span class="annot"><a href="#local-6989586621679380102"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Sqlite.Transaction</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Names</span></span><span>
</span><span id="line-321"></span><span id="shallowNames"><span class="annot"><span class="annottext">shallowNames :: forall (m :: * -&gt; *) v a.
Monad m =&gt;
Codebase m v a -&gt; Branch m -&gt; Transaction Names
</span><a href="Unison.Server.Backend.html#shallowNames"><span class="hs-identifier hs-var hs-var">shallowNames</span></a></span></span><span> </span><span id="local-6989586621679378676"><span class="annot"><span class="annottext">Codebase m v a
</span><a href="#local-6989586621679378676"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621679378675"><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621679378675"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-322"></span><span>  </span><span id="local-6989586621679378674"><span class="annot"><span class="annottext">Map Name (Set Referent)
</span><a href="#local-6989586621679378674"><span class="hs-identifier hs-var">newTerms</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-323"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
Branch m -&gt; Map NameSegment (Map Referent (m MdValues))
</span><span class="hs-identifier hs-var">V2Branch.terms</span></span><span> </span><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621679378675"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-324"></span><span>      </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">forall k2 k1 a. Ord k2 =&gt; (k1 -&gt; k2) -&gt; Map k1 a -&gt; Map k2 a
</span><span class="hs-identifier hs-var">Map.mapKeys</span></span><span> </span><span class="annot"><span class="annottext">NameSegment -&gt; Name
</span><span class="hs-identifier hs-var">Name.fromSegment</span></span><span>
</span><span id="line-325"></span><span>      </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">forall k a. Map k a -&gt; Set k
</span><span class="hs-identifier hs-var">Map.keysSet</span></span><span>
</span><span id="line-326"></span><span>      </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) b a.
(Applicative f, Ord b) =&gt;
(a -&gt; f b) -&gt; Set a -&gt; f (Set b)
</span><span class="hs-identifier hs-var">Set.traverse</span></span><span> </span><span class="annot"><span class="annottext">forall {k} (f :: k -&gt; *) s (t :: k) a (b :: k).
LensLike f s t a b -&gt; LensLike f s t a b
</span><span class="hs-operator hs-var">%%~</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
Applicative m =&gt;
(Reference -&gt; m ConstructorType) -&gt; Referent -&gt; m Referent
</span><span class="hs-identifier hs-var">Cv.referent2to1</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) v a.
Codebase m v a -&gt; Reference -&gt; Transaction ConstructorType
</span><span class="hs-identifier hs-var">Codebase.getDeclType</span></span><span> </span><span class="annot"><span class="annottext">Codebase m v a
</span><a href="#local-6989586621679378676"><span class="hs-identifier hs-var">codebase</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-327"></span><span>
</span><span id="line-328"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679378663"><span class="annot"><span class="annottext">newTypes :: Map Name (Set TypeReference)
</span><a href="#local-6989586621679378663"><span class="hs-identifier hs-var hs-var">newTypes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-329"></span><span>        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
Branch m -&gt; Map NameSegment (Map Reference (m MdValues))
</span><span class="hs-identifier hs-var">V2Branch.types</span></span><span> </span><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621679378675"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-330"></span><span>          </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">forall k2 k1 a. Ord k2 =&gt; (k1 -&gt; k2) -&gt; Map k1 a -&gt; Map k2 a
</span><span class="hs-identifier hs-var">Map.mapKeys</span></span><span> </span><span class="annot"><span class="annottext">NameSegment -&gt; Name
</span><span class="hs-identifier hs-var">Name.fromSegment</span></span><span>
</span><span id="line-331"></span><span>          </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">forall k a. Map k a -&gt; Set k
</span><span class="hs-identifier hs-var">Map.keysSet</span></span><span>
</span><span id="line-332"></span><span>          </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) b a.
(Applicative f, Ord b) =&gt;
(a -&gt; f b) -&gt; Set a -&gt; f (Set b)
</span><span class="hs-identifier hs-var">Set.traverse</span></span><span> </span><span class="annot"><span class="annottext">forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-operator hs-var">%~</span></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; TypeReference
</span><span class="hs-identifier hs-var">Cv.reference2to1</span></span><span>
</span><span id="line-333"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Relation Name Referent -&gt; Relation Name TypeReference -&gt; Names
</span><span class="hs-identifier hs-var">Names</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (Ord a, Ord b) =&gt; Map a (Set b) -&gt; Relation a b
</span><span class="hs-identifier hs-var">R.fromMultimap</span></span><span> </span><span class="annot"><span class="annottext">Map Name (Set Referent)
</span><a href="#local-6989586621679378674"><span class="hs-identifier hs-var">newTerms</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (Ord a, Ord b) =&gt; Map a (Set b) -&gt; Relation a b
</span><span class="hs-identifier hs-var">R.fromMultimap</span></span><span> </span><span class="annot"><span class="annottext">Map Name (Set TypeReference)
</span><a href="#local-6989586621679378663"><span class="hs-identifier hs-var">newTypes</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-334"></span><span>
</span><span id="line-335"></span><span id="local-6989586621679380056"><span class="annot"><a href="Unison.Server.Backend.html#loadReferentType"><span class="hs-identifier hs-type">loadReferentType</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-336"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><a href="#local-6989586621679380056"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-337"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-338"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Sqlite.Transaction</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-339"></span><span id="loadReferentType"><span class="annot"><span class="annottext">loadReferentType :: forall (m :: * -&gt; *).
Codebase m Symbol Ann
-&gt; Referent -&gt; Transaction (Maybe (Type Symbol Ann))
</span><a href="Unison.Server.Backend.html#loadReferentType"><span class="hs-identifier hs-var hs-var">loadReferentType</span></a></span></span><span> </span><span id="local-6989586621679378650"><span class="annot"><span class="annottext">Codebase m Symbol Ann
</span><a href="#local-6989586621679378650"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-340"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Referent.Ref</span></span><span> </span><span id="local-6989586621679378648"><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679378648"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a (m :: * -&gt; *).
BuiltinAnnotation a =&gt;
Codebase m Symbol a
-&gt; TypeReference -&gt; Transaction (Maybe (Type Symbol a))
</span><span class="hs-identifier hs-var">Codebase.getTypeOfTerm</span></span><span> </span><span class="annot"><span class="annottext">Codebase m Symbol Ann
</span><a href="#local-6989586621679378650"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679378648"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-341"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Referent.Con</span></span><span> </span><span id="local-6989586621679378645"><span class="annot"><span class="annottext">GConstructorReference TypeReference
</span><a href="#local-6989586621679378645"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="annot"><span class="annottext">ConstructorType
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">GConstructorReference TypeReference
-&gt; Transaction (Maybe (Type Symbol Ann))
</span><a href="#local-6989586621679378644"><span class="hs-identifier hs-var">getTypeOfConstructor</span></a></span><span> </span><span class="annot"><span class="annottext">GConstructorReference TypeReference
</span><a href="#local-6989586621679378645"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-342"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-343"></span><span>    </span><span class="hs-comment">-- Mitchell wonders: why was this definition copied from Unison.Codebase?</span><span>
</span><span id="line-344"></span><span>    </span><span id="local-6989586621679378644"><span class="annot"><span class="annottext">getTypeOfConstructor :: GConstructorReference TypeReference
-&gt; Transaction (Maybe (Type Symbol Ann))
</span><a href="#local-6989586621679378644"><span class="hs-identifier hs-var hs-var">getTypeOfConstructor</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ConstructorReference</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Reference.DerivedId</span></span><span> </span><span id="local-6989586621679378641"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679378641"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679378640"><span class="annot"><span class="annottext">ConstructorId
</span><a href="#local-6989586621679378640"><span class="hs-identifier hs-var">cid</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-345"></span><span>      </span><span id="local-6989586621679378639"><span class="annot"><span class="annottext">Maybe (Decl Symbol Ann)
</span><a href="#local-6989586621679378639"><span class="hs-identifier hs-var">maybeDecl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) v a.
Codebase m v a -&gt; Id -&gt; Transaction (Maybe (Decl v a))
</span><span class="hs-identifier hs-var">Codebase.getTypeDeclaration</span></span><span> </span><span class="annot"><span class="annottext">Codebase m Symbol Ann
</span><a href="#local-6989586621679378650"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679378641"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-346"></span><span>      </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (Decl Symbol Ann)
</span><a href="#local-6989586621679378639"><span class="hs-identifier hs-var">maybeDecl</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-347"></span><span>        </span><span class="annot"><span class="annottext">Maybe (Decl Symbol Ann)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-348"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679378637"><span class="annot"><span class="annottext">Decl Symbol Ann
</span><a href="#local-6989586621679378637"><span class="hs-identifier hs-var">decl</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall v a.
DataDeclaration v a -&gt; ConstructorId -&gt; Maybe (Type v a)
</span><span class="hs-identifier hs-var">DD.typeOfConstructor</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span> </span><span class="annot"><span class="annottext">forall v a. EffectDeclaration v a -&gt; DataDeclaration v a
</span><span class="hs-identifier hs-var">DD.toDataDecl</span></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">Decl Symbol Ann
</span><a href="#local-6989586621679378637"><span class="hs-identifier hs-var">decl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ConstructorId
</span><a href="#local-6989586621679378640"><span class="hs-identifier hs-var">cid</span></a></span><span>
</span><span id="line-349"></span><span>    </span><span class="annot"><a href="#local-6989586621679378644"><span class="hs-identifier hs-var">getTypeOfConstructor</span></a></span><span> </span><span id="local-6989586621679378632"><span class="annot"><span class="annottext">GConstructorReference TypeReference
</span><a href="#local-6989586621679378632"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-350"></span><span>      </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; WatchKind -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-351"></span><span>        </span><span class="annot"><span class="annottext">WatchKind
</span><span class="hs-string">&quot;Don't know how to getTypeOfConstructor &quot;</span></span><span>
</span><span id="line-352"></span><span>          </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; WatchKind
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">GConstructorReference TypeReference
</span><a href="#local-6989586621679378632"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-353"></span><span>
</span><span id="line-354"></span><span id="local-6989586621679378628"><span id="local-6989586621679378629"></span></span><span class="hs-keyword">data</span><span> </span><span id="TermEntry"><span class="annot"><a href="Unison.Server.Backend.html#TermEntry"><span class="hs-identifier hs-var">TermEntry</span></a></span></span><span> </span><span id="local-6989586621679380281"><span class="annot"><a href="#local-6989586621679380281"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span id="local-6989586621679380280"><span class="annot"><a href="#local-6989586621679380280"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="TermEntry"><span class="annot"><a href="Unison.Server.Backend.html#TermEntry"><span class="hs-identifier hs-var">TermEntry</span></a></span></span><span>
</span><span id="line-355"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3AtermEntryReferent%3ATermEntry"><span class="annot"><span class="annottext">forall v a. TermEntry v a -&gt; Referent
</span><a href="Unison.Server.Backend.html#%24sel%3AtermEntryReferent%3ATermEntry"><span class="hs-identifier hs-var hs-var">termEntryReferent</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">V2Referent.Referent</span></span><span class="hs-special">,</span><span>
</span><span id="line-356"></span><span>    </span><span id="%24sel%3AtermEntryHash%3ATermEntry"><span class="annot"><span class="annottext">forall v a. TermEntry v a -&gt; ShortHash
</span><a href="Unison.Server.Backend.html#%24sel%3AtermEntryHash%3ATermEntry"><span class="hs-identifier hs-var hs-var">termEntryHash</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ShortHash</span></span><span class="hs-special">,</span><span>
</span><span id="line-357"></span><span>    </span><span id="%24sel%3AtermEntryName%3ATermEntry"><span class="annot"><span class="annottext">forall v a. TermEntry v a -&gt; NameSegment
</span><a href="Unison.Server.Backend.html#%24sel%3AtermEntryName%3ATermEntry"><span class="hs-identifier hs-var hs-var">termEntryName</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NameSegment</span></span><span class="hs-special">,</span><span>
</span><span id="line-358"></span><span>    </span><span id="%24sel%3AtermEntryConflicted%3ATermEntry"><span class="annot"><span class="annottext">forall v a. TermEntry v a -&gt; Bool
</span><a href="Unison.Server.Backend.html#%24sel%3AtermEntryConflicted%3ATermEntry"><span class="hs-identifier hs-var hs-var">termEntryConflicted</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">,</span><span>
</span><span id="line-359"></span><span>    </span><span id="%24sel%3AtermEntryType%3ATermEntry"><span class="annot"><span class="annottext">forall v a. TermEntry v a -&gt; Maybe (Type v a)
</span><a href="Unison.Server.Backend.html#%24sel%3AtermEntryType%3ATermEntry"><span class="hs-identifier hs-var hs-var">termEntryType</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><a href="#local-6989586621679380281"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679380280"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-360"></span><span>    </span><span id="%24sel%3AtermEntryTag%3ATermEntry"><span class="annot"><span class="annottext">forall v a. TermEntry v a -&gt; TermTag
</span><a href="Unison.Server.Backend.html#%24sel%3AtermEntryTag%3ATermEntry"><span class="hs-identifier hs-var hs-var">termEntryTag</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Server.Types.html#TermTag"><span class="hs-identifier hs-type">TermTag</span></a></span><span>
</span><span id="line-361"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-362"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679378605"><span id="local-6989586621679378621"><span class="annot"><span class="annottext">TermEntry v a -&gt; TermEntry v a -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
forall v a. Var v =&gt; TermEntry v a -&gt; TermEntry v a -&gt; Bool
/= :: TermEntry v a -&gt; TermEntry v a -&gt; Bool
$c/= :: forall v a. Var v =&gt; TermEntry v a -&gt; TermEntry v a -&gt; Bool
== :: TermEntry v a -&gt; TermEntry v a -&gt; Bool
$c== :: forall v a. Var v =&gt; TermEntry v a -&gt; TermEntry v a -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679378554"><span id="local-6989586621679378556"><span id="local-6989586621679378559"><span id="local-6989586621679378562"><span id="local-6989586621679378565"><span id="local-6989586621679378576"><span id="local-6989586621679378592"><span class="annot"><span class="annottext">TermEntry v a -&gt; TermEntry v a -&gt; Bool
TermEntry v a -&gt; TermEntry v a -&gt; Ordering
forall a.
Eq a
-&gt; (a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
forall v a. Var v =&gt; Eq (TermEntry v a)
forall v a. Var v =&gt; TermEntry v a -&gt; TermEntry v a -&gt; Bool
forall v a. Var v =&gt; TermEntry v a -&gt; TermEntry v a -&gt; Ordering
forall v a.
Var v =&gt;
TermEntry v a -&gt; TermEntry v a -&gt; TermEntry v a
min :: TermEntry v a -&gt; TermEntry v a -&gt; TermEntry v a
$cmin :: forall v a.
Var v =&gt;
TermEntry v a -&gt; TermEntry v a -&gt; TermEntry v a
max :: TermEntry v a -&gt; TermEntry v a -&gt; TermEntry v a
$cmax :: forall v a.
Var v =&gt;
TermEntry v a -&gt; TermEntry v a -&gt; TermEntry v a
&gt;= :: TermEntry v a -&gt; TermEntry v a -&gt; Bool
$c&gt;= :: forall v a. Var v =&gt; TermEntry v a -&gt; TermEntry v a -&gt; Bool
&gt; :: TermEntry v a -&gt; TermEntry v a -&gt; Bool
$c&gt; :: forall v a. Var v =&gt; TermEntry v a -&gt; TermEntry v a -&gt; Bool
&lt;= :: TermEntry v a -&gt; TermEntry v a -&gt; Bool
$c&lt;= :: forall v a. Var v =&gt; TermEntry v a -&gt; TermEntry v a -&gt; Bool
&lt; :: TermEntry v a -&gt; TermEntry v a -&gt; Bool
$c&lt; :: forall v a. Var v =&gt; TermEntry v a -&gt; TermEntry v a -&gt; Bool
compare :: TermEntry v a -&gt; TermEntry v a -&gt; Ordering
$ccompare :: forall v a. Var v =&gt; TermEntry v a -&gt; TermEntry v a -&gt; Ordering
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679378523"><span id="local-6989586621679378525"><span id="local-6989586621679378541"><span class="annot"><span class="annottext">Int -&gt; TermEntry v a -&gt; ShowS
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; WatchKind) -&gt; ([a] -&gt; ShowS) -&gt; Show a
forall v a. Show v =&gt; Int -&gt; TermEntry v a -&gt; ShowS
forall v a. Show v =&gt; [TermEntry v a] -&gt; ShowS
forall v a. Show v =&gt; TermEntry v a -&gt; WatchKind
showList :: [TermEntry v a] -&gt; ShowS
$cshowList :: forall v a. Show v =&gt; [TermEntry v a] -&gt; ShowS
show :: TermEntry v a -&gt; WatchKind
$cshow :: forall v a. Show v =&gt; TermEntry v a -&gt; WatchKind
showsPrec :: Int -&gt; TermEntry v a -&gt; ShowS
$cshowsPrec :: forall v a. Show v =&gt; Int -&gt; TermEntry v a -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
forall v a x. Rep (TermEntry v a) x -&gt; TermEntry v a
forall v a x. TermEntry v a -&gt; Rep (TermEntry v a) x
$cto :: forall v a x. Rep (TermEntry v a) x -&gt; TermEntry v a
$cfrom :: forall v a x. TermEntry v a -&gt; Rep (TermEntry v a) x
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></span><span class="hs-special">)</span><span>
</span><span id="line-363"></span><span>
</span><span id="line-364"></span><span id="local-6989586621679380270"><span id="local-6989586621679380271"><span class="annot"><a href="Unison.Server.Backend.html#termEntryDisplayName"><span class="hs-identifier hs-type">termEntryDisplayName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#TermEntry"><span class="hs-identifier hs-type">TermEntry</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679380271"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679380270"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span></span></span><span>
</span><span id="line-365"></span><span id="termEntryDisplayName"><span class="annot"><span class="annottext">termEntryDisplayName :: forall v a. TermEntry v a -&gt; Text
</span><a href="Unison.Server.Backend.html#termEntryDisplayName"><span class="hs-identifier hs-var hs-var">termEntryDisplayName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall n. (n -&gt; Text) -&gt; HashQualified n -&gt; Text
</span><span class="hs-identifier hs-var">HQ'.toTextWith</span></span><span> </span><span class="annot"><span class="annottext">NameSegment -&gt; Text
</span><span class="hs-identifier hs-var">NameSegment.toText</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall v a. TermEntry v a -&gt; HashQualified NameSegment
</span><a href="Unison.Server.Backend.html#termEntryHQName"><span class="hs-identifier hs-var">termEntryHQName</span></a></span><span>
</span><span id="line-366"></span><span>
</span><span id="line-367"></span><span id="local-6989586621679379979"><span id="local-6989586621679379980"><span class="annot"><a href="Unison.Server.Backend.html#termEntryHQName"><span class="hs-identifier hs-type">termEntryHQName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#TermEntry"><span class="hs-identifier hs-type">TermEntry</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679379980"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679379979"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HQ'.HashQualified</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NameSegment</span></span></span></span><span>
</span><span id="line-368"></span><span id="termEntryHQName"><span class="annot"><span class="annottext">termEntryHQName :: forall v a. TermEntry v a -&gt; HashQualified NameSegment
</span><a href="Unison.Server.Backend.html#termEntryHQName"><span class="hs-identifier hs-var hs-var">termEntryHQName</span></a></span></span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#TermEntry"><span class="hs-identifier hs-type">TermEntry</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679378511"><span class="annot"><span class="annottext">NameSegment
termEntryName :: NameSegment
$sel:termEntryName:TermEntry :: forall v a. TermEntry v a -&gt; NameSegment
</span><a href="#local-6989586621679378511"><span class="hs-identifier hs-var hs-var">termEntryName</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679378510"><span class="annot"><span class="annottext">Bool
termEntryConflicted :: Bool
$sel:termEntryConflicted:TermEntry :: forall v a. TermEntry v a -&gt; Bool
</span><a href="#local-6989586621679378510"><span class="hs-identifier hs-var hs-var">termEntryConflicted</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679378509"><span class="annot"><span class="annottext">ShortHash
termEntryHash :: ShortHash
$sel:termEntryHash:TermEntry :: forall v a. TermEntry v a -&gt; ShortHash
</span><a href="#local-6989586621679378509"><span class="hs-identifier hs-var hs-var">termEntryHash</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-369"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679378510"><span class="hs-identifier hs-var">termEntryConflicted</span></a></span><span>
</span><span id="line-370"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">forall n. n -&gt; ShortHash -&gt; HashQualified n
</span><span class="hs-identifier hs-var">HQ'.HashQualified</span></span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621679378511"><span class="hs-identifier hs-var">termEntryName</span></a></span><span> </span><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679378509"><span class="hs-identifier hs-var">termEntryHash</span></a></span><span>
</span><span id="line-371"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall n. n -&gt; HashQualified n
</span><span class="hs-identifier hs-var">HQ'.NameOnly</span></span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621679378511"><span class="hs-identifier hs-var">termEntryName</span></a></span><span>
</span><span id="line-372"></span><span>
</span><span id="line-373"></span><span id="local-6989586621679378505"><span id="local-6989586621679378506"></span></span><span class="hs-keyword">data</span><span> </span><span id="TypeEntry"><span class="annot"><a href="Unison.Server.Backend.html#TypeEntry"><span class="hs-identifier hs-var">TypeEntry</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="TypeEntry"><span class="annot"><a href="Unison.Server.Backend.html#TypeEntry"><span class="hs-identifier hs-var">TypeEntry</span></a></span></span><span>
</span><span id="line-374"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3AtypeEntryReference%3ATypeEntry"><span class="annot"><span class="annottext">TypeEntry -&gt; TypeReference
</span><a href="Unison.Server.Backend.html#%24sel%3AtypeEntryReference%3ATypeEntry"><span class="hs-identifier hs-var hs-var">typeEntryReference</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span class="hs-special">,</span><span>
</span><span id="line-375"></span><span>    </span><span id="%24sel%3AtypeEntryHash%3ATypeEntry"><span class="annot"><span class="annottext">TypeEntry -&gt; ShortHash
</span><a href="Unison.Server.Backend.html#%24sel%3AtypeEntryHash%3ATypeEntry"><span class="hs-identifier hs-var hs-var">typeEntryHash</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ShortHash</span></span><span class="hs-special">,</span><span>
</span><span id="line-376"></span><span>    </span><span id="%24sel%3AtypeEntryName%3ATypeEntry"><span class="annot"><span class="annottext">TypeEntry -&gt; NameSegment
</span><a href="Unison.Server.Backend.html#%24sel%3AtypeEntryName%3ATypeEntry"><span class="hs-identifier hs-var hs-var">typeEntryName</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NameSegment</span></span><span class="hs-special">,</span><span>
</span><span id="line-377"></span><span>    </span><span id="%24sel%3AtypeEntryConflicted%3ATypeEntry"><span class="annot"><span class="annottext">TypeEntry -&gt; Bool
</span><a href="Unison.Server.Backend.html#%24sel%3AtypeEntryConflicted%3ATypeEntry"><span class="hs-identifier hs-var hs-var">typeEntryConflicted</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">,</span><span>
</span><span id="line-378"></span><span>    </span><span id="%24sel%3AtypeEntryTag%3ATypeEntry"><span class="annot"><span class="annottext">TypeEntry -&gt; TypeTag
</span><a href="Unison.Server.Backend.html#%24sel%3AtypeEntryTag%3ATypeEntry"><span class="hs-identifier hs-var hs-var">typeEntryTag</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Server.Types.html#TypeTag"><span class="hs-identifier hs-type">TypeTag</span></a></span><span>
</span><span id="line-379"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-380"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679378488"><span id="local-6989586621679378497"><span class="annot"><span class="annottext">TypeEntry -&gt; TypeEntry -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: TypeEntry -&gt; TypeEntry -&gt; Bool
$c/= :: TypeEntry -&gt; TypeEntry -&gt; Bool
== :: TypeEntry -&gt; TypeEntry -&gt; Bool
$c== :: TypeEntry -&gt; TypeEntry -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679378458"><span id="local-6989586621679378460"><span id="local-6989586621679378463"><span id="local-6989586621679378466"><span id="local-6989586621679378469"><span id="local-6989586621679378476"><span id="local-6989586621679378484"><span class="annot"><span class="annottext">Eq TypeEntry
TypeEntry -&gt; TypeEntry -&gt; Bool
TypeEntry -&gt; TypeEntry -&gt; Ordering
TypeEntry -&gt; TypeEntry -&gt; TypeEntry
forall a.
Eq a
-&gt; (a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
min :: TypeEntry -&gt; TypeEntry -&gt; TypeEntry
$cmin :: TypeEntry -&gt; TypeEntry -&gt; TypeEntry
max :: TypeEntry -&gt; TypeEntry -&gt; TypeEntry
$cmax :: TypeEntry -&gt; TypeEntry -&gt; TypeEntry
&gt;= :: TypeEntry -&gt; TypeEntry -&gt; Bool
$c&gt;= :: TypeEntry -&gt; TypeEntry -&gt; Bool
&gt; :: TypeEntry -&gt; TypeEntry -&gt; Bool
$c&gt; :: TypeEntry -&gt; TypeEntry -&gt; Bool
&lt;= :: TypeEntry -&gt; TypeEntry -&gt; Bool
$c&lt;= :: TypeEntry -&gt; TypeEntry -&gt; Bool
&lt; :: TypeEntry -&gt; TypeEntry -&gt; Bool
$c&lt; :: TypeEntry -&gt; TypeEntry -&gt; Bool
compare :: TypeEntry -&gt; TypeEntry -&gt; Ordering
$ccompare :: TypeEntry -&gt; TypeEntry -&gt; Ordering
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679378445"><span id="local-6989586621679378447"><span id="local-6989586621679378456"><span class="annot"><span class="annottext">Int -&gt; TypeEntry -&gt; ShowS
[TypeEntry] -&gt; ShowS
TypeEntry -&gt; WatchKind
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; WatchKind) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [TypeEntry] -&gt; ShowS
$cshowList :: [TypeEntry] -&gt; ShowS
show :: TypeEntry -&gt; WatchKind
$cshow :: TypeEntry -&gt; WatchKind
showsPrec :: Int -&gt; TypeEntry -&gt; ShowS
$cshowsPrec :: Int -&gt; TypeEntry -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall x. Rep TypeEntry x -&gt; TypeEntry
forall x. TypeEntry -&gt; Rep TypeEntry x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep TypeEntry x -&gt; TypeEntry
$cfrom :: forall x. TypeEntry -&gt; Rep TypeEntry x
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></span><span class="hs-special">)</span><span>
</span><span id="line-381"></span><span>
</span><span id="line-382"></span><span class="annot"><a href="Unison.Server.Backend.html#typeEntryDisplayName"><span class="hs-identifier hs-type">typeEntryDisplayName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#TypeEntry"><span class="hs-identifier hs-type">TypeEntry</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-383"></span><span id="typeEntryDisplayName"><span class="annot"><span class="annottext">typeEntryDisplayName :: TypeEntry -&gt; Text
</span><a href="Unison.Server.Backend.html#typeEntryDisplayName"><span class="hs-identifier hs-var hs-var">typeEntryDisplayName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall n. (n -&gt; Text) -&gt; HashQualified n -&gt; Text
</span><span class="hs-identifier hs-var">HQ'.toTextWith</span></span><span> </span><span class="annot"><span class="annottext">NameSegment -&gt; Text
</span><span class="hs-identifier hs-var">NameSegment.toText</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TypeEntry -&gt; HashQualified NameSegment
</span><a href="Unison.Server.Backend.html#typeEntryHQName"><span class="hs-identifier hs-var">typeEntryHQName</span></a></span><span>
</span><span id="line-384"></span><span>
</span><span id="line-385"></span><span class="annot"><a href="Unison.Server.Backend.html#typeEntryHQName"><span class="hs-identifier hs-type">typeEntryHQName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#TypeEntry"><span class="hs-identifier hs-type">TypeEntry</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HQ'.HashQualified</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NameSegment</span></span><span>
</span><span id="line-386"></span><span id="typeEntryHQName"><span class="annot"><span class="annottext">typeEntryHQName :: TypeEntry -&gt; HashQualified NameSegment
</span><a href="Unison.Server.Backend.html#typeEntryHQName"><span class="hs-identifier hs-var hs-var">typeEntryHQName</span></a></span></span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#TypeEntry"><span class="hs-identifier hs-type">TypeEntry</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679378441"><span class="annot"><span class="annottext">NameSegment
typeEntryName :: NameSegment
$sel:typeEntryName:TypeEntry :: TypeEntry -&gt; NameSegment
</span><a href="#local-6989586621679378441"><span class="hs-identifier hs-var hs-var">typeEntryName</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679378440"><span class="annot"><span class="annottext">Bool
typeEntryConflicted :: Bool
$sel:typeEntryConflicted:TypeEntry :: TypeEntry -&gt; Bool
</span><a href="#local-6989586621679378440"><span class="hs-identifier hs-var hs-var">typeEntryConflicted</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679378439"><span class="annot"><span class="annottext">TypeReference
typeEntryReference :: TypeReference
$sel:typeEntryReference:TypeEntry :: TypeEntry -&gt; TypeReference
</span><a href="#local-6989586621679378439"><span class="hs-identifier hs-var hs-var">typeEntryReference</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-387"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679378440"><span class="hs-identifier hs-var">typeEntryConflicted</span></a></span><span>
</span><span id="line-388"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">forall n. n -&gt; ShortHash -&gt; HashQualified n
</span><span class="hs-identifier hs-var">HQ'.HashQualified</span></span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621679378441"><span class="hs-identifier hs-var">typeEntryName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeReference -&gt; ShortHash
</span><span class="hs-identifier hs-var">Reference.toShortHash</span></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679378439"><span class="hs-identifier hs-var">typeEntryReference</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-389"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall n. n -&gt; HashQualified n
</span><span class="hs-identifier hs-var">HQ'.NameOnly</span></span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621679378441"><span class="hs-identifier hs-var">typeEntryName</span></a></span><span>
</span><span id="line-390"></span><span>
</span><span id="line-391"></span><span id="local-6989586621679378436"><span id="local-6989586621679378437"></span></span><span class="hs-keyword">data</span><span> </span><span id="FoundRef"><span class="annot"><a href="Unison.Server.Backend.html#FoundRef"><span class="hs-identifier hs-var">FoundRef</span></a></span></span><span>
</span><span id="line-392"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="FoundTermRef"><span class="annot"><a href="Unison.Server.Backend.html#FoundTermRef"><span class="hs-identifier hs-var">FoundTermRef</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span>
</span><span id="line-393"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="FoundTypeRef"><span class="annot"><a href="Unison.Server.Backend.html#FoundTypeRef"><span class="hs-identifier hs-var">FoundTypeRef</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span>
</span><span id="line-394"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679378426"><span id="local-6989586621679378432"><span class="annot"><span class="annottext">FoundRef -&gt; FoundRef -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: FoundRef -&gt; FoundRef -&gt; Bool
$c/= :: FoundRef -&gt; FoundRef -&gt; Bool
== :: FoundRef -&gt; FoundRef -&gt; Bool
$c== :: FoundRef -&gt; FoundRef -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679378403"><span id="local-6989586621679378405"><span id="local-6989586621679378408"><span id="local-6989586621679378411"><span id="local-6989586621679378414"><span id="local-6989586621679378418"><span id="local-6989586621679378422"><span class="annot"><span class="annottext">Eq FoundRef
FoundRef -&gt; FoundRef -&gt; Bool
FoundRef -&gt; FoundRef -&gt; Ordering
FoundRef -&gt; FoundRef -&gt; FoundRef
forall a.
Eq a
-&gt; (a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
min :: FoundRef -&gt; FoundRef -&gt; FoundRef
$cmin :: FoundRef -&gt; FoundRef -&gt; FoundRef
max :: FoundRef -&gt; FoundRef -&gt; FoundRef
$cmax :: FoundRef -&gt; FoundRef -&gt; FoundRef
&gt;= :: FoundRef -&gt; FoundRef -&gt; Bool
$c&gt;= :: FoundRef -&gt; FoundRef -&gt; Bool
&gt; :: FoundRef -&gt; FoundRef -&gt; Bool
$c&gt; :: FoundRef -&gt; FoundRef -&gt; Bool
&lt;= :: FoundRef -&gt; FoundRef -&gt; Bool
$c&lt;= :: FoundRef -&gt; FoundRef -&gt; Bool
&lt; :: FoundRef -&gt; FoundRef -&gt; Bool
$c&lt; :: FoundRef -&gt; FoundRef -&gt; Bool
compare :: FoundRef -&gt; FoundRef -&gt; Ordering
$ccompare :: FoundRef -&gt; FoundRef -&gt; Ordering
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679378391"><span id="local-6989586621679378393"><span id="local-6989586621679378401"><span class="annot"><span class="annottext">Int -&gt; FoundRef -&gt; ShowS
[FoundRef] -&gt; ShowS
FoundRef -&gt; WatchKind
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; WatchKind) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [FoundRef] -&gt; ShowS
$cshowList :: [FoundRef] -&gt; ShowS
show :: FoundRef -&gt; WatchKind
$cshow :: FoundRef -&gt; WatchKind
showsPrec :: Int -&gt; FoundRef -&gt; ShowS
$cshowsPrec :: Int -&gt; FoundRef -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall x. Rep FoundRef x -&gt; FoundRef
forall x. FoundRef -&gt; Rep FoundRef x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep FoundRef x -&gt; FoundRef
$cfrom :: forall x. FoundRef -&gt; Rep FoundRef x
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></span><span class="hs-special">)</span><span>
</span><span id="line-395"></span><span>
</span><span id="line-396"></span><span class="hs-comment">-- After finding a search results with fuzzy find we do some post processing to</span><span>
</span><span id="line-397"></span><span class="hs-comment">-- refine the result:</span><span>
</span><span id="line-398"></span><span class="hs-comment">--  * Sort:</span><span>
</span><span id="line-399"></span><span class="hs-comment">--      we sort both on the FZF score and the number of segments in the FQN</span><span>
</span><span id="line-400"></span><span class="hs-comment">--      preferring shorter FQNs over longer. This helps with things like forks</span><span>
</span><span id="line-401"></span><span class="hs-comment">--      of base.</span><span>
</span><span id="line-402"></span><span class="hs-comment">--  * Dedupe:</span><span>
</span><span id="line-403"></span><span class="hs-comment">--      we dedupe on the found refs to avoid having several rows of a</span><span>
</span><span id="line-404"></span><span class="hs-comment">--      definition with different names in the result set.</span><span>
</span><span id="line-405"></span><span class="annot"><a href="Unison.Server.Backend.html#fuzzyFind"><span class="hs-identifier hs-type">fuzzyFind</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-406"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Names</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-407"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-408"></span><span>  </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">FZF.Alignment</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Server.Types.html#UnisonName"><span class="hs-identifier hs-type">UnisonName</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Unison.Server.Backend.html#FoundRef"><span class="hs-identifier hs-type">FoundRef</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-409"></span><span id="fuzzyFind"><span class="annot"><span class="annottext">fuzzyFind :: Names -&gt; WatchKind -&gt; [(Alignment, Text, [FoundRef])]
</span><a href="Unison.Server.Backend.html#fuzzyFind"><span class="hs-identifier hs-var hs-var">fuzzyFind</span></a></span></span><span> </span><span id="local-6989586621679378386"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679378386"><span class="hs-identifier hs-var">printNames</span></a></span></span><span> </span><span id="local-6989586621679378385"><span class="annot"><span class="annottext">WatchKind
</span><a href="#local-6989586621679378385"><span class="hs-identifier hs-var">query</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-410"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679378384"><span class="annot"><span class="annottext">fzfNames :: [(Alignment, Name, Set (Either Referent TypeReference))]
</span><a href="#local-6989586621679378384"><span class="hs-identifier hs-var hs-var">fzfNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-411"></span><span>        </span><span class="annot"><span class="annottext">(Name -&gt; Text)
-&gt; [WatchKind]
-&gt; Names
-&gt; [(Alignment, Name, Set (Either Referent TypeReference))]
</span><span class="hs-identifier hs-var">Names.fuzzyFind</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Text
</span><span class="hs-identifier hs-var">Name.toText</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WatchKind -&gt; [WatchKind]
</span><span class="hs-identifier hs-var">words</span></span><span> </span><span class="annot"><span class="annottext">WatchKind
</span><a href="#local-6989586621679378385"><span class="hs-identifier hs-var">query</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679378386"><span class="hs-identifier hs-var">printNames</span></a></span><span>
</span><span id="line-412"></span><span>
</span><span id="line-413"></span><span>      </span><span id="local-6989586621679378377"><span class="annot"><span class="annottext">toFoundRef :: (Alignment, Text, Set (Either Referent TypeReference))
-&gt; (Alignment, Text, [FoundRef])
</span><a href="#local-6989586621679378377"><span class="hs-identifier hs-var hs-var">toFoundRef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-414"></span><span>        </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span> </span><span class="annot"><span class="annottext">Referent -&gt; FoundRef
</span><a href="Unison.Server.Backend.html#FoundTermRef"><span class="hs-identifier hs-var">FoundTermRef</span></a></span><span> </span><span class="annot"><span class="annottext">TypeReference -&gt; FoundRef
</span><a href="Unison.Server.Backend.html#FoundTypeRef"><span class="hs-identifier hs-var">FoundTypeRef</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span class="hs-special">)</span><span>
</span><span id="line-415"></span><span>
</span><span id="line-416"></span><span>      </span><span class="hs-comment">-- Remove dupes based on refs</span><span>
</span><span id="line-417"></span><span>      </span><span id="local-6989586621679378372"><span class="annot"><span class="annottext">dedupe :: [(a, b, [FoundRef])] -&gt; [(a, b, [FoundRef])]
</span><a href="#local-6989586621679378372"><span class="hs-identifier hs-var hs-var">dedupe</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-418"></span><span>        </span><span class="annot"><span class="annottext">forall b a. Ord b =&gt; (a -&gt; b) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">nubOrdOn</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679378371"><span class="annot"><span class="annottext">[FoundRef]
</span><a href="#local-6989586621679378371"><span class="hs-identifier hs-var">refs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[FoundRef]
</span><a href="#local-6989586621679378371"><span class="hs-identifier hs-var">refs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-419"></span><span>
</span><span id="line-420"></span><span>      </span><span class="hs-comment">-- Prefer shorter FQNs</span><span>
</span><span id="line-421"></span><span>      </span><span id="local-6989586621679378366"><span class="annot"><span class="annottext">rank :: (Alignment, Text, c) -&gt; (Int, Int)
</span><a href="#local-6989586621679378366"><span class="hs-identifier hs-var hs-var">rank</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679378365"><span class="annot"><span class="annottext">Alignment
</span><a href="#local-6989586621679378365"><span class="hs-identifier hs-var">alignment</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679378364"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679378364"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">c
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-422"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Int
</span><span class="hs-identifier hs-var">Name.countSegments</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasCallStack =&gt; Text -&gt; Name
</span><span class="hs-identifier hs-var">Name.unsafeFromText</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679378364"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-423"></span><span>          </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">negate</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Alignment -&gt; Int
</span><span class="hs-identifier hs-var">FZF.score</span></span><span> </span><span class="annot"><span class="annottext">Alignment
</span><a href="#local-6989586621679378365"><span class="hs-identifier hs-var">alignment</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-424"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-425"></span><span>
</span><span id="line-426"></span><span>      </span><span id="local-6989586621679378361"><span class="annot"><span class="annottext">refine :: [(Alignment, Text, [FoundRef])] -&gt; [(Alignment, Text, [FoundRef])]
</span><a href="#local-6989586621679378361"><span class="hs-identifier hs-var hs-var">refine</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-427"></span><span>        </span><span class="annot"><span class="annottext">forall {a} {b}. [(a, b, [FoundRef])] -&gt; [(a, b, [FoundRef])]
</span><a href="#local-6989586621679378372"><span class="hs-identifier hs-var">dedupe</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall b a. Ord b =&gt; (a -&gt; b) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">sortOn</span></span><span> </span><span class="annot"><span class="annottext">forall {c}. (Alignment, Text, c) -&gt; (Int, Int)
</span><a href="#local-6989586621679378366"><span class="hs-identifier hs-var">rank</span></a></span><span>
</span><span id="line-428"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[(Alignment, Text, [FoundRef])] -&gt; [(Alignment, Text, [FoundRef])]
</span><a href="#local-6989586621679378361"><span class="hs-identifier hs-var">refine</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Alignment, Text, Set (Either Referent TypeReference))
-&gt; (Alignment, Text, [FoundRef])
</span><a href="#local-6989586621679378377"><span class="hs-identifier hs-var">toFoundRef</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-identifier hs-var">over</span></span><span> </span><span class="annot"><span class="annottext">forall s t a b. Field2 s t a b =&gt; Lens s t a b
</span><span class="hs-identifier hs-var">_2</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Text
</span><span class="hs-identifier hs-var">Name.toText</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[(Alignment, Name, Set (Either Referent TypeReference))]
</span><a href="#local-6989586621679378384"><span class="hs-identifier hs-var">fzfNames</span></a></span><span>
</span><span id="line-429"></span><span>
</span><span id="line-430"></span><span class="hs-comment">-- List the immediate children of a namespace</span><span>
</span><span id="line-431"></span><span id="local-6989586621679379953"><span class="annot"><a href="Unison.Server.Backend.html#lsAtPath"><span class="hs-identifier hs-type">lsAtPath</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-432"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679379953"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-433"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><a href="#local-6989586621679379953"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-434"></span><span>  </span><span class="hs-comment">-- The root to follow the path from.</span><span>
</span><span id="line-435"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">V2Branch.Branch</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Sqlite.Transaction</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-436"></span><span>  </span><span class="hs-comment">-- Path from the root to the branch to 'ls'</span><span>
</span><span id="line-437"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Path.Absolute</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-438"></span><span>  </span><span class="annot"><a href="#local-6989586621679379953"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Unison.Server.Backend.html#ShallowListEntry"><span class="hs-identifier hs-type">ShallowListEntry</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">]</span></span><span>
</span><span id="line-439"></span><span id="lsAtPath"><span class="annot"><span class="annottext">lsAtPath :: forall (m :: * -&gt; *).
MonadIO m =&gt;
Codebase m Symbol Ann
-&gt; Maybe (Branch Transaction)
-&gt; Absolute
-&gt; m [ShallowListEntry Symbol Ann]
</span><a href="Unison.Server.Backend.html#lsAtPath"><span class="hs-identifier hs-var hs-var">lsAtPath</span></a></span></span><span> </span><span id="local-6989586621679378351"><span class="annot"><span class="annottext">Codebase m Symbol Ann
</span><a href="#local-6989586621679378351"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621679378350"><span class="annot"><span class="annottext">Maybe (Branch Transaction)
</span><a href="#local-6989586621679378350"><span class="hs-identifier hs-var">mayRootBranch</span></a></span></span><span> </span><span id="local-6989586621679378349"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679378349"><span class="hs-identifier hs-var">absPath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-440"></span><span>  </span><span id="local-6989586621679378348"><span class="annot"><span class="annottext">Branch Transaction
</span><a href="#local-6989586621679378348"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) v a b.
MonadIO m =&gt;
Codebase m v a -&gt; Transaction b -&gt; m b
</span><span class="hs-identifier hs-var">Codebase.runTransaction</span></span><span> </span><span class="annot"><span class="annottext">Codebase m Symbol Ann
</span><a href="#local-6989586621679378351"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Path
-&gt; Maybe (Branch Transaction) -&gt; Transaction (Branch Transaction)
</span><span class="hs-identifier hs-var">Codebase.getShallowBranchAtPath</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Absolute -&gt; Path
</span><span class="hs-identifier hs-var">Path.unabsolute</span></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679378349"><span class="hs-identifier hs-var">absPath</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (Branch Transaction)
</span><a href="#local-6989586621679378350"><span class="hs-identifier hs-var">mayRootBranch</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-441"></span><span>  </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) (n :: * -&gt; *).
MonadIO m =&gt;
Codebase m Symbol Ann
-&gt; Branch n -&gt; m [ShallowListEntry Symbol Ann]
</span><a href="Unison.Server.Backend.html#lsBranch"><span class="hs-identifier hs-var">lsBranch</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase m Symbol Ann
</span><a href="#local-6989586621679378351"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Branch Transaction
</span><a href="#local-6989586621679378348"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-442"></span><span>
</span><span id="line-443"></span><span id="local-6989586621679379947"><span class="annot"><a href="Unison.Server.Backend.html#findDocInBranchAndRender"><span class="hs-identifier hs-type">findDocInBranchAndRender</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-444"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NameSegment</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-445"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Width</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-446"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Rt.Runtime</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-447"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-448"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">PPED.PrettyPrintEnvDecl</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-449"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">V2Branch.Branch</span></span><span> </span><span class="annot"><a href="#local-6989586621679379947"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-450"></span><span>  </span><span class="annot"><a href="Unison.Server.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Unison.Server.Doc.html#Doc"><span class="hs-identifier hs-type">Doc.Doc</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-451"></span><span id="findDocInBranchAndRender"><span class="annot"><span class="annottext">findDocInBranchAndRender :: forall (m :: * -&gt; *).
Set NameSegment
-&gt; Width
-&gt; Runtime Symbol
-&gt; Codebase IO Symbol Ann
-&gt; PrettyPrintEnvDecl
-&gt; Branch m
-&gt; Backend IO (Maybe Doc)
</span><a href="Unison.Server.Backend.html#findDocInBranchAndRender"><span class="hs-identifier hs-var hs-var">findDocInBranchAndRender</span></a></span></span><span> </span><span id="local-6989586621679378329"><span class="annot"><span class="annottext">Set NameSegment
</span><a href="#local-6989586621679378329"><span class="hs-identifier hs-var">names</span></a></span></span><span> </span><span id="local-6989586621679378328"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621679378328"><span class="hs-identifier hs-var">_width</span></a></span></span><span> </span><span id="local-6989586621679378327"><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679378327"><span class="hs-identifier hs-var">runtime</span></a></span></span><span> </span><span id="local-6989586621679378326"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679378326"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621679378325"><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679378325"><span class="hs-identifier hs-var">ppe</span></a></span></span><span> </span><span id="local-6989586621679378324"><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621679378324"><span class="hs-identifier hs-var">namespaceBranch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-452"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621679378323"><span class="hs-identifier hs-type">renderReadme</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PPED.PrettyPrintEnvDecl</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Unison.Server.Doc.html#Doc"><span class="hs-identifier hs-type">Doc.Doc</span></a></span><span>
</span><span id="line-453"></span><span>      </span><span id="local-6989586621679378323"><span class="annot"><span class="annottext">renderReadme :: PrettyPrintEnvDecl -&gt; TypeReference -&gt; IO Doc
</span><a href="#local-6989586621679378323"><span class="hs-identifier hs-var hs-var">renderReadme</span></a></span></span><span> </span><span id="local-6989586621679378322"><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679378322"><span class="hs-identifier hs-var">ppe</span></a></span></span><span> </span><span id="local-6989586621679378321"><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679378321"><span class="hs-identifier hs-var">docReference</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-454"></span><span>        </span><span id="local-6989586621679378320"><span class="annot"><span class="annottext">Doc
</span><a href="#local-6989586621679378320"><span class="hs-identifier hs-var">doc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Runtime Symbol
-&gt; Codebase IO Symbol Ann
-&gt; TypeReference
-&gt; IO (EvaluatedDoc Symbol)
</span><a href="Unison.Server.Backend.html#evalDocRef"><span class="hs-identifier hs-var">evalDocRef</span></a></span><span> </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679378327"><span class="hs-identifier hs-var">runtime</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679378326"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679378321"><span class="hs-identifier hs-var">docReference</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall v. Var v =&gt; PrettyPrintEnvDecl -&gt; EvaluatedDoc v -&gt; Doc
</span><a href="Unison.Server.Doc.html#renderDoc"><span class="hs-identifier hs-var">Doc.renderDoc</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679378322"><span class="hs-identifier hs-var">ppe</span></a></span><span>
</span><span id="line-455"></span><span>        </span><span class="hs-identifier">pure</span><span> </span><span class="annot"><span class="annottext">Doc
</span><a href="#local-6989586621679378320"><span class="hs-identifier hs-var">doc</span></a></span><span>
</span><span id="line-456"></span><span>
</span><span id="line-457"></span><span>      </span><span class="hs-comment">-- choose the first term (among conflicted terms) matching any of these names, in this order.</span><span>
</span><span id="line-458"></span><span>      </span><span class="hs-comment">-- we might later want to return all of them to let the front end decide</span><span>
</span><span id="line-459"></span><span>      </span><span id="local-6989586621679378318"><span class="annot"><span class="annottext">toCheck :: [NameSegment]
</span><a href="#local-6989586621679378318"><span class="hs-identifier hs-var hs-var">toCheck</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">Set.toList</span></span><span> </span><span class="annot"><span class="annottext">Set NameSegment
</span><a href="#local-6989586621679378329"><span class="hs-identifier hs-var">names</span></a></span><span>
</span><span id="line-460"></span><span>      </span><span class="annot"><a href="#local-6989586621679378316"><span class="hs-identifier hs-type">readme</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span>
</span><span id="line-461"></span><span>      </span><span id="local-6989586621679378316"><span class="annot"><span class="annottext">readme :: Maybe TypeReference
</span><a href="#local-6989586621679378316"><span class="hs-identifier hs-var hs-var">readme</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; Maybe a
</span><span class="hs-identifier hs-var">listToMaybe</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-462"></span><span>        </span><span id="local-6989586621679378314"><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621679378314"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[NameSegment]
</span><a href="#local-6989586621679378318"><span class="hs-identifier hs-var">toCheck</span></a></span><span>
</span><span id="line-463"></span><span>        </span><span id="local-6989586621679378313"><span class="annot"><span class="annottext">Map Referent (m MdValues)
</span><a href="#local-6989586621679378313"><span class="hs-identifier hs-var">term</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621679378314"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Map NameSegment (Map Referent (m MdValues))
</span><a href="#local-6989586621679378311"><span class="hs-identifier hs-var">termsMap</span></a></span><span>
</span><span id="line-464"></span><span>        </span><span id="local-6989586621679378310"><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679378310"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall k a. Map k a -&gt; [k]
</span><span class="hs-identifier hs-var">Map.keys</span></span><span> </span><span class="annot"><span class="annottext">Map Referent (m MdValues)
</span><a href="#local-6989586621679378313"><span class="hs-identifier hs-var">term</span></a></span><span>
</span><span id="line-465"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679378310"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-466"></span><span>          </span><span class="hs-comment">-- This shouldn't ever happen unless someone puts a non-doc as their readme.</span><span>
</span><span id="line-467"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">V2Referent.Con</span></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Alternative f =&gt; f a
</span><span class="hs-identifier hs-var">empty</span></span><span>
</span><span id="line-468"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">V2Referent.Ref</span></span><span> </span><span id="local-6989586621679378305"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679378305"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; TypeReference
</span><span class="hs-identifier hs-var">Cv.reference2to1</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679378305"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-469"></span><span>        </span><span class="hs-keyword">where</span><span>
</span><span id="line-470"></span><span>          </span><span id="local-6989586621679378311"><span class="annot"><span class="annottext">termsMap :: Map NameSegment (Map Referent (m MdValues))
</span><a href="#local-6989586621679378311"><span class="hs-identifier hs-var hs-var">termsMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
Branch m -&gt; Map NameSegment (Map Referent (m MdValues))
</span><span class="hs-identifier hs-var">V2Branch.terms</span></span><span> </span><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621679378324"><span class="hs-identifier hs-var">namespaceBranch</span></a></span><span>
</span><span id="line-471"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-472"></span><span>        </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrettyPrintEnvDecl -&gt; TypeReference -&gt; IO Doc
</span><a href="#local-6989586621679378323"><span class="hs-identifier hs-var">renderReadme</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679378325"><span class="hs-identifier hs-var">ppe</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe TypeReference
</span><a href="#local-6989586621679378316"><span class="hs-identifier hs-var">readme</span></a></span><span>
</span><span id="line-473"></span><span>
</span><span id="line-474"></span><span id="local-6989586621679379933"><span class="annot"><a href="Unison.Server.Backend.html#isDoc"><span class="hs-identifier hs-type">isDoc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><a href="#local-6989586621679379933"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent.Referent</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Sqlite.Transaction</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-475"></span><span id="isDoc"><span class="annot"><span class="annottext">isDoc :: forall (m :: * -&gt; *).
Codebase m Symbol Ann -&gt; Referent -&gt; Transaction Bool
</span><a href="Unison.Server.Backend.html#isDoc"><span class="hs-identifier hs-var hs-var">isDoc</span></a></span></span><span> </span><span id="local-6989586621679378299"><span class="annot"><span class="annottext">Codebase m Symbol Ann
</span><a href="#local-6989586621679378299"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621679378298"><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679378298"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-476"></span><span>  </span><span id="local-6989586621679378297"><span class="annot"><span class="annottext">Maybe (Type Symbol Ann)
</span><a href="#local-6989586621679378297"><span class="hs-identifier hs-var">ot</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
Codebase m Symbol Ann
-&gt; Referent -&gt; Transaction (Maybe (Type Symbol Ann))
</span><a href="Unison.Server.Backend.html#loadReferentType"><span class="hs-identifier hs-var">loadReferentType</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase m Symbol Ann
</span><a href="#local-6989586621679378299"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679378298"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-477"></span><span>  </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span> </span><span class="annot"><span class="annottext">forall v loc. (Var v, Monoid loc) =&gt; Maybe (Type v loc) -&gt; Bool
</span><a href="Unison.Server.Backend.html#isDoc%27"><span class="hs-identifier hs-var">isDoc'</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Type Symbol Ann)
</span><a href="#local-6989586621679378297"><span class="hs-identifier hs-var">ot</span></a></span><span>
</span><span id="line-478"></span><span>
</span><span id="line-479"></span><span id="local-6989586621679379930"><span id="local-6989586621679379931"><span class="annot"><a href="Unison.Server.Backend.html#isDoc%27"><span class="hs-identifier hs-type">isDoc'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Var</span></span><span> </span><span class="annot"><a href="#local-6989586621679379931"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="#local-6989586621679379930"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><a href="#local-6989586621679379931"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679379930"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span></span><span>
</span><span id="line-480"></span><span id="isDoc%27"><span class="annot"><span class="annottext">isDoc' :: forall v loc. (Var v, Monoid loc) =&gt; Maybe (Type v loc) -&gt; Bool
</span><a href="Unison.Server.Backend.html#isDoc%27"><span class="hs-identifier hs-var hs-var">isDoc'</span></a></span></span><span> </span><span id="local-6989586621679378283"><span class="annot"><span class="annottext">Maybe (Type v loc)
</span><a href="#local-6989586621679378283"><span class="hs-identifier hs-var">typeOfTerm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-481"></span><span>  </span><span class="hs-comment">-- A term is a dococ if its type conforms to the `Doc` type.</span><span>
</span><span id="line-482"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (Type v loc)
</span><a href="#local-6989586621679378283"><span class="hs-identifier hs-var">typeOfTerm</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-483"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679378282"><span class="annot"><span class="annottext">Type v loc
</span><a href="#local-6989586621679378282"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-484"></span><span>      </span><span class="annot"><span class="annottext">forall v loc. Var v =&gt; Type v loc -&gt; Type v loc -&gt; Bool
</span><span class="hs-identifier hs-var">Typechecker.isSubtype</span></span><span> </span><span class="annot"><span class="annottext">Type v loc
</span><a href="#local-6989586621679378282"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">forall v a. (Ord v, Monoid a) =&gt; Type v a
</span><a href="Unison.Server.Backend.html#doc1Type"><span class="hs-identifier hs-var">doc1Type</span></a></span><span>
</span><span id="line-485"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">forall v loc. Var v =&gt; Type v loc -&gt; Type v loc -&gt; Bool
</span><span class="hs-identifier hs-var">Typechecker.isSubtype</span></span><span> </span><span class="annot"><span class="annottext">Type v loc
</span><a href="#local-6989586621679378282"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">forall v a. (Ord v, Monoid a) =&gt; Type v a
</span><a href="Unison.Server.Backend.html#doc2Type"><span class="hs-identifier hs-var">doc2Type</span></a></span><span>
</span><span id="line-486"></span><span>    </span><span class="annot"><span class="annottext">Maybe (Type v loc)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-487"></span><span>
</span><span id="line-488"></span><span id="local-6989586621679379922"><span id="local-6989586621679379923"><span class="annot"><a href="Unison.Server.Backend.html#doc1Type"><span class="hs-identifier hs-type">doc1Type</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679379923"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="#local-6989586621679379922"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><a href="#local-6989586621679379923"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679379922"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-489"></span><span id="doc1Type"><span class="annot"><span class="annottext">doc1Type :: forall v a. (Ord v, Monoid a) =&gt; Type v a
</span><a href="Unison.Server.Backend.html#doc1Type"><span class="hs-identifier hs-var hs-var">doc1Type</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall v a. Ord v =&gt; a -&gt; TypeReference -&gt; Type v a
</span><span class="hs-identifier hs-var">Type.ref</span></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><span class="hs-identifier hs-var">Decls.docRef</span></span><span>
</span><span id="line-490"></span><span>
</span><span id="line-491"></span><span id="local-6989586621679378270"><span id="local-6989586621679378271"><span class="annot"><a href="Unison.Server.Backend.html#doc2Type"><span class="hs-identifier hs-type">doc2Type</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679378271"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="#local-6989586621679378270"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><a href="#local-6989586621679378271"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679378270"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-492"></span><span id="doc2Type"><span class="annot"><span class="annottext">doc2Type :: forall v a. (Ord v, Monoid a) =&gt; Type v a
</span><a href="Unison.Server.Backend.html#doc2Type"><span class="hs-identifier hs-var hs-var">doc2Type</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall v a. Ord v =&gt; a -&gt; TypeReference -&gt; Type v a
</span><span class="hs-identifier hs-var">Type.ref</span></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><span class="hs-identifier hs-var">DD.doc2Ref</span></span><span>
</span><span id="line-493"></span><span>
</span><span id="line-494"></span><span class="annot"><a href="Unison.Server.Backend.html#isTestResultList"><span class="hs-identifier hs-type">isTestResultList</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679378264"><span class="annot"><a href="#local-6989586621679378264"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span id="local-6989586621679378263"><span class="annot"><a href="#local-6989586621679378263"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Var</span></span><span> </span><span class="annot"><a href="#local-6989586621679378264"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="#local-6989586621679378263"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><a href="#local-6989586621679378264"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679378263"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-495"></span><span id="isTestResultList"><span class="annot"><span class="annottext">isTestResultList :: forall v loc. (Var v, Monoid loc) =&gt; Maybe (Type v loc) -&gt; Bool
</span><a href="Unison.Server.Backend.html#isTestResultList"><span class="hs-identifier hs-var hs-var">isTestResultList</span></a></span></span><span> </span><span id="local-6989586621679378255"><span class="annot"><span class="annottext">Maybe (Type v a)
</span><a href="#local-6989586621679378255"><span class="hs-identifier hs-var">typ</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (Type v a)
</span><a href="#local-6989586621679378255"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-496"></span><span>  </span><span class="annot"><span class="annottext">Maybe (Type v a)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-497"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679378254"><span class="annot"><span class="annottext">Type v a
</span><a href="#local-6989586621679378254"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall v loc. Var v =&gt; Type v loc -&gt; Type v loc -&gt; Bool
</span><span class="hs-identifier hs-var">Typechecker.isSubtype</span></span><span> </span><span class="annot"><span class="annottext">Type v a
</span><a href="#local-6989586621679378254"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">forall v a. (Ord v, Monoid a) =&gt; Type v a
</span><a href="Unison.Server.Backend.html#resultListType"><span class="hs-identifier hs-var">resultListType</span></a></span><span>
</span><span id="line-498"></span><span>
</span><span id="line-499"></span><span id="local-6989586621679378251"><span id="local-6989586621679378252"><span class="annot"><a href="Unison.Server.Backend.html#resultListType"><span class="hs-identifier hs-type">resultListType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679378252"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="#local-6989586621679378251"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><a href="#local-6989586621679378252"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679378251"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-500"></span><span id="resultListType"><span class="annot"><span class="annottext">resultListType :: forall v a. (Ord v, Monoid a) =&gt; Type v a
</span><a href="Unison.Server.Backend.html#resultListType"><span class="hs-identifier hs-var hs-var">resultListType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall v a. Ord v =&gt; a -&gt; Type v a -&gt; Type v a -&gt; Type v a
</span><span class="hs-identifier hs-var">Type.app</span></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall v a. Ord v =&gt; a -&gt; Type v a
</span><span class="hs-identifier hs-var">Type.list</span></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall v a. Ord v =&gt; a -&gt; TypeReference -&gt; Type v a
</span><span class="hs-identifier hs-var">Type.ref</span></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><span class="hs-identifier hs-var">Decls.testResultRef</span></span><span class="hs-special">)</span><span>
</span><span id="line-501"></span><span>
</span><span id="line-502"></span><span id="local-6989586621679379906"><span id="local-6989586621679379907"><span class="annot"><a href="Unison.Server.Backend.html#termListEntry"><span class="hs-identifier hs-type">termListEntry</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-503"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679379907"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-504"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><a href="#local-6989586621679379907"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-505"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">V2Branch.Branch</span></span><span> </span><span class="annot"><a href="#local-6989586621679379906"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-506"></span><span>  </span><span class="annot"><a href="Unison.Server.Types.html#ExactName"><span class="hs-identifier hs-type">ExactName</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NameSegment</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">V2Referent.Referent</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-507"></span><span>  </span><span class="annot"><a href="#local-6989586621679379907"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.Backend.html#TermEntry"><span class="hs-identifier hs-type">TermEntry</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-508"></span><span id="termListEntry"><span class="annot"><span class="annottext">termListEntry :: forall (m :: * -&gt; *) (n :: * -&gt; *).
MonadIO m =&gt;
Codebase m Symbol Ann
-&gt; Branch n
-&gt; ExactName NameSegment Referent
-&gt; m (TermEntry Symbol Ann)
</span><a href="Unison.Server.Backend.html#termListEntry"><span class="hs-identifier hs-var hs-var">termListEntry</span></a></span></span><span> </span><span id="local-6989586621679378223"><span class="annot"><span class="annottext">Codebase m Symbol Ann
</span><a href="#local-6989586621679378223"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621679378222"><span class="annot"><span class="annottext">Branch n
</span><a href="#local-6989586621679378222"><span class="hs-identifier hs-var">branch</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.Types.html#ExactName"><span class="hs-identifier hs-type">ExactName</span></a></span><span> </span><span id="local-6989586621679378220"><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621679378220"><span class="hs-identifier hs-var">nameSegment</span></a></span></span><span> </span><span id="local-6989586621679378219"><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679378219"><span class="hs-identifier hs-var">ref</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-509"></span><span>  </span><span id="local-6989586621679378218"><span class="annot"><span class="annottext">Maybe (Type Symbol Ann)
</span><a href="#local-6989586621679378218"><span class="hs-identifier hs-var">ot</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) v a b.
MonadIO m =&gt;
Codebase m v a -&gt; Transaction b -&gt; m b
</span><span class="hs-identifier hs-var">Codebase.runTransaction</span></span><span> </span><span class="annot"><span class="annottext">Codebase m Symbol Ann
</span><a href="#local-6989586621679378223"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-510"></span><span>    </span><span id="local-6989586621679378217"><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679378217"><span class="hs-identifier hs-var">v1Referent</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
Applicative m =&gt;
(Reference -&gt; m ConstructorType) -&gt; Referent -&gt; m Referent
</span><span class="hs-identifier hs-var">Cv.referent2to1</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) v a.
Codebase m v a -&gt; Reference -&gt; Transaction ConstructorType
</span><span class="hs-identifier hs-var">Codebase.getDeclType</span></span><span> </span><span class="annot"><span class="annottext">Codebase m Symbol Ann
</span><a href="#local-6989586621679378223"><span class="hs-identifier hs-var">codebase</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679378219"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-511"></span><span>    </span><span id="local-6989586621679378216"><span class="annot"><span class="annottext">Maybe (Type Symbol Ann)
</span><a href="#local-6989586621679378216"><span class="hs-identifier hs-var">ot</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
Codebase m Symbol Ann
-&gt; Referent -&gt; Transaction (Maybe (Type Symbol Ann))
</span><a href="Unison.Server.Backend.html#loadReferentType"><span class="hs-identifier hs-var">loadReferentType</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase m Symbol Ann
</span><a href="#local-6989586621679378223"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679378217"><span class="hs-identifier hs-var">v1Referent</span></a></span><span>
</span><span id="line-512"></span><span>    </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (Type Symbol Ann)
</span><a href="#local-6989586621679378216"><span class="hs-identifier hs-var">ot</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-513"></span><span>  </span><span id="local-6989586621679378215"><span class="annot"><span class="annottext">TermTag
</span><a href="#local-6989586621679378215"><span class="hs-identifier hs-var">tag</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall v (m :: * -&gt; *) a.
(Var v, MonadIO m) =&gt;
Codebase m v a -&gt; Referent -&gt; Maybe (Type v Ann) -&gt; m TermTag
</span><a href="Unison.Server.Backend.html#getTermTag"><span class="hs-identifier hs-var">getTermTag</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase m Symbol Ann
</span><a href="#local-6989586621679378223"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679378219"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Type Symbol Ann)
</span><a href="#local-6989586621679378218"><span class="hs-identifier hs-var">ot</span></a></span><span>
</span><span id="line-514"></span><span>  </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span>
</span><span id="line-515"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#TermEntry"><span class="hs-identifier hs-type">TermEntry</span></a></span><span>
</span><span id="line-516"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:termEntryReferent:TermEntry :: Referent
</span><a href="Unison.Server.Backend.html#%24sel%3AtermEntryReferent%3ATermEntry"><span class="hs-identifier hs-var">termEntryReferent</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679378219"><span class="hs-identifier hs-var">ref</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-517"></span><span>        </span><span class="annot"><span class="annottext">$sel:termEntryName:TermEntry :: NameSegment
</span><a href="Unison.Server.Backend.html#%24sel%3AtermEntryName%3ATermEntry"><span class="hs-identifier hs-var">termEntryName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621679378220"><span class="hs-identifier hs-var">nameSegment</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-518"></span><span>        </span><span class="annot"><span class="annottext">$sel:termEntryType:TermEntry :: Maybe (Type Symbol Ann)
</span><a href="Unison.Server.Backend.html#%24sel%3AtermEntryType%3ATermEntry"><span class="hs-identifier hs-var">termEntryType</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Type Symbol Ann)
</span><a href="#local-6989586621679378218"><span class="hs-identifier hs-var">ot</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-519"></span><span>        </span><span class="annot"><span class="annottext">$sel:termEntryTag:TermEntry :: TermTag
</span><a href="Unison.Server.Backend.html#%24sel%3AtermEntryTag%3ATermEntry"><span class="hs-identifier hs-var">termEntryTag</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TermTag
</span><a href="#local-6989586621679378215"><span class="hs-identifier hs-var">tag</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-520"></span><span>        </span><span class="annot"><span class="annottext">$sel:termEntryConflicted:TermEntry :: Bool
</span><a href="Unison.Server.Backend.html#%24sel%3AtermEntryConflicted%3ATermEntry"><span class="hs-identifier hs-var">termEntryConflicted</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679378214"><span class="hs-identifier hs-var">isConflicted</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-521"></span><span>        </span><span class="annot"><span class="annottext">$sel:termEntryHash:TermEntry :: ShortHash
</span><a href="Unison.Server.Backend.html#%24sel%3AtermEntryHash%3ATermEntry"><span class="hs-identifier hs-var">termEntryHash</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Int -&gt; Referent -&gt; ShortHash
</span><span class="hs-identifier hs-var">Cv.referent2toshorthash1</span></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679378219"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-522"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-523"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-524"></span><span>    </span><span id="local-6989586621679378214"><span class="annot"><span class="annottext">isConflicted :: Bool
</span><a href="#local-6989586621679378214"><span class="hs-identifier hs-var hs-var">isConflicted</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-525"></span><span>      </span><span class="annot"><span class="annottext">Branch n
</span><a href="#local-6989586621679378222"><span class="hs-identifier hs-var">branch</span></a></span><span>
</span><span id="line-526"></span><span>        </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
Branch m -&gt; Map NameSegment (Map Referent (m MdValues))
</span><span class="hs-identifier hs-var">V2Branch.terms</span></span><span>
</span><span id="line-527"></span><span>        </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621679378220"><span class="hs-identifier hs-var">nameSegment</span></a></span><span>
</span><span id="line-528"></span><span>        </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">forall k a. Map k a -&gt; Int
</span><span class="hs-identifier hs-var">Map.size</span></span><span>
</span><span id="line-529"></span><span>        </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-530"></span><span>
</span><span id="line-531"></span><span id="local-6989586621679379900"><span id="local-6989586621679379901"><span id="local-6989586621679379902"><span class="annot"><a href="Unison.Server.Backend.html#getTermTag"><span class="hs-identifier hs-type">getTermTag</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-532"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Var</span></span><span> </span><span class="annot"><a href="#local-6989586621679379902"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679379901"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-533"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><a href="#local-6989586621679379901"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679379902"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679379900"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-534"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">V2Referent.Referent</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-535"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><a href="#local-6989586621679379902"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-536"></span><span>  </span><span class="annot"><a href="#local-6989586621679379901"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Unison.Server.Types.html#TermTag"><span class="hs-identifier hs-type">TermTag</span></a></span></span></span></span><span>
</span><span id="line-537"></span><span id="getTermTag"><span class="annot"><span class="annottext">getTermTag :: forall v (m :: * -&gt; *) a.
(Var v, MonadIO m) =&gt;
Codebase m v a -&gt; Referent -&gt; Maybe (Type v Ann) -&gt; m TermTag
</span><a href="Unison.Server.Backend.html#getTermTag"><span class="hs-identifier hs-var hs-var">getTermTag</span></a></span></span><span> </span><span id="local-6989586621679378189"><span class="annot"><span class="annottext">Codebase m v a
</span><a href="#local-6989586621679378189"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621679378188"><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679378188"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621679378187"><span class="annot"><span class="annottext">Maybe (Type v Ann)
</span><a href="#local-6989586621679378187"><span class="hs-identifier hs-var">sig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-538"></span><span>  </span><span class="hs-comment">-- A term is a doc if its type conforms to the `Doc` type.</span><span>
</span><span id="line-539"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679378186"><span class="annot"><span class="annottext">isDoc :: Bool
</span><a href="#local-6989586621679378186"><span class="hs-identifier hs-var hs-var">isDoc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (Type v Ann)
</span><a href="#local-6989586621679378187"><span class="hs-identifier hs-var">sig</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-540"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679378185"><span class="annot"><span class="annottext">Type v Ann
</span><a href="#local-6989586621679378185"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-541"></span><span>          </span><span class="annot"><span class="annottext">forall v loc. Var v =&gt; Type v loc -&gt; Type v loc -&gt; Bool
</span><span class="hs-identifier hs-var">Typechecker.isSubtype</span></span><span> </span><span class="annot"><span class="annottext">Type v Ann
</span><a href="#local-6989586621679378185"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall v a. Ord v =&gt; a -&gt; TypeReference -&gt; Type v a
</span><span class="hs-identifier hs-var">Type.ref</span></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><span class="hs-identifier hs-var">Decls.docRef</span></span><span class="hs-special">)</span><span>
</span><span id="line-542"></span><span>            </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">forall v loc. Var v =&gt; Type v loc -&gt; Type v loc -&gt; Bool
</span><span class="hs-identifier hs-var">Typechecker.isSubtype</span></span><span> </span><span class="annot"><span class="annottext">Type v Ann
</span><a href="#local-6989586621679378185"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall v a. Ord v =&gt; a -&gt; TypeReference -&gt; Type v a
</span><span class="hs-identifier hs-var">Type.ref</span></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><span class="hs-identifier hs-var">DD.doc2Ref</span></span><span class="hs-special">)</span><span>
</span><span id="line-543"></span><span>        </span><span class="annot"><span class="annottext">Maybe (Type v Ann)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-544"></span><span>  </span><span class="hs-comment">-- A term is a test if it has the type [test.Result]</span><span>
</span><span id="line-545"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679378184"><span class="annot"><span class="annottext">isTest :: Bool
</span><a href="#local-6989586621679378184"><span class="hs-identifier hs-var hs-var">isTest</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (Type v Ann)
</span><a href="#local-6989586621679378187"><span class="hs-identifier hs-var">sig</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-546"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679378183"><span class="annot"><span class="annottext">Type v Ann
</span><a href="#local-6989586621679378183"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-547"></span><span>          </span><span class="annot"><span class="annottext">forall v loc. Var v =&gt; Type v loc -&gt; Type v loc -&gt; Bool
</span><span class="hs-identifier hs-var">Typechecker.isSubtype</span></span><span> </span><span class="annot"><span class="annottext">Type v Ann
</span><a href="#local-6989586621679378183"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall v a. Ord v =&gt; a -&gt; Type v a
</span><span class="hs-identifier hs-var">Decls.testResultType</span></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">)</span><span>
</span><span id="line-548"></span><span>        </span><span class="annot"><span class="annottext">Maybe (Type v Ann)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-549"></span><span>  </span><span id="local-6989586621679378181"><span class="annot"><span class="annottext">Maybe ConstructorType
</span><a href="#local-6989586621679378181"><span class="hs-identifier hs-var">constructorType</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679378188"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-550"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">V2Referent.Ref</span></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-551"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">V2Referent.Con</span></span><span> </span><span id="local-6989586621679378180"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679378180"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span class="annot"><span class="annottext">ConstructorId
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) v a b.
MonadIO m =&gt;
Codebase m v a -&gt; Transaction b -&gt; m b
</span><span class="hs-identifier hs-var">Codebase.runTransaction</span></span><span> </span><span class="annot"><span class="annottext">Codebase m v a
</span><a href="#local-6989586621679378189"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) v a.
Codebase m v a -&gt; Reference -&gt; Transaction ConstructorType
</span><span class="hs-identifier hs-var">Codebase.getDeclType</span></span><span> </span><span class="annot"><span class="annottext">Codebase m v a
</span><a href="#local-6989586621679378189"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679378180"><span class="hs-identifier hs-var">ref</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-552"></span><span>  </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span>
</span><span id="line-553"></span><span>    </span><span class="hs-keyword">if</span><span>
</span><span id="line-554"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679378186"><span class="hs-identifier hs-var">isDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TermTag
</span><a href="Unison.Server.Types.html#Doc"><span class="hs-identifier hs-var">Doc</span></a></span><span>
</span><span id="line-555"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679378184"><span class="hs-identifier hs-var">isTest</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TermTag
</span><a href="Unison.Server.Types.html#Test"><span class="hs-identifier hs-var">Test</span></a></span><span>
</span><span id="line-556"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">ConstructorType
</span><span class="hs-identifier hs-var">CT.Effect</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe ConstructorType
</span><a href="#local-6989586621679378181"><span class="hs-identifier hs-var">constructorType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeTag -&gt; TermTag
</span><a href="Unison.Server.Types.html#Constructor"><span class="hs-identifier hs-var">Constructor</span></a></span><span> </span><span class="annot"><span class="annottext">TypeTag
</span><a href="Unison.Server.Types.html#Ability"><span class="hs-identifier hs-var">Ability</span></a></span><span>
</span><span id="line-557"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">ConstructorType
</span><span class="hs-identifier hs-var">CT.Data</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe ConstructorType
</span><a href="#local-6989586621679378181"><span class="hs-identifier hs-var">constructorType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeTag -&gt; TermTag
</span><a href="Unison.Server.Types.html#Constructor"><span class="hs-identifier hs-var">Constructor</span></a></span><span> </span><span class="annot"><span class="annottext">TypeTag
</span><a href="Unison.Server.Types.html#Data"><span class="hs-identifier hs-var">Data</span></a></span><span>
</span><span id="line-558"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TermTag
</span><a href="Unison.Server.Types.html#Plain"><span class="hs-identifier hs-var">Plain</span></a></span><span>
</span><span id="line-559"></span><span>
</span><span id="line-560"></span><span id="local-6989586621679379891"><span id="local-6989586621679379892"><span class="annot"><a href="Unison.Server.Backend.html#getTypeTag"><span class="hs-identifier hs-type">getTypeTag</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-561"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Var</span></span><span> </span><span class="annot"><a href="#local-6989586621679379892"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-562"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><a href="#local-6989586621679379891"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679379892"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-563"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-564"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Sqlite.Transaction</span></span><span> </span><span class="annot"><a href="Unison.Server.Types.html#TypeTag"><span class="hs-identifier hs-type">TypeTag</span></a></span></span></span><span>
</span><span id="line-565"></span><span id="getTypeTag"><span class="annot"><span class="annottext">getTypeTag :: forall v (m :: * -&gt; *).
Var v =&gt;
Codebase m v Ann -&gt; TypeReference -&gt; Transaction TypeTag
</span><a href="Unison.Server.Backend.html#getTypeTag"><span class="hs-identifier hs-var hs-var">getTypeTag</span></a></span></span><span> </span><span id="local-6989586621679378167"><span class="annot"><span class="annottext">Codebase m v Ann
</span><a href="#local-6989586621679378167"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621679378166"><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679378166"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-566"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TypeReference -&gt; Maybe Id
</span><span class="hs-identifier hs-var">Reference.toId</span></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679378166"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-567"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679378164"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679378164"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-568"></span><span>      </span><span id="local-6989586621679378163"><span class="annot"><span class="annottext">Maybe (Decl v Ann)
</span><a href="#local-6989586621679378163"><span class="hs-identifier hs-var">decl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) v a.
Codebase m v a -&gt; Id -&gt; Transaction (Maybe (Decl v a))
</span><span class="hs-identifier hs-var">Codebase.getTypeDeclaration</span></span><span> </span><span class="annot"><span class="annottext">Codebase m v Ann
</span><a href="#local-6989586621679378167"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679378164"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-569"></span><span>      </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (Decl v Ann)
</span><a href="#local-6989586621679378163"><span class="hs-identifier hs-var">decl</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-570"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="annot"><span class="annottext">EffectDeclaration v Ann
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeTag
</span><a href="Unison.Server.Types.html#Ability"><span class="hs-identifier hs-var">Ability</span></a></span><span>
</span><span id="line-571"></span><span>        </span><span class="annot"><span class="annottext">Maybe (Decl v Ann)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeTag
</span><a href="Unison.Server.Types.html#Data"><span class="hs-identifier hs-var">Data</span></a></span><span>
</span><span id="line-572"></span><span>    </span><span class="annot"><span class="annottext">Maybe Id
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-identifier hs-var">Set.member</span></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679378166"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Set TypeReference
</span><span class="hs-identifier hs-var">Type.builtinAbilities</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">TypeTag
</span><a href="Unison.Server.Types.html#Ability"><span class="hs-identifier hs-var">Ability</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">TypeTag
</span><a href="Unison.Server.Types.html#Data"><span class="hs-identifier hs-var">Data</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-573"></span><span>
</span><span id="line-574"></span><span id="local-6989586621679379885"><span id="local-6989586621679379886"><span id="local-6989586621679379887"><span class="annot"><a href="Unison.Server.Backend.html#typeListEntry"><span class="hs-identifier hs-type">typeListEntry</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-575"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Var</span></span><span> </span><span class="annot"><a href="#local-6989586621679379887"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-576"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><a href="#local-6989586621679379886"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679379887"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-577"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">V2Branch.Branch</span></span><span> </span><span class="annot"><a href="#local-6989586621679379885"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-578"></span><span>  </span><span class="annot"><a href="Unison.Server.Types.html#ExactName"><span class="hs-identifier hs-type">ExactName</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NameSegment</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-579"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Sqlite.Transaction</span></span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#TypeEntry"><span class="hs-identifier hs-type">TypeEntry</span></a></span></span></span></span><span>
</span><span id="line-580"></span><span id="typeListEntry"><span class="annot"><span class="annottext">typeListEntry :: forall v (m :: * -&gt; *) (n :: * -&gt; *).
Var v =&gt;
Codebase m v Ann
-&gt; Branch n
-&gt; ExactName NameSegment TypeReference
-&gt; Transaction TypeEntry
</span><a href="Unison.Server.Backend.html#typeListEntry"><span class="hs-identifier hs-var hs-var">typeListEntry</span></a></span></span><span> </span><span id="local-6989586621679378152"><span class="annot"><span class="annottext">Codebase m v Ann
</span><a href="#local-6989586621679378152"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621679378151"><span class="annot"><span class="annottext">Branch n
</span><a href="#local-6989586621679378151"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.Types.html#ExactName"><span class="hs-identifier hs-type">ExactName</span></a></span><span> </span><span id="local-6989586621679378150"><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621679378150"><span class="hs-identifier hs-var">nameSegment</span></a></span></span><span> </span><span id="local-6989586621679378149"><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679378149"><span class="hs-identifier hs-var">ref</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-581"></span><span>  </span><span id="local-6989586621679378148"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679378148"><span class="hs-identifier hs-var">hashLength</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Transaction Int
</span><span class="hs-identifier hs-var">Codebase.hashLength</span></span><span>
</span><span id="line-582"></span><span>  </span><span id="local-6989586621679378147"><span class="annot"><span class="annottext">TypeTag
</span><a href="#local-6989586621679378147"><span class="hs-identifier hs-var">tag</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall v (m :: * -&gt; *).
Var v =&gt;
Codebase m v Ann -&gt; TypeReference -&gt; Transaction TypeTag
</span><a href="Unison.Server.Backend.html#getTypeTag"><span class="hs-identifier hs-var">getTypeTag</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase m v Ann
</span><a href="#local-6989586621679378152"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679378149"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-583"></span><span>  </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span>
</span><span id="line-584"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#TypeEntry"><span class="hs-identifier hs-type">TypeEntry</span></a></span><span>
</span><span id="line-585"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:typeEntryReference:TypeEntry :: TypeReference
</span><a href="Unison.Server.Backend.html#%24sel%3AtypeEntryReference%3ATypeEntry"><span class="hs-identifier hs-var">typeEntryReference</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679378149"><span class="hs-identifier hs-var">ref</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-586"></span><span>        </span><span class="annot"><span class="annottext">$sel:typeEntryName:TypeEntry :: NameSegment
</span><a href="Unison.Server.Backend.html#%24sel%3AtypeEntryName%3ATypeEntry"><span class="hs-identifier hs-var">typeEntryName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621679378150"><span class="hs-identifier hs-var">nameSegment</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-587"></span><span>        </span><span class="annot"><span class="annottext">$sel:typeEntryConflicted:TypeEntry :: Bool
</span><a href="Unison.Server.Backend.html#%24sel%3AtypeEntryConflicted%3ATypeEntry"><span class="hs-identifier hs-var">typeEntryConflicted</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679378146"><span class="hs-identifier hs-var">isConflicted</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-588"></span><span>        </span><span class="annot"><span class="annottext">$sel:typeEntryTag:TypeEntry :: TypeTag
</span><a href="Unison.Server.Backend.html#%24sel%3AtypeEntryTag%3ATypeEntry"><span class="hs-identifier hs-var">typeEntryTag</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeTag
</span><a href="#local-6989586621679378147"><span class="hs-identifier hs-var">tag</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-589"></span><span>        </span><span class="annot"><span class="annottext">$sel:typeEntryHash:TypeEntry :: ShortHash
</span><a href="Unison.Server.Backend.html#%24sel%3AtypeEntryHash%3ATypeEntry"><span class="hs-identifier hs-var">typeEntryHash</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ShortHash -&gt; ShortHash
</span><span class="hs-identifier hs-var">SH.take</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679378148"><span class="hs-identifier hs-var">hashLength</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeReference -&gt; ShortHash
</span><span class="hs-identifier hs-var">Reference.toShortHash</span></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679378149"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-590"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-591"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-592"></span><span>    </span><span id="local-6989586621679378146"><span class="annot"><span class="annottext">isConflicted :: Bool
</span><a href="#local-6989586621679378146"><span class="hs-identifier hs-var hs-var">isConflicted</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-593"></span><span>      </span><span class="annot"><span class="annottext">Branch n
</span><a href="#local-6989586621679378151"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-594"></span><span>        </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
Branch m -&gt; Map NameSegment (Map Reference (m MdValues))
</span><span class="hs-identifier hs-var">V2Branch.types</span></span><span>
</span><span id="line-595"></span><span>        </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621679378150"><span class="hs-identifier hs-var">nameSegment</span></a></span><span>
</span><span id="line-596"></span><span>        </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">forall k a. Map k a -&gt; Int
</span><span class="hs-identifier hs-var">Map.size</span></span><span>
</span><span id="line-597"></span><span>        </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-598"></span><span>
</span><span id="line-599"></span><span class="annot"><a href="Unison.Server.Backend.html#typeDeclHeader"><span class="hs-identifier hs-type">typeDeclHeader</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-600"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679379881"><span class="annot"><a href="#local-6989586621679379881"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span id="local-6989586621679379880"><span class="annot"><a href="#local-6989586621679379880"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-601"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Var</span></span><span> </span><span class="annot"><a href="#local-6989586621679379881"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-602"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><a href="#local-6989586621679379880"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679379881"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-603"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">PPE.PrettyPrintEnv</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-604"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-605"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Sqlite.Transaction</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DisplayObject</span></span><span> </span><span class="annot"><a href="Unison.Server.Syntax.html#SyntaxText"><span class="hs-identifier hs-type">Syntax.SyntaxText</span></a></span><span> </span><span class="annot"><a href="Unison.Server.Syntax.html#SyntaxText"><span class="hs-identifier hs-type">Syntax.SyntaxText</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-606"></span><span id="typeDeclHeader"><span class="annot"><span class="annottext">typeDeclHeader :: forall v (m :: * -&gt; *).
Var v =&gt;
Codebase m v Ann
-&gt; PrettyPrintEnv
-&gt; TypeReference
-&gt; Transaction (DisplayObject SyntaxText SyntaxText)
</span><a href="Unison.Server.Backend.html#typeDeclHeader"><span class="hs-identifier hs-var hs-var">typeDeclHeader</span></a></span></span><span> </span><span id="local-6989586621679378137"><span class="annot"><span class="annottext">Codebase m v Ann
</span><a href="#local-6989586621679378137"><span class="hs-identifier hs-var">code</span></a></span></span><span> </span><span id="local-6989586621679378136"><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679378136"><span class="hs-identifier hs-var">ppe</span></a></span></span><span> </span><span id="local-6989586621679378135"><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679378135"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TypeReference -&gt; Maybe Id
</span><span class="hs-identifier hs-var">Reference.toId</span></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679378135"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-607"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679378134"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679378134"><span class="hs-identifier hs-var">rid</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-608"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) v a.
Codebase m v a -&gt; Id -&gt; Transaction (Maybe (Decl v a))
</span><span class="hs-identifier hs-var">Codebase.getTypeDeclaration</span></span><span> </span><span class="annot"><span class="annottext">Codebase m v Ann
</span><a href="#local-6989586621679378137"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679378134"><span class="hs-identifier hs-var">rid</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-609"></span><span>      </span><span class="annot"><span class="annottext">Maybe (Decl v Ann)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall b a. ShortHash -&gt; DisplayObject b a
</span><span class="hs-identifier hs-var">DisplayObject.MissingObject</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeReference -&gt; ShortHash
</span><span class="hs-identifier hs-var">Reference.toShortHash</span></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679378135"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-610"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679378132"><span class="annot"><span class="annottext">Decl v Ann
</span><a href="#local-6989586621679378132"><span class="hs-identifier hs-var">decl</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-611"></span><span>        </span><span class="annot"><span class="annottext">forall b a. a -&gt; DisplayObject b a
</span><span class="hs-identifier hs-var">DisplayObject.UserObject</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-612"></span><span>          </span><span class="annot"><span class="annottext">Element TypeReference -&gt; Element
</span><a href="Unison.Server.Syntax.html#convertElement"><span class="hs-identifier hs-var">Syntax.convertElement</span></a></span><span>
</span><span id="line-613"></span><span>            </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall s. (Monoid s, IsString s) =&gt; Width -&gt; Pretty s -&gt; s
</span><span class="hs-identifier hs-var">Pretty.render</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="Unison.Server.Types.html#defaultWidth"><span class="hs-identifier hs-var">defaultWidth</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall v a.
Var v =&gt;
HashQualified Name
-&gt; Either (EffectDeclaration v a) (DataDeclaration v a)
-&gt; Pretty SyntaxText
</span><span class="hs-identifier hs-var">DeclPrinter.prettyDeclHeader</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679378126"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Decl v Ann
</span><a href="#local-6989586621679378132"><span class="hs-identifier hs-var">decl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-614"></span><span>  </span><span class="annot"><span class="annottext">Maybe Id
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-615"></span><span>    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall b a. b -&gt; DisplayObject b a
</span><span class="hs-identifier hs-var">DisplayObject.BuiltinObject</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrettyPrintEnv -&gt; TypeReference -&gt; SyntaxText
</span><a href="Unison.Server.Backend.html#formatTypeName"><span class="hs-identifier hs-var">formatTypeName</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679378136"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679378135"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-616"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-617"></span><span>    </span><span id="local-6989586621679378126"><span class="annot"><span class="annottext">name :: HashQualified Name
</span><a href="#local-6989586621679378126"><span class="hs-identifier hs-var hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv -&gt; TypeReference -&gt; HashQualified Name
</span><span class="hs-identifier hs-var">PPE.typeName</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679378136"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679378135"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-618"></span><span>
</span><span id="line-619"></span><span class="annot"><a href="Unison.Server.Backend.html#formatTypeName"><span class="hs-identifier hs-type">formatTypeName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PPE.PrettyPrintEnv</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Server.Syntax.html#SyntaxText"><span class="hs-identifier hs-type">Syntax.SyntaxText</span></a></span><span>
</span><span id="line-620"></span><span id="formatTypeName"><span class="annot"><span class="annottext">formatTypeName :: PrettyPrintEnv -&gt; TypeReference -&gt; SyntaxText
</span><a href="Unison.Server.Backend.html#formatTypeName"><span class="hs-identifier hs-var hs-var">formatTypeName</span></a></span></span><span> </span><span id="local-6989586621679378122"><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679378122"><span class="hs-identifier hs-var">ppe</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-621"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Element TypeReference -&gt; Element
</span><a href="Unison.Server.Syntax.html#convertElement"><span class="hs-identifier hs-var">Syntax.convertElement</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv -&gt; TypeReference -&gt; SyntaxText
</span><a href="Unison.Server.Backend.html#formatTypeName%27"><span class="hs-identifier hs-var">formatTypeName'</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679378122"><span class="hs-identifier hs-var">ppe</span></a></span><span>
</span><span id="line-622"></span><span>
</span><span id="line-623"></span><span class="annot"><a href="Unison.Server.Backend.html#formatTypeName%27"><span class="hs-identifier hs-type">formatTypeName'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PPE.PrettyPrintEnv</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#SyntaxText"><span class="hs-identifier hs-type">SyntaxText</span></a></span><span>
</span><span id="line-624"></span><span id="formatTypeName%27"><span class="annot"><span class="annottext">formatTypeName' :: PrettyPrintEnv -&gt; TypeReference -&gt; SyntaxText
</span><a href="Unison.Server.Backend.html#formatTypeName%27"><span class="hs-identifier hs-var hs-var">formatTypeName'</span></a></span></span><span> </span><span id="local-6989586621679378120"><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679378120"><span class="hs-identifier hs-var">ppe</span></a></span></span><span> </span><span id="local-6989586621679378119"><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679378119"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-625"></span><span>  </span><span class="annot"><span class="annottext">forall s. (Monoid s, IsString s) =&gt; Pretty s -&gt; s
</span><span class="hs-identifier hs-var">Pretty.renderUnbroken</span></span><span>
</span><span id="line-626"></span><span>    </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall s.
IsString s =&gt;
(Pretty s -&gt; Pretty s) -&gt; HashQualified Name -&gt; Pretty s
</span><span class="hs-identifier hs-var">NP.styleHashQualified</span></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-627"></span><span>    </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv -&gt; TypeReference -&gt; HashQualified Name
</span><span class="hs-identifier hs-var">PPE.typeName</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679378120"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679378119"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-628"></span><span>
</span><span id="line-629"></span><span id="local-6989586621679379865"><span id="local-6989586621679379866"><span class="annot"><a href="Unison.Server.Backend.html#termEntryToNamedTerm"><span class="hs-identifier hs-type">termEntryToNamedTerm</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-630"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Var</span></span><span> </span><span class="annot"><a href="#local-6989586621679379866"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PPE.PrettyPrintEnv</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Width</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#TermEntry"><span class="hs-identifier hs-type">TermEntry</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679379866"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679379865"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Server.Types.html#NamedTerm"><span class="hs-identifier hs-type">NamedTerm</span></a></span></span></span><span>
</span><span id="line-631"></span><span id="termEntryToNamedTerm"><span class="annot"><span class="annottext">termEntryToNamedTerm :: forall v a.
Var v =&gt;
PrettyPrintEnv -&gt; Maybe Width -&gt; TermEntry v a -&gt; NamedTerm
</span><a href="Unison.Server.Backend.html#termEntryToNamedTerm"><span class="hs-identifier hs-var hs-var">termEntryToNamedTerm</span></a></span></span><span> </span><span id="local-6989586621679378113"><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679378113"><span class="hs-identifier hs-var">ppe</span></a></span></span><span> </span><span id="local-6989586621679378112"><span class="annot"><span class="annottext">Maybe Width
</span><a href="#local-6989586621679378112"><span class="hs-identifier hs-var">typeWidth</span></a></span></span><span> </span><span id="local-6989586621679378111"><span class="annot"><span class="annottext">te :: TermEntry v a
</span><a href="#local-6989586621679378111"><span class="hs-identifier hs-var">te</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Unison.Server.Backend.html#TermEntry"><span class="hs-identifier hs-type">TermEntry</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:termEntryType:TermEntry :: forall v a. TermEntry v a -&gt; Maybe (Type v a)
</span><a href="Unison.Server.Backend.html#%24sel%3AtermEntryType%3ATermEntry"><span class="hs-identifier hs-var">termEntryType</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679378110"><span class="annot"><span class="annottext">Maybe (Type v a)
</span><a href="#local-6989586621679378110"><span class="hs-identifier hs-var">mayType</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:termEntryTag:TermEntry :: forall v a. TermEntry v a -&gt; TermTag
</span><a href="Unison.Server.Backend.html#%24sel%3AtermEntryTag%3ATermEntry"><span class="hs-identifier hs-var">termEntryTag</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679378109"><span class="annot"><span class="annottext">TermTag
</span><a href="#local-6989586621679378109"><span class="hs-identifier hs-var">tag</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679378108"><span class="annot"><span class="annottext">ShortHash
termEntryHash :: ShortHash
$sel:termEntryHash:TermEntry :: forall v a. TermEntry v a -&gt; ShortHash
</span><a href="#local-6989586621679378108"><span class="hs-identifier hs-var hs-var">termEntryHash</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-632"></span><span>  </span><span class="annot"><a href="Unison.Server.Types.html#NamedTerm"><span class="hs-identifier hs-type">NamedTerm</span></a></span><span>
</span><span id="line-633"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:termName:NamedTerm :: HashQualified NameSegment
</span><a href="Unison.Server.Types.html#%24sel%3AtermName%3ANamedTerm"><span class="hs-identifier hs-var">termName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall v a. TermEntry v a -&gt; HashQualified NameSegment
</span><a href="Unison.Server.Backend.html#termEntryHQName"><span class="hs-identifier hs-var">termEntryHQName</span></a></span><span> </span><span class="annot"><span class="annottext">TermEntry v a
</span><a href="#local-6989586621679378111"><span class="hs-identifier hs-var">te</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-634"></span><span>      </span><span class="annot"><span class="annottext">$sel:termHash:NamedTerm :: ShortHash
</span><a href="Unison.Server.Types.html#%24sel%3AtermHash%3ANamedTerm"><span class="hs-identifier hs-var">termHash</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679378108"><span class="hs-identifier hs-var">termEntryHash</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-635"></span><span>      </span><span class="annot"><span class="annottext">$sel:termType:NamedTerm :: Maybe SyntaxText
</span><a href="Unison.Server.Types.html#%24sel%3AtermType%3ANamedTerm"><span class="hs-identifier hs-var">termType</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall v a.
Var v =&gt;
PrettyPrintEnv -&gt; Width -&gt; Type v a -&gt; SyntaxText
</span><a href="Unison.Server.Backend.html#formatType"><span class="hs-identifier hs-var">formatType</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679378113"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Width -&gt; Width
</span><a href="Unison.Server.Types.html#mayDefaultWidth"><span class="hs-identifier hs-var">mayDefaultWidth</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Width
</span><a href="#local-6989586621679378112"><span class="hs-identifier hs-var">typeWidth</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Type v a)
</span><a href="#local-6989586621679378110"><span class="hs-identifier hs-var">mayType</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-636"></span><span>      </span><span class="annot"><span class="annottext">$sel:termTag:NamedTerm :: TermTag
</span><a href="Unison.Server.Types.html#%24sel%3AtermTag%3ANamedTerm"><span class="hs-identifier hs-var">termTag</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TermTag
</span><a href="#local-6989586621679378109"><span class="hs-identifier hs-var">tag</span></a></span><span>
</span><span id="line-637"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-638"></span><span>
</span><span id="line-639"></span><span class="annot"><a href="Unison.Server.Backend.html#typeEntryToNamedType"><span class="hs-identifier hs-type">typeEntryToNamedType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#TypeEntry"><span class="hs-identifier hs-type">TypeEntry</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Server.Types.html#NamedType"><span class="hs-identifier hs-type">NamedType</span></a></span><span>
</span><span id="line-640"></span><span id="typeEntryToNamedType"><span class="annot"><span class="annottext">typeEntryToNamedType :: TypeEntry -&gt; NamedType
</span><a href="Unison.Server.Backend.html#typeEntryToNamedType"><span class="hs-identifier hs-var hs-var">typeEntryToNamedType</span></a></span></span><span> </span><span id="local-6989586621679378100"><span class="annot"><span class="annottext">te :: TypeEntry
</span><a href="#local-6989586621679378100"><span class="hs-identifier hs-var">te</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Unison.Server.Backend.html#TypeEntry"><span class="hs-identifier hs-type">TypeEntry</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679378099"><span class="annot"><span class="annottext">TypeTag
typeEntryTag :: TypeTag
$sel:typeEntryTag:TypeEntry :: TypeEntry -&gt; TypeTag
</span><a href="#local-6989586621679378099"><span class="hs-identifier hs-var hs-var">typeEntryTag</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679378098"><span class="annot"><span class="annottext">ShortHash
typeEntryHash :: ShortHash
$sel:typeEntryHash:TypeEntry :: TypeEntry -&gt; ShortHash
</span><a href="#local-6989586621679378098"><span class="hs-identifier hs-var hs-var">typeEntryHash</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-641"></span><span>  </span><span class="annot"><a href="Unison.Server.Types.html#NamedType"><span class="hs-identifier hs-type">NamedType</span></a></span><span>
</span><span id="line-642"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:typeName:NamedType :: HashQualified NameSegment
</span><a href="Unison.Server.Types.html#%24sel%3AtypeName%3ANamedType"><span class="hs-identifier hs-var">typeName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeEntry -&gt; HashQualified NameSegment
</span><a href="Unison.Server.Backend.html#typeEntryHQName"><span class="hs-identifier hs-var">typeEntryHQName</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeEntry
</span><a href="#local-6989586621679378100"><span class="hs-identifier hs-var">te</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-643"></span><span>      </span><span class="annot"><span class="annottext">$sel:typeHash:NamedType :: ShortHash
</span><a href="Unison.Server.Types.html#%24sel%3AtypeHash%3ANamedType"><span class="hs-identifier hs-var">typeHash</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679378098"><span class="hs-identifier hs-var">typeEntryHash</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-644"></span><span>      </span><span class="annot"><span class="annottext">$sel:typeTag:NamedType :: TypeTag
</span><a href="Unison.Server.Types.html#%24sel%3AtypeTag%3ANamedType"><span class="hs-identifier hs-var">typeTag</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeTag
</span><a href="#local-6989586621679378099"><span class="hs-identifier hs-var">typeEntryTag</span></a></span><span>
</span><span id="line-645"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-646"></span><span>
</span><span id="line-647"></span><span class="hs-comment">-- | Find all definitions and children reachable from the given 'V2Branch.Branch',</span><span>
</span><span id="line-648"></span><span id="local-6989586621679379950"><span id="local-6989586621679379951"><span class="annot"><a href="Unison.Server.Backend.html#lsBranch"><span class="hs-identifier hs-type">lsBranch</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-649"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679379951"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-650"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><a href="#local-6989586621679379951"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-651"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">V2Branch.Branch</span></span><span> </span><span class="annot"><a href="#local-6989586621679379950"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-652"></span><span>  </span><span class="annot"><a href="#local-6989586621679379951"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Unison.Server.Backend.html#ShallowListEntry"><span class="hs-identifier hs-type">ShallowListEntry</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">]</span></span></span><span>
</span><span id="line-653"></span><span id="lsBranch"><span class="annot"><span class="annottext">lsBranch :: forall (m :: * -&gt; *) (n :: * -&gt; *).
MonadIO m =&gt;
Codebase m Symbol Ann
-&gt; Branch n -&gt; m [ShallowListEntry Symbol Ann]
</span><a href="Unison.Server.Backend.html#lsBranch"><span class="hs-identifier hs-var hs-var">lsBranch</span></a></span></span><span> </span><span id="local-6989586621679378065"><span class="annot"><span class="annottext">Codebase m Symbol Ann
</span><a href="#local-6989586621679378065"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621679378064"><span class="annot"><span class="annottext">Branch n
</span><a href="#local-6989586621679378064"><span class="hs-identifier hs-var">b0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-654"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679379855"><span id="local-6989586621679379856"><span class="annot"><a href="#local-6989586621679378063"><span class="hs-identifier hs-type">flattenRefs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NameSegment</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="#local-6989586621679379856"><span class="hs-identifier hs-type">ref</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679379855"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679379856"><span class="hs-identifier hs-type">ref</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NameSegment</span></span><span class="hs-special">)</span><span class="hs-special">]</span></span></span><span>
</span><span id="line-655"></span><span>      </span><span id="local-6989586621679378063"><span class="annot"><span class="annottext">flattenRefs :: forall ref v. Map NameSegment (Map ref v) -&gt; [(ref, NameSegment)]
</span><a href="#local-6989586621679378063"><span class="hs-identifier hs-var hs-var">flattenRefs</span></a></span></span><span> </span><span id="local-6989586621679378060"><span class="annot"><span class="annottext">Map NameSegment (Map ref v)
</span><a href="#local-6989586621679378060"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-656"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679378059"><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621679378059"><span class="hs-identifier hs-var">ns</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679378058"><span class="annot"><span class="annottext">Map ref v
</span><a href="#local-6989586621679378058"><span class="hs-identifier hs-var">refs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span> </span><span class="annot"><span class="annottext">Map NameSegment (Map ref v)
</span><a href="#local-6989586621679378060"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-657"></span><span>        </span><span id="local-6989586621679378056"><span class="annot"><span class="annottext">ref
</span><a href="#local-6989586621679378056"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall k a. Map k a -&gt; [k]
</span><span class="hs-identifier hs-var">Map.keys</span></span><span> </span><span class="annot"><span class="annottext">Map ref v
</span><a href="#local-6989586621679378058"><span class="hs-identifier hs-var">refs</span></a></span><span>
</span><span id="line-658"></span><span>        </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ref
</span><a href="#local-6989586621679378056"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621679378059"><span class="hs-identifier hs-var">ns</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-659"></span><span>  </span><span id="local-6989586621679378055"><span class="annot"><span class="annottext">[ShallowListEntry Symbol Ann]
</span><a href="#local-6989586621679378055"><span class="hs-identifier hs-var">termEntries</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f (t b)
</span><span class="hs-identifier hs-var">for</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall ref v. Map NameSegment (Map ref v) -&gt; [(ref, NameSegment)]
</span><a href="#local-6989586621679378063"><span class="hs-identifier hs-var">flattenRefs</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
Branch m -&gt; Map NameSegment (Map Referent (m MdValues))
</span><span class="hs-identifier hs-var">V2Branch.terms</span></span><span> </span><span class="annot"><span class="annottext">Branch n
</span><a href="#local-6989586621679378064"><span class="hs-identifier hs-var">b0</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679378053"><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679378053"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679378052"><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621679378052"><span class="hs-identifier hs-var">ns</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-660"></span><span>    </span><span class="annot"><span class="annottext">forall v a. TermEntry v a -&gt; ShallowListEntry v a
</span><a href="Unison.Server.Backend.html#ShallowTermEntry"><span class="hs-identifier hs-var">ShallowTermEntry</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) (n :: * -&gt; *).
MonadIO m =&gt;
Codebase m Symbol Ann
-&gt; Branch n
-&gt; ExactName NameSegment Referent
-&gt; m (TermEntry Symbol Ann)
</span><a href="Unison.Server.Backend.html#termListEntry"><span class="hs-identifier hs-var">termListEntry</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase m Symbol Ann
</span><a href="#local-6989586621679378065"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Branch n
</span><a href="#local-6989586621679378064"><span class="hs-identifier hs-var">b0</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall name ref. name -&gt; ref -&gt; ExactName name ref
</span><a href="Unison.Server.Types.html#ExactName"><span class="hs-identifier hs-var">ExactName</span></a></span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621679378052"><span class="hs-identifier hs-var">ns</span></a></span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679378053"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-661"></span><span>  </span><span id="local-6989586621679378051"><span class="annot"><span class="annottext">[ShallowListEntry Symbol Ann]
</span><a href="#local-6989586621679378051"><span class="hs-identifier hs-var">typeEntries</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-662"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) v a b.
MonadIO m =&gt;
Codebase m v a -&gt; Transaction b -&gt; m b
</span><span class="hs-identifier hs-var">Codebase.runTransaction</span></span><span> </span><span class="annot"><span class="annottext">Codebase m Symbol Ann
</span><a href="#local-6989586621679378065"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-663"></span><span>      </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f (t b)
</span><span class="hs-identifier hs-var">for</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall ref v. Map NameSegment (Map ref v) -&gt; [(ref, NameSegment)]
</span><a href="#local-6989586621679378063"><span class="hs-identifier hs-var">flattenRefs</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
Branch m -&gt; Map NameSegment (Map Reference (m MdValues))
</span><span class="hs-identifier hs-var">V2Branch.types</span></span><span> </span><span class="annot"><span class="annottext">Branch n
</span><a href="#local-6989586621679378064"><span class="hs-identifier hs-var">b0</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679378050"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679378050"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679378049"><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621679378049"><span class="hs-identifier hs-var">ns</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-664"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679378048"><span class="annot"><span class="annottext">v1Ref :: TypeReference
</span><a href="#local-6989586621679378048"><span class="hs-identifier hs-var hs-var">v1Ref</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Reference -&gt; TypeReference
</span><span class="hs-identifier hs-var">Cv.reference2to1</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679378050"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-665"></span><span>        </span><span class="annot"><span class="annottext">forall v a. TypeEntry -&gt; ShallowListEntry v a
</span><a href="Unison.Server.Backend.html#ShallowTypeEntry"><span class="hs-identifier hs-var">ShallowTypeEntry</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall v (m :: * -&gt; *) (n :: * -&gt; *).
Var v =&gt;
Codebase m v Ann
-&gt; Branch n
-&gt; ExactName NameSegment TypeReference
-&gt; Transaction TypeEntry
</span><a href="Unison.Server.Backend.html#typeListEntry"><span class="hs-identifier hs-var">typeListEntry</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase m Symbol Ann
</span><a href="#local-6989586621679378065"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Branch n
</span><a href="#local-6989586621679378064"><span class="hs-identifier hs-var">b0</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall name ref. name -&gt; ref -&gt; ExactName name ref
</span><a href="Unison.Server.Types.html#ExactName"><span class="hs-identifier hs-var">ExactName</span></a></span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621679378049"><span class="hs-identifier hs-var">ns</span></a></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679378048"><span class="hs-identifier hs-var">v1Ref</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-666"></span><span>  </span><span id="local-6989586621679378047"><span class="annot"><span class="annottext">Map NameSegment (CausalBranch n, NamespaceStats)
</span><a href="#local-6989586621679378047"><span class="hs-identifier hs-var">childrenWithStats</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) v a b.
MonadIO m =&gt;
Codebase m v a -&gt; Transaction b -&gt; m b
</span><span class="hs-identifier hs-var">Codebase.runTransaction</span></span><span> </span><span class="annot"><span class="annottext">Codebase m Symbol Ann
</span><a href="#local-6989586621679378065"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
Branch m
-&gt; Transaction (Map NameSegment (CausalBranch m, NamespaceStats))
</span><span class="hs-identifier hs-var">V2Branch.childStats</span></span><span> </span><span class="annot"><span class="annottext">Branch n
</span><a href="#local-6989586621679378064"><span class="hs-identifier hs-var">b0</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-667"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679378045"><span class="annot"><span class="annottext">[ShallowListEntry Symbol Ann]
</span><a href="#local-6989586621679378045"><span class="hs-identifier hs-var">branchEntries</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Unison.Server.Backend.html#ShallowListEntry"><span class="hs-identifier hs-type">ShallowListEntry</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-668"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679378044"><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621679378044"><span class="hs-identifier hs-var">ns</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679378043"><span class="annot"><span class="annottext">CausalBranch n
</span><a href="#local-6989586621679378043"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679378042"><span class="annot"><span class="annottext">NamespaceStats
</span><a href="#local-6989586621679378042"><span class="hs-identifier hs-var">stats</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map NameSegment (CausalBranch n, NamespaceStats)
</span><a href="#local-6989586621679378047"><span class="hs-identifier hs-var">childrenWithStats</span></a></span><span>
</span><span id="line-669"></span><span>        </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><span class="hs-identifier hs-var">guard</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NamespaceStats -&gt; Bool
</span><span class="hs-identifier hs-var">V2Branch.hasDefinitions</span></span><span> </span><span class="annot"><span class="annottext">NamespaceStats
</span><a href="#local-6989586621679378042"><span class="hs-identifier hs-var">stats</span></a></span><span>
</span><span id="line-670"></span><span>        </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span> </span><span class="annot"><span class="annottext">forall v a.
NameSegment -&gt; CausalHash -&gt; NamespaceStats -&gt; ShallowListEntry v a
</span><a href="Unison.Server.Backend.html#ShallowBranchEntry"><span class="hs-identifier hs-var">ShallowBranchEntry</span></a></span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621679378044"><span class="hs-identifier hs-var">ns</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) hc he e. Causal m hc he e -&gt; hc
</span><span class="hs-identifier hs-var">V2Causal.causalHash</span></span><span> </span><span class="annot"><span class="annottext">CausalBranch n
</span><a href="#local-6989586621679378043"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NamespaceStats
</span><a href="#local-6989586621679378042"><span class="hs-identifier hs-var">stats</span></a></span><span>
</span><span id="line-671"></span><span>      </span><span id="local-6989586621679378039"><span class="annot"><span class="annottext">[ShallowListEntry Symbol Ann]
</span><a href="#local-6989586621679378039"><span class="hs-identifier hs-var">patchEntries</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Unison.Server.Backend.html#ShallowListEntry"><span class="hs-identifier hs-type">ShallowListEntry</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-672"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679378038"><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621679378038"><span class="hs-identifier hs-var">ns</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679378037"><span class="annot"><span class="annottext">(PatchHash, n Patch)
</span><a href="#local-6989586621679378037"><span class="hs-identifier hs-var">_h</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
Branch m -&gt; Map NameSegment (PatchHash, m Patch)
</span><span class="hs-identifier hs-var">V2Branch.patches</span></span><span> </span><span class="annot"><span class="annottext">Branch n
</span><a href="#local-6989586621679378064"><span class="hs-identifier hs-var">b0</span></a></span><span>
</span><span id="line-673"></span><span>        </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall v a. NameSegment -&gt; ShallowListEntry v a
</span><a href="Unison.Server.Backend.html#ShallowPatchEntry"><span class="hs-identifier hs-var">ShallowPatchEntry</span></a></span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621679378038"><span class="hs-identifier hs-var">ns</span></a></span><span>
</span><span id="line-674"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall b a. Ord b =&gt; (a -&gt; b) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">List.sortOn</span></span><span> </span><span class="annot"><span class="annottext">forall v a. ShallowListEntry v a -&gt; Text
</span><a href="Unison.Server.Backend.html#listEntryName"><span class="hs-identifier hs-var">listEntryName</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-675"></span><span>    </span><span class="annot"><span class="annottext">[ShallowListEntry Symbol Ann]
</span><a href="#local-6989586621679378055"><span class="hs-identifier hs-var">termEntries</span></a></span><span>
</span><span id="line-676"></span><span>      </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[ShallowListEntry Symbol Ann]
</span><a href="#local-6989586621679378051"><span class="hs-identifier hs-var">typeEntries</span></a></span><span>
</span><span id="line-677"></span><span>      </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[ShallowListEntry Symbol Ann]
</span><a href="#local-6989586621679378045"><span class="hs-identifier hs-var">branchEntries</span></a></span><span>
</span><span id="line-678"></span><span>      </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[ShallowListEntry Symbol Ann]
</span><a href="#local-6989586621679378039"><span class="hs-identifier hs-var">patchEntries</span></a></span><span>
</span><span id="line-679"></span><span>
</span><span id="line-680"></span><span class="hs-comment">-- currentPathNames :: Path -&gt; Names</span><span>
</span><span id="line-681"></span><span class="hs-comment">-- currentPathNames = Branch.toNames . Branch.head . Branch.getAt</span><span>
</span><span id="line-682"></span><span>
</span><span id="line-683"></span><span class="hs-comment">-- | Configure how names will be constructed and filtered.</span><span>
</span><span id="line-684"></span><span class="hs-comment">--   this is typically used when fetching names for printing source code or when finding</span><span>
</span><span id="line-685"></span><span class="hs-comment">--   definitions by name.</span><span>
</span><span id="line-686"></span><span class="hs-keyword">data</span><span> </span><span id="NameScoping"><span class="annot"><a href="Unison.Server.Backend.html#NameScoping"><span class="hs-identifier hs-var">NameScoping</span></a></span></span><span>
</span><span id="line-687"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- | Find all names, making any names which are children of this path,</span><span>
</span><span id="line-688"></span><span>    </span><span class="hs-comment">-- otherwise leave them absolute.</span><span>
</span><span id="line-689"></span><span>    </span><span id="AllNames"><span class="annot"><a href="Unison.Server.Backend.html#AllNames"><span class="hs-identifier hs-var">AllNames</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Path</span></span><span>
</span><span id="line-690"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- | Filter returned names to only include names within this path.</span><span>
</span><span id="line-691"></span><span>    </span><span id="Within"><span class="annot"><a href="Unison.Server.Backend.html#Within"><span class="hs-identifier hs-var">Within</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Path</span></span><span>
</span><span id="line-692"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- | Like `Within`, but does not include a fallback</span><span>
</span><span id="line-693"></span><span>    </span><span id="WithinStrict"><span class="annot"><a href="Unison.Server.Backend.html#WithinStrict"><span class="hs-identifier hs-var">WithinStrict</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Path</span></span><span>
</span><span id="line-694"></span><span>
</span><span id="line-695"></span><span class="annot"><a href="Unison.Server.Backend.html#toAllNames"><span class="hs-identifier hs-type">toAllNames</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#NameScoping"><span class="hs-identifier hs-type">NameScoping</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#NameScoping"><span class="hs-identifier hs-type">NameScoping</span></a></span><span>
</span><span id="line-696"></span><span id="toAllNames"><span class="annot"><span class="annottext">toAllNames :: NameScoping -&gt; NameScoping
</span><a href="Unison.Server.Backend.html#toAllNames"><span class="hs-identifier hs-var hs-var">toAllNames</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.Backend.html#AllNames"><span class="hs-identifier hs-type">AllNames</span></a></span><span> </span><span id="local-6989586621679378035"><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679378035"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Path -&gt; NameScoping
</span><a href="Unison.Server.Backend.html#AllNames"><span class="hs-identifier hs-var">AllNames</span></a></span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679378035"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-697"></span><span class="annot"><a href="Unison.Server.Backend.html#toAllNames"><span class="hs-identifier hs-var">toAllNames</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.Backend.html#Within"><span class="hs-identifier hs-type">Within</span></a></span><span> </span><span id="local-6989586621679378034"><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679378034"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Path -&gt; NameScoping
</span><a href="Unison.Server.Backend.html#AllNames"><span class="hs-identifier hs-var">AllNames</span></a></span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679378034"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-698"></span><span class="annot"><a href="Unison.Server.Backend.html#toAllNames"><span class="hs-identifier hs-var">toAllNames</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.Backend.html#WithinStrict"><span class="hs-identifier hs-type">WithinStrict</span></a></span><span> </span><span id="local-6989586621679378033"><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679378033"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Path -&gt; NameScoping
</span><a href="Unison.Server.Backend.html#AllNames"><span class="hs-identifier hs-var">AllNames</span></a></span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679378033"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-699"></span><span>
</span><span id="line-700"></span><span id="local-6989586621679379833"><span class="annot"><a href="Unison.Server.Backend.html#getCurrentPrettyNames"><span class="hs-identifier hs-type">getCurrentPrettyNames</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#NameScoping"><span class="hs-identifier hs-type">NameScoping</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Branch</span></span><span> </span><span class="annot"><a href="#local-6989586621679379833"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PPED.PrettyPrintEnvDecl</span></span></span><span>
</span><span id="line-701"></span><span id="getCurrentPrettyNames"><span class="annot"><span class="annottext">getCurrentPrettyNames :: forall (m :: * -&gt; *).
Int -&gt; NameScoping -&gt; Branch m -&gt; PrettyPrintEnvDecl
</span><a href="Unison.Server.Backend.html#getCurrentPrettyNames"><span class="hs-identifier hs-var hs-var">getCurrentPrettyNames</span></a></span></span><span> </span><span id="local-6989586621679378028"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679378028"><span class="hs-identifier hs-var">hashLen</span></a></span></span><span> </span><span id="local-6989586621679378027"><span class="annot"><span class="annottext">NameScoping
</span><a href="#local-6989586621679378027"><span class="hs-identifier hs-var">scope</span></a></span></span><span> </span><span id="local-6989586621679378026"><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621679378026"><span class="hs-identifier hs-var">root</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-702"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">NameScoping
</span><a href="#local-6989586621679378027"><span class="hs-identifier hs-var">scope</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-703"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#WithinStrict"><span class="hs-identifier hs-type">WithinStrict</span></a></span><span> </span><span class="annot"><span class="annottext">Path
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679378025"><span class="hs-identifier hs-var">primary</span></a></span><span>
</span><span id="line-704"></span><span>    </span><span class="annot"><span class="annottext">NameScoping
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-705"></span><span>      </span><span class="annot"><span class="annottext">PrettyPrintEnv -&gt; PrettyPrintEnv -&gt; PrettyPrintEnvDecl
</span><span class="hs-identifier hs-var">PPED.PrettyPrintEnvDecl</span></span><span>
</span><span id="line-706"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrettyPrintEnvDecl -&gt; PrettyPrintEnv
</span><span class="hs-identifier hs-var">PPED.unsuffixifiedPPE</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679378025"><span class="hs-identifier hs-var">primary</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv -&gt; PrettyPrintEnv -&gt; PrettyPrintEnv
</span><span class="hs-operator hs-var">`PPE.addFallback`</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl -&gt; PrettyPrintEnv
</span><span class="hs-identifier hs-var">PPED.unsuffixifiedPPE</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679378021"><span class="hs-identifier hs-var">backup</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-707"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrettyPrintEnvDecl -&gt; PrettyPrintEnv
</span><span class="hs-identifier hs-var">PPED.suffixifiedPPE</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679378025"><span class="hs-identifier hs-var">primary</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv -&gt; PrettyPrintEnv -&gt; PrettyPrintEnv
</span><span class="hs-operator hs-var">`PPE.addFallback`</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl -&gt; PrettyPrintEnv
</span><span class="hs-identifier hs-var">PPED.suffixifiedPPE</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679378021"><span class="hs-identifier hs-var">backup</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-708"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-709"></span><span>        </span><span id="local-6989586621679378021"><span class="annot"><span class="annottext">backup :: PrettyPrintEnvDecl
</span><a href="#local-6989586621679378021"><span class="hs-identifier hs-var hs-var">backup</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; NamesWithHistory -&gt; PrettyPrintEnvDecl
</span><span class="hs-identifier hs-var">PPED.fromNamesDecl</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679378028"><span class="hs-identifier hs-var">hashLen</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; NamesWithHistory
</span><span class="hs-identifier hs-var">NamesWithHistory</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Branch m -&gt; NameScoping -&gt; Names
</span><a href="Unison.Server.Backend.html#parseNamesForBranch"><span class="hs-identifier hs-var">parseNamesForBranch</span></a></span><span> </span><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621679378026"><span class="hs-identifier hs-var">root</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Path -&gt; NameScoping
</span><a href="Unison.Server.Backend.html#AllNames"><span class="hs-identifier hs-var">AllNames</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-710"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-711"></span><span>    </span><span id="local-6989586621679378025"><span class="annot"><span class="annottext">primary :: PrettyPrintEnvDecl
</span><a href="#local-6989586621679378025"><span class="hs-identifier hs-var hs-var">primary</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; NamesWithHistory -&gt; PrettyPrintEnvDecl
</span><span class="hs-identifier hs-var">PPED.fromNamesDecl</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679378028"><span class="hs-identifier hs-var">hashLen</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; NamesWithHistory
</span><span class="hs-identifier hs-var">NamesWithHistory</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Branch m -&gt; NameScoping -&gt; Names
</span><a href="Unison.Server.Backend.html#parseNamesForBranch"><span class="hs-identifier hs-var">parseNamesForBranch</span></a></span><span> </span><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621679378026"><span class="hs-identifier hs-var">root</span></a></span><span> </span><span class="annot"><span class="annottext">NameScoping
</span><a href="#local-6989586621679378027"><span class="hs-identifier hs-var">scope</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-712"></span><span>
</span><span id="line-713"></span><span id="local-6989586621679379831"><span class="annot"><a href="Unison.Server.Backend.html#getCurrentParseNames"><span class="hs-identifier hs-type">getCurrentParseNames</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#NameScoping"><span class="hs-identifier hs-type">NameScoping</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Branch</span></span><span> </span><span class="annot"><a href="#local-6989586621679379831"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NamesWithHistory</span></span></span><span>
</span><span id="line-714"></span><span id="getCurrentParseNames"><span class="annot"><span class="annottext">getCurrentParseNames :: forall (m :: * -&gt; *). NameScoping -&gt; Branch m -&gt; NamesWithHistory
</span><a href="Unison.Server.Backend.html#getCurrentParseNames"><span class="hs-identifier hs-var hs-var">getCurrentParseNames</span></a></span></span><span> </span><span id="local-6989586621679378019"><span class="annot"><span class="annottext">NameScoping
</span><a href="#local-6989586621679378019"><span class="hs-identifier hs-var">scope</span></a></span></span><span> </span><span id="local-6989586621679378018"><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621679378018"><span class="hs-identifier hs-var">root</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-715"></span><span>  </span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; NamesWithHistory
</span><span class="hs-identifier hs-var">NamesWithHistory</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Branch m -&gt; NameScoping -&gt; Names
</span><a href="Unison.Server.Backend.html#parseNamesForBranch"><span class="hs-identifier hs-var">parseNamesForBranch</span></a></span><span> </span><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621679378018"><span class="hs-identifier hs-var">root</span></a></span><span> </span><span class="annot"><span class="annottext">NameScoping
</span><a href="#local-6989586621679378019"><span class="hs-identifier hs-var">scope</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-716"></span><span>
</span><span id="line-717"></span><span class="hs-comment">-- Any absolute names in the input which have `root` as a prefix</span><span>
</span><span id="line-718"></span><span class="hs-comment">-- are converted to names relative to current path. All other names are</span><span>
</span><span id="line-719"></span><span class="hs-comment">-- converted to absolute names. For example:</span><span>
</span><span id="line-720"></span><span class="hs-comment">--</span><span>
</span><span id="line-721"></span><span class="hs-comment">-- e.g. if currentPath = .foo.bar</span><span>
</span><span id="line-722"></span><span class="hs-comment">--      then name foo.bar.baz becomes baz</span><span>
</span><span id="line-723"></span><span class="hs-comment">--           name cat.dog     becomes .cat.dog</span><span>
</span><span id="line-724"></span><span class="annot"><a href="Unison.Server.Backend.html#fixupNamesRelative"><span class="hs-identifier hs-type">fixupNamesRelative</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Path.Absolute</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Names</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Names</span></span><span>
</span><span id="line-725"></span><span id="fixupNamesRelative"><span class="annot"><span class="annottext">fixupNamesRelative :: Absolute -&gt; Names -&gt; Names
</span><a href="Unison.Server.Backend.html#fixupNamesRelative"><span class="hs-identifier hs-var hs-var">fixupNamesRelative</span></a></span></span><span> </span><span id="local-6989586621679378017"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679378017"><span class="hs-identifier hs-var">root</span></a></span></span><span> </span><span id="local-6989586621679378016"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679378016"><span class="hs-identifier hs-var">names</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-726"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Path -&gt; Maybe Name
</span><span class="hs-identifier hs-var">Path.toName</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Absolute -&gt; Path
</span><span class="hs-identifier hs-var">Path.unabsolute</span></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679378017"><span class="hs-identifier hs-var">root</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-727"></span><span>    </span><span class="annot"><span class="annottext">Maybe Name
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679378016"><span class="hs-identifier hs-var">names</span></a></span><span>
</span><span id="line-728"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679378015"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679378015"><span class="hs-identifier hs-var">prefix</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Name) -&gt; Names -&gt; Names
</span><span class="hs-identifier hs-var">Names.map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Name
</span><a href="#local-6989586621679378013"><span class="hs-identifier hs-var">fixName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679378015"><span class="hs-identifier hs-var">prefix</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679378016"><span class="hs-identifier hs-var">names</span></a></span><span>
</span><span id="line-729"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-730"></span><span>    </span><span id="local-6989586621679378013"><span class="annot"><span class="annottext">fixName :: Name -&gt; Name -&gt; Name
</span><a href="#local-6989586621679378013"><span class="hs-identifier hs-var hs-var">fixName</span></a></span></span><span> </span><span id="local-6989586621679378012"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679378012"><span class="hs-identifier hs-var">prefix</span></a></span></span><span> </span><span id="local-6989586621679378011"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679378011"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-731"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679378017"><span class="hs-identifier hs-var">root</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><span class="hs-identifier hs-var">Path.absoluteEmpty</span></span><span>
</span><span id="line-732"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679378011"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-733"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Name
</span><span class="hs-identifier hs-var">Name.makeAbsolute</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679378011"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Maybe Name
</span><span class="hs-identifier hs-var">Name.stripNamePrefix</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679378012"><span class="hs-identifier hs-var">prefix</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679378011"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-734"></span><span>
</span><span id="line-735"></span><span id="local-6989586621679379828"><span id="local-6989586621679379829"><span class="annot"><a href="Unison.Server.Backend.html#hqNameQuery"><span class="hs-identifier hs-type">hqNameQuery</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-736"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><a href="#local-6989586621679379829"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679379828"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-737"></span><span>  </span><span class="annot"><a href="Unison.Server.NameSearch.html#NameSearch"><span class="hs-identifier hs-type">NameSearch</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Sqlite.Transaction</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-738"></span><span>  </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">HQ.HashQualified</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-739"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Sqlite.Transaction</span></span><span> </span><span class="annot"><a href="Unison.Server.QueryResult.html#QueryResult"><span class="hs-identifier hs-type">QueryResult</span></a></span></span></span><span>
</span><span id="line-740"></span><span id="hqNameQuery"><span class="annot"><span class="annottext">hqNameQuery :: forall (m :: * -&gt; *) v.
Codebase m v Ann
-&gt; NameSearch Transaction
-&gt; [HashQualified Name]
-&gt; Transaction QueryResult
</span><a href="Unison.Server.Backend.html#hqNameQuery"><span class="hs-identifier hs-var hs-var">hqNameQuery</span></a></span></span><span> </span><span id="local-6989586621679377974"><span class="annot"><span class="annottext">Codebase m v Ann
</span><a href="#local-6989586621679377974"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span class="annot"><a href="Unison.Server.NameSearch.html#NameSearch"><span class="hs-identifier hs-type">NameSearch</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679377972"><span class="annot"><span class="annottext">Search Transaction TypeReference
$sel:typeSearch:NameSearch :: forall (m :: * -&gt; *). NameSearch m -&gt; Search m TypeReference
typeSearch :: Search Transaction TypeReference
</span><a href="Unison.Server.NameSearch.html#%24sel%3AtypeSearch%3ANameSearch"><span class="hs-identifier hs-var hs-var">typeSearch</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679377970"><span class="annot"><span class="annottext">Search Transaction Referent
$sel:termSearch:NameSearch :: forall (m :: * -&gt; *). NameSearch m -&gt; Search m Referent
termSearch :: Search Transaction Referent
</span><a href="Unison.Server.NameSearch.html#%24sel%3AtermSearch%3ANameSearch"><span class="hs-identifier hs-var hs-var">termSearch</span></a></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621679377968"><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679377968"><span class="hs-identifier hs-var">hqs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-741"></span><span>  </span><span class="hs-comment">-- Split the query into hash-only and hash-qualified-name queries.</span><span>
</span><span id="line-742"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679377967"><span class="annot"><span class="annottext">[ShortHash]
</span><a href="#local-6989586621679377967"><span class="hs-identifier hs-var">hashes</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679377966"><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679377966"><span class="hs-identifier hs-var">hqnames</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. [Either a b] -&gt; ([a], [b])
</span><span class="hs-identifier hs-var">partitionEithers</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">forall n. HashQualified n -&gt; Either ShortHash (HashQualified n)
</span><span class="hs-identifier hs-var">HQ'.fromHQ2</span></span><span> </span><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679377968"><span class="hs-identifier hs-var">hqs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-743"></span><span>  </span><span class="hs-comment">-- Find the terms with those hashes.</span><span>
</span><span id="line-744"></span><span>  </span><span id="local-6989586621679377963"><span class="annot"><span class="annottext">[(ShortHash, Set Referent)]
</span><a href="#local-6989586621679377963"><span class="hs-identifier hs-var">termRefs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-745"></span><span>    </span><span class="annot"><span class="annottext">forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a. Set a -&gt; Bool
</span><span class="hs-identifier hs-var">Set.null</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="annot"><span class="annottext">[ShortHash]
</span><a href="#local-6989586621679377967"><span class="hs-identifier hs-var">hashes</span></a></span><span>
</span><span id="line-746"></span><span>      </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span>
</span><span id="line-747"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) v a.
Codebase m v a -&gt; ShortHash -&gt; Transaction (Set Referent)
</span><a href="Unison.Server.NameSearch.Sqlite.html#termReferentsByShortHash"><span class="hs-identifier hs-var">termReferentsByShortHash</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase m v Ann
</span><a href="#local-6989586621679377974"><span class="hs-identifier hs-var">codebase</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-748"></span><span>        </span><span class="annot"><span class="annottext">[ShortHash]
</span><a href="#local-6989586621679377967"><span class="hs-identifier hs-var">hashes</span></a></span><span>
</span><span id="line-749"></span><span>  </span><span class="hs-comment">-- Find types with those hashes.</span><span>
</span><span id="line-750"></span><span>  </span><span id="local-6989586621679377960"><span class="annot"><span class="annottext">[(ShortHash, Set TypeReference)]
</span><a href="#local-6989586621679377960"><span class="hs-identifier hs-var">typeRefs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-751"></span><span>    </span><span class="annot"><span class="annottext">forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a. Set a -&gt; Bool
</span><span class="hs-identifier hs-var">Set.null</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="annot"><span class="annottext">[ShortHash]
</span><a href="#local-6989586621679377967"><span class="hs-identifier hs-var">hashes</span></a></span><span>
</span><span id="line-752"></span><span>      </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span>
</span><span id="line-753"></span><span>        </span><span class="annot"><span class="annottext">ShortHash -&gt; Transaction (Set TypeReference)
</span><a href="Unison.Server.NameSearch.Sqlite.html#typeReferencesByShortHash"><span class="hs-identifier hs-var">typeReferencesByShortHash</span></a></span><span>
</span><span id="line-754"></span><span>        </span><span class="annot"><span class="annottext">[ShortHash]
</span><a href="#local-6989586621679377967"><span class="hs-identifier hs-var">hashes</span></a></span><span>
</span><span id="line-755"></span><span>  </span><span class="hs-comment">-- Now do the name queries.</span><span>
</span><span id="line-756"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679377959"><span class="annot"><span class="annottext">mkTermResult :: ShortHash -&gt; Referent -&gt; SearchResult
</span><a href="#local-6989586621679377959"><span class="hs-identifier hs-var hs-var">mkTermResult</span></a></span></span><span> </span><span id="local-6989586621679377958"><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679377958"><span class="hs-identifier hs-var">sh</span></a></span></span><span> </span><span id="local-6989586621679377957"><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679377957"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashQualified Name
-&gt; Referent -&gt; Set (HashQualified Name) -&gt; SearchResult
</span><a href="Unison.Server.SearchResult.html#termResult"><span class="hs-identifier hs-var">SR.termResult</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall n. ShortHash -&gt; HashQualified n
</span><span class="hs-identifier hs-var">HQ.HashOnly</span></span><span> </span><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679377958"><span class="hs-identifier hs-var">sh</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679377957"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Set a
</span><span class="hs-identifier hs-var">Set.empty</span></span><span>
</span><span id="line-757"></span><span>      </span><span id="local-6989586621679377953"><span class="annot"><span class="annottext">mkTypeResult :: ShortHash -&gt; TypeReference -&gt; SearchResult
</span><a href="#local-6989586621679377953"><span class="hs-identifier hs-var hs-var">mkTypeResult</span></a></span></span><span> </span><span id="local-6989586621679377952"><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679377952"><span class="hs-identifier hs-var">sh</span></a></span></span><span> </span><span id="local-6989586621679377951"><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679377951"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashQualified Name
-&gt; TypeReference -&gt; Set (HashQualified Name) -&gt; SearchResult
</span><a href="Unison.Server.SearchResult.html#typeResult"><span class="hs-identifier hs-var">SR.typeResult</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall n. ShortHash -&gt; HashQualified n
</span><span class="hs-identifier hs-var">HQ.HashOnly</span></span><span> </span><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679377952"><span class="hs-identifier hs-var">sh</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679377951"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Set a
</span><span class="hs-identifier hs-var">Set.empty</span></span><span>
</span><span id="line-758"></span><span>      </span><span class="hs-comment">-- Transform the hash results a bit</span><span>
</span><span id="line-759"></span><span>      </span><span id="local-6989586621679377949"><span class="annot"><span class="annottext">termResults :: [[SearchResult]]
</span><a href="#local-6989586621679377949"><span class="hs-identifier hs-var hs-var">termResults</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-760"></span><span>        </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679377948"><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679377948"><span class="hs-identifier hs-var">sh</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679377947"><span class="annot"><span class="annottext">Set Referent
</span><a href="#local-6989586621679377947"><span class="hs-identifier hs-var">tms</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ShortHash -&gt; Referent -&gt; SearchResult
</span><a href="#local-6989586621679377959"><span class="hs-identifier hs-var">mkTermResult</span></a></span><span> </span><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679377948"><span class="hs-identifier hs-var">sh</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">Set Referent
</span><a href="#local-6989586621679377947"><span class="hs-identifier hs-var">tms</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[(ShortHash, Set Referent)]
</span><a href="#local-6989586621679377963"><span class="hs-identifier hs-var">termRefs</span></a></span><span>
</span><span id="line-761"></span><span>      </span><span id="local-6989586621679377946"><span class="annot"><span class="annottext">typeResults :: [[SearchResult]]
</span><a href="#local-6989586621679377946"><span class="hs-identifier hs-var hs-var">typeResults</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-762"></span><span>        </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679377945"><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679377945"><span class="hs-identifier hs-var">sh</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679377944"><span class="annot"><span class="annottext">Set TypeReference
</span><a href="#local-6989586621679377944"><span class="hs-identifier hs-var">tps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ShortHash -&gt; TypeReference -&gt; SearchResult
</span><a href="#local-6989586621679377953"><span class="hs-identifier hs-var">mkTypeResult</span></a></span><span> </span><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679377945"><span class="hs-identifier hs-var">sh</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">Set TypeReference
</span><a href="#local-6989586621679377944"><span class="hs-identifier hs-var">tps</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[(ShortHash, Set TypeReference)]
</span><a href="#local-6989586621679377960"><span class="hs-identifier hs-var">typeRefs</span></a></span><span>
</span><span id="line-763"></span><span>
</span><span id="line-764"></span><span>  </span><span class="hs-comment">-- Now do the actual name query</span><span>
</span><span id="line-765"></span><span>  </span><span id="local-6989586621679377943"><span class="annot"><span class="annottext">[[SearchResult]]
</span><a href="#local-6989586621679377943"><span class="hs-identifier hs-var">resultss</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f (t b)
</span><span class="hs-identifier hs-var">for</span></span><span> </span><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679377966"><span class="hs-identifier hs-var">hqnames</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679377942"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679377942"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b c.
Applicative f =&gt;
(a -&gt; b -&gt; c) -&gt; f a -&gt; f b -&gt; f c
</span><span class="hs-identifier hs-var">liftA2</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(&lt;&gt;)</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall r (m :: * -&gt; *).
(Show r, Monad m) =&gt;
Search m r -&gt; HashQualified Name -&gt; m [SearchResult]
</span><a href="Unison.Server.NameSearch.html#applySearch"><span class="hs-identifier hs-var">applySearch</span></a></span><span> </span><span class="annot"><span class="annottext">Search Transaction TypeReference
</span><a href="#local-6989586621679377972"><span class="hs-identifier hs-var">typeSearch</span></a></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679377942"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall r (m :: * -&gt; *).
(Show r, Monad m) =&gt;
Search m r -&gt; HashQualified Name -&gt; m [SearchResult]
</span><a href="Unison.Server.NameSearch.html#applySearch"><span class="hs-identifier hs-var">applySearch</span></a></span><span> </span><span class="annot"><span class="annottext">Search Transaction Referent
</span><a href="#local-6989586621679377970"><span class="hs-identifier hs-var">termSearch</span></a></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679377942"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-766"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679377940"><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679377940"><span class="hs-identifier hs-var">misses</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679377939"><span class="annot"><span class="annottext">[[SearchResult]]
</span><a href="#local-6989586621679377939"><span class="hs-identifier hs-var">hits</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-767"></span><span>        </span><span class="annot"><span class="annottext">forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span>
</span><span id="line-768"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679377937"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679377937"><span class="hs-identifier hs-var">hqname</span></a></span></span><span> </span><span id="local-6989586621679377936"><span class="annot"><span class="annottext">[SearchResult]
</span><a href="#local-6989586621679377936"><span class="hs-identifier hs-var">results</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-769"></span><span>              </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[SearchResult]
</span><a href="#local-6989586621679377936"><span class="hs-identifier hs-var">results</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679377937"><span class="hs-identifier hs-var">hqname</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">[SearchResult]
</span><a href="#local-6989586621679377936"><span class="hs-identifier hs-var">results</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-770"></span><span>          </span><span class="hs-special">)</span><span>
</span><span id="line-771"></span><span>          </span><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679377966"><span class="hs-identifier hs-var">hqnames</span></a></span><span>
</span><span id="line-772"></span><span>          </span><span class="annot"><span class="annottext">[[SearchResult]]
</span><a href="#local-6989586621679377943"><span class="hs-identifier hs-var">resultss</span></a></span><span>
</span><span id="line-773"></span><span>          </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. [Either a b] -&gt; ([a], [b])
</span><span class="hs-identifier hs-var">partitionEithers</span></span><span>
</span><span id="line-774"></span><span>      </span><span class="hs-comment">-- Handle query misses correctly</span><span>
</span><span id="line-775"></span><span>      </span><span id="local-6989586621679377934"><span class="annot"><span class="annottext">missingRefs :: [HashQualified Name]
</span><a href="#local-6989586621679377934"><span class="hs-identifier hs-var hs-var">missingRefs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-776"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">forall n. ShortHash -&gt; HashQualified n
</span><span class="hs-identifier hs-var">HQ.HashOnly</span></span><span> </span><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679377933"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-777"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621679377933"><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679377933"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[ShortHash]
</span><a href="#local-6989586621679377967"><span class="hs-identifier hs-var">hashes</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-778"></span><span>            </span><span class="annot"><span class="annottext">forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isNothing</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b
</span><span class="hs-identifier hs-var">lookup</span></span><span> </span><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679377933"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">[(ShortHash, Set Referent)]
</span><a href="#local-6989586621679377963"><span class="hs-identifier hs-var">termRefs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isNothing</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b
</span><span class="hs-identifier hs-var">lookup</span></span><span> </span><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679377933"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">[(ShortHash, Set TypeReference)]
</span><a href="#local-6989586621679377960"><span class="hs-identifier hs-var">typeRefs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-779"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-780"></span><span>      </span><span class="hs-comment">-- Gather the results</span><span>
</span><span id="line-781"></span><span>      </span><span id="local-6989586621679377929"><span class="annot"><span class="annottext">results :: [SearchResult]
</span><a href="#local-6989586621679377929"><span class="hs-identifier hs-var hs-var">results</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-782"></span><span>        </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">List.sort</span></span><span>
</span><span id="line-783"></span><span>          </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) b a.
(Foldable f, Ord b) =&gt;
(a -&gt; b) -&gt; f a -&gt; [a]
</span><span class="hs-identifier hs-var">uniqueBy</span></span><span> </span><span class="annot"><span class="annottext">SearchResult -&gt; Referent
</span><a href="Unison.Server.SearchResult.html#toReferent"><span class="hs-identifier hs-var">SR.toReferent</span></a></span><span>
</span><span id="line-784"></span><span>          </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span>
</span><span id="line-785"></span><span>          </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[[SearchResult]]
</span><a href="#local-6989586621679377939"><span class="hs-identifier hs-var">hits</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[[SearchResult]]
</span><a href="#local-6989586621679377949"><span class="hs-identifier hs-var">termResults</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[[SearchResult]]
</span><a href="#local-6989586621679377946"><span class="hs-identifier hs-var">typeResults</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-786"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-787"></span><span>    </span><span class="annot"><a href="Unison.Server.QueryResult.html#QueryResult"><span class="hs-identifier hs-type">QueryResult</span></a></span><span>
</span><span id="line-788"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:misses:QueryResult :: [HashQualified Name]
</span><a href="Unison.Server.QueryResult.html#%24sel%3Amisses%3AQueryResult"><span class="hs-identifier hs-var">misses</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679377934"><span class="hs-identifier hs-var">missingRefs</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">forall n. HashQualified n -&gt; HashQualified n
</span><span class="hs-identifier hs-var">HQ'.toHQ</span></span><span> </span><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679377940"><span class="hs-identifier hs-var">misses</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-789"></span><span>        </span><span class="annot"><span class="annottext">$sel:hits:QueryResult :: [SearchResult]
</span><a href="Unison.Server.QueryResult.html#%24sel%3Ahits%3AQueryResult"><span class="hs-identifier hs-var">hits</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SearchResult]
</span><a href="#local-6989586621679377929"><span class="hs-identifier hs-var">results</span></a></span><span>
</span><span id="line-790"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-791"></span><span>
</span><span id="line-792"></span><span class="hs-comment">-- TODO: Move this to its own module</span><span>
</span><span id="line-793"></span><span class="hs-keyword">data</span><span> </span><span id="DefinitionResults"><span class="annot"><a href="Unison.Server.Backend.html#DefinitionResults"><span class="hs-identifier hs-var">DefinitionResults</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="DefinitionResults"><span class="annot"><a href="Unison.Server.Backend.html#DefinitionResults"><span class="hs-identifier hs-var">DefinitionResults</span></a></span></span><span>
</span><span id="line-794"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3AtermResults%3ADefinitionResults"><span class="annot"><span class="annottext">DefinitionResults
-&gt; Map
     TypeReference (DisplayObject (Type Symbol Ann) (Term Symbol Ann))
</span><a href="Unison.Server.Backend.html#%24sel%3AtermResults%3ADefinitionResults"><span class="hs-identifier hs-var hs-var">termResults</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DisplayObject</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Term</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-795"></span><span>    </span><span id="%24sel%3AtypeResults%3ADefinitionResults"><span class="annot"><span class="annottext">DefinitionResults
-&gt; Map TypeReference (DisplayObject () (Decl Symbol Ann))
</span><a href="Unison.Server.Backend.html#%24sel%3AtypeResults%3ADefinitionResults"><span class="hs-identifier hs-var hs-var">typeResults</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DisplayObject</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DD.Decl</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-796"></span><span>    </span><span id="%24sel%3AnoResults%3ADefinitionResults"><span class="annot"><span class="annottext">DefinitionResults -&gt; [HashQualified Name]
</span><a href="Unison.Server.Backend.html#%24sel%3AnoResults%3ADefinitionResults"><span class="hs-identifier hs-var hs-var">noResults</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">HQ.HashQualified</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">]</span><span>
</span><span id="line-797"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-798"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679377903"><span id="local-6989586621679377905"><span id="local-6989586621679377916"><span class="annot"><span class="annottext">Int -&gt; DefinitionResults -&gt; ShowS
[DefinitionResults] -&gt; ShowS
DefinitionResults -&gt; WatchKind
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; WatchKind) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [DefinitionResults] -&gt; ShowS
$cshowList :: [DefinitionResults] -&gt; ShowS
show :: DefinitionResults -&gt; WatchKind
$cshow :: DefinitionResults -&gt; WatchKind
showsPrec :: Int -&gt; DefinitionResults -&gt; ShowS
$cshowsPrec :: Int -&gt; DefinitionResults -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-799"></span><span>
</span><span id="line-800"></span><span class="hs-comment">-- | Finds ALL direct references contained within a 'DefinitionResults' so we can</span><span>
</span><span id="line-801"></span><span class="hs-comment">-- build a pretty printer for them.</span><span>
</span><span id="line-802"></span><span class="annot"><a href="Unison.Server.Backend.html#definitionResultsDependencies"><span class="hs-identifier hs-type">definitionResultsDependencies</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#DefinitionResults"><span class="hs-identifier hs-type">DefinitionResults</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">LD.LabeledDependency</span></span><span>
</span><span id="line-803"></span><span id="definitionResultsDependencies"><span class="annot"><span class="annottext">definitionResultsDependencies :: DefinitionResults -&gt; Set LabeledDependency
</span><a href="Unison.Server.Backend.html#definitionResultsDependencies"><span class="hs-identifier hs-var hs-var">definitionResultsDependencies</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.Backend.html#DefinitionResults"><span class="hs-identifier hs-type">DefinitionResults</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679377884"><span class="annot"><span class="annottext">Map
  TypeReference (DisplayObject (Type Symbol Ann) (Term Symbol Ann))
termResults :: Map
  TypeReference (DisplayObject (Type Symbol Ann) (Term Symbol Ann))
$sel:termResults:DefinitionResults :: DefinitionResults
-&gt; Map
     TypeReference (DisplayObject (Type Symbol Ann) (Term Symbol Ann))
</span><a href="#local-6989586621679377884"><span class="hs-identifier hs-var hs-var">termResults</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679377883"><span class="annot"><span class="annottext">Map TypeReference (DisplayObject () (Decl Symbol Ann))
typeResults :: Map TypeReference (DisplayObject () (Decl Symbol Ann))
$sel:typeResults:DefinitionResults :: DefinitionResults
-&gt; Map TypeReference (DisplayObject () (Decl Symbol Ann))
</span><a href="#local-6989586621679377883"><span class="hs-identifier hs-var hs-var">typeResults</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-804"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679377882"><span class="annot"><span class="annottext">topLevelTerms :: Set LabeledDependency
</span><a href="#local-6989586621679377882"><span class="hs-identifier hs-var hs-var">topLevelTerms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">TypeReference -&gt; LabeledDependency
</span><span class="hs-identifier hs-var">LD.TermReference</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall k a. Map k a -&gt; [k]
</span><span class="hs-identifier hs-var">Map.keys</span></span><span> </span><span class="annot"><span class="annottext">Map
  TypeReference (DisplayObject (Type Symbol Ann) (Term Symbol Ann))
</span><a href="#local-6989586621679377884"><span class="hs-identifier hs-var">termResults</span></a></span><span>
</span><span id="line-805"></span><span>      </span><span id="local-6989586621679377879"><span class="annot"><span class="annottext">topLevelTypes :: Set LabeledDependency
</span><a href="#local-6989586621679377879"><span class="hs-identifier hs-var hs-var">topLevelTypes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">TypeReference -&gt; LabeledDependency
</span><span class="hs-identifier hs-var">LD.TypeReference</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall k a. Map k a -&gt; [k]
</span><span class="hs-identifier hs-var">Map.keys</span></span><span> </span><span class="annot"><span class="annottext">Map TypeReference (DisplayObject () (Decl Symbol Ann))
</span><a href="#local-6989586621679377883"><span class="hs-identifier hs-var">typeResults</span></a></span><span>
</span><span id="line-806"></span><span>      </span><span id="local-6989586621679377877"><span class="annot"><span class="annottext">termDeps :: Set LabeledDependency
</span><a href="#local-6989586621679377877"><span class="hs-identifier hs-var hs-var">termDeps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-807"></span><span>        </span><span class="annot"><span class="annottext">Map
  TypeReference (DisplayObject (Type Symbol Ann) (Term Symbol Ann))
</span><a href="#local-6989586621679377884"><span class="hs-identifier hs-var">termResults</span></a></span><span>
</span><span id="line-808"></span><span>          </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">forall a s. Getting a s a -&gt; s -&gt; a
</span><span class="hs-identifier hs-var">foldOf</span></span><span>
</span><span id="line-809"></span><span>            </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Foldable f =&gt; IndexedFold Int (f a) a
</span><span class="hs-identifier hs-var">folded</span></span><span>
</span><span id="line-810"></span><span>                </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (q :: * -&gt; * -&gt; *) (f :: * -&gt; *) (r :: * -&gt; * -&gt; *)
       (p :: * -&gt; * -&gt; *) s t a b s' t'.
(Representable q, Applicative (Rep q), Applicative f,
 Bitraversable r) =&gt;
Optical p q f s t a b
-&gt; Optical p q f s' t' a b -&gt; Optical p q f (r s s') (r t t') a b
</span><span class="hs-identifier hs-var">beside</span></span><span>
</span><span id="line-811"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (p :: * -&gt; * -&gt; *) (f :: * -&gt; *) s a.
(Profunctor p, Contravariant f) =&gt;
(s -&gt; a) -&gt; Optic' p f s a
</span><span class="hs-identifier hs-var">to</span></span><span> </span><span class="annot"><span class="annottext">forall v a. Ord v =&gt; Type v a -&gt; Set LabeledDependency
</span><span class="hs-identifier hs-var">Type.labeledDependencies</span></span><span class="hs-special">)</span><span>
</span><span id="line-812"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (p :: * -&gt; * -&gt; *) (f :: * -&gt; *) s a.
(Profunctor p, Contravariant f) =&gt;
(s -&gt; a) -&gt; Optic' p f s a
</span><span class="hs-identifier hs-var">to</span></span><span> </span><span class="annot"><span class="annottext">forall v vt at ap a.
(Ord v, Ord vt) =&gt;
Term2 vt at ap v a -&gt; Set LabeledDependency
</span><span class="hs-identifier hs-var">Term.labeledDependencies</span></span><span class="hs-special">)</span><span>
</span><span id="line-813"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-814"></span><span>      </span><span id="local-6989586621679377870"><span class="annot"><span class="annottext">typeDeps :: Set LabeledDependency
</span><a href="#local-6989586621679377870"><span class="hs-identifier hs-var hs-var">typeDeps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-815"></span><span>        </span><span class="annot"><span class="annottext">Map TypeReference (DisplayObject () (Decl Symbol Ann))
</span><a href="#local-6989586621679377883"><span class="hs-identifier hs-var">typeResults</span></a></span><span>
</span><span id="line-816"></span><span>          </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">forall i (f :: * -&gt; *) m a.
(FoldableWithIndex i f, Monoid m) =&gt;
(i -&gt; a -&gt; m) -&gt; f a -&gt; m
</span><span class="hs-identifier hs-var">ifoldMap</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679377868"><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679377868"><span class="hs-identifier hs-var">typeRef</span></a></span></span><span> </span><span id="local-6989586621679377867"><span class="annot"><span class="annottext">DisplayObject () (Decl Symbol Ann)
</span><a href="#local-6989586621679377867"><span class="hs-identifier hs-var">ddObj</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-817"></span><span>            </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall v a.
Ord v =&gt;
TypeReference -&gt; Decl v a -&gt; Set LabeledDependency
</span><span class="hs-identifier hs-var">DD.labeledDeclDependenciesIncludingSelf</span></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679377868"><span class="hs-identifier hs-var">typeRef</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DisplayObject () (Decl Symbol Ann)
</span><a href="#local-6989586621679377867"><span class="hs-identifier hs-var">ddObj</span></a></span><span>
</span><span id="line-818"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Set LabeledDependency
</span><a href="#local-6989586621679377877"><span class="hs-identifier hs-var">termDeps</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Set LabeledDependency
</span><a href="#local-6989586621679377870"><span class="hs-identifier hs-var">typeDeps</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Set LabeledDependency
</span><a href="#local-6989586621679377882"><span class="hs-identifier hs-var">topLevelTerms</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Set LabeledDependency
</span><a href="#local-6989586621679377879"><span class="hs-identifier hs-var">topLevelTypes</span></a></span><span>
</span><span id="line-819"></span><span>
</span><span id="line-820"></span><span class="annot"><a href="Unison.Server.Backend.html#expandShortCausalHash"><span class="hs-identifier hs-type">expandShortCausalHash</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ShortCausalHash</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Sqlite.Transaction</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CausalHash</span></span><span>
</span><span id="line-821"></span><span id="expandShortCausalHash"><span class="annot"><span class="annottext">expandShortCausalHash :: ShortCausalHash -&gt; Backend Transaction CausalHash
</span><a href="Unison.Server.Backend.html#expandShortCausalHash"><span class="hs-identifier hs-var hs-var">expandShortCausalHash</span></a></span></span><span> </span><span id="local-6989586621679377864"><span class="annot"><span class="annottext">ShortCausalHash
</span><a href="#local-6989586621679377864"><span class="hs-identifier hs-var">hash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-822"></span><span>  </span><span id="local-6989586621679377863"><span class="annot"><span class="annottext">Set CausalHash
</span><a href="#local-6989586621679377863"><span class="hs-identifier hs-var">hashSet</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ShortCausalHash -&gt; Transaction (Set CausalHash)
</span><span class="hs-identifier hs-var">Codebase.causalHashesByPrefix</span></span><span> </span><span class="annot"><span class="annottext">ShortCausalHash
</span><a href="#local-6989586621679377864"><span class="hs-identifier hs-var">hash</span></a></span><span>
</span><span id="line-823"></span><span>  </span><span id="local-6989586621679377861"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679377861"><span class="hs-identifier hs-var">len</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Transaction Int
</span><span class="hs-identifier hs-var">Codebase.branchHashLength</span></span><span>
</span><span id="line-824"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">Set.toList</span></span><span> </span><span class="annot"><span class="annottext">Set CausalHash
</span><a href="#local-6989586621679377863"><span class="hs-identifier hs-var">hashSet</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-825"></span><span>    </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ShortCausalHash -&gt; BackendError
</span><a href="Unison.Server.Backend.html#CouldntExpandBranchHash"><span class="hs-identifier hs-var">CouldntExpandBranchHash</span></a></span><span> </span><span class="annot"><span class="annottext">ShortCausalHash
</span><a href="#local-6989586621679377864"><span class="hs-identifier hs-var">hash</span></a></span><span>
</span><span id="line-826"></span><span>    </span><span class="hs-special">[</span><span id="local-6989586621679377858"><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621679377858"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621679377858"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-827"></span><span>    </span><span class="annot"><span class="annottext">[CausalHash]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-828"></span><span>      </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ShortCausalHash -&gt; Set ShortCausalHash -&gt; BackendError
</span><a href="Unison.Server.Backend.html#AmbiguousBranchHash"><span class="hs-identifier hs-var">AmbiguousBranchHash</span></a></span><span> </span><span class="annot"><span class="annottext">ShortCausalHash
</span><a href="#local-6989586621679377864"><span class="hs-identifier hs-var">hash</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall b a. Ord b =&gt; (a -&gt; b) -&gt; Set a -&gt; Set b
</span><span class="hs-identifier hs-var">Set.map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall h. Coercible h Hash =&gt; Int -&gt; h -&gt; ShortCausalHash
</span><span class="hs-identifier hs-var">SCH.fromHash</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679377861"><span class="hs-identifier hs-var">len</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set CausalHash
</span><a href="#local-6989586621679377863"><span class="hs-identifier hs-var">hashSet</span></a></span><span>
</span><span id="line-829"></span><span>
</span><span id="line-830"></span><span class="hs-comment">-- | Efficiently resolve a root hash and path to a shallow branch's causal.</span><span>
</span><span id="line-831"></span><span class="annot"><a href="Unison.Server.Backend.html#getShallowCausalAtPathFromRootHash"><span class="hs-identifier hs-type">getShallowCausalAtPathFromRootHash</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-832"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CausalHash</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-833"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Path</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-834"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Sqlite.Transaction</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">V2Branch.CausalBranch</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Sqlite.Transaction</span></span><span class="hs-special">)</span><span>
</span><span id="line-835"></span><span id="getShallowCausalAtPathFromRootHash"><span class="annot"><span class="annottext">getShallowCausalAtPathFromRootHash :: Maybe CausalHash -&gt; Path -&gt; Transaction (CausalBranch Transaction)
</span><a href="Unison.Server.Backend.html#getShallowCausalAtPathFromRootHash"><span class="hs-identifier hs-var hs-var">getShallowCausalAtPathFromRootHash</span></a></span></span><span> </span><span id="local-6989586621679377855"><span class="annot"><span class="annottext">Maybe CausalHash
</span><a href="#local-6989586621679377855"><span class="hs-identifier hs-var">mayRootHash</span></a></span></span><span> </span><span id="local-6989586621679377854"><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679377854"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-836"></span><span>  </span><span id="local-6989586621679377853"><span class="annot"><span class="annottext">CausalBranch Transaction
</span><a href="#local-6989586621679377853"><span class="hs-identifier hs-var">shallowRoot</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe CausalHash
</span><a href="#local-6989586621679377855"><span class="hs-identifier hs-var">mayRootHash</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-837"></span><span>    </span><span class="annot"><span class="annottext">Maybe CausalHash
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Transaction (CausalBranch Transaction)
</span><span class="hs-identifier hs-var">Codebase.getShallowRootCausal</span></span><span>
</span><span id="line-838"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679377851"><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621679377851"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CausalHash -&gt; Transaction (CausalBranch Transaction)
</span><span class="hs-identifier hs-var">Codebase.expectCausalBranchByCausalHash</span></span><span> </span><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621679377851"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-839"></span><span>  </span><span class="annot"><span class="annottext">Path
-&gt; Maybe (CausalBranch Transaction)
-&gt; Transaction (CausalBranch Transaction)
</span><span class="hs-identifier hs-var">Codebase.getShallowCausalAtPath</span></span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679377854"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">CausalBranch Transaction
</span><a href="#local-6989586621679377853"><span class="hs-identifier hs-var">shallowRoot</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-840"></span><span>
</span><span id="line-841"></span><span id="local-6989586621679379730"><span id="local-6989586621679379731"><span class="annot"><a href="Unison.Server.Backend.html#formatType%27"><span class="hs-identifier hs-type">formatType'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Var</span></span><span> </span><span class="annot"><a href="#local-6989586621679379731"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PPE.PrettyPrintEnv</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Width</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><a href="#local-6989586621679379731"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679379730"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#SyntaxText"><span class="hs-identifier hs-type">SyntaxText</span></a></span></span></span><span>
</span><span id="line-842"></span><span id="formatType%27"><span class="annot"><span class="annottext">formatType' :: forall v a.
Var v =&gt;
PrettyPrintEnv -&gt; Width -&gt; Type v a -&gt; SyntaxText
</span><a href="Unison.Server.Backend.html#formatType%27"><span class="hs-identifier hs-var hs-var">formatType'</span></a></span></span><span> </span><span id="local-6989586621679377843"><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679377843"><span class="hs-identifier hs-var">ppe</span></a></span></span><span> </span><span id="local-6989586621679377842"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621679377842"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-843"></span><span>  </span><span class="annot"><span class="annottext">forall s. (Monoid s, IsString s) =&gt; Width -&gt; Pretty s -&gt; s
</span><span class="hs-identifier hs-var">Pretty.render</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621679377842"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall v a.
Var v =&gt;
PrettyPrintEnv -&gt; Type v a -&gt; Pretty SyntaxText
</span><span class="hs-identifier hs-var">TypePrinter.prettySyntax</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679377843"><span class="hs-identifier hs-var">ppe</span></a></span><span>
</span><span id="line-844"></span><span>
</span><span id="line-845"></span><span id="local-6989586621679379860"><span id="local-6989586621679379861"><span class="annot"><a href="Unison.Server.Backend.html#formatType"><span class="hs-identifier hs-type">formatType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Var</span></span><span> </span><span class="annot"><a href="#local-6989586621679379861"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PPE.PrettyPrintEnv</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Width</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><a href="#local-6989586621679379861"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679379860"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Server.Syntax.html#SyntaxText"><span class="hs-identifier hs-type">Syntax.SyntaxText</span></a></span></span></span><span>
</span><span id="line-846"></span><span id="formatType"><span class="annot"><span class="annottext">formatType :: forall v a.
Var v =&gt;
PrettyPrintEnv -&gt; Width -&gt; Type v a -&gt; SyntaxText
</span><a href="Unison.Server.Backend.html#formatType"><span class="hs-identifier hs-var hs-var">formatType</span></a></span></span><span> </span><span id="local-6989586621679377837"><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679377837"><span class="hs-identifier hs-var">ppe</span></a></span></span><span> </span><span id="local-6989586621679377836"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621679377836"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (g :: * -&gt; *).
Functor g =&gt;
g (Element TypeReference) -&gt; g Element
</span><a href="Unison.Server.Backend.html#mungeSyntaxText"><span class="hs-identifier hs-var">mungeSyntaxText</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall v a.
Var v =&gt;
PrettyPrintEnv -&gt; Width -&gt; Type v a -&gt; SyntaxText
</span><a href="Unison.Server.Backend.html#formatType%27"><span class="hs-identifier hs-var">formatType'</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679377837"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621679377836"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-847"></span><span>
</span><span id="line-848"></span><span id="local-6989586621679379722"><span class="annot"><a href="Unison.Server.Backend.html#formatSuffixedType"><span class="hs-identifier hs-type">formatSuffixedType</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-849"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Var</span></span><span> </span><span class="annot"><a href="#local-6989586621679379722"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-850"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">PPED.PrettyPrintEnvDecl</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-851"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Width</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-852"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><a href="#local-6989586621679379722"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-853"></span><span>  </span><span class="annot"><a href="Unison.Server.Syntax.html#SyntaxText"><span class="hs-identifier hs-type">Syntax.SyntaxText</span></a></span></span><span>
</span><span id="line-854"></span><span id="formatSuffixedType"><span class="annot"><span class="annottext">formatSuffixedType :: forall v.
Var v =&gt;
PrettyPrintEnvDecl -&gt; Width -&gt; Type v Ann -&gt; SyntaxText
</span><a href="Unison.Server.Backend.html#formatSuffixedType"><span class="hs-identifier hs-var hs-var">formatSuffixedType</span></a></span></span><span> </span><span id="local-6989586621679377833"><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679377833"><span class="hs-identifier hs-var">ppe</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall v a.
Var v =&gt;
PrettyPrintEnv -&gt; Width -&gt; Type v a -&gt; SyntaxText
</span><a href="Unison.Server.Backend.html#formatType"><span class="hs-identifier hs-var">formatType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrettyPrintEnvDecl -&gt; PrettyPrintEnv
</span><span class="hs-identifier hs-var">PPED.suffixifiedPPE</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679377833"><span class="hs-identifier hs-var">ppe</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-855"></span><span>
</span><span id="line-856"></span><span id="local-6989586621679379723"><span class="annot"><a href="Unison.Server.Backend.html#mungeSyntaxText"><span class="hs-identifier hs-type">mungeSyntaxText</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-857"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Functor</span></span><span> </span><span class="annot"><a href="#local-6989586621679379723"><span class="hs-identifier hs-type">g</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679379723"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">UST.Element</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679379723"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="Unison.Server.Syntax.html#Element"><span class="hs-identifier hs-type">Syntax.Element</span></a></span></span><span>
</span><span id="line-858"></span><span id="mungeSyntaxText"><span class="annot"><span class="annottext">mungeSyntaxText :: forall (g :: * -&gt; *).
Functor g =&gt;
g (Element TypeReference) -&gt; g Element
</span><a href="Unison.Server.Backend.html#mungeSyntaxText"><span class="hs-identifier hs-var hs-var">mungeSyntaxText</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Element TypeReference -&gt; Element
</span><a href="Unison.Server.Syntax.html#convertElement"><span class="hs-identifier hs-var">Syntax.convertElement</span></a></span><span>
</span><span id="line-859"></span><span>
</span><span id="line-860"></span><span class="hs-comment">-- | Renders a definition for the given name or hash alongside its documentation.</span><span>
</span><span id="line-861"></span><span class="annot"><a href="Unison.Server.Backend.html#prettyDefinitionsForHQName"><span class="hs-identifier hs-type">prettyDefinitionsForHQName</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-862"></span><span>  </span><span class="hs-comment">-- | The path representing the user's current perspective.</span><span>
</span><span id="line-863"></span><span>  </span><span class="hs-comment">-- Searches will be limited to definitions within this path, and names will be relative to</span><span>
</span><span id="line-864"></span><span>  </span><span class="hs-comment">-- this path.</span><span>
</span><span id="line-865"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Path</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-866"></span><span>  </span><span class="hs-comment">-- | The root branch to use</span><span>
</span><span id="line-867"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">V2Branch.CausalBranch</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Sqlite.Transaction</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-868"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Width</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-869"></span><span>  </span><span class="hs-comment">-- | Whether to suffixify bindings in the rendered syntax</span><span>
</span><span id="line-870"></span><span>  </span><span class="annot"><a href="Unison.Server.Types.html#Suffixify"><span class="hs-identifier hs-type">Suffixify</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-871"></span><span>  </span><span class="hs-comment">-- | Runtime used to evaluate docs. This should be sandboxed if run on the server.</span><span>
</span><span id="line-872"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Rt.Runtime</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-873"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-874"></span><span>  </span><span class="hs-comment">-- | The name, hash, or both, of the definition to display.</span><span>
</span><span id="line-875"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">HQ.HashQualified</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-876"></span><span>  </span><span class="annot"><a href="Unison.Server.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Unison.Server.Types.html#DefinitionDisplayResults"><span class="hs-identifier hs-type">DefinitionDisplayResults</span></a></span><span>
</span><span id="line-877"></span><span id="prettyDefinitionsForHQName"><span class="annot"><span class="annottext">prettyDefinitionsForHQName :: Path
-&gt; CausalBranch Transaction
-&gt; Maybe Width
-&gt; Suffixify
-&gt; Runtime Symbol
-&gt; Codebase IO Symbol Ann
-&gt; HashQualified Name
-&gt; Backend IO DefinitionDisplayResults
</span><a href="Unison.Server.Backend.html#prettyDefinitionsForHQName"><span class="hs-identifier hs-var hs-var">prettyDefinitionsForHQName</span></a></span></span><span> </span><span id="local-6989586621679377830"><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679377830"><span class="hs-identifier hs-var">perspective</span></a></span></span><span> </span><span id="local-6989586621679377829"><span class="annot"><span class="annottext">CausalBranch Transaction
</span><a href="#local-6989586621679377829"><span class="hs-identifier hs-var">shallowRoot</span></a></span></span><span> </span><span id="local-6989586621679377828"><span class="annot"><span class="annottext">Maybe Width
</span><a href="#local-6989586621679377828"><span class="hs-identifier hs-var">renderWidth</span></a></span></span><span> </span><span id="local-6989586621679377827"><span class="annot"><span class="annottext">Suffixify
</span><a href="#local-6989586621679377827"><span class="hs-identifier hs-var">suffixifyBindings</span></a></span></span><span> </span><span id="local-6989586621679377826"><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679377826"><span class="hs-identifier hs-var">rt</span></a></span></span><span> </span><span id="local-6989586621679377825"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679377825"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621679377824"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679377824"><span class="hs-identifier hs-var">perspectiveQuery</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-878"></span><span>  </span><span id="local-6989586621679377823"><span class="annot"><span class="annottext">Either
  BackendError (CausalBranch Transaction, Path, HashQualified Name)
</span><a href="#local-6989586621679377823"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) v a b.
MonadIO m =&gt;
Codebase m v a -&gt; Transaction b -&gt; m b
</span><span class="hs-identifier hs-var">Codebase.runTransaction</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679377825"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-879"></span><span>    </span><span id="local-6989586621679377822"><span class="annot"><span class="annottext">Branch Transaction
</span><a href="#local-6989586621679377822"><span class="hs-identifier hs-var">shallowBranch</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) hc he e. Causal m hc he e -&gt; m e
</span><span class="hs-identifier hs-var">V2Causal.value</span></span><span> </span><span class="annot"><span class="annottext">CausalBranch Transaction
</span><a href="#local-6989586621679377829"><span class="hs-identifier hs-var">shallowRoot</span></a></span><span>
</span><span id="line-880"></span><span>    </span><span class="annot"><span class="annottext">Path
-&gt; HashQualified Name
-&gt; Branch Transaction
-&gt; Transaction (Either BackendError (Path, HashQualified Name))
</span><a href="Unison.Server.Backend.html#relocateToProjectRoot"><span class="hs-identifier hs-var">relocateToProjectRoot</span></a></span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679377830"><span class="hs-identifier hs-var">perspective</span></a></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679377824"><span class="hs-identifier hs-var">perspectiveQuery</span></a></span><span> </span><span class="annot"><span class="annottext">Branch Transaction
</span><a href="#local-6989586621679377822"><span class="hs-identifier hs-var">shallowBranch</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-881"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679377820"><span class="annot"><span class="annottext">BackendError
</span><a href="#local-6989586621679377820"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">BackendError
</span><a href="#local-6989586621679377820"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-882"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679377819"><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679377819"><span class="hs-identifier hs-var">namesRoot</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679377818"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679377818"><span class="hs-identifier hs-var">locatedQuery</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CausalBranch Transaction
</span><a href="#local-6989586621679377829"><span class="hs-identifier hs-var">shallowRoot</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679377819"><span class="hs-identifier hs-var">namesRoot</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679377818"><span class="hs-identifier hs-var">locatedQuery</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-883"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679377817"><span class="annot"><span class="annottext">CausalBranch Transaction
</span><a href="#local-6989586621679377817"><span class="hs-identifier hs-var">shallowRoot</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679377816"><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679377816"><span class="hs-identifier hs-var">namesRoot</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679377815"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679377815"><span class="hs-identifier hs-var">query</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span> </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Either
  BackendError (CausalBranch Transaction, Path, HashQualified Name)
</span><a href="#local-6989586621679377823"><span class="hs-identifier hs-var">result</span></a></span><span>
</span><span id="line-884"></span><span>  </span><span class="hs-comment">-- Bias towards both relative and absolute path to queries,</span><span>
</span><span id="line-885"></span><span>  </span><span class="hs-comment">-- This allows us to still bias towards definitions outside our perspective but within the</span><span>
</span><span id="line-886"></span><span>  </span><span class="hs-comment">-- same tree;</span><span>
</span><span id="line-887"></span><span>  </span><span class="hs-comment">-- e.g. if the query is `map` and we're in `base.trunk.List`,</span><span>
</span><span id="line-888"></span><span>  </span><span class="hs-comment">-- we bias towards `map` and `.base.trunk.List.map` which ensures we still prefer names in</span><span>
</span><span id="line-889"></span><span>  </span><span class="hs-comment">-- `trunk` over those in other releases.</span><span>
</span><span id="line-890"></span><span>  </span><span class="hs-comment">-- ppe which returns names fully qualified to the current perspective,  not to the codebase root.</span><span>
</span><span id="line-891"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679377814"><span class="annot"><span class="annottext">biases :: [Name]
</span><a href="#local-6989586621679377814"><span class="hs-identifier hs-var hs-var">biases</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a -&gt; [a]
</span><span class="hs-identifier hs-var">maybeToList</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall n. HashQualified n -&gt; Maybe n
</span><span class="hs-identifier hs-var">HQ.toName</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679377815"><span class="hs-identifier hs-var">query</span></a></span><span>
</span><span id="line-892"></span><span>  </span><span id="local-6989586621679377811"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679377811"><span class="hs-identifier hs-var">hqLength</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) v a b.
MonadIO m =&gt;
Codebase m v a -&gt; Transaction b -&gt; m b
</span><span class="hs-identifier hs-var">Codebase.runTransaction</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679377825"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Transaction Int
</span><span class="hs-identifier hs-var">Codebase.hashLength</span></span><span>
</span><span id="line-893"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679377810"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679377810"><span class="hs-identifier hs-var">localNamesOnly</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679377809"><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679377809"><span class="hs-identifier hs-var">unbiasedPPED</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) (n :: * -&gt; *) v a.
MonadIO m =&gt;
Codebase m v a
-&gt; Maybe (CausalBranch n)
-&gt; Path
-&gt; Backend m (Names, PrettyPrintEnvDecl)
</span><a href="Unison.Server.Backend.html#scopedNamesForBranchHash"><span class="hs-identifier hs-var">scopedNamesForBranchHash</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679377825"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">CausalBranch Transaction
</span><a href="#local-6989586621679377817"><span class="hs-identifier hs-var">shallowRoot</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679377830"><span class="hs-identifier hs-var">perspective</span></a></span><span>
</span><span id="line-894"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679377808"><span class="annot"><span class="annottext">pped :: PrettyPrintEnvDecl
</span><a href="#local-6989586621679377808"><span class="hs-identifier hs-var hs-var">pped</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; PrettyPrintEnvDecl -&gt; PrettyPrintEnvDecl
</span><span class="hs-identifier hs-var">PPED.biasTo</span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679377814"><span class="hs-identifier hs-var">biases</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679377809"><span class="hs-identifier hs-var">unbiasedPPED</span></a></span><span>
</span><span id="line-895"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679377806"><span class="annot"><span class="annottext">nameSearch :: NameSearch Transaction
</span><a href="#local-6989586621679377806"><span class="hs-identifier hs-var hs-var">nameSearch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
Applicative m =&gt;
Int -&gt; NamesWithHistory -&gt; NameSearch m
</span><a href="Unison.Server.NameSearch.FromNames.html#makeNameSearch"><span class="hs-identifier hs-var">makeNameSearch</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679377811"><span class="hs-identifier hs-var">hqLength</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Names -&gt; NamesWithHistory
</span><span class="hs-identifier hs-var">NamesWithHistory.fromCurrentNames</span></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679377810"><span class="hs-identifier hs-var">localNamesOnly</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-896"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.Backend.html#DefinitionResults"><span class="hs-identifier hs-type">DefinitionResults</span></a></span><span> </span><span id="local-6989586621679377805"><span class="annot"><span class="annottext">Map
  TypeReference (DisplayObject (Type Symbol Ann) (Term Symbol Ann))
</span><a href="#local-6989586621679377805"><span class="hs-identifier hs-var">terms</span></a></span></span><span> </span><span id="local-6989586621679377804"><span class="annot"><span class="annottext">Map TypeReference (DisplayObject () (Decl Symbol Ann))
</span><a href="#local-6989586621679377804"><span class="hs-identifier hs-var">types</span></a></span></span><span> </span><span id="local-6989586621679377803"><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679377803"><span class="hs-identifier hs-var">misses</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) v a b.
MonadIO m =&gt;
Codebase m v a -&gt; Transaction b -&gt; m b
</span><span class="hs-identifier hs-var">Codebase.runTransaction</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679377825"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-897"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
Codebase m Symbol Ann
-&gt; NameSearch Transaction
-&gt; IncludeCycles
-&gt; [HashQualified Name]
-&gt; Transaction DefinitionResults
</span><a href="Unison.Server.Backend.html#definitionsBySuffixes"><span class="hs-identifier hs-var">definitionsBySuffixes</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679377825"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">NameSearch Transaction
</span><a href="#local-6989586621679377806"><span class="hs-identifier hs-var">nameSearch</span></a></span><span> </span><span class="annot"><span class="annottext">IncludeCycles
</span><a href="Unison.Server.Backend.html#DontIncludeCycles"><span class="hs-identifier hs-var">DontIncludeCycles</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679377815"><span class="hs-identifier hs-var">query</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-898"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679377801"><span class="annot"><span class="annottext">width :: Width
</span><a href="#local-6989586621679377801"><span class="hs-identifier hs-var hs-var">width</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Width -&gt; Width
</span><a href="Unison.Server.Types.html#mayDefaultWidth"><span class="hs-identifier hs-var">mayDefaultWidth</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Width
</span><a href="#local-6989586621679377828"><span class="hs-identifier hs-var">renderWidth</span></a></span><span>
</span><span id="line-899"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621679377800"><span class="hs-identifier hs-type">docResults</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.Types.html#HashQualifiedName"><span class="hs-identifier hs-type">HashQualifiedName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Server.Types.html#UnisonHash"><span class="hs-identifier hs-type">UnisonHash</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Server.Doc.html#Doc"><span class="hs-identifier hs-type">Doc.Doc</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-900"></span><span>      </span><span id="local-6989586621679377800"><span class="annot"><span class="annottext">docResults :: Name -&gt; IO [(Text, Text, Doc)]
</span><a href="#local-6989586621679377800"><span class="hs-identifier hs-var hs-var">docResults</span></a></span></span><span> </span><span id="local-6989586621679377797"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679377797"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-901"></span><span>        </span><span id="local-6989586621679377796"><span class="annot"><span class="annottext">[TypeReference]
</span><a href="#local-6989586621679377796"><span class="hs-identifier hs-var">docRefs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; NameSearch Transaction -&gt; Name -&gt; IO [TypeReference]
</span><a href="Unison.Server.Backend.html#docsForDefinitionName"><span class="hs-identifier hs-var">docsForDefinitionName</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679377825"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">NameSearch Transaction
</span><a href="#local-6989586621679377806"><span class="hs-identifier hs-var">nameSearch</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679377797"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-902"></span><span>        </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *).
Traversable t =&gt;
PrettyPrintEnvDecl
-&gt; Width
-&gt; Codebase IO Symbol Ann
-&gt; Runtime Symbol
-&gt; t TypeReference
-&gt; IO (t (Text, Text, Doc))
</span><a href="Unison.Server.Backend.html#renderDocRefs"><span class="hs-identifier hs-var">renderDocRefs</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679377808"><span class="hs-identifier hs-var">pped</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621679377801"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679377825"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679377826"><span class="hs-identifier hs-var">rt</span></a></span><span> </span><span class="annot"><span class="annottext">[TypeReference]
</span><a href="#local-6989586621679377796"><span class="hs-identifier hs-var">docRefs</span></a></span><span>
</span><span id="line-903"></span><span>
</span><span id="line-904"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679377795"><span class="annot"><span class="annottext">fqnPPE :: PrettyPrintEnv
</span><a href="#local-6989586621679377795"><span class="hs-identifier hs-var hs-var">fqnPPE</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl -&gt; PrettyPrintEnv
</span><span class="hs-identifier hs-var">PPED.unsuffixifiedPPE</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679377808"><span class="hs-identifier hs-var">pped</span></a></span><span>
</span><span id="line-905"></span><span>  </span><span id="local-6989586621679377794"><span class="annot"><span class="annottext">Map TypeReference TypeDefinition
</span><a href="#local-6989586621679377794"><span class="hs-identifier hs-var">typeDefinitions</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-906"></span><span>    </span><span class="annot"><span class="annottext">forall i (t :: * -&gt; *) (f :: * -&gt; *) a b.
(TraversableWithIndex i t, Applicative f) =&gt;
t a -&gt; (i -&gt; a -&gt; f b) -&gt; f (t b)
</span><span class="hs-identifier hs-var">ifor</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall v a.
(Var v, Ord a) =&gt;
Suffixify
-&gt; Width
-&gt; PrettyPrintEnvDecl
-&gt; Map TypeReference (DisplayObject () (Decl v a))
-&gt; Map TypeReference (DisplayObject SyntaxText SyntaxText)
</span><a href="Unison.Server.Backend.html#typesToSyntax"><span class="hs-identifier hs-var">typesToSyntax</span></a></span><span> </span><span class="annot"><span class="annottext">Suffixify
</span><a href="#local-6989586621679377827"><span class="hs-identifier hs-var">suffixifyBindings</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621679377801"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679377808"><span class="hs-identifier hs-var">pped</span></a></span><span> </span><span class="annot"><span class="annottext">Map TypeReference (DisplayObject () (Decl Symbol Ann))
</span><a href="#local-6989586621679377804"><span class="hs-identifier hs-var">types</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679377792"><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679377792"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span id="local-6989586621679377791"><span class="annot"><span class="annottext">DisplayObject SyntaxText SyntaxText
</span><a href="#local-6989586621679377791"><span class="hs-identifier hs-var">tp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-907"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679377790"><span class="annot"><span class="annottext">hqTypeName :: HashQualified Name
</span><a href="#local-6989586621679377790"><span class="hs-identifier hs-var hs-var">hqTypeName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv -&gt; TypeReference -&gt; HashQualified Name
</span><span class="hs-identifier hs-var">PPE.typeNameOrHashOnly</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679377795"><span class="hs-identifier hs-var">fqnPPE</span></a></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679377792"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-908"></span><span>      </span><span id="local-6989586621679377788"><span class="annot"><span class="annottext">[(Text, Text, Doc)]
</span><a href="#local-6989586621679377788"><span class="hs-identifier hs-var">docs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name -&gt; IO [(Text, Text, Doc)]
</span><a href="#local-6989586621679377800"><span class="hs-identifier hs-var">docResults</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall n. HashQualified n -&gt; Maybe n
</span><span class="hs-identifier hs-var">HQ.toName</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679377790"><span class="hs-identifier hs-var">hqTypeName</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-909"></span><span>      </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; PrettyPrintEnvDecl
-&gt; Path
-&gt; CausalBranch Transaction
-&gt; Width
-&gt; TypeReference
-&gt; [(Text, Text, Doc)]
-&gt; DisplayObject SyntaxText SyntaxText
-&gt; Backend IO TypeDefinition
</span><a href="Unison.Server.Backend.html#mkTypeDefinition"><span class="hs-identifier hs-var">mkTypeDefinition</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679377825"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679377808"><span class="hs-identifier hs-var">pped</span></a></span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679377816"><span class="hs-identifier hs-var">namesRoot</span></a></span><span> </span><span class="annot"><span class="annottext">CausalBranch Transaction
</span><a href="#local-6989586621679377817"><span class="hs-identifier hs-var">shallowRoot</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621679377801"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679377792"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">[(Text, Text, Doc)]
</span><a href="#local-6989586621679377788"><span class="hs-identifier hs-var">docs</span></a></span><span> </span><span class="annot"><span class="annottext">DisplayObject SyntaxText SyntaxText
</span><a href="#local-6989586621679377791"><span class="hs-identifier hs-var">tp</span></a></span><span>
</span><span id="line-910"></span><span>  </span><span id="local-6989586621679377787"><span class="annot"><span class="annottext">Map TypeReference TermDefinition
</span><a href="#local-6989586621679377787"><span class="hs-identifier hs-var">termDefinitions</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-911"></span><span>    </span><span class="annot"><span class="annottext">forall i (t :: * -&gt; *) (f :: * -&gt; *) a b.
(TraversableWithIndex i t, Applicative f) =&gt;
t a -&gt; (i -&gt; a -&gt; f b) -&gt; f (t b)
</span><span class="hs-identifier hs-var">ifor</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall v a.
(Var v, Ord a) =&gt;
Suffixify
-&gt; Width
-&gt; PrettyPrintEnvDecl
-&gt; Map TypeReference (DisplayObject (Type v a) (Term v a))
-&gt; Map TypeReference (DisplayObject SyntaxText SyntaxText)
</span><a href="Unison.Server.Backend.html#termsToSyntax"><span class="hs-identifier hs-var">termsToSyntax</span></a></span><span> </span><span class="annot"><span class="annottext">Suffixify
</span><a href="#local-6989586621679377827"><span class="hs-identifier hs-var">suffixifyBindings</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621679377801"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679377808"><span class="hs-identifier hs-var">pped</span></a></span><span> </span><span class="annot"><span class="annottext">Map
  TypeReference (DisplayObject (Type Symbol Ann) (Term Symbol Ann))
</span><a href="#local-6989586621679377805"><span class="hs-identifier hs-var">terms</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679377786"><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679377786"><span class="hs-identifier hs-var">reference</span></a></span></span><span> </span><span id="local-6989586621679377785"><span class="annot"><span class="annottext">DisplayObject SyntaxText SyntaxText
</span><a href="#local-6989586621679377785"><span class="hs-identifier hs-var">trm</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-912"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679377784"><span class="annot"><span class="annottext">referent :: Referent
</span><a href="#local-6989586621679377784"><span class="hs-identifier hs-var hs-var">referent</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeReference -&gt; Referent
</span><span class="hs-identifier hs-var">Referent.Ref</span></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679377786"><span class="hs-identifier hs-var">reference</span></a></span><span>
</span><span id="line-913"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679377783"><span class="annot"><span class="annottext">hqTermName :: HashQualified Name
</span><a href="#local-6989586621679377783"><span class="hs-identifier hs-var hs-var">hqTermName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv -&gt; Referent -&gt; HashQualified Name
</span><span class="hs-identifier hs-var">PPE.termNameOrHashOnly</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679377795"><span class="hs-identifier hs-var">fqnPPE</span></a></span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679377784"><span class="hs-identifier hs-var">referent</span></a></span><span>
</span><span id="line-914"></span><span>      </span><span id="local-6989586621679377781"><span class="annot"><span class="annottext">[(Text, Text, Doc)]
</span><a href="#local-6989586621679377781"><span class="hs-identifier hs-var">docs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name -&gt; IO [(Text, Text, Doc)]
</span><a href="#local-6989586621679377800"><span class="hs-identifier hs-var">docResults</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall n. HashQualified n -&gt; Maybe n
</span><span class="hs-identifier hs-var">HQ.toName</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679377783"><span class="hs-identifier hs-var">hqTermName</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-915"></span><span>      </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; PrettyPrintEnvDecl
-&gt; Path
-&gt; CausalBranch Transaction
-&gt; Width
-&gt; TypeReference
-&gt; [(Text, Text, Doc)]
-&gt; DisplayObject SyntaxText SyntaxText
-&gt; Backend IO TermDefinition
</span><a href="Unison.Server.Backend.html#mkTermDefinition"><span class="hs-identifier hs-var">mkTermDefinition</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679377825"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679377808"><span class="hs-identifier hs-var">pped</span></a></span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679377816"><span class="hs-identifier hs-var">namesRoot</span></a></span><span> </span><span class="annot"><span class="annottext">CausalBranch Transaction
</span><a href="#local-6989586621679377817"><span class="hs-identifier hs-var">shallowRoot</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621679377801"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679377786"><span class="hs-identifier hs-var">reference</span></a></span><span> </span><span class="annot"><span class="annottext">[(Text, Text, Doc)]
</span><a href="#local-6989586621679377781"><span class="hs-identifier hs-var">docs</span></a></span><span> </span><span class="annot"><span class="annottext">DisplayObject SyntaxText SyntaxText
</span><a href="#local-6989586621679377785"><span class="hs-identifier hs-var">trm</span></a></span><span>
</span><span id="line-916"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679377780"><span class="annot"><span class="annottext">renderedDisplayTerms :: Map Text TermDefinition
</span><a href="#local-6989586621679377780"><span class="hs-identifier hs-var hs-var">renderedDisplayTerms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall k2 k1 a. Ord k2 =&gt; (k1 -&gt; k2) -&gt; Map k1 a -&gt; Map k2 a
</span><span class="hs-identifier hs-var">Map.mapKeys</span></span><span> </span><span class="annot"><span class="annottext">TypeReference -&gt; Text
</span><span class="hs-identifier hs-var">Reference.toText</span></span><span> </span><span class="annot"><span class="annottext">Map TypeReference TermDefinition
</span><a href="#local-6989586621679377787"><span class="hs-identifier hs-var">termDefinitions</span></a></span><span>
</span><span id="line-917"></span><span>      </span><span id="local-6989586621679377778"><span class="annot"><span class="annottext">renderedDisplayTypes :: Map Text TypeDefinition
</span><a href="#local-6989586621679377778"><span class="hs-identifier hs-var hs-var">renderedDisplayTypes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall k2 k1 a. Ord k2 =&gt; (k1 -&gt; k2) -&gt; Map k1 a -&gt; Map k2 a
</span><span class="hs-identifier hs-var">Map.mapKeys</span></span><span> </span><span class="annot"><span class="annottext">TypeReference -&gt; Text
</span><span class="hs-identifier hs-var">Reference.toText</span></span><span> </span><span class="annot"><span class="annottext">Map TypeReference TypeDefinition
</span><a href="#local-6989586621679377794"><span class="hs-identifier hs-var">typeDefinitions</span></a></span><span>
</span><span id="line-918"></span><span>      </span><span id="local-6989586621679377777"><span class="annot"><span class="annottext">renderedMisses :: [Text]
</span><a href="#local-6989586621679377777"><span class="hs-identifier hs-var hs-var">renderedMisses</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; Text
</span><span class="hs-identifier hs-var">HQ.toText</span></span><span> </span><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679377803"><span class="hs-identifier hs-var">misses</span></a></span><span>
</span><span id="line-919"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-920"></span><span>    </span><span class="annot"><span class="annottext">Map Text TermDefinition
-&gt; Map Text TypeDefinition -&gt; [Text] -&gt; DefinitionDisplayResults
</span><a href="Unison.Server.Types.html#DefinitionDisplayResults"><span class="hs-identifier hs-var">DefinitionDisplayResults</span></a></span><span>
</span><span id="line-921"></span><span>      </span><span class="annot"><span class="annottext">Map Text TermDefinition
</span><a href="#local-6989586621679377780"><span class="hs-identifier hs-var">renderedDisplayTerms</span></a></span><span>
</span><span id="line-922"></span><span>      </span><span class="annot"><span class="annottext">Map Text TypeDefinition
</span><a href="#local-6989586621679377778"><span class="hs-identifier hs-var">renderedDisplayTypes</span></a></span><span>
</span><span id="line-923"></span><span>      </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679377777"><span class="hs-identifier hs-var">renderedMisses</span></a></span><span>
</span><span id="line-924"></span><span>
</span><span id="line-925"></span><span class="annot"><a href="Unison.Server.Backend.html#mkTypeDefinition"><span class="hs-identifier hs-type">mkTypeDefinition</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-926"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-927"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">PPED.PrettyPrintEnvDecl</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-928"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Path.Path</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-929"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">V2Branch.CausalBranch</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Sqlite.Transaction</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-930"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Width</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-931"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-932"></span><span>  </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.Types.html#HashQualifiedName"><span class="hs-identifier hs-type">HashQualifiedName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Server.Types.html#UnisonHash"><span class="hs-identifier hs-type">UnisonHash</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Server.Doc.html#Doc"><span class="hs-identifier hs-type">Doc.Doc</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-933"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">DisplayObject</span></span><span>
</span><span id="line-934"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">AnnotatedText</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">UST.Element</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-935"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">AnnotatedText</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">UST.Element</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-936"></span><span>  </span><span class="annot"><a href="Unison.Server.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Unison.Server.Types.html#TypeDefinition"><span class="hs-identifier hs-type">TypeDefinition</span></a></span><span>
</span><span id="line-937"></span><span id="mkTypeDefinition"><span class="annot"><span class="annottext">mkTypeDefinition :: Codebase IO Symbol Ann
-&gt; PrettyPrintEnvDecl
-&gt; Path
-&gt; CausalBranch Transaction
-&gt; Width
-&gt; TypeReference
-&gt; [(Text, Text, Doc)]
-&gt; DisplayObject SyntaxText SyntaxText
-&gt; Backend IO TypeDefinition
</span><a href="Unison.Server.Backend.html#mkTypeDefinition"><span class="hs-identifier hs-var hs-var">mkTypeDefinition</span></a></span></span><span> </span><span id="local-6989586621679377775"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679377775"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621679377774"><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679377774"><span class="hs-identifier hs-var">pped</span></a></span></span><span> </span><span id="local-6989586621679377773"><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679377773"><span class="hs-identifier hs-var">namesRoot</span></a></span></span><span> </span><span id="local-6989586621679377772"><span class="annot"><span class="annottext">CausalBranch Transaction
</span><a href="#local-6989586621679377772"><span class="hs-identifier hs-var">rootCausal</span></a></span></span><span> </span><span id="local-6989586621679377771"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621679377771"><span class="hs-identifier hs-var">width</span></a></span></span><span> </span><span id="local-6989586621679377770"><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679377770"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621679377769"><span class="annot"><span class="annottext">[(Text, Text, Doc)]
</span><a href="#local-6989586621679377769"><span class="hs-identifier hs-var">docs</span></a></span></span><span> </span><span id="local-6989586621679377768"><span class="annot"><span class="annottext">DisplayObject SyntaxText SyntaxText
</span><a href="#local-6989586621679377768"><span class="hs-identifier hs-var">tp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-938"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679377767"><span class="annot"><span class="annottext">bn :: Text
</span><a href="#local-6989586621679377767"><span class="hs-identifier hs-var hs-var">bn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall v. Var v =&gt; PrettyPrintEnv -&gt; Width -&gt; TypeReference -&gt; Text
</span><a href="Unison.Server.Backend.html#bestNameForType"><span class="hs-identifier hs-var">bestNameForType</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrettyPrintEnvDecl -&gt; PrettyPrintEnv
</span><span class="hs-identifier hs-var">PPED.suffixifiedPPE</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679377774"><span class="hs-identifier hs-var">pped</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621679377771"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679377770"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-939"></span><span>  </span><span id="local-6989586621679377766"><span class="annot"><span class="annottext">TypeTag
</span><a href="#local-6989586621679377766"><span class="hs-identifier hs-var">tag</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-940"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) v a b.
MonadIO m =&gt;
Codebase m v a -&gt; Transaction b -&gt; m b
</span><span class="hs-identifier hs-var">Codebase.runTransaction</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679377775"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-941"></span><span>      </span><span id="local-6989586621679377765"><span class="annot"><span class="annottext">CausalBranch Transaction
</span><a href="#local-6989586621679377765"><span class="hs-identifier hs-var">causalAtPath</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Path
-&gt; Maybe (CausalBranch Transaction)
-&gt; Transaction (CausalBranch Transaction)
</span><span class="hs-identifier hs-var">Codebase.getShallowCausalAtPath</span></span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679377773"><span class="hs-identifier hs-var">namesRoot</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">CausalBranch Transaction
</span><a href="#local-6989586621679377772"><span class="hs-identifier hs-var">rootCausal</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-942"></span><span>      </span><span id="local-6989586621679377764"><span class="annot"><span class="annottext">Branch Transaction
</span><a href="#local-6989586621679377764"><span class="hs-identifier hs-var">branchAtPath</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) hc he e. Causal m hc he e -&gt; m e
</span><span class="hs-identifier hs-var">V2Causal.value</span></span><span> </span><span class="annot"><span class="annottext">CausalBranch Transaction
</span><a href="#local-6989586621679377765"><span class="hs-identifier hs-var">causalAtPath</span></a></span><span>
</span><span id="line-943"></span><span>      </span><span class="annot"><span class="annottext">TypeEntry -&gt; TypeTag
</span><a href="Unison.Server.Backend.html#%24sel%3AtypeEntryTag%3ATypeEntry"><span class="hs-identifier hs-var">typeEntryTag</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall v (m :: * -&gt; *) (n :: * -&gt; *).
Var v =&gt;
Codebase m v Ann
-&gt; Branch n
-&gt; ExactName NameSegment TypeReference
-&gt; Transaction TypeEntry
</span><a href="Unison.Server.Backend.html#typeListEntry"><span class="hs-identifier hs-var">typeListEntry</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679377775"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Branch Transaction
</span><a href="#local-6989586621679377764"><span class="hs-identifier hs-var">branchAtPath</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall name ref. name -&gt; ref -&gt; ExactName name ref
</span><a href="Unison.Server.Types.html#ExactName"><span class="hs-identifier hs-var">ExactName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; NameSegment
</span><span class="hs-identifier hs-var">NameSegment</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679377767"><span class="hs-identifier hs-var">bn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679377770"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-944"></span><span>  </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span>
</span><span id="line-945"></span><span>    </span><span class="annot"><span class="annottext">[Text]
-&gt; Text
-&gt; TypeTag
-&gt; DisplayObject SyntaxText SyntaxText
-&gt; [(Text, Text, Doc)]
-&gt; TypeDefinition
</span><a href="Unison.Server.Types.html#TypeDefinition"><span class="hs-identifier hs-var">TypeDefinition</span></a></span><span>
</span><span id="line-946"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashQualified Name -&gt; Text
</span><span class="hs-identifier hs-var">HQ'.toText</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv -&gt; TypeReference -&gt; [HashQualified Name]
</span><span class="hs-identifier hs-var">PPE.allTypeNames</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679377760"><span class="hs-identifier hs-var">fqnPPE</span></a></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679377770"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-947"></span><span>      </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679377767"><span class="hs-identifier hs-var">bn</span></a></span><span>
</span><span id="line-948"></span><span>      </span><span class="annot"><span class="annottext">TypeTag
</span><a href="#local-6989586621679377766"><span class="hs-identifier hs-var">tag</span></a></span><span>
</span><span id="line-949"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (p :: * -&gt; * -&gt; *) a b c d.
Bifunctor p =&gt;
(a -&gt; b) -&gt; (c -&gt; d) -&gt; p a c -&gt; p b d
</span><span class="hs-identifier hs-var">bimap</span></span><span> </span><span class="annot"><span class="annottext">forall (g :: * -&gt; *).
Functor g =&gt;
g (Element TypeReference) -&gt; g Element
</span><a href="Unison.Server.Backend.html#mungeSyntaxText"><span class="hs-identifier hs-var">mungeSyntaxText</span></a></span><span> </span><span class="annot"><span class="annottext">forall (g :: * -&gt; *).
Functor g =&gt;
g (Element TypeReference) -&gt; g Element
</span><a href="Unison.Server.Backend.html#mungeSyntaxText"><span class="hs-identifier hs-var">mungeSyntaxText</span></a></span><span> </span><span class="annot"><span class="annottext">DisplayObject SyntaxText SyntaxText
</span><a href="#local-6989586621679377768"><span class="hs-identifier hs-var">tp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-950"></span><span>      </span><span class="annot"><span class="annottext">[(Text, Text, Doc)]
</span><a href="#local-6989586621679377769"><span class="hs-identifier hs-var">docs</span></a></span><span>
</span><span id="line-951"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-952"></span><span>    </span><span id="local-6989586621679377760"><span class="annot"><span class="annottext">fqnPPE :: PrettyPrintEnv
</span><a href="#local-6989586621679377760"><span class="hs-identifier hs-var hs-var">fqnPPE</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl -&gt; PrettyPrintEnv
</span><span class="hs-identifier hs-var">PPED.unsuffixifiedPPE</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679377774"><span class="hs-identifier hs-var">pped</span></a></span><span>
</span><span id="line-953"></span><span>
</span><span id="line-954"></span><span class="annot"><a href="Unison.Server.Backend.html#mkTermDefinition"><span class="hs-identifier hs-type">mkTermDefinition</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-955"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-956"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">PPED.PrettyPrintEnvDecl</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-957"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Path.Path</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-958"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">V2Branch.CausalBranch</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Sqlite.Transaction</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-959"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Width</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-960"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-961"></span><span>  </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.Types.html#HashQualifiedName"><span class="hs-identifier hs-type">HashQualifiedName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Server.Types.html#UnisonHash"><span class="hs-identifier hs-type">UnisonHash</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Server.Doc.html#Doc"><span class="hs-identifier hs-type">Doc.Doc</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-962"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">DisplayObject</span></span><span>
</span><span id="line-963"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">AnnotatedText</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">UST.Element</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-964"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">AnnotatedText</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">UST.Element</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-965"></span><span>  </span><span class="annot"><a href="Unison.Server.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Unison.Server.Types.html#TermDefinition"><span class="hs-identifier hs-type">TermDefinition</span></a></span><span>
</span><span id="line-966"></span><span id="mkTermDefinition"><span class="annot"><span class="annottext">mkTermDefinition :: Codebase IO Symbol Ann
-&gt; PrettyPrintEnvDecl
-&gt; Path
-&gt; CausalBranch Transaction
-&gt; Width
-&gt; TypeReference
-&gt; [(Text, Text, Doc)]
-&gt; DisplayObject SyntaxText SyntaxText
-&gt; Backend IO TermDefinition
</span><a href="Unison.Server.Backend.html#mkTermDefinition"><span class="hs-identifier hs-var hs-var">mkTermDefinition</span></a></span></span><span> </span><span id="local-6989586621679377758"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679377758"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621679377757"><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679377757"><span class="hs-identifier hs-var">termPPED</span></a></span></span><span> </span><span id="local-6989586621679377756"><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679377756"><span class="hs-identifier hs-var">namesRoot</span></a></span></span><span> </span><span id="local-6989586621679377755"><span class="annot"><span class="annottext">CausalBranch Transaction
</span><a href="#local-6989586621679377755"><span class="hs-identifier hs-var">rootCausal</span></a></span></span><span> </span><span id="local-6989586621679377754"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621679377754"><span class="hs-identifier hs-var">width</span></a></span></span><span> </span><span id="local-6989586621679377753"><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679377753"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621679377752"><span class="annot"><span class="annottext">[(Text, Text, Doc)]
</span><a href="#local-6989586621679377752"><span class="hs-identifier hs-var">docs</span></a></span></span><span> </span><span id="local-6989586621679377751"><span class="annot"><span class="annottext">DisplayObject SyntaxText SyntaxText
</span><a href="#local-6989586621679377751"><span class="hs-identifier hs-var">tm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-967"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679377750"><span class="annot"><span class="annottext">referent :: Referent
</span><a href="#local-6989586621679377750"><span class="hs-identifier hs-var hs-var">referent</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeReference -&gt; Referent
</span><span class="hs-identifier hs-var">Referent.Ref</span></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679377753"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-968"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679377749"><span class="annot"><span class="annottext">Maybe (Type Symbol Ann)
</span><a href="#local-6989586621679377749"><span class="hs-identifier hs-var">ts</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679377748"><span class="annot"><span class="annottext">Branch Transaction
</span><a href="#local-6989586621679377748"><span class="hs-identifier hs-var">branchAtPath</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) v a b.
MonadIO m =&gt;
Codebase m v a -&gt; Transaction b -&gt; m b
</span><span class="hs-identifier hs-var">Codebase.runTransaction</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679377758"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-969"></span><span>    </span><span id="local-6989586621679377747"><span class="annot"><span class="annottext">Maybe (Type Symbol Ann)
</span><a href="#local-6989586621679377747"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a (m :: * -&gt; *).
BuiltinAnnotation a =&gt;
Codebase m Symbol a
-&gt; TypeReference -&gt; Transaction (Maybe (Type Symbol a))
</span><span class="hs-identifier hs-var">Codebase.getTypeOfTerm</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679377758"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679377753"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-970"></span><span>    </span><span id="local-6989586621679377746"><span class="annot"><span class="annottext">CausalBranch Transaction
</span><a href="#local-6989586621679377746"><span class="hs-identifier hs-var">causalAtPath</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Path
-&gt; Maybe (CausalBranch Transaction)
-&gt; Transaction (CausalBranch Transaction)
</span><span class="hs-identifier hs-var">Codebase.getShallowCausalAtPath</span></span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679377756"><span class="hs-identifier hs-var">namesRoot</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">CausalBranch Transaction
</span><a href="#local-6989586621679377755"><span class="hs-identifier hs-var">rootCausal</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-971"></span><span>    </span><span id="local-6989586621679377745"><span class="annot"><span class="annottext">Branch Transaction
</span><a href="#local-6989586621679377745"><span class="hs-identifier hs-var">branchAtPath</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) hc he e. Causal m hc he e -&gt; m e
</span><span class="hs-identifier hs-var">V2Causal.value</span></span><span> </span><span class="annot"><span class="annottext">CausalBranch Transaction
</span><a href="#local-6989586621679377746"><span class="hs-identifier hs-var">causalAtPath</span></a></span><span>
</span><span id="line-972"></span><span>    </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (Type Symbol Ann)
</span><a href="#local-6989586621679377747"><span class="hs-identifier hs-var">ts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Branch Transaction
</span><a href="#local-6989586621679377745"><span class="hs-identifier hs-var">branchAtPath</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-973"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679377744"><span class="annot"><span class="annottext">bn :: Text
</span><a href="#local-6989586621679377744"><span class="hs-identifier hs-var hs-var">bn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall v. Var v =&gt; PrettyPrintEnv -&gt; Width -&gt; Referent -&gt; Text
</span><a href="Unison.Server.Backend.html#bestNameForTerm"><span class="hs-identifier hs-var">bestNameForTerm</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrettyPrintEnvDecl -&gt; PrettyPrintEnv
</span><span class="hs-identifier hs-var">PPED.suffixifiedPPE</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679377757"><span class="hs-identifier hs-var">termPPED</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621679377754"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeReference -&gt; Referent
</span><span class="hs-identifier hs-var">Referent.Ref</span></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679377753"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-974"></span><span>  </span><span id="local-6989586621679377743"><span class="annot"><span class="annottext">TermTag
</span><a href="#local-6989586621679377743"><span class="hs-identifier hs-var">tag</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-975"></span><span>    </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span>
</span><span id="line-976"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">forall v a. TermEntry v a -&gt; TermTag
</span><a href="Unison.Server.Backend.html#%24sel%3AtermEntryTag%3ATermEntry"><span class="hs-identifier hs-var">termEntryTag</span></a></span><span>
</span><span id="line-977"></span><span>          </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) (n :: * -&gt; *).
MonadIO m =&gt;
Codebase m Symbol Ann
-&gt; Branch n
-&gt; ExactName NameSegment Referent
-&gt; m (TermEntry Symbol Ann)
</span><a href="Unison.Server.Backend.html#termListEntry"><span class="hs-identifier hs-var">termListEntry</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679377758"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Branch Transaction
</span><a href="#local-6989586621679377748"><span class="hs-identifier hs-var">branchAtPath</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall name ref. name -&gt; ref -&gt; ExactName name ref
</span><a href="Unison.Server.Types.html#ExactName"><span class="hs-identifier hs-var">ExactName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; NameSegment
</span><span class="hs-identifier hs-var">NameSegment</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679377744"><span class="hs-identifier hs-var">bn</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Referent -&gt; Referent
</span><span class="hs-identifier hs-var">Cv.referent1to2</span></span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679377750"><span class="hs-identifier hs-var">referent</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-978"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-979"></span><span>  </span><span class="annot"><span class="annottext">Maybe (Type Symbol Ann)
-&gt; Text -&gt; TermTag -&gt; Backend IO TermDefinition
</span><a href="#local-6989586621679377741"><span class="hs-identifier hs-var">mk</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Type Symbol Ann)
</span><a href="#local-6989586621679377749"><span class="hs-identifier hs-var">ts</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679377744"><span class="hs-identifier hs-var">bn</span></a></span><span> </span><span class="annot"><span class="annottext">TermTag
</span><a href="#local-6989586621679377743"><span class="hs-identifier hs-var">tag</span></a></span><span>
</span><span id="line-980"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-981"></span><span>    </span><span id="local-6989586621679377740"><span class="annot"><span class="annottext">fqnTermPPE :: PrettyPrintEnv
</span><a href="#local-6989586621679377740"><span class="hs-identifier hs-var hs-var">fqnTermPPE</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl -&gt; PrettyPrintEnv
</span><span class="hs-identifier hs-var">PPED.unsuffixifiedPPE</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679377757"><span class="hs-identifier hs-var">termPPED</span></a></span><span>
</span><span id="line-982"></span><span>    </span><span id="local-6989586621679377741"><span class="annot"><span class="annottext">mk :: Maybe (Type Symbol Ann)
-&gt; Text -&gt; TermTag -&gt; Backend IO TermDefinition
</span><a href="#local-6989586621679377741"><span class="hs-identifier hs-var hs-var">mk</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe (Type Symbol Ann)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">TermTag
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeReference -&gt; BackendError
</span><a href="Unison.Server.Backend.html#MissingSignatureForTerm"><span class="hs-identifier hs-var">MissingSignatureForTerm</span></a></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679377753"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-983"></span><span>    </span><span class="annot"><a href="#local-6989586621679377741"><span class="hs-identifier hs-var">mk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679377739"><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679377739"><span class="hs-identifier hs-var">typeSig</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679377738"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679377738"><span class="hs-identifier hs-var">bn</span></a></span></span><span> </span><span id="local-6989586621679377737"><span class="annot"><span class="annottext">TermTag
</span><a href="#local-6989586621679377737"><span class="hs-identifier hs-var">tag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-984"></span><span>      </span><span class="hs-comment">-- We don't ever display individual constructors (they're shown as part of their</span><span>
</span><span id="line-985"></span><span>      </span><span class="hs-comment">-- type), so term references are never constructors.</span><span>
</span><span id="line-986"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679377736"><span class="annot"><span class="annottext">referent :: Referent
</span><a href="#local-6989586621679377736"><span class="hs-identifier hs-var hs-var">referent</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeReference -&gt; Referent
</span><span class="hs-identifier hs-var">Referent.Ref</span></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679377753"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-987"></span><span>      </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-988"></span><span>        </span><span class="annot"><span class="annottext">[Text]
-&gt; Text
-&gt; TermTag
-&gt; DisplayObject SyntaxText SyntaxText
-&gt; SyntaxText
-&gt; [(Text, Text, Doc)]
-&gt; TermDefinition
</span><a href="Unison.Server.Types.html#TermDefinition"><span class="hs-identifier hs-var">TermDefinition</span></a></span><span>
</span><span id="line-989"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashQualified Name -&gt; Text
</span><span class="hs-identifier hs-var">HQ'.toText</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv -&gt; Referent -&gt; [HashQualified Name]
</span><span class="hs-identifier hs-var">PPE.allTermNames</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679377740"><span class="hs-identifier hs-var">fqnTermPPE</span></a></span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679377736"><span class="hs-identifier hs-var">referent</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-990"></span><span>          </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679377738"><span class="hs-identifier hs-var">bn</span></a></span><span>
</span><span id="line-991"></span><span>          </span><span class="annot"><span class="annottext">TermTag
</span><a href="#local-6989586621679377737"><span class="hs-identifier hs-var">tag</span></a></span><span>
</span><span id="line-992"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (p :: * -&gt; * -&gt; *) a b c d.
Bifunctor p =&gt;
(a -&gt; b) -&gt; (c -&gt; d) -&gt; p a c -&gt; p b d
</span><span class="hs-identifier hs-var">bimap</span></span><span> </span><span class="annot"><span class="annottext">forall (g :: * -&gt; *).
Functor g =&gt;
g (Element TypeReference) -&gt; g Element
</span><a href="Unison.Server.Backend.html#mungeSyntaxText"><span class="hs-identifier hs-var">mungeSyntaxText</span></a></span><span> </span><span class="annot"><span class="annottext">forall (g :: * -&gt; *).
Functor g =&gt;
g (Element TypeReference) -&gt; g Element
</span><a href="Unison.Server.Backend.html#mungeSyntaxText"><span class="hs-identifier hs-var">mungeSyntaxText</span></a></span><span> </span><span class="annot"><span class="annottext">DisplayObject SyntaxText SyntaxText
</span><a href="#local-6989586621679377751"><span class="hs-identifier hs-var">tm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-993"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall v.
Var v =&gt;
PrettyPrintEnvDecl -&gt; Width -&gt; Type v Ann -&gt; SyntaxText
</span><a href="Unison.Server.Backend.html#formatSuffixedType"><span class="hs-identifier hs-var">formatSuffixedType</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679377757"><span class="hs-identifier hs-var">termPPED</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621679377754"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679377739"><span class="hs-identifier hs-var">typeSig</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-994"></span><span>          </span><span class="annot"><span class="annottext">[(Text, Text, Doc)]
</span><a href="#local-6989586621679377752"><span class="hs-identifier hs-var">docs</span></a></span><span>
</span><span id="line-995"></span><span>
</span><span id="line-996"></span><span class="hs-comment">-- | Given an arbitrary query and perspective, find the project root the query belongs in,</span><span>
</span><span id="line-997"></span><span class="hs-comment">-- then return that root and the query relocated to that project root.</span><span>
</span><span id="line-998"></span><span class="annot"><a href="Unison.Server.Backend.html#relocateToProjectRoot"><span class="hs-identifier hs-type">relocateToProjectRoot</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Path</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HQ.HashQualified</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">V2Branch.Branch</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Sqlite.Transaction</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Sqlite.Transaction</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#BackendError"><span class="hs-identifier hs-type">BackendError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Path</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HQ.HashQualified</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-999"></span><span id="relocateToProjectRoot"><span class="annot"><span class="annottext">relocateToProjectRoot :: Path
-&gt; HashQualified Name
-&gt; Branch Transaction
-&gt; Transaction (Either BackendError (Path, HashQualified Name))
</span><a href="Unison.Server.Backend.html#relocateToProjectRoot"><span class="hs-identifier hs-var hs-var">relocateToProjectRoot</span></a></span></span><span> </span><span id="local-6989586621679377733"><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679377733"><span class="hs-identifier hs-var">perspective</span></a></span></span><span> </span><span id="local-6989586621679377732"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679377732"><span class="hs-identifier hs-var">query</span></a></span></span><span> </span><span id="local-6989586621679377731"><span class="annot"><span class="annottext">Branch Transaction
</span><a href="#local-6989586621679377731"><span class="hs-identifier hs-var">rootBranch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1000"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679377730"><span class="annot"><span class="annottext">queryLocation :: Path
</span><a href="#local-6989586621679377730"><span class="hs-identifier hs-var hs-var">queryLocation</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall n. HashQualified n -&gt; Maybe n
</span><span class="hs-identifier hs-var">HQ.toName</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679377732"><span class="hs-identifier hs-var">query</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679377733"><span class="hs-identifier hs-var">perspective</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679377729"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679377729"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679377733"><span class="hs-identifier hs-var">perspective</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Path
</span><span class="hs-identifier hs-var">Path.fromName</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679377729"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-1001"></span><span>  </span><span class="hs-comment">-- Names should be found from the project root of the queried name</span><span>
</span><span id="line-1002"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Path -&gt; Branch Transaction -&gt; Transaction (Maybe Path)
</span><span class="hs-identifier hs-var">Projects.inferNamesRoot</span></span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679377730"><span class="hs-identifier hs-var">queryLocation</span></a></span><span> </span><span class="annot"><span class="annottext">Branch Transaction
</span><a href="#local-6989586621679377731"><span class="hs-identifier hs-var">rootBranch</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-1003"></span><span>    </span><span class="annot"><span class="annottext">Maybe Path
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1004"></span><span>      </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679377733"><span class="hs-identifier hs-var">perspective</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679377732"><span class="hs-identifier hs-var">query</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1005"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679377726"><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679377726"><span class="hs-identifier hs-var">projectRoot</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1006"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Path -&gt; Path -&gt; (Path, Path, Path)
</span><span class="hs-identifier hs-var">Path.longestPathPrefix</span></span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679377733"><span class="hs-identifier hs-var">perspective</span></a></span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679377726"><span class="hs-identifier hs-var">projectRoot</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1007"></span><span>        </span><span class="hs-comment">-- The perspective is equal to the project root</span><span>
</span><span id="line-1008"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679377724"><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679377724"><span class="hs-identifier hs-var">_sharedPrefix</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Path
</span><span class="hs-identifier hs-var">Path.Empty</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Path
</span><span class="hs-identifier hs-var">Path.Empty</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1009"></span><span>          </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679377733"><span class="hs-identifier hs-var">perspective</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679377732"><span class="hs-identifier hs-var">query</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1010"></span><span>        </span><span class="hs-comment">-- The perspective is _outside_ of the project containing the query</span><span>
</span><span id="line-1011"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679377722"><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679377722"><span class="hs-identifier hs-var">_sharedPrefix</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Path
</span><span class="hs-identifier hs-var">Path.Empty</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679377721"><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679377721"><span class="hs-identifier hs-var">remainder</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1012"></span><span>          </span><span class="hs-comment">-- Since the project root is lower down we need to strip the part of the prefix</span><span>
</span><span id="line-1013"></span><span>          </span><span class="hs-comment">-- which is now redundant.</span><span>
</span><span id="line-1014"></span><span>          </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679377726"><span class="hs-identifier hs-var">projectRoot</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679377732"><span class="hs-identifier hs-var">query</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679377720"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679377720"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679377720"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Absolute -&gt; Name -&gt; Maybe Name
</span><span class="hs-identifier hs-var">Path.unprefixName</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Path -&gt; Absolute
</span><span class="hs-identifier hs-var">Path.Absolute</span></span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679377721"><span class="hs-identifier hs-var">remainder</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679377720"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1015"></span><span>        </span><span class="hs-comment">-- The namesRoot is _inside_ of the project containing the query</span><span>
</span><span id="line-1016"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679377717"><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679377717"><span class="hs-identifier hs-var">_sharedPrefix</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679377716"><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679377716"><span class="hs-identifier hs-var">remainder</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Path
</span><span class="hs-identifier hs-var">Path.Empty</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1017"></span><span>          </span><span class="hs-comment">-- Since the project is higher up, we need to prefix the query</span><span>
</span><span id="line-1018"></span><span>          </span><span class="hs-comment">-- with the remainder of the path</span><span>
</span><span id="line-1019"></span><span>          </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679377726"><span class="hs-identifier hs-var">projectRoot</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679377732"><span class="hs-identifier hs-var">query</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Absolute -&gt; Name -&gt; Name
</span><span class="hs-identifier hs-var">Path.prefixName</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Path -&gt; Absolute
</span><span class="hs-identifier hs-var">Path.Absolute</span></span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679377716"><span class="hs-identifier hs-var">remainder</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1020"></span><span>        </span><span class="hs-comment">-- The namesRoot and project root are disjoint, this shouldn't ever happen.</span><span>
</span><span id="line-1021"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Path
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Path
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Path
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Path -&gt; Path -&gt; BackendError
</span><a href="Unison.Server.Backend.html#DisjointProjectAndPerspective"><span class="hs-identifier hs-var">DisjointProjectAndPerspective</span></a></span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679377733"><span class="hs-identifier hs-var">perspective</span></a></span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679377726"><span class="hs-identifier hs-var">projectRoot</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1022"></span><span>
</span><span id="line-1023"></span><span class="hs-comment">-- | Evaluate the doc at the given reference and return its evaluated-but-not-rendered form.</span><span>
</span><span id="line-1024"></span><span class="annot"><a href="Unison.Server.Backend.html#evalDocRef"><span class="hs-identifier hs-type">evalDocRef</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1025"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Rt.Runtime</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1026"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1027"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">TermReference</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1028"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.Doc.html#EvaluatedDoc"><span class="hs-identifier hs-type">Doc.EvaluatedDoc</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span class="hs-special">)</span><span>
</span><span id="line-1029"></span><span id="evalDocRef"><span class="annot"><span class="annottext">evalDocRef :: Runtime Symbol
-&gt; Codebase IO Symbol Ann
-&gt; TypeReference
-&gt; IO (EvaluatedDoc Symbol)
</span><a href="Unison.Server.Backend.html#evalDocRef"><span class="hs-identifier hs-var hs-var">evalDocRef</span></a></span></span><span> </span><span id="local-6989586621679377714"><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679377714"><span class="hs-identifier hs-var">rt</span></a></span></span><span> </span><span id="local-6989586621679377713"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679377713"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621679377712"><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679377712"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1030"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679377711"><span class="annot"><span class="annottext">tm :: Term2 Symbol () () Symbol ()
</span><a href="#local-6989586621679377711"><span class="hs-identifier hs-var hs-var">tm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall v a vt at ap.
Ord v =&gt;
a -&gt; TypeReference -&gt; Term2 vt at ap v a
</span><span class="hs-identifier hs-var">Term.ref</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679377712"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-1031"></span><span>  </span><span class="annot"><span class="annottext">forall v (m :: * -&gt; *).
(Var v, Monad m) =&gt;
(TypeReference -&gt; m (Maybe (Term v ())))
-&gt; (Referent -&gt; m (Maybe (Type v ())))
-&gt; (Term v () -&gt; m (Maybe (Term v ())))
-&gt; (TypeReference -&gt; m (Maybe (Decl v ())))
-&gt; Term v ()
-&gt; m (EvaluatedDoc v)
</span><a href="Unison.Server.Doc.html#evalDoc"><span class="hs-identifier hs-var">Doc.evalDoc</span></a></span><span> </span><span class="annot"><span class="annottext">TypeReference -&gt; IO (Maybe (Term2 Symbol () () Symbol ()))
</span><a href="#local-6989586621679377708"><span class="hs-identifier hs-var">terms</span></a></span><span> </span><span class="annot"><span class="annottext">Referent -&gt; IO (Maybe (Term F Symbol ()))
</span><a href="#local-6989586621679377707"><span class="hs-identifier hs-var">typeOf</span></a></span><span> </span><span class="annot"><span class="annottext">Term2 Symbol () () Symbol ()
-&gt; IO (Maybe (Term2 Symbol () () Symbol ()))
</span><a href="#local-6989586621679377706"><span class="hs-identifier hs-var">eval</span></a></span><span> </span><span class="annot"><span class="annottext">TypeReference -&gt; IO (Maybe (Decl Symbol ()))
</span><a href="#local-6989586621679377705"><span class="hs-identifier hs-var">decls</span></a></span><span> </span><span class="annot"><span class="annottext">Term2 Symbol () () Symbol ()
</span><a href="#local-6989586621679377711"><span class="hs-identifier hs-var">tm</span></a></span><span>
</span><span id="line-1032"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1033"></span><span>    </span><span id="local-6989586621679377708"><span class="annot"><span class="annottext">terms :: TypeReference -&gt; IO (Maybe (Term2 Symbol () () Symbol ()))
</span><a href="#local-6989586621679377708"><span class="hs-identifier hs-var hs-var">terms</span></a></span></span><span> </span><span id="local-6989586621679377704"><span class="annot"><span class="annottext">r :: TypeReference
</span><a href="#local-6989586621679377704"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Reference.Builtin</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall v a vt at ap.
Ord v =&gt;
a -&gt; TypeReference -&gt; Term2 vt at ap v a
</span><span class="hs-identifier hs-var">Term.ref</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679377704"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1034"></span><span>    </span><span class="annot"><a href="#local-6989586621679377708"><span class="hs-identifier hs-var">terms</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Reference.DerivedId</span></span><span> </span><span id="local-6989586621679377702"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679377702"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1035"></span><span>      </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">forall vt at ap v a. Ord v =&gt; Term2 vt at ap v a -&gt; Term0' vt v
</span><span class="hs-identifier hs-var">Term.unannotate</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) v a b.
MonadIO m =&gt;
Codebase m v a -&gt; Transaction b -&gt; m b
</span><span class="hs-identifier hs-var">Codebase.runTransaction</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679377713"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) v a.
Codebase m v a -&gt; Id -&gt; Transaction (Maybe (Term v a))
</span><span class="hs-identifier hs-var">Codebase.getTerm</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679377713"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679377702"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1036"></span><span>
</span><span id="line-1037"></span><span>    </span><span id="local-6989586621679377707"><span class="annot"><span class="annottext">typeOf :: Referent -&gt; IO (Maybe (Term F Symbol ()))
</span><a href="#local-6989586621679377707"><span class="hs-identifier hs-var hs-var">typeOf</span></a></span></span><span> </span><span id="local-6989586621679377699"><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679377699"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) v a b.
MonadIO m =&gt;
Codebase m v a -&gt; Transaction b -&gt; m b
</span><span class="hs-identifier hs-var">Codebase.runTransaction</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679377713"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a (m :: * -&gt; *).
BuiltinAnnotation a =&gt;
Codebase m Symbol a
-&gt; Referent -&gt; Transaction (Maybe (Type Symbol a))
</span><span class="hs-identifier hs-var">Codebase.getTypeOfReferent</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679377713"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679377699"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1038"></span><span>    </span><span id="local-6989586621679377706"><span class="annot"><span class="annottext">eval :: Term2 Symbol () () Symbol ()
-&gt; IO (Maybe (Term2 Symbol () () Symbol ()))
</span><a href="#local-6989586621679377706"><span class="hs-identifier hs-var hs-var">eval</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall v a a2. Ord v =&gt; (a -&gt; a2) -&gt; Term v a -&gt; Term v a2
</span><span class="hs-identifier hs-var">Term.amap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679377695"><span class="annot"><span class="annottext">Term Symbol Ann
</span><a href="#local-6989586621679377695"><span class="hs-identifier hs-var">tm</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1039"></span><span>      </span><span class="hs-comment">-- We use an empty ppe for evalutation, it's only used for adding additional context to errors.</span><span>
</span><span id="line-1040"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679377694"><span class="annot"><span class="annottext">evalPPE :: PrettyPrintEnv
</span><a href="#local-6989586621679377694"><span class="hs-identifier hs-var hs-var">evalPPE</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><span class="hs-identifier hs-var">PPE.empty</span></span><span>
</span><span id="line-1041"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679377692"><span class="annot"><span class="annottext">codeLookup :: CodeLookup Symbol IO Ann
</span><a href="#local-6989586621679377692"><span class="hs-identifier hs-var hs-var">codeLookup</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
MonadIO m =&gt;
Codebase m Symbol Ann -&gt; CodeLookup Symbol m Ann
</span><span class="hs-identifier hs-var">Codebase.toCodeLookup</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679377713"><span class="hs-identifier hs-var">codebase</span></a></span><span>
</span><span id="line-1042"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679377690"><span class="annot"><span class="annottext">cache :: Id -&gt; IO (Maybe (Term2 Symbol () () Symbol ()))
</span><a href="#local-6989586621679377690"><span class="hs-identifier hs-var hs-var">cache</span></a></span></span><span> </span><span id="local-6989586621679377689"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679377689"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">forall vt at ap v a. Ord v =&gt; Term2 vt at ap v a -&gt; Term0' vt v
</span><span class="hs-identifier hs-var">Term.unannotate</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) v a b.
MonadIO m =&gt;
Codebase m v a -&gt; Transaction b -&gt; m b
</span><span class="hs-identifier hs-var">Codebase.runTransaction</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679377713"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) v a.
Codebase m v a -&gt; Id -&gt; Transaction (Maybe (Term v a))
</span><span class="hs-identifier hs-var">Codebase.lookupWatchCache</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679377713"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679377689"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1043"></span><span>      </span><span id="local-6989586621679377687"><span class="annot"><span class="annottext">Maybe (Term2 Symbol () () Symbol ())
</span><a href="#local-6989586621679377687"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">forall a b. Either a b -&gt; Maybe b
</span><span class="hs-identifier hs-var">hush</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall v a.
(Var v, Monoid a) =&gt;
CodeLookup v IO a
-&gt; (Id -&gt; IO (Maybe (Term v)))
-&gt; PrettyPrintEnv
-&gt; Runtime v
-&gt; Term v a
-&gt; IO (Either Error (Term v))
</span><span class="hs-identifier hs-var">Rt.evaluateTerm'</span></span><span> </span><span class="annot"><span class="annottext">CodeLookup Symbol IO Ann
</span><a href="#local-6989586621679377692"><span class="hs-identifier hs-var">codeLookup</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; IO (Maybe (Term2 Symbol () () Symbol ()))
</span><a href="#local-6989586621679377690"><span class="hs-identifier hs-var">cache</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679377694"><span class="hs-identifier hs-var">evalPPE</span></a></span><span> </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679377714"><span class="hs-identifier hs-var">rt</span></a></span><span> </span><span class="annot"><span class="annottext">Term Symbol Ann
</span><a href="#local-6989586621679377695"><span class="hs-identifier hs-var">tm</span></a></span><span>
</span><span id="line-1044"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (Term2 Symbol () () Symbol ())
</span><a href="#local-6989586621679377687"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1045"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679377685"><span class="annot"><span class="annottext">Term2 Symbol () () Symbol ()
</span><a href="#local-6989586621679377685"><span class="hs-identifier hs-var">tmr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1046"></span><span>          </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) v a b.
MonadIO m =&gt;
Codebase m v a -&gt; Transaction b -&gt; m b
</span><span class="hs-identifier hs-var">Codebase.runTransaction</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679377713"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1047"></span><span>            </span><span class="annot"><span class="annottext">WatchKind -&gt; Id -&gt; Term Symbol Ann -&gt; Transaction ()
</span><span class="hs-identifier hs-var">Codebase.putWatch</span></span><span>
</span><span id="line-1048"></span><span>              </span><span class="annot"><span class="annottext">forall a. (Eq a, IsString a) =&gt; a
</span><span class="hs-identifier hs-var">WK.RegularWatch</span></span><span>
</span><span id="line-1049"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall v a. Var v =&gt; Term v a -&gt; Id
</span><span class="hs-identifier hs-var">Hashing.hashClosedTerm</span></span><span> </span><span class="annot"><span class="annottext">Term Symbol Ann
</span><a href="#local-6989586621679377695"><span class="hs-identifier hs-var">tm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1050"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall v a a2. Ord v =&gt; (a -&gt; a2) -&gt; Term v a -&gt; Term v a2
</span><span class="hs-identifier hs-var">Term.amap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term2 Symbol () () Symbol ()
</span><a href="#local-6989586621679377685"><span class="hs-identifier hs-var">tmr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1051"></span><span>        </span><span class="annot"><span class="annottext">Maybe (Term2 Symbol () () Symbol ())
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1052"></span><span>      </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span> </span><span class="annot"><span class="annottext">Maybe (Term2 Symbol () () Symbol ())
</span><a href="#local-6989586621679377687"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall v a a2. Ord v =&gt; (a -&gt; a2) -&gt; Term v a -&gt; Term v a2
</span><span class="hs-identifier hs-var">Term.amap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">)</span><span>
</span><span id="line-1053"></span><span>
</span><span id="line-1054"></span><span>    </span><span id="local-6989586621679377705"><span class="annot"><span class="annottext">decls :: TypeReference -&gt; IO (Maybe (Decl Symbol ()))
</span><a href="#local-6989586621679377705"><span class="hs-identifier hs-var hs-var">decls</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Reference.DerivedId</span></span><span> </span><span id="local-6989586621679377681"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679377681"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1055"></span><span>      </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a a2 v. (a -&gt; a2) -&gt; Decl v a -&gt; Decl v a2
</span><span class="hs-identifier hs-var">DD.amap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) v a b.
MonadIO m =&gt;
Codebase m v a -&gt; Transaction b -&gt; m b
</span><span class="hs-identifier hs-var">Codebase.runTransaction</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679377713"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) v a.
Codebase m v a -&gt; Id -&gt; Transaction (Maybe (Decl v a))
</span><span class="hs-identifier hs-var">Codebase.getTypeDeclaration</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679377713"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679377681"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1056"></span><span>    </span><span class="annot"><a href="#local-6989586621679377705"><span class="hs-identifier hs-var">decls</span></a></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1057"></span><span>
</span><span id="line-1058"></span><span class="hs-comment">-- | Fetch the docs associated with the given name.</span><span>
</span><span id="line-1059"></span><span class="hs-comment">-- Returns all references with a Doc type which are at the name provided, or at '&lt;name&gt;.doc'.</span><span>
</span><span id="line-1060"></span><span class="annot"><a href="Unison.Server.Backend.html#docsForDefinitionName"><span class="hs-identifier hs-type">docsForDefinitionName</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1061"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1062"></span><span>  </span><span class="annot"><a href="Unison.Server.NameSearch.html#NameSearch"><span class="hs-identifier hs-type">NameSearch</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Sqlite.Transaction</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1063"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1064"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">TermReference</span></span><span class="hs-special">]</span><span>
</span><span id="line-1065"></span><span id="docsForDefinitionName"><span class="annot"><span class="annottext">docsForDefinitionName :: Codebase IO Symbol Ann
-&gt; NameSearch Transaction -&gt; Name -&gt; IO [TypeReference]
</span><a href="Unison.Server.Backend.html#docsForDefinitionName"><span class="hs-identifier hs-var hs-var">docsForDefinitionName</span></a></span></span><span> </span><span id="local-6989586621679377679"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679377679"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.NameSearch.html#NameSearch"><span class="hs-identifier hs-type">NameSearch</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679377678"><span class="annot"><span class="annottext">Search Transaction Referent
termSearch :: Search Transaction Referent
$sel:termSearch:NameSearch :: forall (m :: * -&gt; *). NameSearch m -&gt; Search m Referent
</span><a href="#local-6989586621679377678"><span class="hs-identifier hs-var hs-var">termSearch</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621679377677"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679377677"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1066"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679377676"><span class="annot"><span class="annottext">potentialDocNames :: [Name]
</span><a href="#local-6989586621679377676"><span class="hs-identifier hs-var hs-var">potentialDocNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679377677"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679377677"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. Snoc a a b b =&gt; a -&gt; b -&gt; a
</span><span class="hs-operator hs-var">Cons.:&gt;</span></span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><span class="hs-string">&quot;doc&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-1067"></span><span>  </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) v a b.
MonadIO m =&gt;
Codebase m v a -&gt; Transaction b -&gt; m b
</span><span class="hs-identifier hs-var">Codebase.runTransaction</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679377679"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1068"></span><span>    </span><span id="local-6989586621679377674"><span class="annot"><span class="annottext">Set Referent
</span><a href="#local-6989586621679377674"><span class="hs-identifier hs-var">refs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1069"></span><span>      </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679377676"><span class="hs-identifier hs-var">potentialDocNames</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) (f :: * -&gt; *) b a.
(Monad m, Foldable f, Monoid b) =&gt;
(a -&gt; m b) -&gt; f a -&gt; m b
</span><span class="hs-identifier hs-var">foldMapM</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679377673"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679377673"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1070"></span><span>        </span><span class="hs-comment">-- TODO: Should replace this with an exact name lookup.</span><span>
</span><span id="line-1071"></span><span>        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) r.
Search m r -&gt; HashQualified Name -&gt; m (Set r)
</span><a href="Unison.Server.NameSearch.html#%24sel%3AlookupRelativeHQRefs%27%3ASearch"><span class="hs-identifier hs-var">lookupRelativeHQRefs'</span></a></span><span> </span><span class="annot"><span class="annottext">Search Transaction Referent
</span><a href="#local-6989586621679377678"><span class="hs-identifier hs-var">termSearch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall n. n -&gt; HashQualified n
</span><span class="hs-identifier hs-var">HQ'.NameOnly</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679377673"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1072"></span><span>    </span><span class="annot"><span class="annottext">[Referent] -&gt; Transaction [TypeReference]
</span><a href="#local-6989586621679377671"><span class="hs-identifier hs-var">filterForDocs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">Set Referent
</span><a href="#local-6989586621679377674"><span class="hs-identifier hs-var">refs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1073"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1074"></span><span>    </span><span class="annot"><a href="#local-6989586621679377671"><span class="hs-identifier hs-type">filterForDocs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Sqlite.Transaction</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">TermReference</span></span><span class="hs-special">]</span><span>
</span><span id="line-1075"></span><span>    </span><span id="local-6989586621679377671"><span class="annot"><span class="annottext">filterForDocs :: [Referent] -&gt; Transaction [TypeReference]
</span><a href="#local-6989586621679377671"><span class="hs-identifier hs-var hs-var">filterForDocs</span></a></span></span><span> </span><span id="local-6989586621679377670"><span class="annot"><span class="annottext">[Referent]
</span><a href="#local-6989586621679377670"><span class="hs-identifier hs-var">rs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1076"></span><span>      </span><span id="local-6989586621679377669"><span class="annot"><span class="annottext">[(TypeReference, Type Symbol Ann)]
</span><a href="#local-6989586621679377669"><span class="hs-identifier hs-var">rts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; m (m a) -&gt; m a
</span><span class="hs-identifier hs-var">join</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f (t b)
</span><span class="hs-identifier hs-var">for</span></span><span> </span><span class="annot"><span class="annottext">[Referent]
</span><a href="#local-6989586621679377670"><span class="hs-identifier hs-var">rs</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-1077"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Referent.Ref</span></span><span> </span><span id="local-6989586621679377668"><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679377668"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1078"></span><span>          </span><span class="annot"><span class="annottext">forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679377668"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a (m :: * -&gt; *).
BuiltinAnnotation a =&gt;
Codebase m Symbol a
-&gt; TypeReference -&gt; Transaction (Maybe (Type Symbol a))
</span><span class="hs-identifier hs-var">Codebase.getTypeOfTerm</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679377679"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679377668"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-1079"></span><span>        </span><span class="annot"><span class="annottext">Referent
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1080"></span><span>      </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679377667"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679377667"><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679377667"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679377666"><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679377666"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(TypeReference, Type Symbol Ann)]
</span><a href="#local-6989586621679377669"><span class="hs-identifier hs-var">rts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall v loc. Var v =&gt; Type v loc -&gt; Type v loc -&gt; Bool
</span><span class="hs-identifier hs-var">Typechecker.isSubtype</span></span><span> </span><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679377666"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall v a. Ord v =&gt; a -&gt; TypeReference -&gt; Type v a
</span><span class="hs-identifier hs-var">Type.ref</span></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><span class="hs-identifier hs-var">DD.doc2Ref</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1081"></span><span>
</span><span id="line-1082"></span><span class="hs-comment">-- | Evaluate and render the given docs</span><span>
</span><span id="line-1083"></span><span id="local-6989586621679379704"><span class="annot"><a href="Unison.Server.Backend.html#renderDocRefs"><span class="hs-identifier hs-type">renderDocRefs</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1084"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Traversable</span></span><span> </span><span class="annot"><a href="#local-6989586621679379704"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1085"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">PPED.PrettyPrintEnvDecl</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1086"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Width</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1087"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1088"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Rt.Runtime</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1089"></span><span>  </span><span class="annot"><a href="#local-6989586621679379704"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TermReference</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1090"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679379704"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.Types.html#HashQualifiedName"><span class="hs-identifier hs-type">HashQualifiedName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Server.Types.html#UnisonHash"><span class="hs-identifier hs-type">UnisonHash</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Server.Doc.html#Doc"><span class="hs-identifier hs-type">Doc.Doc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-1091"></span><span id="renderDocRefs"><span class="annot"><span class="annottext">renderDocRefs :: forall (t :: * -&gt; *).
Traversable t =&gt;
PrettyPrintEnvDecl
-&gt; Width
-&gt; Codebase IO Symbol Ann
-&gt; Runtime Symbol
-&gt; t TypeReference
-&gt; IO (t (Text, Text, Doc))
</span><a href="Unison.Server.Backend.html#renderDocRefs"><span class="hs-identifier hs-var hs-var">renderDocRefs</span></a></span></span><span> </span><span id="local-6989586621679377655"><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679377655"><span class="hs-identifier hs-var">pped</span></a></span></span><span> </span><span id="local-6989586621679377654"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621679377654"><span class="hs-identifier hs-var">width</span></a></span></span><span> </span><span id="local-6989586621679377653"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679377653"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621679377652"><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679377652"><span class="hs-identifier hs-var">rt</span></a></span></span><span> </span><span id="local-6989586621679377651"><span class="annot"><span class="annottext">t TypeReference
</span><a href="#local-6989586621679377651"><span class="hs-identifier hs-var">docRefs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1092"></span><span>  </span><span id="local-6989586621679377650"><span class="annot"><span class="annottext">t (TypeReference, EvaluatedDoc Symbol)
</span><a href="#local-6989586621679377650"><span class="hs-identifier hs-var">eDocs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f (t b)
</span><span class="hs-identifier hs-var">for</span></span><span> </span><span class="annot"><span class="annottext">t TypeReference
</span><a href="#local-6989586621679377651"><span class="hs-identifier hs-var">docRefs</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679377649"><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679377649"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679377649"><span class="hs-identifier hs-var">ref</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Runtime Symbol
-&gt; Codebase IO Symbol Ann
-&gt; TypeReference
-&gt; IO (EvaluatedDoc Symbol)
</span><a href="Unison.Server.Backend.html#evalDocRef"><span class="hs-identifier hs-var">evalDocRef</span></a></span><span> </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679377652"><span class="hs-identifier hs-var">rt</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679377653"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679377649"><span class="hs-identifier hs-var">ref</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1093"></span><span>  </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f (t b)
</span><span class="hs-identifier hs-var">for</span></span><span> </span><span class="annot"><span class="annottext">t (TypeReference, EvaluatedDoc Symbol)
</span><a href="#local-6989586621679377650"><span class="hs-identifier hs-var">eDocs</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679377648"><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679377648"><span class="hs-identifier hs-var">ref</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679377647"><span class="annot"><span class="annottext">EvaluatedDoc Symbol
</span><a href="#local-6989586621679377647"><span class="hs-identifier hs-var">eDoc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1094"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679377646"><span class="annot"><span class="annottext">name :: Text
</span><a href="#local-6989586621679377646"><span class="hs-identifier hs-var hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall v. Var v =&gt; PrettyPrintEnv -&gt; Width -&gt; Referent -&gt; Text
</span><a href="Unison.Server.Backend.html#bestNameForTerm"><span class="hs-identifier hs-var">bestNameForTerm</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrettyPrintEnvDecl -&gt; PrettyPrintEnv
</span><span class="hs-identifier hs-var">PPED.suffixifiedPPE</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679377655"><span class="hs-identifier hs-var">pped</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621679377654"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeReference -&gt; Referent
</span><span class="hs-identifier hs-var">Referent.Ref</span></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679377648"><span class="hs-identifier hs-var">ref</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1095"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679377645"><span class="annot"><span class="annottext">hash :: Text
</span><a href="#local-6989586621679377645"><span class="hs-identifier hs-var hs-var">hash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeReference -&gt; Text
</span><span class="hs-identifier hs-var">Reference.toText</span></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679377648"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-1096"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679377644"><span class="annot"><span class="annottext">renderedDoc :: Doc
</span><a href="#local-6989586621679377644"><span class="hs-identifier hs-var hs-var">renderedDoc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall v. Var v =&gt; PrettyPrintEnvDecl -&gt; EvaluatedDoc v -&gt; Doc
</span><a href="Unison.Server.Doc.html#renderDoc"><span class="hs-identifier hs-var">Doc.renderDoc</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679377655"><span class="hs-identifier hs-var">pped</span></a></span><span> </span><span class="annot"><span class="annottext">EvaluatedDoc Symbol
</span><a href="#local-6989586621679377647"><span class="hs-identifier hs-var">eDoc</span></a></span><span>
</span><span id="line-1097"></span><span>    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679377646"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679377645"><span class="hs-identifier hs-var">hash</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Doc
</span><a href="#local-6989586621679377644"><span class="hs-identifier hs-var">renderedDoc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1098"></span><span>
</span><span id="line-1099"></span><span class="annot"><a href="Unison.Server.Backend.html#docsInBranchToHtmlFiles"><span class="hs-identifier hs-type">docsInBranchToHtmlFiles</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1100"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Rt.Runtime</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1101"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1102"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Branch</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1103"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Path</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1104"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1105"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1106"></span><span id="docsInBranchToHtmlFiles"><span class="annot"><span class="annottext">docsInBranchToHtmlFiles :: Runtime Symbol
-&gt; Codebase IO Symbol Ann
-&gt; Branch IO
-&gt; Path
-&gt; WatchKind
-&gt; IO ()
</span><a href="Unison.Server.Backend.html#docsInBranchToHtmlFiles"><span class="hs-identifier hs-var hs-var">docsInBranchToHtmlFiles</span></a></span></span><span> </span><span id="local-6989586621679377642"><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679377642"><span class="hs-identifier hs-var">runtime</span></a></span></span><span> </span><span id="local-6989586621679377641"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679377641"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621679377640"><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679377640"><span class="hs-identifier hs-var">root</span></a></span></span><span> </span><span id="local-6989586621679377639"><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679377639"><span class="hs-identifier hs-var">currentPath</span></a></span></span><span> </span><span id="local-6989586621679377638"><span class="annot"><span class="annottext">WatchKind
</span><a href="#local-6989586621679377638"><span class="hs-identifier hs-var">directory</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1107"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679377637"><span class="annot"><span class="annottext">currentBranch :: Branch IO
</span><a href="#local-6989586621679377637"><span class="hs-identifier hs-var hs-var">currentBranch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Path -&gt; Branch m -&gt; Branch m
</span><span class="hs-identifier hs-var">Branch.getAt'</span></span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679377639"><span class="hs-identifier hs-var">currentPath</span></a></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679377640"><span class="hs-identifier hs-var">root</span></a></span><span>
</span><span id="line-1108"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679377635"><span class="annot"><span class="annottext">allTerms :: [(Referent, Name)]
</span><a href="#local-6989586621679377635"><span class="hs-identifier hs-var hs-var">allTerms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. Relation a b -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">R.toList</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Branch0 m -&gt; Relation Referent Name
</span><span class="hs-identifier hs-var">Branch.deepTerms</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Branch m -&gt; Branch0 m
</span><span class="hs-identifier hs-var">Branch.head</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679377637"><span class="hs-identifier hs-var">currentBranch</span></a></span><span>
</span><span id="line-1109"></span><span>  </span><span class="hs-comment">-- ignores docs inside lib namespace, recursively</span><span>
</span><span id="line-1110"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679377629"><span class="annot"><span class="annottext">notLib :: (a, Name) -&gt; Bool
</span><a href="#local-6989586621679377629"><span class="hs-identifier hs-var hs-var">notLib</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679377628"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679377628"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><span class="hs-string">&quot;lib&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`notElem`</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; NonEmpty NameSegment
</span><span class="hs-identifier hs-var">Name.segments</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679377628"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-1111"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679377625"><span class="annot"><span class="annottext">[(Referent, Name)]
</span><a href="#local-6989586621679377625"><span class="hs-identifier hs-var">docTermsWithNames</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679377624"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679377624"><span class="hs-identifier hs-var">hqLength</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1112"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) v a b.
MonadIO m =&gt;
Codebase m v a -&gt; Transaction b -&gt; m b
</span><span class="hs-identifier hs-var">Codebase.runTransaction</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679377641"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1113"></span><span>      </span><span id="local-6989586621679377623"><span class="annot"><span class="annottext">[(Referent, Name)]
</span><a href="#local-6989586621679377623"><span class="hs-identifier hs-var">docTermsWithNames</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
Applicative m =&gt;
(a -&gt; m Bool) -&gt; [a] -&gt; m [a]
</span><span class="hs-identifier hs-var">filterM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
Codebase m Symbol Ann -&gt; Referent -&gt; Transaction Bool
</span><a href="Unison.Server.Backend.html#isDoc"><span class="hs-identifier hs-var">isDoc</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679377641"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="annot"><span class="annottext">forall {a}. (a, Name) -&gt; Bool
</span><a href="#local-6989586621679377629"><span class="hs-identifier hs-var">notLib</span></a></span><span> </span><span class="annot"><span class="annottext">[(Referent, Name)]
</span><a href="#local-6989586621679377635"><span class="hs-identifier hs-var">allTerms</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1114"></span><span>      </span><span id="local-6989586621679377621"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679377621"><span class="hs-identifier hs-var">hqLength</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Transaction Int
</span><span class="hs-identifier hs-var">Codebase.hashLength</span></span><span>
</span><span id="line-1115"></span><span>      </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Referent, Name)]
</span><a href="#local-6989586621679377623"><span class="hs-identifier hs-var">docTermsWithNames</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679377621"><span class="hs-identifier hs-var">hqLength</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1116"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679377620"><span class="annot"><span class="annottext">docNamesByRef :: Map Referent Name
</span><a href="#local-6989586621679377620"><span class="hs-identifier hs-var hs-var">docNamesByRef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromList</span></span><span> </span><span class="annot"><span class="annottext">[(Referent, Name)]
</span><a href="#local-6989586621679377625"><span class="hs-identifier hs-var">docTermsWithNames</span></a></span><span>
</span><span id="line-1117"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679377618"><span class="annot"><span class="annottext">printNames :: Names
</span><a href="#local-6989586621679377618"><span class="hs-identifier hs-var hs-var">printNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Branch m -&gt; NameScoping -&gt; Names
</span><a href="Unison.Server.Backend.html#prettyNamesForBranch"><span class="hs-identifier hs-var">prettyNamesForBranch</span></a></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679377640"><span class="hs-identifier hs-var">root</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Path -&gt; NameScoping
</span><a href="Unison.Server.Backend.html#AllNames"><span class="hs-identifier hs-var">AllNames</span></a></span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679377639"><span class="hs-identifier hs-var">currentPath</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1118"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679377617"><span class="annot"><span class="annottext">printNamesWithHistory :: NamesWithHistory
</span><a href="#local-6989586621679377617"><span class="hs-identifier hs-var hs-var">printNamesWithHistory</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NamesWithHistory</span></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">currentNames :: Names
</span><span class="hs-identifier hs-var">currentNames</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679377618"><span class="hs-identifier hs-var">printNames</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">oldNames :: Names
</span><span class="hs-identifier hs-var">oldNames</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">}</span><span>
</span><span id="line-1119"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679377614"><span class="annot"><span class="annottext">ppe :: PrettyPrintEnvDecl
</span><a href="#local-6989586621679377614"><span class="hs-identifier hs-var hs-var">ppe</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; NamesWithHistory -&gt; PrettyPrintEnvDecl
</span><span class="hs-identifier hs-var">PPED.fromNamesDecl</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679377624"><span class="hs-identifier hs-var">hqLength</span></a></span><span> </span><span class="annot"><span class="annottext">NamesWithHistory
</span><a href="#local-6989586621679377617"><span class="hs-identifier hs-var">printNamesWithHistory</span></a></span><span>
</span><span id="line-1120"></span><span>  </span><span id="local-6989586621679377613"><span class="annot"><span class="annottext">[(Name, Text, Doc)]
</span><a href="#local-6989586621679377613"><span class="hs-identifier hs-var">docs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f (t b)
</span><span class="hs-identifier hs-var">for</span></span><span> </span><span class="annot"><span class="annottext">[(Referent, Name)]
</span><a href="#local-6989586621679377625"><span class="hs-identifier hs-var">docTermsWithNames</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {a}.
PrettyPrintEnvDecl
-&gt; Runtime Symbol
-&gt; Codebase IO Symbol Ann
-&gt; (Referent, a)
-&gt; IO (a, Text, Doc)
</span><a href="#local-6989586621679377612"><span class="hs-identifier hs-var">renderDoc'</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679377614"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679377642"><span class="hs-identifier hs-var">runtime</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679377641"><span class="hs-identifier hs-var">codebase</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1121"></span><span>  </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f ()
</span><span class="hs-identifier hs-var">traverse_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Referent Name -&gt; WatchKind -&gt; (Name, Text, Doc) -&gt; IO ()
</span><a href="#local-6989586621679377610"><span class="hs-identifier hs-var">renderDocToHtmlFile</span></a></span><span> </span><span class="annot"><span class="annottext">Map Referent Name
</span><a href="#local-6989586621679377620"><span class="hs-identifier hs-var">docNamesByRef</span></a></span><span> </span><span class="annot"><span class="annottext">WatchKind
</span><a href="#local-6989586621679377638"><span class="hs-identifier hs-var">directory</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Name, Text, Doc)]
</span><a href="#local-6989586621679377613"><span class="hs-identifier hs-var">docs</span></a></span><span>
</span><span id="line-1122"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1123"></span><span>    </span><span id="local-6989586621679377612"><span class="annot"><span class="annottext">renderDoc' :: PrettyPrintEnvDecl
-&gt; Runtime Symbol
-&gt; Codebase IO Symbol Ann
-&gt; (Referent, a)
-&gt; IO (a, Text, Doc)
</span><a href="#local-6989586621679377612"><span class="hs-identifier hs-var hs-var">renderDoc'</span></a></span></span><span> </span><span id="local-6989586621679377605"><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679377605"><span class="hs-identifier hs-var">ppe</span></a></span></span><span> </span><span id="local-6989586621679377604"><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679377604"><span class="hs-identifier hs-var">runtime</span></a></span></span><span> </span><span id="local-6989586621679377603"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679377603"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679377602"><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679377602"><span class="hs-identifier hs-var">docReferent</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679377601"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679377601"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1124"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679377600"><span class="annot"><span class="annottext">docReference :: TypeReference
</span><a href="#local-6989586621679377600"><span class="hs-identifier hs-var hs-var">docReference</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Referent -&gt; TypeReference
</span><span class="hs-identifier hs-var">Referent.toReference</span></span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679377602"><span class="hs-identifier hs-var">docReferent</span></a></span><span>
</span><span id="line-1125"></span><span>      </span><span id="local-6989586621679377598"><span class="annot"><span class="annottext">Doc
</span><a href="#local-6989586621679377598"><span class="hs-identifier hs-var">doc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Runtime Symbol
-&gt; Codebase IO Symbol Ann
-&gt; TypeReference
-&gt; IO (EvaluatedDoc Symbol)
</span><a href="Unison.Server.Backend.html#evalDocRef"><span class="hs-identifier hs-var">evalDocRef</span></a></span><span> </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679377604"><span class="hs-identifier hs-var">runtime</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679377603"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679377600"><span class="hs-identifier hs-var">docReference</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall v. Var v =&gt; PrettyPrintEnvDecl -&gt; EvaluatedDoc v -&gt; Doc
</span><a href="Unison.Server.Doc.html#renderDoc"><span class="hs-identifier hs-var">Doc.renderDoc</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679377605"><span class="hs-identifier hs-var">ppe</span></a></span><span>
</span><span id="line-1126"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679377597"><span class="annot"><span class="annottext">hash :: Text
</span><a href="#local-6989586621679377597"><span class="hs-identifier hs-var hs-var">hash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeReference -&gt; Text
</span><span class="hs-identifier hs-var">Reference.toText</span></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679377600"><span class="hs-identifier hs-var">docReference</span></a></span><span>
</span><span id="line-1127"></span><span>      </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679377601"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679377597"><span class="hs-identifier hs-var">hash</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Doc
</span><a href="#local-6989586621679377598"><span class="hs-identifier hs-var">doc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1128"></span><span>
</span><span id="line-1129"></span><span>    </span><span class="annot"><a href="#local-6989586621679377596"><span class="hs-identifier hs-type">cleanPath</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span>
</span><span id="line-1130"></span><span>    </span><span id="local-6989586621679377596"><span class="annot"><span class="annottext">cleanPath :: ShowS
</span><a href="#local-6989586621679377596"><span class="hs-identifier hs-var hs-var">cleanPath</span></a></span></span><span> </span><span id="local-6989586621679377595"><span class="annot"><span class="annottext">WatchKind
</span><a href="#local-6989586621679377595"><span class="hs-identifier hs-var">filePath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1131"></span><span>      </span><span class="annot"><span class="annottext">WatchKind
</span><a href="#local-6989586621679377595"><span class="hs-identifier hs-var">filePath</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-1132"></span><span>        </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'#'</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'@'</span></span><span>
</span><span id="line-1133"></span><span>        </span><span id="local-6989586621679377594"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679377594"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679377594"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-1134"></span><span>
</span><span id="line-1135"></span><span>    </span><span class="annot"><a href="#local-6989586621679377593"><span class="hs-identifier hs-type">docFilePath</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span>
</span><span id="line-1136"></span><span>    </span><span id="local-6989586621679377593"><span class="annot"><span class="annottext">docFilePath :: WatchKind -&gt; Name -&gt; WatchKind
</span><a href="#local-6989586621679377593"><span class="hs-identifier hs-var hs-var">docFilePath</span></a></span></span><span> </span><span id="local-6989586621679377592"><span class="annot"><span class="annottext">WatchKind
</span><a href="#local-6989586621679377592"><span class="hs-identifier hs-var">destination</span></a></span></span><span> </span><span id="local-6989586621679377591"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679377591"><span class="hs-identifier hs-var">docFQN</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1137"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679377590"><span class="annot"><span class="annottext">WatchKind
</span><a href="#local-6989586621679377590"><span class="hs-identifier hs-var">dir</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679377589"><span class="annot"><span class="annottext">WatchKind
</span><a href="#local-6989586621679377589"><span class="hs-identifier hs-var">fileName</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1138"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall s a. Snoc s s a a =&gt; s -&gt; Maybe (s, a)
</span><span class="hs-identifier hs-var">unsnoc</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">NameSegment -&gt; WatchKind
</span><span class="hs-identifier hs-var">NameSegment.toString</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; NonEmpty NameSegment
</span><span class="hs-identifier hs-var">Name.segments</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679377591"><span class="hs-identifier hs-var">docFQN</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1139"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679377586"><span class="annot"><span class="annottext">[WatchKind]
</span><a href="#local-6989586621679377586"><span class="hs-identifier hs-var">path</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679377585"><span class="annot"><span class="annottext">WatchKind
</span><a href="#local-6989586621679377585"><span class="hs-identifier hs-var">leafName</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1140"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[WatchKind] -&gt; WatchKind
</span><a href="#local-6989586621679377584"><span class="hs-identifier hs-var">directoryPath</span></a></span><span> </span><span class="annot"><span class="annottext">[WatchKind]
</span><a href="#local-6989586621679377586"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ShowS
</span><a href="#local-6989586621679377583"><span class="hs-identifier hs-var">docFileName</span></a></span><span> </span><span class="annot"><span class="annottext">WatchKind
</span><a href="#local-6989586621679377585"><span class="hs-identifier hs-var">leafName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1141"></span><span>              </span><span class="annot"><span class="annottext">Maybe ([WatchKind], WatchKind)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1142"></span><span>                </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; WatchKind -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">WatchKind
</span><span class="hs-string">&quot;Could not parse doc name&quot;</span></span><span>
</span><span id="line-1143"></span><span>
</span><span id="line-1144"></span><span>          </span><span id="local-6989586621679377584"><span class="annot"><span class="annottext">directoryPath :: [WatchKind] -&gt; WatchKind
</span><a href="#local-6989586621679377584"><span class="hs-identifier hs-var hs-var">directoryPath</span></a></span></span><span> </span><span id="local-6989586621679377582"><span class="annot"><span class="annottext">[WatchKind]
</span><a href="#local-6989586621679377582"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1145"></span><span>            </span><span class="annot"><span class="annottext">WatchKind
</span><a href="#local-6989586621679377592"><span class="hs-identifier hs-var">destination</span></a></span><span> </span><span class="annot"><span class="annottext">WatchKind -&gt; ShowS
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">[WatchKind] -&gt; WatchKind
</span><span class="hs-identifier hs-var">joinPath</span></span><span> </span><span class="annot"><span class="annottext">[WatchKind]
</span><a href="#local-6989586621679377582"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-1146"></span><span>
</span><span id="line-1147"></span><span>          </span><span id="local-6989586621679377583"><span class="annot"><span class="annottext">docFileName :: ShowS
</span><a href="#local-6989586621679377583"><span class="hs-identifier hs-var hs-var">docFileName</span></a></span></span><span> </span><span id="local-6989586621679377576"><span class="annot"><span class="annottext">WatchKind
</span><a href="#local-6989586621679377576"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1148"></span><span>            </span><span class="annot"><span class="annottext">ShowS
</span><a href="#local-6989586621679377596"><span class="hs-identifier hs-var">cleanPath</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">WatchKind
</span><a href="#local-6989586621679377576"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">WatchKind
</span><span class="hs-string">&quot;.html&quot;</span></span><span>
</span><span id="line-1149"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">WatchKind
</span><a href="#local-6989586621679377590"><span class="hs-identifier hs-var">dir</span></a></span><span> </span><span class="annot"><span class="annottext">WatchKind -&gt; ShowS
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">WatchKind
</span><a href="#local-6989586621679377589"><span class="hs-identifier hs-var">fileName</span></a></span><span>
</span><span id="line-1150"></span><span>
</span><span id="line-1151"></span><span>    </span><span class="annot"><a href="#local-6989586621679377610"><span class="hs-identifier hs-type">renderDocToHtmlFile</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Server.Types.html#UnisonHash"><span class="hs-identifier hs-type">UnisonHash</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Server.Doc.html#Doc"><span class="hs-identifier hs-type">Doc.Doc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1152"></span><span>    </span><span id="local-6989586621679377610"><span class="annot"><span class="annottext">renderDocToHtmlFile :: Map Referent Name -&gt; WatchKind -&gt; (Name, Text, Doc) -&gt; IO ()
</span><a href="#local-6989586621679377610"><span class="hs-identifier hs-var hs-var">renderDocToHtmlFile</span></a></span></span><span> </span><span id="local-6989586621679377575"><span class="annot"><span class="annottext">Map Referent Name
</span><a href="#local-6989586621679377575"><span class="hs-identifier hs-var">docNamesByRef</span></a></span></span><span> </span><span id="local-6989586621679377574"><span class="annot"><span class="annottext">WatchKind
</span><a href="#local-6989586621679377574"><span class="hs-identifier hs-var">destination</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679377573"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679377573"><span class="hs-identifier hs-var">docName</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679377572"><span class="annot"><span class="annottext">Doc
</span><a href="#local-6989586621679377572"><span class="hs-identifier hs-var">doc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1153"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679377571"><span class="annot"><span class="annottext">fullPath :: WatchKind
</span><a href="#local-6989586621679377571"><span class="hs-identifier hs-var hs-var">fullPath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1154"></span><span>            </span><span class="annot"><span class="annottext">WatchKind -&gt; Name -&gt; WatchKind
</span><a href="#local-6989586621679377593"><span class="hs-identifier hs-var">docFilePath</span></a></span><span> </span><span class="annot"><span class="annottext">WatchKind
</span><a href="#local-6989586621679377574"><span class="hs-identifier hs-var">destination</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679377573"><span class="hs-identifier hs-var">docName</span></a></span><span>
</span><span id="line-1155"></span><span>
</span><span id="line-1156"></span><span>          </span><span id="local-6989586621679377570"><span class="annot"><span class="annottext">directoryPath :: WatchKind
</span><a href="#local-6989586621679377570"><span class="hs-identifier hs-var hs-var">directoryPath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1157"></span><span>            </span><span class="annot"><span class="annottext">ShowS
</span><span class="hs-identifier hs-var">takeDirectory</span></span><span> </span><span class="annot"><span class="annottext">WatchKind
</span><a href="#local-6989586621679377571"><span class="hs-identifier hs-var">fullPath</span></a></span><span>
</span><span id="line-1158"></span><span>
</span><span id="line-1159"></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.Doc.AsHtml.html#FrontMatterData"><span class="hs-identifier hs-type">DocHtml.FrontMatterData</span></a></span><span> </span><span id="local-6989586621679377567"><span class="annot"><span class="annottext">Map Text [Text]
</span><a href="#local-6989586621679377567"><span class="hs-identifier hs-var">frontmatter</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679377566"><span class="annot"><span class="annottext">Html ()
</span><a href="#local-6989586621679377566"><span class="hs-identifier hs-var">html</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1160"></span><span>            </span><span class="annot"><span class="annottext">Map Referent Name -&gt; Doc -&gt; (FrontMatterData, Html ())
</span><a href="Unison.Server.Doc.AsHtml.html#toHtml"><span class="hs-identifier hs-var">DocHtml.toHtml</span></a></span><span> </span><span class="annot"><span class="annottext">Map Referent Name
</span><a href="#local-6989586621679377575"><span class="hs-identifier hs-var">docNamesByRef</span></a></span><span> </span><span class="annot"><span class="annottext">Doc
</span><a href="#local-6989586621679377572"><span class="hs-identifier hs-var">doc</span></a></span><span>
</span><span id="line-1161"></span><span>
</span><span id="line-1162"></span><span>          </span><span id="local-6989586621679377564"><span class="annot"><span class="annottext">go :: [Text] -&gt; Value
</span><a href="#local-6989586621679377564"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">[</span><span id="local-6989586621679377563"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679377563"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Value
</span><span class="hs-identifier hs-var">Yaml.String</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679377563"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-1163"></span><span>          </span><span class="annot"><a href="#local-6989586621679377564"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621679377561"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679377561"><span class="hs-identifier hs-var">vs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Value] -&gt; Value
</span><span class="hs-identifier hs-var">Yaml.array</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Value
</span><span class="hs-identifier hs-var">Yaml.String</span></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679377561"><span class="hs-identifier hs-var">vs</span></a></span><span>
</span><span id="line-1164"></span><span>
</span><span id="line-1165"></span><span>          </span><span id="local-6989586621679377557"><span class="annot"><span class="annottext">frontMatterToYaml :: f [Text] -&gt; f Value
</span><a href="#local-6989586621679377557"><span class="hs-identifier hs-var hs-var">frontMatterToYaml</span></a></span></span><span> </span><span id="local-6989586621679377556"><span class="annot"><span class="annottext">f [Text]
</span><a href="#local-6989586621679377556"><span class="hs-identifier hs-var">fm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1166"></span><span>            </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Value
</span><a href="#local-6989586621679377564"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">f [Text]
</span><a href="#local-6989586621679377556"><span class="hs-identifier hs-var">fm</span></a></span><span>
</span><span id="line-1167"></span><span>
</span><span id="line-1168"></span><span>          </span><span id="local-6989586621679377555"><span class="annot"><span class="annottext">frontmatterTxt :: Text
</span><a href="#local-6989586621679377555"><span class="hs-identifier hs-var hs-var">frontmatterTxt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1169"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">forall k a. Map k a -&gt; Bool
</span><span class="hs-identifier hs-var">Map.null</span></span><span> </span><span class="annot"><span class="annottext">Map Text [Text]
</span><a href="#local-6989586621679377567"><span class="hs-identifier hs-var">frontmatter</span></a></span><span>
</span><span id="line-1170"></span><span>              </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-1171"></span><span>              </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;---\n&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Text
</span><span class="hs-identifier hs-var">TextE.decodeUtf8</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. ToJSON a =&gt; a -&gt; ByteString
</span><span class="hs-identifier hs-var">Yaml.encode</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall {f :: * -&gt; *}. Functor f =&gt; f [Text] -&gt; f Value
</span><a href="#local-6989586621679377557"><span class="hs-identifier hs-var">frontMatterToYaml</span></a></span><span> </span><span class="annot"><span class="annottext">Map Text [Text]
</span><a href="#local-6989586621679377567"><span class="hs-identifier hs-var">frontmatter</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;---\n&quot;</span></span><span>
</span><span id="line-1172"></span><span>
</span><span id="line-1173"></span><span>          </span><span id="local-6989586621679377551"><span class="annot"><span class="annottext">htmlAsText :: Text
</span><a href="#local-6989586621679377551"><span class="hs-identifier hs-var hs-var">htmlAsText</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1174"></span><span>            </span><span class="annot"><span class="annottext">forall a. Html a -&gt; Text
</span><span class="hs-identifier hs-var">Lucid.renderText</span></span><span> </span><span class="annot"><span class="annottext">Html ()
</span><a href="#local-6989586621679377566"><span class="hs-identifier hs-var">html</span></a></span><span>
</span><span id="line-1175"></span><span>
</span><span id="line-1176"></span><span>          </span><span id="local-6989586621679377549"><span class="annot"><span class="annottext">fileContents :: Text
</span><a href="#local-6989586621679377549"><span class="hs-identifier hs-var hs-var">fileContents</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1177"></span><span>            </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679377555"><span class="hs-identifier hs-var">frontmatterTxt</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">toStrict</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679377551"><span class="hs-identifier hs-var">htmlAsText</span></a></span><span>
</span><span id="line-1178"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1179"></span><span>            </span><span class="hs-comment">-- Ensure all directories exists</span><span>
</span><span id="line-1180"></span><span>            </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; WatchKind -&gt; IO ()
</span><span class="hs-identifier hs-var">createDirectoryIfMissing</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">WatchKind
</span><a href="#local-6989586621679377570"><span class="hs-identifier hs-var">directoryPath</span></a></span><span>
</span><span id="line-1181"></span><span>            </span><span class="annot"><span class="annottext">WatchKind -&gt; WatchKind -&gt; IO ()
</span><span class="hs-identifier hs-var">writeFile</span></span><span> </span><span class="annot"><span class="annottext">WatchKind
</span><a href="#local-6989586621679377571"><span class="hs-identifier hs-var">fullPath</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; WatchKind
</span><span class="hs-identifier hs-var">Text.unpack</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679377549"><span class="hs-identifier hs-var">fileContents</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1182"></span><span>
</span><span id="line-1183"></span><span class="annot"><a href="Unison.Server.Backend.html#bestNameForTerm"><span class="hs-identifier hs-type">bestNameForTerm</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1184"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679379686"><span class="annot"><a href="#local-6989586621679379686"><span class="hs-identifier hs-type">v</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Var</span></span><span> </span><span class="annot"><a href="#local-6989586621679379686"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PPE.PrettyPrintEnv</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Width</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-1185"></span><span id="bestNameForTerm"><span class="annot"><span class="annottext">bestNameForTerm :: forall v. Var v =&gt; PrettyPrintEnv -&gt; Width -&gt; Referent -&gt; Text
</span><a href="Unison.Server.Backend.html#bestNameForTerm"><span class="hs-identifier hs-var hs-var">bestNameForTerm</span></a></span></span><span> </span><span id="local-6989586621679377529"><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679377529"><span class="hs-identifier hs-var">ppe</span></a></span></span><span> </span><span id="local-6989586621679377528"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621679377528"><span class="hs-identifier hs-var">width</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1186"></span><span>  </span><span class="annot"><span class="annottext">WatchKind -&gt; Text
</span><span class="hs-identifier hs-var">Text.pack</span></span><span>
</span><span id="line-1187"></span><span>    </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall s. (Monoid s, IsString s) =&gt; Width -&gt; Pretty s -&gt; s
</span><span class="hs-identifier hs-var">Pretty.render</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621679377528"><span class="hs-identifier hs-var">width</span></a></span><span>
</span><span id="line-1188"></span><span>    </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">forall r. SyntaxText' r -&gt; WatchKind
</span><span class="hs-identifier hs-var">UST.toPlain</span></span><span>
</span><span id="line-1189"></span><span>    </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall v a.
Var v =&gt;
PrettyPrintEnv -&gt; Reader (PrettyPrintEnv, Set v) a -&gt; a
</span><span class="hs-identifier hs-var">TermPrinter.runPretty</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679377529"><span class="hs-identifier hs-var">ppe</span></a></span><span>
</span><span id="line-1190"></span><span>    </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall v (m :: * -&gt; *).
MonadPretty v m =&gt;
AmbientContext -&gt; Term3 v PrintAnnotation -&gt; m (Pretty SyntaxText)
</span><span class="hs-identifier hs-var">TermPrinter.pretty0</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679379686"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><span class="annottext">AmbientContext
</span><span class="hs-identifier hs-var">TermPrinter.emptyAc</span></span><span>
</span><span id="line-1191"></span><span>    </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall v a vt at ap. Ord v =&gt; a -&gt; Referent -&gt; Term2 vt at ap v a
</span><span class="hs-identifier hs-var">Term.fromReferent</span></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-1192"></span><span>
</span><span id="line-1193"></span><span class="annot"><a href="Unison.Server.Backend.html#bestNameForType"><span class="hs-identifier hs-type">bestNameForType</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1194"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679379692"><span class="annot"><a href="#local-6989586621679379692"><span class="hs-identifier hs-type">v</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Var</span></span><span> </span><span class="annot"><a href="#local-6989586621679379692"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PPE.PrettyPrintEnv</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Width</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-1195"></span><span id="bestNameForType"><span class="annot"><span class="annottext">bestNameForType :: forall v. Var v =&gt; PrettyPrintEnv -&gt; Width -&gt; TypeReference -&gt; Text
</span><a href="Unison.Server.Backend.html#bestNameForType"><span class="hs-identifier hs-var hs-var">bestNameForType</span></a></span></span><span> </span><span id="local-6989586621679377513"><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679377513"><span class="hs-identifier hs-var">ppe</span></a></span></span><span> </span><span id="local-6989586621679377512"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621679377512"><span class="hs-identifier hs-var">width</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1196"></span><span>  </span><span class="annot"><span class="annottext">WatchKind -&gt; Text
</span><span class="hs-identifier hs-var">Text.pack</span></span><span>
</span><span id="line-1197"></span><span>    </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall s. (Monoid s, IsString s) =&gt; Width -&gt; Pretty s -&gt; s
</span><span class="hs-identifier hs-var">Pretty.render</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621679377512"><span class="hs-identifier hs-var">width</span></a></span><span>
</span><span id="line-1198"></span><span>    </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">forall r. SyntaxText' r -&gt; WatchKind
</span><span class="hs-identifier hs-var">UST.toPlain</span></span><span>
</span><span id="line-1199"></span><span>    </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall v a.
Var v =&gt;
PrettyPrintEnv -&gt; Type v a -&gt; Pretty SyntaxText
</span><span class="hs-identifier hs-var">TypePrinter.prettySyntax</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679379692"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679377513"><span class="hs-identifier hs-var">ppe</span></a></span><span>
</span><span id="line-1200"></span><span>    </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall v a. Ord v =&gt; a -&gt; TypeReference -&gt; Type v a
</span><span class="hs-identifier hs-var">Type.ref</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1201"></span><span>
</span><span id="line-1202"></span><span class="hs-comment">-- | Returns (parse, pretty, local, ppe) where:</span><span>
</span><span id="line-1203"></span><span class="hs-comment">--</span><span>
</span><span id="line-1204"></span><span class="hs-comment">-- - 'parse' includes ALL fully qualified names from the root, and ALSO all names from within the provided path, relative to that path.</span><span>
</span><span id="line-1205"></span><span class="hs-comment">-- - 'pretty' includes names within the provided path, relative to that path, and also all globally scoped names _outside_ of the path</span><span>
</span><span id="line-1206"></span><span class="hs-comment">-- - 'local' includes ONLY the names within the provided path</span><span>
</span><span id="line-1207"></span><span class="hs-comment">-- - 'ppe' is a ppe which searches for a name within the path first, but falls back to a global name search.</span><span>
</span><span id="line-1208"></span><span class="hs-comment">--     The 'suffixified' component of this ppe will search for the shortest unambiguous suffix within the scope in which the name is found (local, falling back to global)</span><span>
</span><span id="line-1209"></span><span class="annot"><a href="Unison.Server.Backend.html#scopedNamesForBranchHash"><span class="hs-identifier hs-type">scopedNamesForBranchHash</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1210"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679379711"><span class="annot"><a href="#local-6989586621679379711"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679379708"><span class="annot"><a href="#local-6989586621679379708"><span class="hs-identifier hs-type">n</span></a></span></span><span> </span><span id="local-6989586621679379710"><span class="annot"><a href="#local-6989586621679379710"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span id="local-6989586621679379709"><span class="annot"><a href="#local-6989586621679379709"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1211"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679379711"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1212"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><a href="#local-6989586621679379711"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679379710"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679379709"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1213"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">V2Branch.CausalBranch</span></span><span> </span><span class="annot"><a href="#local-6989586621679379708"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1214"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Path</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1215"></span><span>  </span><span class="annot"><a href="Unison.Server.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679379711"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Names</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PPED.PrettyPrintEnvDecl</span></span><span class="hs-special">)</span><span>
</span><span id="line-1216"></span><span id="scopedNamesForBranchHash"><span class="annot"><span class="annottext">scopedNamesForBranchHash :: forall (m :: * -&gt; *) (n :: * -&gt; *) v a.
MonadIO m =&gt;
Codebase m v a
-&gt; Maybe (CausalBranch n)
-&gt; Path
-&gt; Backend m (Names, PrettyPrintEnvDecl)
</span><a href="Unison.Server.Backend.html#scopedNamesForBranchHash"><span class="hs-identifier hs-var hs-var">scopedNamesForBranchHash</span></a></span></span><span> </span><span id="local-6989586621679377475"><span class="annot"><span class="annottext">Codebase m v a
</span><a href="#local-6989586621679377475"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621679377474"><span class="annot"><span class="annottext">Maybe (CausalBranch n)
</span><a href="#local-6989586621679377474"><span class="hs-identifier hs-var">mbh</span></a></span></span><span> </span><span id="local-6989586621679377473"><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679377473"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1217"></span><span>  </span><span id="local-6989586621679377472"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679377472"><span class="hs-identifier hs-var">shouldUseNamesIndex</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">BackendEnv -&gt; Bool
</span><a href="Unison.Server.Backend.html#%24sel%3AuseNamesIndex%3ABackendEnv"><span class="hs-identifier hs-var">useNamesIndex</span></a></span><span>
</span><span id="line-1218"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679377470"><span class="annot"><span class="annottext">BranchHash
</span><a href="#local-6989586621679377470"><span class="hs-identifier hs-var">rootBranchHash</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679377469"><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621679377469"><span class="hs-identifier hs-var">rootCausalHash</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (CausalBranch n)
</span><a href="#local-6989586621679377474"><span class="hs-identifier hs-var">mbh</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1219"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679377468"><span class="annot"><span class="annottext">CausalBranch n
</span><a href="#local-6989586621679377468"><span class="hs-identifier hs-var">cb</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) hc he e. Causal m hc he e -&gt; he
</span><span class="hs-identifier hs-var">V2Causal.valueHash</span></span><span> </span><span class="annot"><span class="annottext">CausalBranch n
</span><a href="#local-6989586621679377468"><span class="hs-identifier hs-var">cb</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) hc he e. Causal m hc he e -&gt; hc
</span><span class="hs-identifier hs-var">V2Causal.causalHash</span></span><span> </span><span class="annot"><span class="annottext">CausalBranch n
</span><a href="#local-6989586621679377468"><span class="hs-identifier hs-var">cb</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1220"></span><span>    </span><span class="annot"><span class="annottext">Maybe (CausalBranch n)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1221"></span><span>      </span><span id="local-6989586621679377466"><span class="annot"><span class="annottext">CausalBranch Transaction
</span><a href="#local-6989586621679377466"><span class="hs-identifier hs-var">cb</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) v a b.
MonadIO m =&gt;
Codebase m v a -&gt; Transaction b -&gt; m b
</span><span class="hs-identifier hs-var">Codebase.runTransaction</span></span><span> </span><span class="annot"><span class="annottext">Codebase m v a
</span><a href="#local-6989586621679377475"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Transaction (CausalBranch Transaction)
</span><span class="hs-identifier hs-var">Operations.expectRootCausal</span></span><span>
</span><span id="line-1222"></span><span>      </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) hc he e. Causal m hc he e -&gt; he
</span><span class="hs-identifier hs-var">V2Causal.valueHash</span></span><span> </span><span class="annot"><span class="annottext">CausalBranch Transaction
</span><a href="#local-6989586621679377466"><span class="hs-identifier hs-var">cb</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) hc he e. Causal m hc he e -&gt; hc
</span><span class="hs-identifier hs-var">V2Causal.causalHash</span></span><span> </span><span class="annot"><span class="annottext">CausalBranch Transaction
</span><a href="#local-6989586621679377466"><span class="hs-identifier hs-var">cb</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1223"></span><span>  </span><span id="local-6989586621679377464"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679377464"><span class="hs-identifier hs-var">haveNameLookupForRoot</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) v a b.
MonadIO m =&gt;
Codebase m v a -&gt; Transaction b -&gt; m b
</span><span class="hs-identifier hs-var">Codebase.runTransaction</span></span><span> </span><span class="annot"><span class="annottext">Codebase m v a
</span><a href="#local-6989586621679377475"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BranchHash -&gt; Transaction Bool
</span><span class="hs-identifier hs-var">Ops.checkBranchHashNameLookupExists</span></span><span> </span><span class="annot"><span class="annottext">BranchHash
</span><a href="#local-6989586621679377470"><span class="hs-identifier hs-var">rootBranchHash</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1224"></span><span>  </span><span id="local-6989586621679377462"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679377462"><span class="hs-identifier hs-var">hashLen</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) v a b.
MonadIO m =&gt;
Codebase m v a -&gt; Transaction b -&gt; m b
</span><span class="hs-identifier hs-var">Codebase.runTransaction</span></span><span> </span><span class="annot"><span class="annottext">Codebase m v a
</span><a href="#local-6989586621679377475"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Transaction Int
</span><span class="hs-identifier hs-var">Codebase.hashLength</span></span><span>
</span><span id="line-1225"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679377461"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679377461"><span class="hs-identifier hs-var">parseNames</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679377460"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679377460"><span class="hs-identifier hs-var">localNames</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1226"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679377472"><span class="hs-identifier hs-var">shouldUseNamesIndex</span></a></span><span>
</span><span id="line-1227"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1228"></span><span>        </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679377464"><span class="hs-identifier hs-var">haveNameLookupForRoot</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BranchHash -&gt; BackendError
</span><a href="Unison.Server.Backend.html#ExpectedNameLookup"><span class="hs-identifier hs-var">ExpectedNameLookup</span></a></span><span> </span><span class="annot"><span class="annottext">BranchHash
</span><a href="#local-6989586621679377470"><span class="hs-identifier hs-var">rootBranchHash</span></a></span><span>
</span><span id="line-1229"></span><span>        </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) v a b.
MonadIO m =&gt;
Codebase m v a -&gt; Transaction b -&gt; m b
</span><span class="hs-identifier hs-var">Codebase.runTransaction</span></span><span> </span><span class="annot"><span class="annottext">Codebase m v a
</span><a href="#local-6989586621679377475"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BranchHash -&gt; Transaction (Names, Names)
</span><a href="#local-6989586621679377458"><span class="hs-identifier hs-var">indexNames</span></a></span><span> </span><span class="annot"><span class="annottext">BranchHash
</span><a href="#local-6989586621679377470"><span class="hs-identifier hs-var">rootBranchHash</span></a></span><span>
</span><span id="line-1230"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1231"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679377457"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679377457"><span class="hs-identifier hs-var">parseNames</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679377456"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679377456"><span class="hs-identifier hs-var">_pretty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679377455"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679377455"><span class="hs-identifier hs-var">localNames</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
Branch m -&gt; NameScoping -&gt; (Names, Names, Names)
</span><a href="Unison.Server.Backend.html#namesForBranch"><span class="hs-identifier hs-var">namesForBranch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Path -&gt; NameScoping
</span><a href="Unison.Server.Backend.html#AllNames"><span class="hs-identifier hs-var">AllNames</span></a></span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679377473"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) v a.
Monad m =&gt;
Maybe CausalHash -&gt; Codebase m v a -&gt; Backend m (Branch m)
</span><a href="Unison.Server.Backend.html#resolveCausalHash"><span class="hs-identifier hs-var">resolveCausalHash</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621679377469"><span class="hs-identifier hs-var">rootCausalHash</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Codebase m v a
</span><a href="#local-6989586621679377475"><span class="hs-identifier hs-var">codebase</span></a></span><span>
</span><span id="line-1232"></span><span>        </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679377457"><span class="hs-identifier hs-var">parseNames</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679377455"><span class="hs-identifier hs-var">localNames</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1233"></span><span>
</span><span id="line-1234"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679377452"><span class="annot"><span class="annottext">localPPE :: PrettyPrintEnvDecl
</span><a href="#local-6989586621679377452"><span class="hs-identifier hs-var hs-var">localPPE</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; NamesWithHistory -&gt; PrettyPrintEnvDecl
</span><span class="hs-identifier hs-var">PPED.fromNamesDecl</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679377462"><span class="hs-identifier hs-var">hashLen</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Names -&gt; NamesWithHistory
</span><span class="hs-identifier hs-var">NamesWithHistory.fromCurrentNames</span></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679377460"><span class="hs-identifier hs-var">localNames</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1235"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679377451"><span class="annot"><span class="annottext">globalPPE :: PrettyPrintEnvDecl
</span><a href="#local-6989586621679377451"><span class="hs-identifier hs-var hs-var">globalPPE</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; NamesWithHistory -&gt; PrettyPrintEnvDecl
</span><span class="hs-identifier hs-var">PPED.fromNamesDecl</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679377462"><span class="hs-identifier hs-var">hashLen</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Names -&gt; NamesWithHistory
</span><span class="hs-identifier hs-var">NamesWithHistory.fromCurrentNames</span></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679377461"><span class="hs-identifier hs-var">parseNames</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1236"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679377460"><span class="hs-identifier hs-var">localNames</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl -&gt; PrettyPrintEnvDecl -&gt; PrettyPrintEnvDecl
</span><a href="#local-6989586621679377450"><span class="hs-identifier hs-var">mkPPE</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679377452"><span class="hs-identifier hs-var">localPPE</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679377451"><span class="hs-identifier hs-var">globalPPE</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1237"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1238"></span><span>    </span><span class="annot"><a href="#local-6989586621679377450"><span class="hs-identifier hs-type">mkPPE</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PPED.PrettyPrintEnvDecl</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PPED.PrettyPrintEnvDecl</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PPED.PrettyPrintEnvDecl</span></span><span>
</span><span id="line-1239"></span><span>    </span><span id="local-6989586621679377450"><span class="annot"><span class="annottext">mkPPE :: PrettyPrintEnvDecl -&gt; PrettyPrintEnvDecl -&gt; PrettyPrintEnvDecl
</span><a href="#local-6989586621679377450"><span class="hs-identifier hs-var hs-var">mkPPE</span></a></span></span><span> </span><span id="local-6989586621679377449"><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679377449"><span class="hs-identifier hs-var">primary</span></a></span></span><span> </span><span id="local-6989586621679377448"><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679377448"><span class="hs-identifier hs-var">addFallback</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1240"></span><span>      </span><span class="annot"><span class="annottext">PrettyPrintEnv -&gt; PrettyPrintEnv -&gt; PrettyPrintEnvDecl
</span><span class="hs-identifier hs-var">PPED.PrettyPrintEnvDecl</span></span><span>
</span><span id="line-1241"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrettyPrintEnvDecl -&gt; PrettyPrintEnv
</span><span class="hs-identifier hs-var">PPED.unsuffixifiedPPE</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679377449"><span class="hs-identifier hs-var">primary</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv -&gt; PrettyPrintEnv -&gt; PrettyPrintEnv
</span><span class="hs-operator hs-var">`PPE.addFallback`</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl -&gt; PrettyPrintEnv
</span><span class="hs-identifier hs-var">PPED.unsuffixifiedPPE</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679377448"><span class="hs-identifier hs-var">addFallback</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1242"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrettyPrintEnvDecl -&gt; PrettyPrintEnv
</span><span class="hs-identifier hs-var">PPED.suffixifiedPPE</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679377449"><span class="hs-identifier hs-var">primary</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv -&gt; PrettyPrintEnv -&gt; PrettyPrintEnv
</span><span class="hs-operator hs-var">`PPE.addFallback`</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl -&gt; PrettyPrintEnv
</span><span class="hs-identifier hs-var">PPED.suffixifiedPPE</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679377448"><span class="hs-identifier hs-var">addFallback</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1243"></span><span>    </span><span class="annot"><a href="#local-6989586621679377458"><span class="hs-identifier hs-type">indexNames</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">BranchHash</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Sqlite.Transaction</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Names</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Names</span></span><span class="hs-special">)</span><span>
</span><span id="line-1244"></span><span>    </span><span id="local-6989586621679377458"><span class="annot"><span class="annottext">indexNames :: BranchHash -&gt; Transaction (Names, Names)
</span><a href="#local-6989586621679377458"><span class="hs-identifier hs-var hs-var">indexNames</span></a></span></span><span> </span><span id="local-6989586621679377447"><span class="annot"><span class="annottext">BranchHash
</span><a href="#local-6989586621679377447"><span class="hs-identifier hs-var">bh</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1245"></span><span>      </span><span id="local-6989586621679377446"><span class="annot"><span class="annottext">Branch Transaction
</span><a href="#local-6989586621679377446"><span class="hs-identifier hs-var">branch</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Transaction (Branch Transaction)
</span><span class="hs-identifier hs-var">Codebase.getShallowRootBranch</span></span><span>
</span><span id="line-1246"></span><span>      </span><span id="local-6989586621679377444"><span class="annot"><span class="annottext">Maybe Path
</span><a href="#local-6989586621679377444"><span class="hs-identifier hs-var">mayProjectRoot</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Path -&gt; Branch Transaction -&gt; Transaction (Maybe Path)
</span><span class="hs-identifier hs-var">Projects.inferNamesRoot</span></span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679377473"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="annot"><span class="annottext">Branch Transaction
</span><a href="#local-6989586621679377446"><span class="hs-identifier hs-var">branch</span></a></span><span>
</span><span id="line-1247"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679377443"><span class="annot"><span class="annottext">namesRoot :: Path
</span><a href="#local-6989586621679377443"><span class="hs-identifier hs-var hs-var">namesRoot</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679377473"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Path
</span><a href="#local-6989586621679377444"><span class="hs-identifier hs-var">mayProjectRoot</span></a></span><span>
</span><span id="line-1248"></span><span>      </span><span id="local-6989586621679377442"><span class="annot"><span class="annottext">ScopedNames
</span><a href="#local-6989586621679377442"><span class="hs-identifier hs-var">scopedNames</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">BranchHash -&gt; Path -&gt; Path -&gt; Transaction ScopedNames
</span><span class="hs-identifier hs-var">Codebase.namesAtPath</span></span><span> </span><span class="annot"><span class="annottext">BranchHash
</span><a href="#local-6989586621679377447"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679377443"><span class="hs-identifier hs-var">namesRoot</span></a></span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679377473"><span class="hs-identifier hs-var">path</span></a></span><span>
</span><span id="line-1249"></span><span>      </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScopedNames -&gt; Names
</span><span class="hs-identifier hs-var">ScopedNames.parseNames</span></span><span> </span><span class="annot"><span class="annottext">ScopedNames
</span><a href="#local-6989586621679377442"><span class="hs-identifier hs-var">scopedNames</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ScopedNames -&gt; Names
</span><span class="hs-identifier hs-var">ScopedNames.namesAtPath</span></span><span> </span><span class="annot"><span class="annottext">ScopedNames
</span><a href="#local-6989586621679377442"><span class="hs-identifier hs-var">scopedNames</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1250"></span><span>
</span><span id="line-1251"></span><span id="local-6989586621679379572"><span id="local-6989586621679379573"><span id="local-6989586621679379574"><span class="annot"><a href="Unison.Server.Backend.html#resolveCausalHash"><span class="hs-identifier hs-type">resolveCausalHash</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1252"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679379574"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CausalHash</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><a href="#local-6989586621679379574"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679379573"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679379572"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679379574"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Branch</span></span><span> </span><span class="annot"><a href="#local-6989586621679379574"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-1253"></span><span id="resolveCausalHash"><span class="annot"><span class="annottext">resolveCausalHash :: forall (m :: * -&gt; *) v a.
Monad m =&gt;
Maybe CausalHash -&gt; Codebase m v a -&gt; Backend m (Branch m)
</span><a href="Unison.Server.Backend.html#resolveCausalHash"><span class="hs-identifier hs-var hs-var">resolveCausalHash</span></a></span></span><span> </span><span id="local-6989586621679377429"><span class="annot"><span class="annottext">Maybe CausalHash
</span><a href="#local-6989586621679377429"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span id="local-6989586621679377428"><span class="annot"><span class="annottext">Codebase m v a
</span><a href="#local-6989586621679377428"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe CausalHash
</span><a href="#local-6989586621679377429"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1254"></span><span>  </span><span class="annot"><span class="annottext">Maybe CausalHash
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) v a. Codebase m v a -&gt; m (Branch m)
</span><span class="hs-identifier hs-var">Codebase.getRootBranch</span></span><span> </span><span class="annot"><span class="annottext">Codebase m v a
</span><a href="#local-6989586621679377428"><span class="hs-identifier hs-var">codebase</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1255"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679377426"><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621679377426"><span class="hs-identifier hs-var">bhash</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1256"></span><span>    </span><span id="local-6989586621679377425"><span class="annot"><span class="annottext">Maybe (Branch m)
</span><a href="#local-6989586621679377425"><span class="hs-identifier hs-var">mayBranch</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) v a.
Monad m =&gt;
Codebase m v a -&gt; CausalHash -&gt; m (Maybe (Branch m))
</span><span class="hs-identifier hs-var">Codebase.getBranchForHash</span></span><span> </span><span class="annot"><span class="annottext">Codebase m v a
</span><a href="#local-6989586621679377428"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621679377426"><span class="hs-identifier hs-var">bhash</span></a></span><span>
</span><span id="line-1257"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Applicative m =&gt; Maybe a -&gt; m a -&gt; m a
</span><span class="hs-identifier hs-var">whenNothing</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Branch m)
</span><a href="#local-6989586621679377425"><span class="hs-identifier hs-var">mayBranch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CausalHash -&gt; BackendError
</span><a href="Unison.Server.Backend.html#NoBranchForHash"><span class="hs-identifier hs-var">NoBranchForHash</span></a></span><span> </span><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621679377426"><span class="hs-identifier hs-var">bhash</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1258"></span><span>
</span><span id="line-1259"></span><span class="annot"><a href="Unison.Server.Backend.html#resolveCausalHashV2"><span class="hs-identifier hs-type">resolveCausalHashV2</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CausalHash</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Sqlite.Transaction</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">V2Branch.CausalBranch</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Sqlite.Transaction</span></span><span class="hs-special">)</span><span>
</span><span id="line-1260"></span><span id="resolveCausalHashV2"><span class="annot"><span class="annottext">resolveCausalHashV2 :: Maybe CausalHash -&gt; Transaction (CausalBranch Transaction)
</span><a href="Unison.Server.Backend.html#resolveCausalHashV2"><span class="hs-identifier hs-var hs-var">resolveCausalHashV2</span></a></span></span><span> </span><span id="local-6989586621679377422"><span class="annot"><span class="annottext">Maybe CausalHash
</span><a href="#local-6989586621679377422"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe CausalHash
</span><a href="#local-6989586621679377422"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1261"></span><span>  </span><span class="annot"><span class="annottext">Maybe CausalHash
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Transaction (CausalBranch Transaction)
</span><span class="hs-identifier hs-var">Codebase.getShallowRootCausal</span></span><span>
</span><span id="line-1262"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679377421"><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621679377421"><span class="hs-identifier hs-var">ch</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CausalHash -&gt; Transaction (CausalBranch Transaction)
</span><span class="hs-identifier hs-var">Codebase.expectCausalBranchByCausalHash</span></span><span> </span><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621679377421"><span class="hs-identifier hs-var">ch</span></a></span><span>
</span><span id="line-1263"></span><span>
</span><span id="line-1264"></span><span id="local-6989586621679379557"><span id="local-6989586621679379558"><span id="local-6989586621679379559"><span class="annot"><a href="Unison.Server.Backend.html#resolveRootBranchHash"><span class="hs-identifier hs-type">resolveRootBranchHash</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1265"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679379559"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ShortCausalHash</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><a href="#local-6989586621679379559"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679379558"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679379557"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679379559"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Branch</span></span><span> </span><span class="annot"><a href="#local-6989586621679379559"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-1266"></span><span id="resolveRootBranchHash"><span class="annot"><span class="annottext">resolveRootBranchHash :: forall (m :: * -&gt; *) v a.
MonadIO m =&gt;
Maybe ShortCausalHash -&gt; Codebase m v a -&gt; Backend m (Branch m)
</span><a href="Unison.Server.Backend.html#resolveRootBranchHash"><span class="hs-identifier hs-var hs-var">resolveRootBranchHash</span></a></span></span><span> </span><span id="local-6989586621679377414"><span class="annot"><span class="annottext">Maybe ShortCausalHash
</span><a href="#local-6989586621679377414"><span class="hs-identifier hs-var">mayRoot</span></a></span></span><span> </span><span id="local-6989586621679377413"><span class="annot"><span class="annottext">Codebase m v a
</span><a href="#local-6989586621679377413"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe ShortCausalHash
</span><a href="#local-6989586621679377414"><span class="hs-identifier hs-var">mayRoot</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1267"></span><span>  </span><span class="annot"><span class="annottext">Maybe ShortCausalHash
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1268"></span><span>    </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) v a. Codebase m v a -&gt; m (Branch m)
</span><span class="hs-identifier hs-var">Codebase.getRootBranch</span></span><span> </span><span class="annot"><span class="annottext">Codebase m v a
</span><a href="#local-6989586621679377413"><span class="hs-identifier hs-var">codebase</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1269"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679377412"><span class="annot"><span class="annottext">ShortCausalHash
</span><a href="#local-6989586621679377412"><span class="hs-identifier hs-var">sch</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1270"></span><span>    </span><span id="local-6989586621679377411"><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621679377411"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) (n :: * -&gt; *) a.
(forall x. m x -&gt; n x) -&gt; Backend m a -&gt; Backend n a
</span><a href="Unison.Server.Backend.html#hoistBackend"><span class="hs-identifier hs-var">hoistBackend</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) v a b.
MonadIO m =&gt;
Codebase m v a -&gt; Transaction b -&gt; m b
</span><span class="hs-identifier hs-var">Codebase.runTransaction</span></span><span> </span><span class="annot"><span class="annottext">Codebase m v a
</span><a href="#local-6989586621679377413"><span class="hs-identifier hs-var">codebase</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShortCausalHash -&gt; Backend Transaction CausalHash
</span><a href="Unison.Server.Backend.html#expandShortCausalHash"><span class="hs-identifier hs-var">expandShortCausalHash</span></a></span><span> </span><span class="annot"><span class="annottext">ShortCausalHash
</span><a href="#local-6989586621679377412"><span class="hs-identifier hs-var">sch</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1271"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) v a.
Monad m =&gt;
Maybe CausalHash -&gt; Codebase m v a -&gt; Backend m (Branch m)
</span><a href="Unison.Server.Backend.html#resolveCausalHash"><span class="hs-identifier hs-var">resolveCausalHash</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621679377411"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Codebase m v a
</span><a href="#local-6989586621679377413"><span class="hs-identifier hs-var">codebase</span></a></span><span>
</span><span id="line-1272"></span><span>
</span><span id="line-1273"></span><span class="annot"><a href="Unison.Server.Backend.html#resolveRootBranchHashV2"><span class="hs-identifier hs-type">resolveRootBranchHashV2</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1274"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ShortCausalHash</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Sqlite.Transaction</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">V2Branch.CausalBranch</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Sqlite.Transaction</span></span><span class="hs-special">)</span><span>
</span><span id="line-1275"></span><span id="resolveRootBranchHashV2"><span class="annot"><span class="annottext">resolveRootBranchHashV2 :: Maybe ShortCausalHash
-&gt; Backend Transaction (CausalBranch Transaction)
</span><a href="Unison.Server.Backend.html#resolveRootBranchHashV2"><span class="hs-identifier hs-var hs-var">resolveRootBranchHashV2</span></a></span></span><span> </span><span id="local-6989586621679377409"><span class="annot"><span class="annottext">Maybe ShortCausalHash
</span><a href="#local-6989586621679377409"><span class="hs-identifier hs-var">mayRoot</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe ShortCausalHash
</span><a href="#local-6989586621679377409"><span class="hs-identifier hs-var">mayRoot</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1276"></span><span>  </span><span class="annot"><span class="annottext">Maybe ShortCausalHash
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">Transaction (CausalBranch Transaction)
</span><span class="hs-identifier hs-var">Codebase.getShallowRootCausal</span></span><span>
</span><span id="line-1277"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679377408"><span class="annot"><span class="annottext">ShortCausalHash
</span><a href="#local-6989586621679377408"><span class="hs-identifier hs-var">sch</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1278"></span><span>    </span><span id="local-6989586621679377407"><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621679377407"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ShortCausalHash -&gt; Backend Transaction CausalHash
</span><a href="Unison.Server.Backend.html#expandShortCausalHash"><span class="hs-identifier hs-var">expandShortCausalHash</span></a></span><span> </span><span class="annot"><span class="annottext">ShortCausalHash
</span><a href="#local-6989586621679377408"><span class="hs-identifier hs-var">sch</span></a></span><span>
</span><span id="line-1279"></span><span>    </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe CausalHash -&gt; Transaction (CausalBranch Transaction)
</span><a href="Unison.Server.Backend.html#resolveCausalHashV2"><span class="hs-identifier hs-var">resolveCausalHashV2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621679377407"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1280"></span><span>
</span><span id="line-1281"></span><span class="annot"><a href="Unison.Server.Backend.html#normaliseRootCausalHash"><span class="hs-identifier hs-type">normaliseRootCausalHash</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ShortCausalHash</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CausalHash</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Sqlite.Transaction</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">V2Branch.CausalBranch</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Sqlite.Transaction</span></span><span class="hs-special">)</span><span>
</span><span id="line-1282"></span><span id="normaliseRootCausalHash"><span class="annot"><span class="annottext">normaliseRootCausalHash :: Maybe (Either ShortCausalHash CausalHash)
-&gt; Backend Transaction (CausalBranch Transaction)
</span><a href="Unison.Server.Backend.html#normaliseRootCausalHash"><span class="hs-identifier hs-var hs-var">normaliseRootCausalHash</span></a></span></span><span> </span><span id="local-6989586621679377406"><span class="annot"><span class="annottext">Maybe (Either ShortCausalHash CausalHash)
</span><a href="#local-6989586621679377406"><span class="hs-identifier hs-var">mayCh</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (Either ShortCausalHash CausalHash)
</span><a href="#local-6989586621679377406"><span class="hs-identifier hs-var">mayCh</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1283"></span><span>  </span><span class="annot"><span class="annottext">Maybe (Either ShortCausalHash CausalHash)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe CausalHash -&gt; Transaction (CausalBranch Transaction)
</span><a href="Unison.Server.Backend.html#resolveCausalHashV2"><span class="hs-identifier hs-var">resolveCausalHashV2</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1284"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679377405"><span class="annot"><span class="annottext">ShortCausalHash
</span><a href="#local-6989586621679377405"><span class="hs-identifier hs-var">sch</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1285"></span><span>    </span><span id="local-6989586621679377404"><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621679377404"><span class="hs-identifier hs-var">ch</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ShortCausalHash -&gt; Backend Transaction CausalHash
</span><a href="Unison.Server.Backend.html#expandShortCausalHash"><span class="hs-identifier hs-var">expandShortCausalHash</span></a></span><span> </span><span class="annot"><span class="annottext">ShortCausalHash
</span><a href="#local-6989586621679377405"><span class="hs-identifier hs-var">sch</span></a></span><span>
</span><span id="line-1286"></span><span>    </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe CausalHash -&gt; Transaction (CausalBranch Transaction)
</span><a href="Unison.Server.Backend.html#resolveCausalHashV2"><span class="hs-identifier hs-var">resolveCausalHashV2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621679377404"><span class="hs-identifier hs-var">ch</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1287"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679377403"><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621679377403"><span class="hs-identifier hs-var">ch</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe CausalHash -&gt; Transaction (CausalBranch Transaction)
</span><a href="Unison.Server.Backend.html#resolveCausalHashV2"><span class="hs-identifier hs-var">resolveCausalHashV2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621679377403"><span class="hs-identifier hs-var">ch</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1288"></span><span>
</span><span id="line-1289"></span><span class="hs-comment">-- | Determines whether we include full cycles in the results, (e.g. if I search for `isEven`, will I find `isOdd` too?)</span><span>
</span><span id="line-1290"></span><span class="hs-comment">--</span><span>
</span><span id="line-1291"></span><span class="hs-comment">-- This was once used for both term and decl components, but now is only used for decl components, because 'update' does</span><span>
</span><span id="line-1292"></span><span class="hs-comment">-- The Right Thing for terms (i.e. propagates changes to all dependents, including component-mates, which are de facto</span><span>
</span><span id="line-1293"></span><span class="hs-comment">-- dependents).</span><span>
</span><span id="line-1294"></span><span class="hs-comment">--</span><span>
</span><span id="line-1295"></span><span class="hs-comment">-- Ticket of interest: https://github.com/unisonweb/unison/issues/3445</span><span>
</span><span id="line-1296"></span><span class="hs-keyword">data</span><span> </span><span id="IncludeCycles"><span class="annot"><a href="Unison.Server.Backend.html#IncludeCycles"><span class="hs-identifier hs-var">IncludeCycles</span></a></span></span><span>
</span><span id="line-1297"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="IncludeCycles"><span class="annot"><a href="Unison.Server.Backend.html#IncludeCycles"><span class="hs-identifier hs-var">IncludeCycles</span></a></span></span><span>
</span><span id="line-1298"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="DontIncludeCycles"><span class="annot"><a href="Unison.Server.Backend.html#DontIncludeCycles"><span class="hs-identifier hs-var">DontIncludeCycles</span></a></span></span><span>
</span><span id="line-1299"></span><span>
</span><span id="line-1300"></span><span id="local-6989586621679379706"><span class="annot"><a href="Unison.Server.Backend.html#definitionsBySuffixes"><span class="hs-identifier hs-type">definitionsBySuffixes</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1301"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><a href="#local-6989586621679379706"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1302"></span><span>  </span><span class="annot"><a href="Unison.Server.NameSearch.html#NameSearch"><span class="hs-identifier hs-type">NameSearch</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Sqlite.Transaction</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1303"></span><span>  </span><span class="annot"><a href="Unison.Server.Backend.html#IncludeCycles"><span class="hs-identifier hs-type">IncludeCycles</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1304"></span><span>  </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">HQ.HashQualified</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1305"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Sqlite.Transaction</span></span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#DefinitionResults"><span class="hs-identifier hs-type">DefinitionResults</span></a></span></span><span>
</span><span id="line-1306"></span><span id="definitionsBySuffixes"><span class="annot"><span class="annottext">definitionsBySuffixes :: forall (m :: * -&gt; *).
Codebase m Symbol Ann
-&gt; NameSearch Transaction
-&gt; IncludeCycles
-&gt; [HashQualified Name]
-&gt; Transaction DefinitionResults
</span><a href="Unison.Server.Backend.html#definitionsBySuffixes"><span class="hs-identifier hs-var hs-var">definitionsBySuffixes</span></a></span></span><span> </span><span id="local-6989586621679377379"><span class="annot"><span class="annottext">Codebase m Symbol Ann
</span><a href="#local-6989586621679377379"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621679377378"><span class="annot"><span class="annottext">NameSearch Transaction
</span><a href="#local-6989586621679377378"><span class="hs-identifier hs-var">nameSearch</span></a></span></span><span> </span><span id="local-6989586621679377377"><span class="annot"><span class="annottext">IncludeCycles
</span><a href="#local-6989586621679377377"><span class="hs-identifier hs-var">includeCycles</span></a></span></span><span> </span><span id="local-6989586621679377376"><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679377376"><span class="hs-identifier hs-var">query</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1307"></span><span>  </span><span class="annot"><a href="Unison.Server.QueryResult.html#QueryResult"><span class="hs-identifier hs-type">QueryResult</span></a></span><span> </span><span id="local-6989586621679377375"><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679377375"><span class="hs-identifier hs-var">misses</span></a></span></span><span> </span><span id="local-6989586621679377374"><span class="annot"><span class="annottext">[SearchResult]
</span><a href="#local-6989586621679377374"><span class="hs-identifier hs-var">results</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) v.
Codebase m v Ann
-&gt; NameSearch Transaction
-&gt; [HashQualified Name]
-&gt; Transaction QueryResult
</span><a href="Unison.Server.Backend.html#hqNameQuery"><span class="hs-identifier hs-var">hqNameQuery</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase m Symbol Ann
</span><a href="#local-6989586621679377379"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">NameSearch Transaction
</span><a href="#local-6989586621679377378"><span class="hs-identifier hs-var">nameSearch</span></a></span><span> </span><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679377376"><span class="hs-identifier hs-var">query</span></a></span><span>
</span><span id="line-1308"></span><span>  </span><span class="hs-comment">-- todo: remember to replace this with getting components directly,</span><span>
</span><span id="line-1309"></span><span>  </span><span class="hs-comment">-- and maybe even remove getComponentLength from Codebase interface altogether</span><span>
</span><span id="line-1310"></span><span>  </span><span id="local-6989586621679377373"><span class="annot"><span class="annottext">Map
  TypeReference (DisplayObject (Type Symbol Ann) (Term Symbol Ann))
</span><a href="#local-6989586621679377373"><span class="hs-identifier hs-var">terms</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall k (m :: * -&gt; *) (t :: * -&gt; *) a v.
(Ord k, Monad m, Foldable t) =&gt;
(a -&gt; m (k, v)) -&gt; t a -&gt; m (Map k v)
</span><span class="hs-identifier hs-var">Map.foldMapM</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679377371"><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679377371"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679377371"><span class="hs-identifier hs-var">ref</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
Codebase m Symbol Ann
-&gt; TypeReference
-&gt; Transaction (DisplayObject (Type Symbol Ann) (Term Symbol Ann))
</span><a href="Unison.Server.Backend.html#displayTerm"><span class="hs-identifier hs-var">displayTerm</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase m Symbol Ann
</span><a href="#local-6989586621679377379"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679377371"><span class="hs-identifier hs-var">ref</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SearchResult] -&gt; Set TypeReference
</span><a href="#local-6989586621679377369"><span class="hs-identifier hs-var">searchResultsToTermRefs</span></a></span><span> </span><span class="annot"><span class="annottext">[SearchResult]
</span><a href="#local-6989586621679377374"><span class="hs-identifier hs-var">results</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1311"></span><span>  </span><span id="local-6989586621679377368"><span class="annot"><span class="annottext">Map TypeReference (DisplayObject () (Decl Symbol Ann))
</span><a href="#local-6989586621679377368"><span class="hs-identifier hs-var">types</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1312"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679377367"><span class="annot"><span class="annottext">typeRefsWithoutCycles :: Set TypeReference
</span><a href="#local-6989586621679377367"><span class="hs-identifier hs-var hs-var">typeRefsWithoutCycles</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SearchResult] -&gt; Set TypeReference
</span><a href="#local-6989586621679377366"><span class="hs-identifier hs-var">searchResultsToTypeRefs</span></a></span><span> </span><span class="annot"><span class="annottext">[SearchResult]
</span><a href="#local-6989586621679377374"><span class="hs-identifier hs-var">results</span></a></span><span>
</span><span id="line-1313"></span><span>    </span><span id="local-6989586621679377365"><span class="annot"><span class="annottext">Set TypeReference
</span><a href="#local-6989586621679377365"><span class="hs-identifier hs-var">typeRefs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">IncludeCycles
</span><a href="#local-6989586621679377377"><span class="hs-identifier hs-var">includeCycles</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1314"></span><span>      </span><span class="annot"><span class="annottext">IncludeCycles
</span><a href="Unison.Server.Backend.html#IncludeCycles"><span class="hs-identifier hs-var">IncludeCycles</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1315"></span><span>        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) (f :: * -&gt; *) b a.
(Monad m, Foldable f, Monoid b) =&gt;
(a -&gt; m b) -&gt; f a -&gt; m b
</span><span class="hs-identifier hs-var">Monoid.foldMapM</span></span><span>
</span><span id="line-1316"></span><span>          </span><span class="annot"><span class="annottext">TypeReference -&gt; Transaction (Set TypeReference)
</span><span class="hs-identifier hs-var">Codebase.componentReferencesForReference</span></span><span>
</span><span id="line-1317"></span><span>          </span><span class="annot"><span class="annottext">Set TypeReference
</span><a href="#local-6989586621679377367"><span class="hs-identifier hs-var">typeRefsWithoutCycles</span></a></span><span>
</span><span id="line-1318"></span><span>      </span><span class="annot"><span class="annottext">IncludeCycles
</span><a href="Unison.Server.Backend.html#DontIncludeCycles"><span class="hs-identifier hs-var">DontIncludeCycles</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Set TypeReference
</span><a href="#local-6989586621679377367"><span class="hs-identifier hs-var">typeRefsWithoutCycles</span></a></span><span>
</span><span id="line-1319"></span><span>    </span><span class="annot"><span class="annottext">forall k (m :: * -&gt; *) (t :: * -&gt; *) a v.
(Ord k, Monad m, Foldable t) =&gt;
(a -&gt; m (k, v)) -&gt; t a -&gt; m (Map k v)
</span><span class="hs-identifier hs-var">Map.foldMapM</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679377363"><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679377363"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679377363"><span class="hs-identifier hs-var">ref</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
Codebase m Symbol Ann
-&gt; TypeReference
-&gt; Transaction (DisplayObject () (Decl Symbol Ann))
</span><a href="Unison.Server.Backend.html#displayType"><span class="hs-identifier hs-var">displayType</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase m Symbol Ann
</span><a href="#local-6989586621679377379"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679377363"><span class="hs-identifier hs-var">ref</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set TypeReference
</span><a href="#local-6989586621679377365"><span class="hs-identifier hs-var">typeRefs</span></a></span><span>
</span><span id="line-1320"></span><span>  </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map
  TypeReference (DisplayObject (Type Symbol Ann) (Term Symbol Ann))
-&gt; Map TypeReference (DisplayObject () (Decl Symbol Ann))
-&gt; [HashQualified Name]
-&gt; DefinitionResults
</span><a href="Unison.Server.Backend.html#DefinitionResults"><span class="hs-identifier hs-var">DefinitionResults</span></a></span><span> </span><span class="annot"><span class="annottext">Map
  TypeReference (DisplayObject (Type Symbol Ann) (Term Symbol Ann))
</span><a href="#local-6989586621679377373"><span class="hs-identifier hs-var">terms</span></a></span><span> </span><span class="annot"><span class="annottext">Map TypeReference (DisplayObject () (Decl Symbol Ann))
</span><a href="#local-6989586621679377368"><span class="hs-identifier hs-var">types</span></a></span><span> </span><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679377375"><span class="hs-identifier hs-var">misses</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1321"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1322"></span><span>    </span><span class="annot"><a href="#local-6989586621679377369"><span class="hs-identifier hs-type">searchResultsToTermRefs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Unison.Server.SearchResult.html#SearchResult"><span class="hs-identifier hs-type">SR.SearchResult</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span>
</span><span id="line-1323"></span><span>    </span><span id="local-6989586621679377369"><span class="annot"><span class="annottext">searchResultsToTermRefs :: [SearchResult] -&gt; Set TypeReference
</span><a href="#local-6989586621679377369"><span class="hs-identifier hs-var hs-var">searchResultsToTermRefs</span></a></span></span><span> </span><span id="local-6989586621679377362"><span class="annot"><span class="annottext">[SearchResult]
</span><a href="#local-6989586621679377362"><span class="hs-identifier hs-var">results</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1324"></span><span>      </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679377361"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="Unison.Server.SearchResult.html#Tm%27"><span class="hs-identifier hs-type">SR.Tm'</span></a></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Referent.Ref</span></span><span> </span><span id="local-6989586621679377361"><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679377361"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set (HashQualified Name)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[SearchResult]
</span><a href="#local-6989586621679377362"><span class="hs-identifier hs-var">results</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1325"></span><span>    </span><span class="annot"><a href="#local-6989586621679377366"><span class="hs-identifier hs-type">searchResultsToTypeRefs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Unison.Server.SearchResult.html#SearchResult"><span class="hs-identifier hs-type">SR.SearchResult</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span>
</span><span id="line-1326"></span><span>    </span><span id="local-6989586621679377366"><span class="annot"><span class="annottext">searchResultsToTypeRefs :: [SearchResult] -&gt; Set TypeReference
</span><a href="#local-6989586621679377366"><span class="hs-identifier hs-var hs-var">searchResultsToTypeRefs</span></a></span></span><span> </span><span id="local-6989586621679377359"><span class="annot"><span class="annottext">[SearchResult]
</span><a href="#local-6989586621679377359"><span class="hs-identifier hs-var">results</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1327"></span><span>      </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b.
Filterable f =&gt;
(a -&gt; Maybe b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="annot"><span class="annottext">SearchResult -&gt; Maybe TypeReference
</span><a href="#local-6989586621679377357"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">[SearchResult]
</span><a href="#local-6989586621679377359"><span class="hs-identifier hs-var">results</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1328"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1329"></span><span>        </span><span class="annot"><a href="#local-6989586621679377357"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Server.SearchResult.html#SearchResult"><span class="hs-identifier hs-type">SR.SearchResult</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span>
</span><span id="line-1330"></span><span>        </span><span id="local-6989586621679377357"><span class="annot"><span class="annottext">f :: SearchResult -&gt; Maybe TypeReference
</span><a href="#local-6989586621679377357"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-1331"></span><span>          </span><span class="annot"><a href="Unison.Server.SearchResult.html#Tm%27"><span class="hs-identifier hs-type">SR.Tm'</span></a></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Referent.Con</span></span><span> </span><span id="local-6989586621679377356"><span class="annot"><span class="annottext">GConstructorReference TypeReference
</span><a href="#local-6989586621679377356"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="annot"><span class="annottext">ConstructorType
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set (HashQualified Name)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GConstructorReference TypeReference
</span><a href="#local-6989586621679377356"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">forall r s.
Lens (GConstructorReference r) (GConstructorReference s) r s
</span><span class="hs-identifier hs-var">ConstructorReference.reference_</span></span><span class="hs-special">)</span><span>
</span><span id="line-1332"></span><span>          </span><span class="annot"><a href="Unison.Server.SearchResult.html#Tp%27"><span class="hs-identifier hs-type">SR.Tp'</span></a></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679377352"><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679377352"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="annot"><span class="annottext">Set (HashQualified Name)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679377352"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-1333"></span><span>          </span><span class="annot"><span class="annottext">SearchResult
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1334"></span><span>
</span><span id="line-1335"></span><span id="local-6989586621679379545"><span class="annot"><a href="Unison.Server.Backend.html#displayTerm"><span class="hs-identifier hs-type">displayTerm</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><a href="#local-6989586621679379545"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Sqlite.Transaction</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DisplayObject</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Term</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-1336"></span><span id="displayTerm"><span class="annot"><span class="annottext">displayTerm :: forall (m :: * -&gt; *).
Codebase m Symbol Ann
-&gt; TypeReference
-&gt; Transaction (DisplayObject (Type Symbol Ann) (Term Symbol Ann))
</span><a href="Unison.Server.Backend.html#displayTerm"><span class="hs-identifier hs-var hs-var">displayTerm</span></a></span></span><span> </span><span id="local-6989586621679377342"><span class="annot"><span class="annottext">Codebase m Symbol Ann
</span><a href="#local-6989586621679377342"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-1337"></span><span>  </span><span id="local-6989586621679377341"><span class="annot"><span class="annottext">ref :: TypeReference
</span><a href="#local-6989586621679377341"><span class="hs-identifier hs-var">ref</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Reference.Builtin</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1338"></span><span>    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679377341"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">Map TypeReference (Term F Symbol ())
</span><span class="hs-identifier hs-var">B.termRefTypes</span></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1339"></span><span>      </span><span class="hs-comment">-- This would be better as a `MissingBuiltin` constructor; `MissingObject` is kind of being</span><span>
</span><span id="line-1340"></span><span>      </span><span class="hs-comment">-- misused here. Is `MissingObject` even possible anymore?</span><span>
</span><span id="line-1341"></span><span>      </span><span class="annot"><span class="annottext">Maybe (Term F Symbol ())
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall b a. ShortHash -&gt; DisplayObject b a
</span><span class="hs-identifier hs-var">MissingObject</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeReference -&gt; ShortHash
</span><span class="hs-identifier hs-var">Reference.toShortHash</span></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679377341"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-1342"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679377339"><span class="annot"><span class="annottext">Term F Symbol ()
</span><a href="#local-6989586621679377339"><span class="hs-identifier hs-var">typ</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall b a. b -&gt; DisplayObject b a
</span><span class="hs-identifier hs-var">BuiltinObject</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;$</span></span><span> </span><span class="annot"><span class="annottext">Term F Symbol ()
</span><a href="#local-6989586621679377339"><span class="hs-identifier hs-var">typ</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1343"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Reference.DerivedId</span></span><span> </span><span id="local-6989586621679377337"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679377337"><span class="hs-identifier hs-var">rid</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1344"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679377336"><span class="annot"><span class="annottext">Term Symbol Ann
</span><a href="#local-6989586621679377336"><span class="hs-identifier hs-var">term</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679377335"><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679377335"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) v a.
HasCallStack =&gt;
Codebase m v a -&gt; Id -&gt; Transaction (Term v a, Type v a)
</span><span class="hs-identifier hs-var">Codebase.unsafeGetTermWithType</span></span><span> </span><span class="annot"><span class="annottext">Codebase m Symbol Ann
</span><a href="#local-6989586621679377342"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679377337"><span class="hs-identifier hs-var">rid</span></a></span><span>
</span><span id="line-1345"></span><span>    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Term Symbol Ann
</span><a href="#local-6989586621679377336"><span class="hs-identifier hs-var">term</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1346"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Term.Ann'</span></span><span> </span><span class="annot"><span class="annottext">Term Symbol Ann
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type Symbol Ann
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall b a. a -&gt; DisplayObject b a
</span><span class="hs-identifier hs-var">UserObject</span></span><span> </span><span class="annot"><span class="annottext">Term Symbol Ann
</span><a href="#local-6989586621679377336"><span class="hs-identifier hs-var">term</span></a></span><span>
</span><span id="line-1347"></span><span>      </span><span class="hs-comment">-- manually annotate if necessary</span><span>
</span><span id="line-1348"></span><span>      </span><span class="annot"><span class="annottext">Term Symbol Ann
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall b a. a -&gt; DisplayObject b a
</span><span class="hs-identifier hs-var">UserObject</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall v a vt at ap.
Ord v =&gt;
a -&gt; Term2 vt at ap v a -&gt; Type vt at -&gt; Term2 vt at ap v a
</span><span class="hs-identifier hs-var">Term.ann</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) v a. Term f v a -&gt; a
</span><span class="hs-identifier hs-var">ABT.annotation</span></span><span> </span><span class="annot"><span class="annottext">Term Symbol Ann
</span><a href="#local-6989586621679377336"><span class="hs-identifier hs-var">term</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term Symbol Ann
</span><a href="#local-6989586621679377336"><span class="hs-identifier hs-var">term</span></a></span><span> </span><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679377335"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1349"></span><span>
</span><span id="line-1350"></span><span id="local-6989586621679379544"><span class="annot"><a href="Unison.Server.Backend.html#displayType"><span class="hs-identifier hs-type">displayType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><a href="#local-6989586621679379544"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Sqlite.Transaction</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DisplayObject</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DD.Decl</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-1351"></span><span id="displayType"><span class="annot"><span class="annottext">displayType :: forall (m :: * -&gt; *).
Codebase m Symbol Ann
-&gt; TypeReference
-&gt; Transaction (DisplayObject () (Decl Symbol Ann))
</span><a href="Unison.Server.Backend.html#displayType"><span class="hs-identifier hs-var hs-var">displayType</span></a></span></span><span> </span><span id="local-6989586621679377326"><span class="annot"><span class="annottext">Codebase m Symbol Ann
</span><a href="#local-6989586621679377326"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-1352"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Reference.Builtin</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall b a. b -&gt; DisplayObject b a
</span><span class="hs-identifier hs-var">BuiltinObject</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1353"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Reference.DerivedId</span></span><span> </span><span id="local-6989586621679377325"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679377325"><span class="hs-identifier hs-var">rid</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1354"></span><span>    </span><span id="local-6989586621679377324"><span class="annot"><span class="annottext">Decl Symbol Ann
</span><a href="#local-6989586621679377324"><span class="hs-identifier hs-var">decl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) v a.
HasCallStack =&gt;
Codebase m v a -&gt; Id -&gt; Transaction (Decl v a)
</span><span class="hs-identifier hs-var">Codebase.unsafeGetTypeDeclaration</span></span><span> </span><span class="annot"><span class="annottext">Codebase m Symbol Ann
</span><a href="#local-6989586621679377326"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679377325"><span class="hs-identifier hs-var">rid</span></a></span><span>
</span><span id="line-1355"></span><span>    </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall b a. a -&gt; DisplayObject b a
</span><span class="hs-identifier hs-var">UserObject</span></span><span> </span><span class="annot"><span class="annottext">Decl Symbol Ann
</span><a href="#local-6989586621679377324"><span class="hs-identifier hs-var">decl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1356"></span><span>
</span><span id="line-1357"></span><span id="local-6989586621679379693"><span id="local-6989586621679379694"><span class="annot"><a href="Unison.Server.Backend.html#termsToSyntax"><span class="hs-identifier hs-type">termsToSyntax</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1358"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Var</span></span><span> </span><span class="annot"><a href="#local-6989586621679379694"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1359"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679379693"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1360"></span><span>  </span><span class="annot"><a href="Unison.Server.Types.html#Suffixify"><span class="hs-identifier hs-type">Suffixify</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1361"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Width</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1362"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">PPED.PrettyPrintEnvDecl</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1363"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference.Reference</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DisplayObject</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><a href="#local-6989586621679379694"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679379693"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Term</span></span><span> </span><span class="annot"><a href="#local-6989586621679379694"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679379693"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1364"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference.Reference</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DisplayObject</span></span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#SyntaxText"><span class="hs-identifier hs-type">SyntaxText</span></a></span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#SyntaxText"><span class="hs-identifier hs-type">SyntaxText</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-1365"></span><span id="termsToSyntax"><span class="annot"><span class="annottext">termsToSyntax :: forall v a.
(Var v, Ord a) =&gt;
Suffixify
-&gt; Width
-&gt; PrettyPrintEnvDecl
-&gt; Map TypeReference (DisplayObject (Type v a) (Term v a))
-&gt; Map TypeReference (DisplayObject SyntaxText SyntaxText)
</span><a href="Unison.Server.Backend.html#termsToSyntax"><span class="hs-identifier hs-var hs-var">termsToSyntax</span></a></span></span><span> </span><span id="local-6989586621679377309"><span class="annot"><span class="annottext">Suffixify
</span><a href="#local-6989586621679377309"><span class="hs-identifier hs-var">suff</span></a></span></span><span> </span><span id="local-6989586621679377308"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621679377308"><span class="hs-identifier hs-var">width</span></a></span></span><span> </span><span id="local-6989586621679377307"><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679377307"><span class="hs-identifier hs-var">ppe0</span></a></span></span><span> </span><span id="local-6989586621679377306"><span class="annot"><span class="annottext">Map TypeReference (DisplayObject (Type v a) (Term v a))
</span><a href="#local-6989586621679377306"><span class="hs-identifier hs-var">terms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1366"></span><span>  </span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromList</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">((HashQualified Name, TypeReference),
 DisplayObject (Type v a) (Term v a))
-&gt; (TypeReference, DisplayObject SyntaxText SyntaxText)
</span><a href="#local-6989586621679377305"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1367"></span><span>    </span><span class="annot"><span class="annottext">forall k2 k1 a. Ord k2 =&gt; (k1 -&gt; k2) -&gt; Map k1 a -&gt; Map k2 a
</span><span class="hs-identifier hs-var">Map.mapKeys</span></span><span>
</span><span id="line-1368"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (p :: * -&gt; * -&gt; *) a b c.
Bifunctor p =&gt;
(a -&gt; b) -&gt; p a c -&gt; p b c
</span><span class="hs-identifier hs-var">first</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrettyPrintEnv -&gt; Referent -&gt; HashQualified Name
</span><span class="hs-identifier hs-var">PPE.termName</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679377302"><span class="hs-identifier hs-var">ppeDecl</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TypeReference -&gt; Referent
</span><span class="hs-identifier hs-var">Referent.Ref</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; (a, a)
</span><span class="hs-identifier hs-var">dupe</span></span><span class="hs-special">)</span><span>
</span><span id="line-1369"></span><span>      </span><span class="annot"><span class="annottext">Map TypeReference (DisplayObject (Type v a) (Term v a))
</span><a href="#local-6989586621679377306"><span class="hs-identifier hs-var">terms</span></a></span><span>
</span><span id="line-1370"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1371"></span><span>    </span><span id="local-6989586621679377301"><span class="annot"><span class="annottext">ppeBody :: TypeReference -&gt; PrettyPrintEnv
</span><a href="#local-6989586621679377301"><span class="hs-identifier hs-var hs-var">ppeBody</span></a></span></span><span> </span><span id="local-6989586621679377300"><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679377300"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1372"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Suffixify -&gt; Bool
</span><a href="Unison.Server.Types.html#%24sel%3Asuffixified%3ASuffixify"><span class="hs-identifier hs-var">suffixified</span></a></span><span> </span><span class="annot"><span class="annottext">Suffixify
</span><a href="#local-6989586621679377309"><span class="hs-identifier hs-var">suff</span></a></span><span>
</span><span id="line-1373"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl -&gt; PrettyPrintEnv
</span><span class="hs-identifier hs-var">PPED.suffixifiedPPE</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679377307"><span class="hs-identifier hs-var">ppe0</span></a></span><span>
</span><span id="line-1374"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl -&gt; TypeReference -&gt; PrettyPrintEnv
</span><span class="hs-identifier hs-var">PPE.declarationPPE</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679377307"><span class="hs-identifier hs-var">ppe0</span></a></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679377300"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-1375"></span><span>    </span><span id="local-6989586621679377302"><span class="annot"><span class="annottext">ppeDecl :: PrettyPrintEnv
</span><a href="#local-6989586621679377302"><span class="hs-identifier hs-var hs-var">ppeDecl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1376"></span><span>      </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Suffixify -&gt; Bool
</span><a href="Unison.Server.Types.html#%24sel%3Asuffixified%3ASuffixify"><span class="hs-identifier hs-var">suffixified</span></a></span><span> </span><span class="annot"><span class="annottext">Suffixify
</span><a href="#local-6989586621679377309"><span class="hs-identifier hs-var">suff</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl -&gt; PrettyPrintEnv
</span><span class="hs-identifier hs-var">PPED.suffixifiedPPE</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl -&gt; PrettyPrintEnv
</span><span class="hs-identifier hs-var">PPED.unsuffixifiedPPE</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679377307"><span class="hs-identifier hs-var">ppe0</span></a></span><span>
</span><span id="line-1377"></span><span>    </span><span id="local-6989586621679377305"><span class="annot"><span class="annottext">go :: ((HashQualified Name, TypeReference),
 DisplayObject (Type v a) (Term v a))
-&gt; (TypeReference, DisplayObject SyntaxText SyntaxText)
</span><a href="#local-6989586621679377305"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621679377297"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679377297"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679377296"><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679377296"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621679377295"><span class="annot"><span class="annottext">DisplayObject (Type v a) (Term v a)
</span><a href="#local-6989586621679377295"><span class="hs-identifier hs-var">dt</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679377296"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DisplayObject (Type v a) (Term v a)
</span><a href="#local-6989586621679377295"><span class="hs-identifier hs-var">dt</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1378"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">DisplayObject.BuiltinObject</span></span><span> </span><span id="local-6989586621679377294"><span class="annot"><span class="annottext">Type v a
</span><a href="#local-6989586621679377294"><span class="hs-identifier hs-var">typ</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1379"></span><span>        </span><span class="annot"><span class="annottext">forall b a. b -&gt; DisplayObject b a
</span><span class="hs-identifier hs-var">DisplayObject.BuiltinObject</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1380"></span><span>          </span><span class="annot"><span class="annottext">forall v a.
Var v =&gt;
PrettyPrintEnv -&gt; Width -&gt; Type v a -&gt; SyntaxText
</span><a href="Unison.Server.Backend.html#formatType%27"><span class="hs-identifier hs-var">formatType'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeReference -&gt; PrettyPrintEnv
</span><a href="#local-6989586621679377301"><span class="hs-identifier hs-var">ppeBody</span></a></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679377296"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621679377308"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">Type v a
</span><a href="#local-6989586621679377294"><span class="hs-identifier hs-var">typ</span></a></span><span>
</span><span id="line-1381"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">DisplayObject.MissingObject</span></span><span> </span><span id="local-6989586621679377293"><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679377293"><span class="hs-identifier hs-var">sh</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall b a. ShortHash -&gt; DisplayObject b a
</span><span class="hs-identifier hs-var">DisplayObject.MissingObject</span></span><span> </span><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679377293"><span class="hs-identifier hs-var">sh</span></a></span><span>
</span><span id="line-1382"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">DisplayObject.UserObject</span></span><span> </span><span id="local-6989586621679377292"><span class="annot"><span class="annottext">Term v a
</span><a href="#local-6989586621679377292"><span class="hs-identifier hs-var">tm</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1383"></span><span>        </span><span class="annot"><span class="annottext">forall b a. a -&gt; DisplayObject b a
</span><span class="hs-identifier hs-var">DisplayObject.UserObject</span></span><span>
</span><span id="line-1384"></span><span>          </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall s. (Monoid s, IsString s) =&gt; Width -&gt; Pretty s -&gt; s
</span><span class="hs-identifier hs-var">Pretty.render</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621679377308"><span class="hs-identifier hs-var">width</span></a></span><span>
</span><span id="line-1385"></span><span>          </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall v at ap a.
Var v =&gt;
PrettyPrintEnv
-&gt; HashQualified Name -&gt; Term2 v at ap v a -&gt; Pretty SyntaxText
</span><span class="hs-identifier hs-var">TermPrinter.prettyBinding</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeReference -&gt; PrettyPrintEnv
</span><a href="#local-6989586621679377301"><span class="hs-identifier hs-var">ppeBody</span></a></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679377296"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679377297"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Term v a
</span><a href="#local-6989586621679377292"><span class="hs-identifier hs-var">tm</span></a></span><span>
</span><span id="line-1386"></span><span>
</span><span id="line-1387"></span><span id="local-6989586621679379696"><span id="local-6989586621679379697"><span class="annot"><a href="Unison.Server.Backend.html#typesToSyntax"><span class="hs-identifier hs-type">typesToSyntax</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1388"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Var</span></span><span> </span><span class="annot"><a href="#local-6989586621679379697"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1389"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679379696"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1390"></span><span>  </span><span class="annot"><a href="Unison.Server.Types.html#Suffixify"><span class="hs-identifier hs-type">Suffixify</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1391"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Width</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1392"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">PPED.PrettyPrintEnvDecl</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1393"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference.Reference</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DisplayObject</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DD.Decl</span></span><span> </span><span class="annot"><a href="#local-6989586621679379697"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679379696"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1394"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference.Reference</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DisplayObject</span></span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#SyntaxText"><span class="hs-identifier hs-type">SyntaxText</span></a></span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#SyntaxText"><span class="hs-identifier hs-type">SyntaxText</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-1395"></span><span id="typesToSyntax"><span class="annot"><span class="annottext">typesToSyntax :: forall v a.
(Var v, Ord a) =&gt;
Suffixify
-&gt; Width
-&gt; PrettyPrintEnvDecl
-&gt; Map TypeReference (DisplayObject () (Decl v a))
-&gt; Map TypeReference (DisplayObject SyntaxText SyntaxText)
</span><a href="Unison.Server.Backend.html#typesToSyntax"><span class="hs-identifier hs-var hs-var">typesToSyntax</span></a></span></span><span> </span><span id="local-6989586621679377280"><span class="annot"><span class="annottext">Suffixify
</span><a href="#local-6989586621679377280"><span class="hs-identifier hs-var">suff</span></a></span></span><span> </span><span id="local-6989586621679377279"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621679377279"><span class="hs-identifier hs-var">width</span></a></span></span><span> </span><span id="local-6989586621679377278"><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679377278"><span class="hs-identifier hs-var">ppe0</span></a></span></span><span> </span><span id="local-6989586621679377277"><span class="annot"><span class="annottext">Map TypeReference (DisplayObject () (Decl v a))
</span><a href="#local-6989586621679377277"><span class="hs-identifier hs-var">types</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1396"></span><span>  </span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromList</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1397"></span><span>    </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">((HashQualified Name, TypeReference), DisplayObject () (Decl v a))
-&gt; (TypeReference, DisplayObject SyntaxText SyntaxText)
</span><a href="#local-6989586621679377276"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1398"></span><span>      </span><span class="annot"><span class="annottext">forall k2 k1 a. Ord k2 =&gt; (k1 -&gt; k2) -&gt; Map k1 a -&gt; Map k2 a
</span><span class="hs-identifier hs-var">Map.mapKeys</span></span><span>
</span><span id="line-1399"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (p :: * -&gt; * -&gt; *) a b c.
Bifunctor p =&gt;
(a -&gt; b) -&gt; p a c -&gt; p b c
</span><span class="hs-identifier hs-var">first</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrettyPrintEnv -&gt; TypeReference -&gt; HashQualified Name
</span><span class="hs-identifier hs-var">PPE.typeName</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679377275"><span class="hs-identifier hs-var">ppeDecl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; (a, a)
</span><span class="hs-identifier hs-var">dupe</span></span><span class="hs-special">)</span><span>
</span><span id="line-1400"></span><span>        </span><span class="annot"><span class="annottext">Map TypeReference (DisplayObject () (Decl v a))
</span><a href="#local-6989586621679377277"><span class="hs-identifier hs-var">types</span></a></span><span>
</span><span id="line-1401"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1402"></span><span>    </span><span id="local-6989586621679377275"><span class="annot"><span class="annottext">ppeDecl :: PrettyPrintEnv
</span><a href="#local-6989586621679377275"><span class="hs-identifier hs-var hs-var">ppeDecl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1403"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Suffixify -&gt; Bool
</span><a href="Unison.Server.Types.html#%24sel%3Asuffixified%3ASuffixify"><span class="hs-identifier hs-var">suffixified</span></a></span><span> </span><span class="annot"><span class="annottext">Suffixify
</span><a href="#local-6989586621679377280"><span class="hs-identifier hs-var">suff</span></a></span><span>
</span><span id="line-1404"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl -&gt; PrettyPrintEnv
</span><span class="hs-identifier hs-var">PPED.suffixifiedPPE</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679377278"><span class="hs-identifier hs-var">ppe0</span></a></span><span>
</span><span id="line-1405"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl -&gt; PrettyPrintEnv
</span><span class="hs-identifier hs-var">PPED.unsuffixifiedPPE</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679377278"><span class="hs-identifier hs-var">ppe0</span></a></span><span>
</span><span id="line-1406"></span><span>    </span><span id="local-6989586621679377276"><span class="annot"><span class="annottext">go :: ((HashQualified Name, TypeReference), DisplayObject () (Decl v a))
-&gt; (TypeReference, DisplayObject SyntaxText SyntaxText)
</span><a href="#local-6989586621679377276"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621679377274"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679377274"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679377273"><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679377273"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621679377272"><span class="annot"><span class="annottext">DisplayObject () (Decl v a)
</span><a href="#local-6989586621679377272"><span class="hs-identifier hs-var">dt</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679377273"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DisplayObject () (Decl v a)
</span><a href="#local-6989586621679377272"><span class="hs-identifier hs-var">dt</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1407"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">BuiltinObject</span></span><span> </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall b a. b -&gt; DisplayObject b a
</span><span class="hs-identifier hs-var">BuiltinObject</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrettyPrintEnv -&gt; TypeReference -&gt; SyntaxText
</span><a href="Unison.Server.Backend.html#formatTypeName%27"><span class="hs-identifier hs-var">formatTypeName'</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679377275"><span class="hs-identifier hs-var">ppeDecl</span></a></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679377273"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1408"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">MissingObject</span></span><span> </span><span id="local-6989586621679377271"><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679377271"><span class="hs-identifier hs-var">sh</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall b a. ShortHash -&gt; DisplayObject b a
</span><span class="hs-identifier hs-var">MissingObject</span></span><span> </span><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679377271"><span class="hs-identifier hs-var">sh</span></a></span><span>
</span><span id="line-1409"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">UserObject</span></span><span> </span><span id="local-6989586621679377270"><span class="annot"><span class="annottext">Decl v a
</span><a href="#local-6989586621679377270"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1410"></span><span>        </span><span class="annot"><span class="annottext">forall b a. a -&gt; DisplayObject b a
</span><span class="hs-identifier hs-var">UserObject</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall s. (Monoid s, IsString s) =&gt; Width -&gt; Pretty s -&gt; s
</span><span class="hs-identifier hs-var">Pretty.render</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621679377279"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1411"></span><span>          </span><span class="annot"><span class="annottext">forall v a.
Var v =&gt;
PrettyPrintEnvDecl
-&gt; TypeReference
-&gt; HashQualified Name
-&gt; Decl v a
-&gt; Pretty SyntaxText
</span><span class="hs-identifier hs-var">DeclPrinter.prettyDecl</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrettyPrintEnvDecl -&gt; TypeReference -&gt; PrettyPrintEnvDecl
</span><span class="hs-identifier hs-var">PPE.declarationPPEDecl</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679377278"><span class="hs-identifier hs-var">ppe0</span></a></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679377273"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679377273"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679377274"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Decl v a
</span><a href="#local-6989586621679377270"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-1412"></span><span>
</span><span id="line-1413"></span><span class="hs-comment">-- | Renders a type to its decl header, e.g.</span><span>
</span><span id="line-1414"></span><span class="hs-comment">--</span><span>
</span><span id="line-1415"></span><span class="hs-comment">-- Effect:</span><span>
</span><span id="line-1416"></span><span class="hs-comment">--</span><span>
</span><span id="line-1417"></span><span class="hs-comment">-- unique ability Stream s</span><span>
</span><span id="line-1418"></span><span class="hs-comment">--</span><span>
</span><span id="line-1419"></span><span class="hs-comment">-- Data:</span><span>
</span><span id="line-1420"></span><span class="hs-comment">--</span><span>
</span><span id="line-1421"></span><span class="hs-comment">-- structural type Maybe a</span><span>
</span><span id="line-1422"></span><span class="annot"><a href="Unison.Server.Backend.html#typeToSyntaxHeader"><span class="hs-identifier hs-type">typeToSyntaxHeader</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1423"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Width</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1424"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">HQ.HashQualified</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1425"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">DisplayObject</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DD.Decl</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1426"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">DisplayObject</span></span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#SyntaxText"><span class="hs-identifier hs-type">SyntaxText</span></a></span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#SyntaxText"><span class="hs-identifier hs-type">SyntaxText</span></a></span><span>
</span><span id="line-1427"></span><span id="typeToSyntaxHeader"><span class="annot"><span class="annottext">typeToSyntaxHeader :: Width
-&gt; HashQualified Name
-&gt; DisplayObject () (Decl Symbol Ann)
-&gt; DisplayObject SyntaxText SyntaxText
</span><a href="Unison.Server.Backend.html#typeToSyntaxHeader"><span class="hs-identifier hs-var hs-var">typeToSyntaxHeader</span></a></span></span><span> </span><span id="local-6989586621679377267"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621679377267"><span class="hs-identifier hs-var">width</span></a></span></span><span> </span><span id="local-6989586621679377266"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679377266"><span class="hs-identifier hs-var">hqName</span></a></span></span><span> </span><span id="local-6989586621679377265"><span class="annot"><span class="annottext">DisplayObject () (Decl Symbol Ann)
</span><a href="#local-6989586621679377265"><span class="hs-identifier hs-var">obj</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1428"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DisplayObject () (Decl Symbol Ann)
</span><a href="#local-6989586621679377265"><span class="hs-identifier hs-var">obj</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1429"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">BuiltinObject</span></span><span> </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1430"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679377264"><span class="annot"><span class="annottext">syntaxName :: SyntaxText
</span><a href="#local-6989586621679377264"><span class="hs-identifier hs-var hs-var">syntaxName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall s. (Monoid s, IsString s) =&gt; Pretty s -&gt; s
</span><span class="hs-identifier hs-var">Pretty.renderUnbroken</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall s.
IsString s =&gt;
(Pretty s -&gt; Pretty s) -&gt; HashQualified Name -&gt; Pretty s
</span><span class="hs-identifier hs-var">NP.styleHashQualified</span></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679377266"><span class="hs-identifier hs-var">hqName</span></a></span><span>
</span><span id="line-1431"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">forall b a. b -&gt; DisplayObject b a
</span><span class="hs-identifier hs-var">BuiltinObject</span></span><span> </span><span class="annot"><span class="annottext">SyntaxText
</span><a href="#local-6989586621679377264"><span class="hs-identifier hs-var">syntaxName</span></a></span><span>
</span><span id="line-1432"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MissingObject</span></span><span> </span><span id="local-6989586621679377263"><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679377263"><span class="hs-identifier hs-var">sh</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall b a. ShortHash -&gt; DisplayObject b a
</span><span class="hs-identifier hs-var">MissingObject</span></span><span> </span><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679377263"><span class="hs-identifier hs-var">sh</span></a></span><span>
</span><span id="line-1433"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">UserObject</span></span><span> </span><span id="local-6989586621679377262"><span class="annot"><span class="annottext">Decl Symbol Ann
</span><a href="#local-6989586621679377262"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1434"></span><span>      </span><span class="annot"><span class="annottext">forall b a. a -&gt; DisplayObject b a
</span><span class="hs-identifier hs-var">UserObject</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall s. (Monoid s, IsString s) =&gt; Width -&gt; Pretty s -&gt; s
</span><span class="hs-identifier hs-var">Pretty.render</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621679377267"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1435"></span><span>        </span><span class="annot"><span class="annottext">forall v a.
Var v =&gt;
HashQualified Name
-&gt; Either (EffectDeclaration v a) (DataDeclaration v a)
-&gt; Pretty SyntaxText
</span><span class="hs-identifier hs-var">DeclPrinter.prettyDeclHeader</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679377266"><span class="hs-identifier hs-var">hqName</span></a></span><span> </span><span class="annot"><span class="annottext">Decl Symbol Ann
</span><a href="#local-6989586621679377262"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-1436"></span><span>
</span><span id="line-1437"></span><span id="local-6989586621679379505"><span class="annot"><a href="Unison.Server.Backend.html#loadSearchResults"><span class="hs-identifier hs-type">loadSearchResults</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1438"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><a href="#local-6989586621679379505"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1439"></span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="Unison.Server.SearchResult.html#SearchResult"><span class="hs-identifier hs-type">SR.SearchResult</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1440"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Sqlite.Transaction</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Unison.Server.SearchResult'.html#SearchResult%27"><span class="hs-identifier hs-type">SR'.SearchResult'</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">]</span></span><span>
</span><span id="line-1441"></span><span id="loadSearchResults"><span class="annot"><span class="annottext">loadSearchResults :: forall (m :: * -&gt; *).
Codebase m Symbol Ann
-&gt; [SearchResult] -&gt; Transaction [SearchResult' Symbol Ann]
</span><a href="Unison.Server.Backend.html#loadSearchResults"><span class="hs-identifier hs-var hs-var">loadSearchResults</span></a></span></span><span> </span><span id="local-6989586621679377257"><span class="annot"><span class="annottext">Codebase m Symbol Ann
</span><a href="#local-6989586621679377257"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">SearchResult -&gt; Transaction (SearchResult' Symbol Ann)
</span><a href="#local-6989586621679377256"><span class="hs-identifier hs-var">loadSearchResult</span></a></span><span>
</span><span id="line-1442"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1443"></span><span>    </span><span id="local-6989586621679377256"><span class="annot"><span class="annottext">loadSearchResult :: SearchResult -&gt; Transaction (SearchResult' Symbol Ann)
</span><a href="#local-6989586621679377256"><span class="hs-identifier hs-var hs-var">loadSearchResult</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-1444"></span><span>      </span><span class="annot"><a href="Unison.Server.SearchResult.html#Tm"><span class="hs-identifier hs-type">SR.Tm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.SearchResult.html#TermResult"><span class="hs-identifier hs-type">SR.TermResult</span></a></span><span> </span><span id="local-6989586621679377253"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679377253"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679377252"><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679377252"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621679377251"><span class="annot"><span class="annottext">Set (HashQualified Name)
</span><a href="#local-6989586621679377251"><span class="hs-identifier hs-var">aliases</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1445"></span><span>        </span><span id="local-6989586621679377250"><span class="annot"><span class="annottext">Maybe (Type Symbol Ann)
</span><a href="#local-6989586621679377250"><span class="hs-identifier hs-var">typ</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
Codebase m Symbol Ann
-&gt; Referent -&gt; Transaction (Maybe (Type Symbol Ann))
</span><a href="Unison.Server.Backend.html#loadReferentType"><span class="hs-identifier hs-var">loadReferentType</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase m Symbol Ann
</span><a href="#local-6989586621679377257"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679377252"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-1446"></span><span>        </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span> </span><span class="annot"><span class="annottext">forall v a.
HashQualified Name
-&gt; Maybe (Type v a)
-&gt; Referent
-&gt; Set (HashQualified Name)
-&gt; SearchResult' v a
</span><a href="Unison.Server.SearchResult'.html#Tm"><span class="hs-identifier hs-var">SR'.Tm</span></a></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679377253"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Type Symbol Ann)
</span><a href="#local-6989586621679377250"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679377252"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Set (HashQualified Name)
</span><a href="#local-6989586621679377251"><span class="hs-identifier hs-var">aliases</span></a></span><span>
</span><span id="line-1447"></span><span>      </span><span class="annot"><a href="Unison.Server.SearchResult.html#Tp"><span class="hs-identifier hs-type">SR.Tp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.SearchResult.html#TypeResult"><span class="hs-identifier hs-type">SR.TypeResult</span></a></span><span> </span><span id="local-6989586621679377246"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679377246"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679377245"><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679377245"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621679377244"><span class="annot"><span class="annottext">Set (HashQualified Name)
</span><a href="#local-6989586621679377244"><span class="hs-identifier hs-var">aliases</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1448"></span><span>        </span><span id="local-6989586621679377243"><span class="annot"><span class="annottext">DisplayObject () (Decl Symbol Ann)
</span><a href="#local-6989586621679377243"><span class="hs-identifier hs-var">dt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) v.
Codebase m v Ann
-&gt; TypeReference -&gt; Transaction (DisplayObject () (Decl v Ann))
</span><a href="Unison.Server.Backend.html#loadTypeDisplayObject"><span class="hs-identifier hs-var">loadTypeDisplayObject</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase m Symbol Ann
</span><a href="#local-6989586621679377257"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679377245"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-1449"></span><span>        </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span> </span><span class="annot"><span class="annottext">forall v a.
HashQualified Name
-&gt; DisplayObject () (Decl v a)
-&gt; TypeReference
-&gt; Set (HashQualified Name)
-&gt; SearchResult' v a
</span><a href="Unison.Server.SearchResult'.html#Tp"><span class="hs-identifier hs-var">SR'.Tp</span></a></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679377246"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">DisplayObject () (Decl Symbol Ann)
</span><a href="#local-6989586621679377243"><span class="hs-identifier hs-var">dt</span></a></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679377245"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Set (HashQualified Name)
</span><a href="#local-6989586621679377244"><span class="hs-identifier hs-var">aliases</span></a></span><span>
</span><span id="line-1450"></span><span>
</span><span id="line-1451"></span><span id="local-6989586621679379497"><span id="local-6989586621679379498"><span class="annot"><a href="Unison.Server.Backend.html#loadTypeDisplayObject"><span class="hs-identifier hs-type">loadTypeDisplayObject</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1452"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><a href="#local-6989586621679379498"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679379497"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1453"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1454"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Sqlite.Transaction</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DisplayObject</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DD.Decl</span></span><span> </span><span class="annot"><a href="#local-6989586621679379497"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-1455"></span><span id="loadTypeDisplayObject"><span class="annot"><span class="annottext">loadTypeDisplayObject :: forall (m :: * -&gt; *) v.
Codebase m v Ann
-&gt; TypeReference -&gt; Transaction (DisplayObject () (Decl v Ann))
</span><a href="Unison.Server.Backend.html#loadTypeDisplayObject"><span class="hs-identifier hs-var hs-var">loadTypeDisplayObject</span></a></span></span><span> </span><span id="local-6989586621679377238"><span class="annot"><span class="annottext">Codebase m v Ann
</span><a href="#local-6989586621679377238"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-1456"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Reference.Builtin</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall b a. b -&gt; DisplayObject b a
</span><span class="hs-identifier hs-var">BuiltinObject</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1457"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Reference.DerivedId</span></span><span> </span><span id="local-6989586621679377237"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679377237"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1458"></span><span>    </span><span class="annot"><span class="annottext">forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall b a. ShortHash -&gt; DisplayObject b a
</span><span class="hs-identifier hs-var">MissingObject</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Id -&gt; ShortHash
</span><span class="hs-identifier hs-var">Reference.idToShortHash</span></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679377237"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall b a. a -&gt; DisplayObject b a
</span><span class="hs-identifier hs-var">UserObject</span></span><span>
</span><span id="line-1459"></span><span>      </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) v a.
Codebase m v a -&gt; Id -&gt; Transaction (Maybe (Decl v a))
</span><span class="hs-identifier hs-var">Codebase.getTypeDeclaration</span></span><span> </span><span class="annot"><span class="annottext">Codebase m v Ann
</span><a href="#local-6989586621679377238"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679377237"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-1460"></span></pre></body></html>