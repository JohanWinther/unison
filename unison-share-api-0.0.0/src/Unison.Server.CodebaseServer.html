<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DataKinds #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DeriveAnyClass #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE DeriveGeneric #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE TypeOperators #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# OPTIONS_GHC -Wno-orphans #-}</span><span>
</span><span id="line-8"></span><span>
</span><span id="line-9"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Unison.Server.CodebaseServer</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-10"></span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Concurrent</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">newEmptyMVar</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">putMVar</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">readMVar</span></span><span class="hs-special">)</span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Concurrent.Async</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">race</span></span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Exception</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ErrorCall</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">throwIO</span></span><span class="hs-special">)</span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Lens</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(.~)</span></span><span class="hs-special">)</span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Reader</span></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Trans.Except</span></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Aeson</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Strict</span></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Char8</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">unpack</span></span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Char8</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">C8</span></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Lazy</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Lazy</span></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Lazy.UTF8</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BLU</span></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.NanoID</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">customNanoID</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">defaultAlphabet</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">unNanoID</span></span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.OpenApi</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Info</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">License</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">OpenApi</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">URL</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.OpenApi.Lens</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">OpenApi</span></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Proxy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Proxy</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Text</span></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text.Encoding</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Text</span></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Generics</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.HTTP.Media</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(//)</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(/:)</span></span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.HTTP.Types</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">HeaderName</span></span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.HTTP.Types.Status</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ok200</span></span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Network.URI.Encode</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">URI</span></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.Wai</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Middleware</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">responseLBS</span></span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.Wai.Handler.Warp</span></span><span>
</span><span id="line-36"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">Port</span></span><span class="hs-special">,</span><span>
</span><span id="line-37"></span><span>    </span><span class="annot"><span class="hs-identifier">defaultSettings</span></span><span class="hs-special">,</span><span>
</span><span id="line-38"></span><span>    </span><span class="annot"><span class="hs-identifier">runSettings</span></span><span class="hs-special">,</span><span>
</span><span id="line-39"></span><span>    </span><span class="annot"><span class="hs-identifier">setBeforeMainLoop</span></span><span class="hs-special">,</span><span>
</span><span id="line-40"></span><span>    </span><span class="annot"><span class="hs-identifier">setHost</span></span><span class="hs-special">,</span><span>
</span><span id="line-41"></span><span>    </span><span class="annot"><span class="hs-identifier">setPort</span></span><span class="hs-special">,</span><span>
</span><span id="line-42"></span><span>    </span><span class="annot"><span class="hs-identifier">withApplicationSettings</span></span><span class="hs-special">,</span><span>
</span><span id="line-43"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.Wai.Middleware.Cors</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">cors</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">corsMethods</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">corsOrigins</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">simpleCorsResourcePolicy</span></span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Servant</span></span><span>
</span><span id="line-46"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">Handler</span></span><span class="hs-special">,</span><span>
</span><span id="line-47"></span><span>    </span><span class="annot"><span class="hs-identifier">HasServer</span></span><span class="hs-special">,</span><span>
</span><span id="line-48"></span><span>    </span><span class="annot"><span class="hs-identifier">MimeRender</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-49"></span><span>    </span><span class="annot"><span class="hs-identifier">ServerT</span></span><span class="hs-special">,</span><span>
</span><span id="line-50"></span><span>    </span><span class="annot"><span class="hs-identifier">serve</span></span><span class="hs-special">,</span><span>
</span><span id="line-51"></span><span>    </span><span class="annot"><span class="hs-identifier">throwError</span></span><span class="hs-special">,</span><span>
</span><span id="line-52"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Servant.API</span></span><span>
</span><span id="line-54"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">Accept</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-55"></span><span>    </span><span class="annot"><span class="hs-identifier">Capture</span></span><span class="hs-special">,</span><span>
</span><span id="line-56"></span><span>    </span><span class="annot"><span class="hs-identifier">CaptureAll</span></span><span class="hs-special">,</span><span>
</span><span id="line-57"></span><span>    </span><span class="annot"><span class="hs-identifier">Get</span></span><span class="hs-special">,</span><span>
</span><span id="line-58"></span><span>    </span><span class="annot"><span class="hs-identifier">JSON</span></span><span class="hs-special">,</span><span>
</span><span id="line-59"></span><span>    </span><span class="annot"><span class="hs-identifier">Raw</span></span><span class="hs-special">,</span><span>
</span><span id="line-60"></span><span>    </span><span class="annot"><span class="hs-operator">(:&gt;)</span></span><span class="hs-special">,</span><span>
</span><span id="line-61"></span><span>    </span><span class="hs-keyword">type</span><span> </span><span class="annot"><span class="hs-operator">(:&lt;|&gt;)</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-62"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Servant.Docs</span></span><span>
</span><span id="line-64"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">DocIntro</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">DocIntro</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-65"></span><span>    </span><span class="annot"><span class="hs-identifier">ToSample</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-66"></span><span>    </span><span class="annot"><span class="hs-identifier">docsWithIntros</span></span><span class="hs-special">,</span><span>
</span><span id="line-67"></span><span>    </span><span class="annot"><span class="hs-identifier">markdown</span></span><span class="hs-special">,</span><span>
</span><span id="line-68"></span><span>    </span><span class="annot"><span class="hs-identifier">singleSample</span></span><span class="hs-special">,</span><span>
</span><span id="line-69"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Servant.OpenApi</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">HasOpenApi</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">toOpenApi</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Servant.Server</span></span><span>
</span><span id="line-72"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">Application</span></span><span class="hs-special">,</span><span>
</span><span id="line-73"></span><span>    </span><span class="annot"><span class="hs-identifier">Handler</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Handler</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-74"></span><span>    </span><span class="annot"><span class="hs-identifier">Server</span></span><span class="hs-special">,</span><span>
</span><span id="line-75"></span><span>    </span><span class="annot"><span class="hs-identifier">ServerError</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-76"></span><span>    </span><span class="annot"><span class="hs-identifier">Tagged</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Tagged</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-77"></span><span>    </span><span class="annot"><span class="hs-identifier">err401</span></span><span class="hs-special">,</span><span>
</span><span id="line-78"></span><span>    </span><span class="annot"><span class="hs-identifier">err404</span></span><span class="hs-special">,</span><span>
</span><span id="line-79"></span><span>    </span><span class="annot"><span class="hs-identifier">hoistServer</span></span><span class="hs-special">,</span><span>
</span><span id="line-80"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Servant.Server.StaticFiles</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">serveDirectoryWebApp</span></span><span class="hs-special">)</span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Directory</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">canonicalizePath</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">doesFileExist</span></span><span class="hs-special">)</span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Environment</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">getExecutablePath</span></span><span class="hs-special">)</span><span>
</span><span id="line-84"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.FilePath</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(&lt;/&gt;)</span></span><span class="hs-special">)</span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">System.FilePath</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">FilePath</span></span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Random.MWC</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">createSystemRandom</span></span><span class="hs-special">)</span><span>
</span><span id="line-87"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Codebase</span></span><span class="hs-special">)</span><span>
</span><span id="line-88"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.Runtime</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Rt</span></span><span>
</span><span id="line-89"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Parser.Ann</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Ann</span></span><span class="hs-special">)</span><span>
</span><span id="line-90"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Prelude</span></span><span>
</span><span id="line-91"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html"><span class="hs-identifier">Unison.Server.Backend</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.Backend.html#Backend"><span class="hs-identifier">Backend</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#BackendEnv"><span class="hs-identifier">BackendEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#%24sel%3ArunBackend%3ABackend"><span class="hs-identifier">runBackend</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-92"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Server.Endpoints.DefinitionSummary.html"><span class="hs-identifier">Unison.Server.Endpoints.DefinitionSummary</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.Endpoints.DefinitionSummary.html#TermSummaryAPI"><span class="hs-identifier">TermSummaryAPI</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Server.Endpoints.DefinitionSummary.html#TypeSummaryAPI"><span class="hs-identifier">TypeSummaryAPI</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Server.Endpoints.DefinitionSummary.html#serveTermSummary"><span class="hs-identifier">serveTermSummary</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Server.Endpoints.DefinitionSummary.html#serveTypeSummary"><span class="hs-identifier">serveTypeSummary</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-93"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Server.Endpoints.FuzzyFind.html"><span class="hs-identifier">Unison.Server.Endpoints.FuzzyFind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.Endpoints.FuzzyFind.html#FuzzyFindAPI"><span class="hs-identifier">FuzzyFindAPI</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Server.Endpoints.FuzzyFind.html#serveFuzzyFind"><span class="hs-identifier">serveFuzzyFind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-94"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Server.Endpoints.GetDefinitions.html"><span class="hs-identifier">Unison.Server.Endpoints.GetDefinitions</span></a></span><span>
</span><span id="line-95"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Unison.Server.Endpoints.GetDefinitions.html#DefinitionsAPI"><span class="hs-identifier">DefinitionsAPI</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-96"></span><span>    </span><span class="annot"><a href="Unison.Server.Endpoints.GetDefinitions.html#serveDefinitions"><span class="hs-identifier">serveDefinitions</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-97"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-98"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Unison.Server.Endpoints.NamespaceDetails.html"><span class="hs-identifier">Unison.Server.Endpoints.NamespaceDetails</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NamespaceDetails</span></span><span>
</span><span id="line-99"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Unison.Server.Endpoints.NamespaceListing.html"><span class="hs-identifier">Unison.Server.Endpoints.NamespaceListing</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NamespaceListing</span></span><span>
</span><span id="line-100"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Unison.Server.Endpoints.Projects.html"><span class="hs-identifier">Unison.Server.Endpoints.Projects</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Projects</span></span><span>
</span><span id="line-101"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Server.Errors.html"><span class="hs-identifier">Unison.Server.Errors</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.Errors.html#backendError"><span class="hs-identifier">backendError</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-102"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Server.Types.html"><span class="hs-identifier">Unison.Server.Types</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.Types.html#mungeString"><span class="hs-identifier">mungeString</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Server.Types.html#setCacheControl"><span class="hs-identifier">setCacheControl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-103"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Symbol</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Symbol</span></span><span class="hs-special">)</span><span>
</span><span id="line-104"></span><span>
</span><span id="line-105"></span><span class="hs-comment">-- HTML content type</span><span>
</span><span id="line-106"></span><span class="hs-keyword">data</span><span> </span><span id="HTML"><span class="annot"><a href="Unison.Server.CodebaseServer.html#HTML"><span class="hs-identifier hs-var">HTML</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="HTML"><span class="annot"><a href="Unison.Server.CodebaseServer.html#HTML"><span class="hs-identifier hs-var">HTML</span></a></span></span><span>
</span><span id="line-107"></span><span>
</span><span id="line-108"></span><span class="hs-keyword">newtype</span><span> </span><span id="RawHtml"><span class="annot"><a href="Unison.Server.CodebaseServer.html#RawHtml"><span class="hs-identifier hs-var">RawHtml</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="RawHtml"><span class="annot"><a href="Unison.Server.CodebaseServer.html#RawHtml"><span class="hs-identifier hs-var">RawHtml</span></a></span></span><span> </span><span class="hs-special">{</span><span id="%24sel%3AunRaw%3ARawHtml"><span class="annot"><span class="annottext">RawHtml -&gt; ByteString
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3AunRaw%3ARawHtml"><span class="hs-identifier hs-var hs-var">unRaw</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Lazy.ByteString</span></span><span class="hs-special">}</span><span>
</span><span id="line-109"></span><span>
</span><span id="line-110"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679317527"><span class="annot"><span class="hs-identifier hs-type">Accept</span></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#HTML"><span class="hs-identifier hs-type">HTML</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-111"></span><span>  </span><span id="local-6989586621679317525"><span class="annot"><span class="annottext">contentType :: Proxy HTML -&gt; MediaType
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">contentType</span></span></span><span> </span><span class="annot"><span class="annottext">Proxy HTML
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;text&quot;</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; MediaType
</span><span class="hs-operator hs-var">//</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;html&quot;</span></span><span> </span><span class="annot"><span class="annottext">MediaType -&gt; (ByteString, ByteString) -&gt; MediaType
</span><span class="hs-operator hs-var">/:</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;charset&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;utf-8&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-112"></span><span>
</span><span id="line-113"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MimeRender</span></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#HTML"><span class="hs-identifier hs-type">HTML</span></a></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#RawHtml"><span class="hs-identifier hs-type">RawHtml</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-114"></span><span>  </span><span id="local-6989586621679317520"><span class="annot"><span class="annottext">mimeRender :: Proxy HTML -&gt; RawHtml -&gt; ByteString
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">mimeRender</span></span></span><span> </span><span class="annot"><span class="annottext">Proxy HTML
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RawHtml -&gt; ByteString
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3AunRaw%3ARawHtml"><span class="hs-identifier hs-var hs-var">unRaw</span></a></span><span>
</span><span id="line-115"></span><span>
</span><span id="line-116"></span><span class="hs-keyword">type</span><span> </span><span id="OpenApiJSON"><span class="annot"><a href="Unison.Server.CodebaseServer.html#OpenApiJSON"><span class="hs-identifier hs-var">OpenApiJSON</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-string">&quot;openapi.json&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Get</span></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">JSON</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-identifier hs-type">OpenApi</span></span><span>
</span><span id="line-117"></span><span>
</span><span id="line-118"></span><span class="hs-keyword">type</span><span> </span><span id="UnisonAndDocsAPI"><span class="annot"><a href="Unison.Server.CodebaseServer.html#UnisonAndDocsAPI"><span class="hs-identifier hs-var">UnisonAndDocsAPI</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#UnisonAPI"><span class="hs-identifier hs-type">UnisonAPI</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&lt;|&gt;</span></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#OpenApiJSON"><span class="hs-identifier hs-type">OpenApiJSON</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&lt;|&gt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Raw</span></span><span>
</span><span id="line-119"></span><span>
</span><span id="line-120"></span><span class="hs-keyword">type</span><span> </span><span id="UnisonAPI"><span class="annot"><a href="Unison.Server.CodebaseServer.html#UnisonAPI"><span class="hs-identifier hs-var">UnisonAPI</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-121"></span><span>  </span><span class="annot"><a href="Unison.Server.Endpoints.NamespaceListing.html#NamespaceListingAPI"><span class="hs-identifier hs-type">NamespaceListing.NamespaceListingAPI</span></a></span><span>
</span><span id="line-122"></span><span>    </span><span class="annot"><span class="hs-operator hs-type">:&lt;|&gt;</span></span><span> </span><span class="annot"><a href="Unison.Server.Endpoints.NamespaceDetails.html#NamespaceDetailsAPI"><span class="hs-identifier hs-type">NamespaceDetails.NamespaceDetailsAPI</span></a></span><span>
</span><span id="line-123"></span><span>    </span><span class="annot"><span class="hs-operator hs-type">:&lt;|&gt;</span></span><span> </span><span class="annot"><a href="Unison.Server.Endpoints.Projects.html#ProjectsAPI"><span class="hs-identifier hs-type">Projects.ProjectsAPI</span></a></span><span>
</span><span id="line-124"></span><span>    </span><span class="annot"><span class="hs-operator hs-type">:&lt;|&gt;</span></span><span> </span><span class="annot"><a href="Unison.Server.Endpoints.GetDefinitions.html#DefinitionsAPI"><span class="hs-identifier hs-type">DefinitionsAPI</span></a></span><span>
</span><span id="line-125"></span><span>    </span><span class="annot"><span class="hs-operator hs-type">:&lt;|&gt;</span></span><span> </span><span class="annot"><a href="Unison.Server.Endpoints.FuzzyFind.html#FuzzyFindAPI"><span class="hs-identifier hs-type">FuzzyFindAPI</span></a></span><span>
</span><span id="line-126"></span><span>    </span><span class="annot"><span class="hs-operator hs-type">:&lt;|&gt;</span></span><span> </span><span class="annot"><a href="Unison.Server.Endpoints.DefinitionSummary.html#TermSummaryAPI"><span class="hs-identifier hs-type">TermSummaryAPI</span></a></span><span>
</span><span id="line-127"></span><span>    </span><span class="annot"><span class="hs-operator hs-type">:&lt;|&gt;</span></span><span> </span><span class="annot"><a href="Unison.Server.Endpoints.DefinitionSummary.html#TypeSummaryAPI"><span class="hs-identifier hs-type">TypeSummaryAPI</span></a></span><span>
</span><span id="line-128"></span><span>
</span><span id="line-129"></span><span class="hs-keyword">type</span><span> </span><span id="WebUI"><span class="annot"><a href="Unison.Server.CodebaseServer.html#WebUI"><span class="hs-identifier hs-var">WebUI</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CaptureAll</span></span><span> </span><span class="annot"><span class="hs-string">&quot;route&quot;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Get</span></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><a href="Unison.Server.CodebaseServer.html#HTML"><span class="hs-identifier hs-type">HTML</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#RawHtml"><span class="hs-identifier hs-type">RawHtml</span></a></span><span>
</span><span id="line-130"></span><span>
</span><span id="line-131"></span><span class="hs-keyword">type</span><span> </span><span id="ServerAPI"><span class="annot"><a href="Unison.Server.CodebaseServer.html#ServerAPI"><span class="hs-identifier hs-var">ServerAPI</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;ui&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#WebUI"><span class="hs-identifier hs-type">WebUI</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">:&lt;|&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;api&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#UnisonAndDocsAPI"><span class="hs-identifier hs-type">UnisonAndDocsAPI</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-132"></span><span>
</span><span id="line-133"></span><span class="hs-keyword">type</span><span> </span><span id="StaticAPI"><span class="annot"><a href="Unison.Server.CodebaseServer.html#StaticAPI"><span class="hs-identifier hs-var">StaticAPI</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-string">&quot;static&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Raw</span></span><span>
</span><span id="line-134"></span><span>
</span><span id="line-135"></span><span class="hs-keyword">type</span><span> </span><span id="Authed"><span class="annot"><a href="Unison.Server.CodebaseServer.html#Authed"><span class="hs-identifier hs-var">Authed</span></a></span></span><span> </span><span id="local-6989586621679317513"><span class="annot"><a href="#local-6989586621679317513"><span class="hs-identifier hs-type">api</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Capture</span></span><span> </span><span class="annot"><span class="hs-string">&quot;token&quot;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621679317513"><span class="hs-identifier hs-type">api</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-136"></span><span>
</span><span id="line-137"></span><span class="hs-keyword">type</span><span> </span><span id="AppAPI"><span class="annot"><a href="Unison.Server.CodebaseServer.html#AppAPI"><span class="hs-identifier hs-var">AppAPI</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#StaticAPI"><span class="hs-identifier hs-type">StaticAPI</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&lt;|&gt;</span></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#Authed"><span class="hs-identifier hs-type">Authed</span></a></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#ServerAPI"><span class="hs-identifier hs-type">ServerAPI</span></a></span><span>
</span><span id="line-138"></span><span>
</span><span id="line-139"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ToSample</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-140"></span><span>  </span><span id="local-6989586621679317510"><span class="annot"><span class="annottext">toSamples :: Proxy Char -&gt; [(Text, Char)]
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">toSamples</span></span></span><span> </span><span class="annot"><span class="annottext">Proxy Char
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; [(Text, Char)]
forall a. a -&gt; [(Text, a)]
</span><span class="hs-identifier hs-var">singleSample</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'x'</span></span><span>
</span><span id="line-141"></span><span>
</span><span id="line-142"></span><span class="hs-comment">-- BaseUrl and helpers</span><span>
</span><span id="line-143"></span><span>
</span><span id="line-144"></span><span class="hs-keyword">data</span><span> </span><span id="BaseUrl"><span class="annot"><a href="Unison.Server.CodebaseServer.html#BaseUrl"><span class="hs-identifier hs-var">BaseUrl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="BaseUrl"><span class="annot"><a href="Unison.Server.CodebaseServer.html#BaseUrl"><span class="hs-identifier hs-var">BaseUrl</span></a></span></span><span>
</span><span id="line-145"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3AurlHost%3ABaseUrl"><span class="annot"><span class="annottext">BaseUrl -&gt; String
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3AurlHost%3ABaseUrl"><span class="hs-identifier hs-var hs-var">urlHost</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">,</span><span>
</span><span id="line-146"></span><span>    </span><span id="%24sel%3AurlToken%3ABaseUrl"><span class="annot"><span class="annottext">BaseUrl -&gt; ByteString
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3AurlToken%3ABaseUrl"><span class="hs-identifier hs-var hs-var">urlToken</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Strict.ByteString</span></span><span class="hs-special">,</span><span>
</span><span id="line-147"></span><span>    </span><span id="%24sel%3AurlPort%3ABaseUrl"><span class="annot"><span class="annottext">BaseUrl -&gt; Port
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3AurlPort%3ABaseUrl"><span class="hs-identifier hs-var hs-var">urlPort</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Port</span></span><span>
</span><span id="line-148"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-149"></span><span>
</span><span id="line-150"></span><span class="hs-keyword">data</span><span> </span><span id="BaseUrlPath"><span class="annot"><a href="Unison.Server.CodebaseServer.html#BaseUrlPath"><span class="hs-identifier hs-var">BaseUrlPath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="UI"><span class="annot"><a href="Unison.Server.CodebaseServer.html#UI"><span class="hs-identifier hs-var">UI</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="Api"><span class="annot"><a href="Unison.Server.CodebaseServer.html#Api"><span class="hs-identifier hs-var">Api</span></a></span></span><span>
</span><span id="line-151"></span><span>
</span><span id="line-152"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679317498"><span id="local-6989586621679317501"><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#BaseUrl"><span class="hs-identifier hs-type">BaseUrl</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-153"></span><span>  </span><span id="local-6989586621679317496"><span class="annot"><span class="annottext">show :: BaseUrl -&gt; String
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">show</span></span></span><span> </span><span id="local-6989586621679317494"><span class="annot"><span class="annottext">BaseUrl
</span><a href="#local-6989586621679317494"><span class="hs-identifier hs-var">url</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BaseUrl -&gt; String
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3AurlHost%3ABaseUrl"><span class="hs-identifier hs-var hs-var">urlHost</span></a></span><span> </span><span class="annot"><span class="annottext">BaseUrl
</span><a href="#local-6989586621679317494"><span class="hs-identifier hs-var">url</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;:&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Port -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BaseUrl -&gt; Port
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3AurlPort%3ABaseUrl"><span class="hs-identifier hs-var hs-var">urlPort</span></a></span><span> </span><span class="annot"><span class="annottext">BaseUrl
</span><a href="#local-6989586621679317494"><span class="hs-identifier hs-var">url</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;/&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShowS
</span><span class="hs-identifier hs-var">URI.encode</span></span><span> </span><span class="annot"><span class="annottext">ShowS -&gt; (BaseUrl -&gt; String) -&gt; BaseUrl -&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; String
</span><span class="hs-identifier hs-var">unpack</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; String)
-&gt; (BaseUrl -&gt; ByteString) -&gt; BaseUrl -&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">BaseUrl -&gt; ByteString
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3AurlToken%3ABaseUrl"><span class="hs-identifier hs-var hs-var">urlToken</span></a></span><span> </span><span class="annot"><span class="annottext">(BaseUrl -&gt; String) -&gt; BaseUrl -&gt; String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BaseUrl
</span><a href="#local-6989586621679317494"><span class="hs-identifier hs-var">url</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-154"></span><span>
</span><span id="line-155"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#urlFor"><span class="hs-identifier hs-type">urlFor</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#BaseUrlPath"><span class="hs-identifier hs-type">BaseUrlPath</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#BaseUrl"><span class="hs-identifier hs-type">BaseUrl</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-156"></span><span id="urlFor"><span class="annot"><span class="annottext">urlFor :: BaseUrlPath -&gt; BaseUrl -&gt; String
</span><a href="Unison.Server.CodebaseServer.html#urlFor"><span class="hs-identifier hs-var hs-var">urlFor</span></a></span></span><span> </span><span id="local-6989586621679317490"><span class="annot"><span class="annottext">BaseUrlPath
</span><a href="#local-6989586621679317490"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span id="local-6989586621679317489"><span class="annot"><span class="annottext">BaseUrl
</span><a href="#local-6989586621679317489"><span class="hs-identifier hs-var">baseUrl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-157"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">BaseUrlPath
</span><a href="#local-6989586621679317490"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-158"></span><span>    </span><span class="annot"><span class="annottext">BaseUrlPath
</span><a href="Unison.Server.CodebaseServer.html#UI"><span class="hs-identifier hs-var">UI</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">BaseUrl -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">BaseUrl
</span><a href="#local-6989586621679317489"><span class="hs-identifier hs-var">baseUrl</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;/ui&quot;</span></span><span>
</span><span id="line-159"></span><span>    </span><span class="annot"><span class="annottext">BaseUrlPath
</span><a href="Unison.Server.CodebaseServer.html#Api"><span class="hs-identifier hs-var">Api</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">BaseUrl -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">BaseUrl
</span><a href="#local-6989586621679317489"><span class="hs-identifier hs-var">baseUrl</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;/api&quot;</span></span><span>
</span><span id="line-160"></span><span>
</span><span id="line-161"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#handleAuth"><span class="hs-identifier hs-type">handleAuth</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Strict.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Handler</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-162"></span><span id="handleAuth"><span class="annot"><span class="annottext">handleAuth :: ByteString -&gt; Text -&gt; Handler ()
</span><a href="Unison.Server.CodebaseServer.html#handleAuth"><span class="hs-identifier hs-var hs-var">handleAuth</span></a></span></span><span> </span><span id="local-6989586621679317487"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679317487"><span class="hs-identifier hs-var">expectedToken</span></a></span></span><span> </span><span id="local-6989586621679317486"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679317486"><span class="hs-identifier hs-var">gotToken</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-163"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Text
</span><span class="hs-identifier hs-var">Text.decodeUtf8</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679317487"><span class="hs-identifier hs-var">expectedToken</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679317486"><span class="hs-identifier hs-var">gotToken</span></a></span><span>
</span><span id="line-164"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">() -&gt; Handler ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-165"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Handler ()
forall (m :: * -&gt; *) a.
MonadError ServerError m =&gt;
ByteString -&gt; m a
</span><a href="#local-6989586621679317484"><span class="hs-identifier hs-var">throw401</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;Authentication token missing or incorrect.&quot;</span></span><span>
</span><span id="line-166"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-167"></span><span>    </span><span id="local-6989586621679317484"><span class="annot"><span class="annottext">throw401 :: ByteString -&gt; m a
</span><a href="#local-6989586621679317484"><span class="hs-identifier hs-var hs-var">throw401</span></a></span></span><span> </span><span id="local-6989586621679317483"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679317483"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ServerError -&gt; m a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(ServerError -&gt; m a) -&gt; ServerError -&gt; m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><span class="hs-identifier hs-var">err401</span></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">errBody :: ByteString
</span><span class="hs-identifier hs-var">errBody</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679317483"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-168"></span><span>
</span><span id="line-169"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#openAPI"><span class="hs-identifier hs-type">openAPI</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">OpenApi</span></span><span>
</span><span id="line-170"></span><span id="openAPI"><span class="annot"><span class="annottext">openAPI :: OpenApi
</span><a href="Unison.Server.CodebaseServer.html#openAPI"><span class="hs-identifier hs-var hs-var">openAPI</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Proxy UnisonAPI -&gt; OpenApi
forall k (api :: k). HasOpenApi api =&gt; Proxy api -&gt; OpenApi
</span><span class="hs-identifier hs-var">toOpenApi</span></span><span> </span><span class="annot"><span class="annottext">Proxy UnisonAPI
</span><a href="Unison.Server.CodebaseServer.html#api"><span class="hs-identifier hs-var">api</span></a></span><span> </span><span class="annot"><span class="annottext">OpenApi -&gt; (OpenApi -&gt; OpenApi) -&gt; OpenApi
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(Info -&gt; Identity Info) -&gt; OpenApi -&gt; Identity OpenApi
forall s a. HasInfo s a =&gt; Lens' s a
</span><span class="hs-identifier hs-var">OpenApi.info</span></span><span> </span><span class="annot"><span class="annottext">((Info -&gt; Identity Info) -&gt; OpenApi -&gt; Identity OpenApi)
-&gt; Info -&gt; OpenApi -&gt; OpenApi
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">Info
</span><a href="Unison.Server.CodebaseServer.html#infoObject"><span class="hs-identifier hs-var">infoObject</span></a></span><span>
</span><span id="line-171"></span><span>
</span><span id="line-172"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#infoObject"><span class="hs-identifier hs-type">infoObject</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Info</span></span><span>
</span><span id="line-173"></span><span id="infoObject"><span class="annot"><span class="annottext">infoObject :: Info
</span><a href="Unison.Server.CodebaseServer.html#infoObject"><span class="hs-identifier hs-var hs-var">infoObject</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-174"></span><span>  </span><span class="annot"><span class="annottext">Info
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-175"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_infoTitle :: Text
</span><span class="hs-identifier hs-var">_infoTitle</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Unison Codebase Manager API&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-176"></span><span>      </span><span class="annot"><span class="annottext">_infoDescription :: Maybe Text
</span><span class="hs-identifier hs-var">_infoDescription</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-177"></span><span>        </span><span class="annot"><span class="annottext">Text -&gt; Maybe Text
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Provides operations for querying and manipulating a Unison codebase.&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-178"></span><span>      </span><span class="annot"><span class="annottext">_infoLicense :: Maybe License
</span><span class="hs-identifier hs-var">_infoLicense</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-179"></span><span>        </span><span class="annot"><span class="annottext">License -&gt; Maybe License
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(License -&gt; Maybe License)
-&gt; (URL -&gt; License) -&gt; URL -&gt; Maybe License
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Maybe URL -&gt; License
</span><span class="hs-identifier hs-var">License</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;MIT&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Maybe URL -&gt; License) -&gt; (URL -&gt; Maybe URL) -&gt; URL -&gt; License
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">URL -&gt; Maybe URL
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(URL -&gt; Maybe License) -&gt; URL -&gt; Maybe License
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-180"></span><span>          </span><span class="annot"><span class="annottext">Text -&gt; URL
</span><span class="hs-identifier hs-var">URL</span></span><span>
</span><span id="line-181"></span><span>            </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;https://github.com/unisonweb/unison/blob/trunk/LICENSE&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-182"></span><span>      </span><span class="annot"><span class="annottext">_infoVersion :: Text
</span><span class="hs-identifier hs-var">_infoVersion</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;1.0&quot;</span></span><span>
</span><span id="line-183"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-184"></span><span>
</span><span id="line-185"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#docsBS"><span class="hs-identifier hs-type">docsBS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Lazy.ByteString</span></span><span>
</span><span id="line-186"></span><span id="docsBS"><span class="annot"><span class="annottext">docsBS :: ByteString
</span><a href="Unison.Server.CodebaseServer.html#docsBS"><span class="hs-identifier hs-var hs-var">docsBS</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; ByteString
</span><a href="Unison.Server.Types.html#mungeString"><span class="hs-identifier hs-var">mungeString</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ByteString) -&gt; (API -&gt; String) -&gt; API -&gt; ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">API -&gt; String
</span><span class="hs-identifier hs-var">markdown</span></span><span> </span><span class="annot"><span class="annottext">(API -&gt; ByteString) -&gt; API -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[DocIntro] -&gt; Proxy UnisonAPI -&gt; API
forall k (api :: k). HasDocs api =&gt; [DocIntro] -&gt; Proxy api -&gt; API
</span><span class="hs-identifier hs-var">docsWithIntros</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">DocIntro
</span><a href="#local-6989586621679317469"><span class="hs-identifier hs-var">intro</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Proxy UnisonAPI
</span><a href="Unison.Server.CodebaseServer.html#api"><span class="hs-identifier hs-var">api</span></a></span><span>
</span><span id="line-187"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-188"></span><span>    </span><span id="local-6989586621679317469"><span class="annot"><span class="annottext">intro :: DocIntro
</span><a href="#local-6989586621679317469"><span class="hs-identifier hs-var hs-var">intro</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-189"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; DocIntro
</span><span class="hs-identifier hs-var">DocIntro</span></span><span>
</span><span id="line-190"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">Text.unpack</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; String) -&gt; Text -&gt; String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Info -&gt; Text
</span><span class="hs-identifier hs-var hs-var">_infoTitle</span></span><span> </span><span class="annot"><span class="annottext">Info
</span><a href="Unison.Server.CodebaseServer.html#infoObject"><span class="hs-identifier hs-var">infoObject</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-191"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe String -&gt; [String]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">(Maybe String -&gt; [String]) -&gt; Maybe String -&gt; [String]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">Text.unpack</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; String) -&gt; Maybe Text -&gt; Maybe String
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Info -&gt; Maybe Text
</span><span class="hs-identifier hs-var hs-var">_infoDescription</span></span><span> </span><span class="annot"><span class="annottext">Info
</span><a href="Unison.Server.CodebaseServer.html#infoObject"><span class="hs-identifier hs-var">infoObject</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-192"></span><span>
</span><span id="line-193"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#unisonAndDocsAPI"><span class="hs-identifier hs-type">unisonAndDocsAPI</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#UnisonAndDocsAPI"><span class="hs-identifier hs-type">UnisonAndDocsAPI</span></a></span><span>
</span><span id="line-194"></span><span id="unisonAndDocsAPI"><span class="annot"><span class="annottext">unisonAndDocsAPI :: Proxy UnisonAndDocsAPI
</span><a href="Unison.Server.CodebaseServer.html#unisonAndDocsAPI"><span class="hs-identifier hs-var hs-var">unisonAndDocsAPI</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Proxy UnisonAndDocsAPI
forall k (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span>
</span><span id="line-195"></span><span>
</span><span id="line-196"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#api"><span class="hs-identifier hs-type">api</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#UnisonAPI"><span class="hs-identifier hs-type">UnisonAPI</span></a></span><span>
</span><span id="line-197"></span><span id="api"><span class="annot"><span class="annottext">api :: Proxy UnisonAPI
</span><a href="Unison.Server.CodebaseServer.html#api"><span class="hs-identifier hs-var hs-var">api</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Proxy UnisonAPI
forall k (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span>
</span><span id="line-198"></span><span>
</span><span id="line-199"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#serverAPI"><span class="hs-identifier hs-type">serverAPI</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#ServerAPI"><span class="hs-identifier hs-type">ServerAPI</span></a></span><span>
</span><span id="line-200"></span><span id="serverAPI"><span class="annot"><span class="annottext">serverAPI :: Proxy ServerAPI
</span><a href="Unison.Server.CodebaseServer.html#serverAPI"><span class="hs-identifier hs-var hs-var">serverAPI</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Proxy ServerAPI
forall k (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span>
</span><span id="line-201"></span><span>
</span><span id="line-202"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#appAPI"><span class="hs-identifier hs-type">appAPI</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#AppAPI"><span class="hs-identifier hs-type">AppAPI</span></a></span><span>
</span><span id="line-203"></span><span id="appAPI"><span class="annot"><span class="annottext">appAPI :: Proxy AppAPI
</span><a href="Unison.Server.CodebaseServer.html#appAPI"><span class="hs-identifier hs-var hs-var">appAPI</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Proxy AppAPI
forall k (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span>
</span><span id="line-204"></span><span>
</span><span id="line-205"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#app"><span class="hs-identifier hs-type">app</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-206"></span><span>  </span><span class="annot"><a href="Unison.Server.Backend.html#BackendEnv"><span class="hs-identifier hs-type">BackendEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-207"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Rt.Runtime</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-208"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-209"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-210"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Strict.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-211"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-212"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Application</span></span><span>
</span><span id="line-213"></span><span id="app"><span class="annot"><span class="annottext">app :: BackendEnv
-&gt; Runtime Symbol
-&gt; Codebase IO Symbol Ann
-&gt; String
-&gt; ByteString
-&gt; Maybe String
-&gt; Application
</span><a href="Unison.Server.CodebaseServer.html#app"><span class="hs-identifier hs-var hs-var">app</span></a></span></span><span> </span><span id="local-6989586621679317459"><span class="annot"><span class="annottext">BackendEnv
</span><a href="#local-6989586621679317459"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621679317458"><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679317458"><span class="hs-identifier hs-var">rt</span></a></span></span><span> </span><span id="local-6989586621679317457"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679317457"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621679317456"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679317456"><span class="hs-identifier hs-var">uiPath</span></a></span></span><span> </span><span id="local-6989586621679317455"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679317455"><span class="hs-identifier hs-var">expectedToken</span></a></span></span><span> </span><span id="local-6989586621679317454"><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621679317454"><span class="hs-identifier hs-var">allowCorsHost</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-214"></span><span>  </span><span class="annot"><span class="annottext">Maybe String -&gt; Middleware
</span><a href="Unison.Server.CodebaseServer.html#corsPolicy"><span class="hs-identifier hs-var">corsPolicy</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621679317454"><span class="hs-identifier hs-var">allowCorsHost</span></a></span><span> </span><span class="annot"><span class="annottext">Middleware -&gt; Middleware
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Proxy AppAPI -&gt; Server AppAPI -&gt; Application
forall api.
HasServer api '[] =&gt;
Proxy api -&gt; Server api -&gt; Application
</span><span class="hs-identifier hs-var">serve</span></span><span> </span><span class="annot"><span class="annottext">Proxy AppAPI
</span><a href="Unison.Server.CodebaseServer.html#appAPI"><span class="hs-identifier hs-var">appAPI</span></a></span><span> </span><span class="annot"><span class="annottext">(Server AppAPI -&gt; Application) -&gt; Server AppAPI -&gt; Application
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BackendEnv
-&gt; Runtime Symbol
-&gt; Codebase IO Symbol Ann
-&gt; String
-&gt; ByteString
-&gt; Server AppAPI
</span><a href="Unison.Server.CodebaseServer.html#server"><span class="hs-identifier hs-var">server</span></a></span><span> </span><span class="annot"><span class="annottext">BackendEnv
</span><a href="#local-6989586621679317459"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679317458"><span class="hs-identifier hs-var">rt</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679317457"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679317456"><span class="hs-identifier hs-var">uiPath</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679317455"><span class="hs-identifier hs-var">expectedToken</span></a></span><span>
</span><span id="line-215"></span><span>
</span><span id="line-216"></span><span class="hs-comment">-- | The Token is used to help prevent multiple users on a machine gain access to</span><span>
</span><span id="line-217"></span><span class="hs-comment">-- each others codebases.</span><span>
</span><span id="line-218"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#genToken"><span class="hs-identifier hs-type">genToken</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Strict.ByteString</span></span><span>
</span><span id="line-219"></span><span id="genToken"><span class="annot"><span class="annottext">genToken :: IO ByteString
</span><a href="Unison.Server.CodebaseServer.html#genToken"><span class="hs-identifier hs-var hs-var">genToken</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-220"></span><span>  </span><span id="local-6989586621679317450"><span class="annot"><span class="annottext">Gen RealWorld
</span><a href="#local-6989586621679317450"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Gen RealWorld)
IO GenIO
</span><span class="hs-identifier hs-var">createSystemRandom</span></span><span>
</span><span id="line-221"></span><span>  </span><span id="local-6989586621679317449"><span class="annot"><span class="annottext">NanoID
</span><a href="#local-6989586621679317449"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Alphabet -&gt; Length -&gt; GenIO -&gt; IO NanoID
</span><span class="hs-identifier hs-var">customNanoID</span></span><span> </span><span class="annot"><span class="annottext">Alphabet
</span><span class="hs-identifier hs-var">defaultAlphabet</span></span><span> </span><span class="annot"><span class="annottext">Length
</span><span class="hs-number">16</span></span><span> </span><span class="annot"><span class="annottext">Gen RealWorld
GenIO
</span><a href="#local-6989586621679317450"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-222"></span><span>  </span><span class="annot"><span class="annottext">ByteString -&gt; IO ByteString
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; IO ByteString) -&gt; ByteString -&gt; IO ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NanoID -&gt; ByteString
</span><span class="hs-identifier hs-var hs-var">unNanoID</span></span><span> </span><span class="annot"><span class="annottext">NanoID
</span><a href="#local-6989586621679317449"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-223"></span><span>
</span><span id="line-224"></span><span class="hs-keyword">data</span><span> </span><span id="Waiter"><span class="annot"><a href="Unison.Server.CodebaseServer.html#Waiter"><span class="hs-identifier hs-var">Waiter</span></a></span></span><span> </span><span id="local-6989586621679317694"><span class="annot"><a href="#local-6989586621679317694"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Waiter"><span class="annot"><a href="Unison.Server.CodebaseServer.html#Waiter"><span class="hs-identifier hs-var">Waiter</span></a></span></span><span>
</span><span id="line-225"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3Anotify%3AWaiter"><span class="annot"><span class="annottext">Waiter a -&gt; a -&gt; IO ()
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3Anotify%3AWaiter"><span class="hs-identifier hs-var hs-var">notify</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679317694"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-226"></span><span>    </span><span id="%24sel%3AwaitFor%3AWaiter"><span class="annot"><span class="annottext">Waiter a -&gt; IO a
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3AwaitFor%3AWaiter"><span class="hs-identifier hs-var hs-var">waitFor</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679317694"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-227"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-228"></span><span>
</span><span id="line-229"></span><span id="local-6989586621679317678"><span class="annot"><a href="Unison.Server.CodebaseServer.html#mkWaiter"><span class="hs-identifier hs-type">mkWaiter</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.CodebaseServer.html#Waiter"><span class="hs-identifier hs-type">Waiter</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679317678"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-230"></span><span id="mkWaiter"><span class="annot"><span class="annottext">mkWaiter :: IO (Waiter a)
</span><a href="Unison.Server.CodebaseServer.html#mkWaiter"><span class="hs-identifier hs-var hs-var">mkWaiter</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-231"></span><span>  </span><span id="local-6989586621679317444"><span class="annot"><span class="annottext">MVar a
</span><a href="#local-6989586621679317444"><span class="hs-identifier hs-var">mvar</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (MVar a)
forall a. IO (MVar a)
</span><span class="hs-identifier hs-var">newEmptyMVar</span></span><span>
</span><span id="line-232"></span><span>  </span><span class="annot"><span class="annottext">Waiter a -&gt; IO (Waiter a)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span>
</span><span id="line-233"></span><span>    </span><span class="annot"><span class="annottext">Waiter :: forall a. (a -&gt; IO ()) -&gt; IO a -&gt; Waiter a
</span><a href="Unison.Server.CodebaseServer.html#Waiter"><span class="hs-identifier hs-type">Waiter</span></a></span><span>
</span><span id="line-234"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:notify:Waiter :: a -&gt; IO ()
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3Anotify%3AWaiter"><span class="hs-identifier hs-var">notify</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MVar a -&gt; a -&gt; IO ()
forall a. MVar a -&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">putMVar</span></span><span> </span><span class="annot"><span class="annottext">MVar a
</span><a href="#local-6989586621679317444"><span class="hs-identifier hs-var">mvar</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-235"></span><span>        </span><span class="annot"><span class="annottext">$sel:waitFor:Waiter :: IO a
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3AwaitFor%3AWaiter"><span class="hs-identifier hs-var">waitFor</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MVar a -&gt; IO a
forall a. MVar a -&gt; IO a
</span><span class="hs-identifier hs-var">readMVar</span></span><span> </span><span class="annot"><span class="annottext">MVar a
</span><a href="#local-6989586621679317444"><span class="hs-identifier hs-var">mvar</span></a></span><span>
</span><span id="line-236"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-237"></span><span>
</span><span id="line-238"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#ucmUIVar"><span class="hs-identifier hs-type">ucmUIVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-239"></span><span id="ucmUIVar"><span class="annot"><span class="annottext">ucmUIVar :: String
</span><a href="Unison.Server.CodebaseServer.html#ucmUIVar"><span class="hs-identifier hs-var hs-var">ucmUIVar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;UCM_WEB_UI&quot;</span></span><span>
</span><span id="line-240"></span><span>
</span><span id="line-241"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#ucmPortVar"><span class="hs-identifier hs-type">ucmPortVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-242"></span><span id="ucmPortVar"><span class="annot"><span class="annottext">ucmPortVar :: String
</span><a href="Unison.Server.CodebaseServer.html#ucmPortVar"><span class="hs-identifier hs-var hs-var">ucmPortVar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;UCM_PORT&quot;</span></span><span>
</span><span id="line-243"></span><span>
</span><span id="line-244"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#ucmHostVar"><span class="hs-identifier hs-type">ucmHostVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-245"></span><span id="ucmHostVar"><span class="annot"><span class="annottext">ucmHostVar :: String
</span><a href="Unison.Server.CodebaseServer.html#ucmHostVar"><span class="hs-identifier hs-var hs-var">ucmHostVar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;UCM_HOST&quot;</span></span><span>
</span><span id="line-246"></span><span>
</span><span id="line-247"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#ucmAllowCorsHost"><span class="hs-identifier hs-type">ucmAllowCorsHost</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-248"></span><span id="ucmAllowCorsHost"><span class="annot"><span class="annottext">ucmAllowCorsHost :: String
</span><a href="Unison.Server.CodebaseServer.html#ucmAllowCorsHost"><span class="hs-identifier hs-var hs-var">ucmAllowCorsHost</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;UCM_ALLOW_CORS_HOST&quot;</span></span><span>
</span><span id="line-249"></span><span>
</span><span id="line-250"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#ucmTokenVar"><span class="hs-identifier hs-type">ucmTokenVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-251"></span><span id="ucmTokenVar"><span class="annot"><span class="annottext">ucmTokenVar :: String
</span><a href="Unison.Server.CodebaseServer.html#ucmTokenVar"><span class="hs-identifier hs-var hs-var">ucmTokenVar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;UCM_TOKEN&quot;</span></span><span>
</span><span id="line-252"></span><span>
</span><span id="line-253"></span><span class="hs-keyword">data</span><span> </span><span id="CodebaseServerOpts"><span class="annot"><a href="Unison.Server.CodebaseServer.html#CodebaseServerOpts"><span class="hs-identifier hs-var">CodebaseServerOpts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="CodebaseServerOpts"><span class="annot"><a href="Unison.Server.CodebaseServer.html#CodebaseServerOpts"><span class="hs-identifier hs-var">CodebaseServerOpts</span></a></span></span><span>
</span><span id="line-254"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3Atoken%3ACodebaseServerOpts"><span class="annot"><span class="annottext">CodebaseServerOpts -&gt; Maybe String
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3Atoken%3ACodebaseServerOpts"><span class="hs-identifier hs-var hs-var">token</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">,</span><span>
</span><span id="line-255"></span><span>    </span><span id="%24sel%3Ahost%3ACodebaseServerOpts"><span class="annot"><span class="annottext">CodebaseServerOpts -&gt; Maybe String
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3Ahost%3ACodebaseServerOpts"><span class="hs-identifier hs-var hs-var">host</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">,</span><span>
</span><span id="line-256"></span><span>    </span><span id="%24sel%3Aport%3ACodebaseServerOpts"><span class="annot"><span class="annottext">CodebaseServerOpts -&gt; Maybe Port
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3Aport%3ACodebaseServerOpts"><span class="hs-identifier hs-var hs-var">port</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span>
</span><span id="line-257"></span><span>    </span><span id="%24sel%3AallowCorsHost%3ACodebaseServerOpts"><span class="annot"><span class="annottext">CodebaseServerOpts -&gt; Maybe String
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3AallowCorsHost%3ACodebaseServerOpts"><span class="hs-identifier hs-var hs-var">allowCorsHost</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">,</span><span>
</span><span id="line-258"></span><span>    </span><span id="%24sel%3AcodebaseUIPath%3ACodebaseServerOpts"><span class="annot"><span class="annottext">CodebaseServerOpts -&gt; Maybe String
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3AcodebaseUIPath%3ACodebaseServerOpts"><span class="hs-identifier hs-var hs-var">codebaseUIPath</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span>
</span><span id="line-259"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-260"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679317427"><span id="local-6989586621679317429"><span id="local-6989586621679317431"><span class="annot"><span class="annottext">Port -&gt; CodebaseServerOpts -&gt; ShowS
[CodebaseServerOpts] -&gt; ShowS
CodebaseServerOpts -&gt; String
(Port -&gt; CodebaseServerOpts -&gt; ShowS)
-&gt; (CodebaseServerOpts -&gt; String)
-&gt; ([CodebaseServerOpts] -&gt; ShowS)
-&gt; Show CodebaseServerOpts
forall a.
(Port -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [CodebaseServerOpts] -&gt; ShowS
$cshowList :: [CodebaseServerOpts] -&gt; ShowS
show :: CodebaseServerOpts -&gt; String
$cshow :: CodebaseServerOpts -&gt; String
showsPrec :: Port -&gt; CodebaseServerOpts -&gt; ShowS
$cshowsPrec :: Port -&gt; CodebaseServerOpts -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679317423"><span id="local-6989586621679317425"><span class="annot"><span class="annottext">CodebaseServerOpts -&gt; CodebaseServerOpts -&gt; Bool
(CodebaseServerOpts -&gt; CodebaseServerOpts -&gt; Bool)
-&gt; (CodebaseServerOpts -&gt; CodebaseServerOpts -&gt; Bool)
-&gt; Eq CodebaseServerOpts
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: CodebaseServerOpts -&gt; CodebaseServerOpts -&gt; Bool
$c/= :: CodebaseServerOpts -&gt; CodebaseServerOpts -&gt; Bool
== :: CodebaseServerOpts -&gt; CodebaseServerOpts -&gt; Bool
$c== :: CodebaseServerOpts -&gt; CodebaseServerOpts -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-261"></span><span>
</span><span id="line-262"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#defaultCodebaseServerOpts"><span class="hs-identifier hs-type">defaultCodebaseServerOpts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#CodebaseServerOpts"><span class="hs-identifier hs-type">CodebaseServerOpts</span></a></span><span>
</span><span id="line-263"></span><span id="defaultCodebaseServerOpts"><span class="annot"><span class="annottext">defaultCodebaseServerOpts :: CodebaseServerOpts
</span><a href="Unison.Server.CodebaseServer.html#defaultCodebaseServerOpts"><span class="hs-identifier hs-var hs-var">defaultCodebaseServerOpts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-264"></span><span>  </span><span class="annot"><span class="annottext">CodebaseServerOpts :: Maybe String
-&gt; Maybe String
-&gt; Maybe Port
-&gt; Maybe String
-&gt; Maybe String
-&gt; CodebaseServerOpts
</span><a href="Unison.Server.CodebaseServer.html#CodebaseServerOpts"><span class="hs-identifier hs-type">CodebaseServerOpts</span></a></span><span>
</span><span id="line-265"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:token:CodebaseServerOpts :: Maybe String
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3Atoken%3ACodebaseServerOpts"><span class="hs-identifier hs-var">token</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe String
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span>
</span><span id="line-266"></span><span>      </span><span class="annot"><span class="annottext">$sel:host:CodebaseServerOpts :: Maybe String
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3Ahost%3ACodebaseServerOpts"><span class="hs-identifier hs-var">host</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe String
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span>
</span><span id="line-267"></span><span>      </span><span class="annot"><span class="annottext">$sel:port:CodebaseServerOpts :: Maybe Port
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3Aport%3ACodebaseServerOpts"><span class="hs-identifier hs-var">port</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Port
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span>
</span><span id="line-268"></span><span>      </span><span class="annot"><span class="annottext">$sel:allowCorsHost:CodebaseServerOpts :: Maybe String
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3AallowCorsHost%3ACodebaseServerOpts"><span class="hs-identifier hs-var">allowCorsHost</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe String
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span>
</span><span id="line-269"></span><span>      </span><span class="annot"><span class="annottext">$sel:codebaseUIPath:CodebaseServerOpts :: Maybe String
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3AcodebaseUIPath%3ACodebaseServerOpts"><span class="hs-identifier hs-var">codebaseUIPath</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe String
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-270"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-271"></span><span>
</span><span id="line-272"></span><span class="hs-comment">-- The auth token required for accessing the server is passed to the function k</span><span>
</span><span id="line-273"></span><span id="local-6989586621679317420"><span class="annot"><a href="Unison.Server.CodebaseServer.html#startServer"><span class="hs-identifier hs-type">startServer</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-274"></span><span>  </span><span class="annot"><a href="Unison.Server.Backend.html#BackendEnv"><span class="hs-identifier hs-type">BackendEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-275"></span><span>  </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#CodebaseServerOpts"><span class="hs-identifier hs-type">CodebaseServerOpts</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-276"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Rt.Runtime</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-277"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-278"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.CodebaseServer.html#BaseUrl"><span class="hs-identifier hs-type">BaseUrl</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679317420"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-279"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679317420"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-280"></span><span id="startServer"><span class="annot"><span class="annottext">startServer :: BackendEnv
-&gt; CodebaseServerOpts
-&gt; Runtime Symbol
-&gt; Codebase IO Symbol Ann
-&gt; (BaseUrl -&gt; IO a)
-&gt; IO a
</span><a href="Unison.Server.CodebaseServer.html#startServer"><span class="hs-identifier hs-var hs-var">startServer</span></a></span></span><span> </span><span id="local-6989586621679317418"><span class="annot"><span class="annottext">BackendEnv
</span><a href="#local-6989586621679317418"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621679317417"><span class="annot"><span class="annottext">CodebaseServerOpts
</span><a href="#local-6989586621679317417"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span id="local-6989586621679317416"><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679317416"><span class="hs-identifier hs-var">rt</span></a></span></span><span> </span><span id="local-6989586621679317415"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679317415"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621679317414"><span class="annot"><span class="annottext">BaseUrl -&gt; IO a
</span><a href="#local-6989586621679317414"><span class="hs-identifier hs-var">onStart</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-281"></span><span>  </span><span class="hs-comment">-- the `canonicalizePath` resolves symlinks</span><span>
</span><span id="line-282"></span><span>  </span><span id="local-6989586621679317413"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679317413"><span class="hs-identifier hs-var">exePath</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO String
</span><span class="hs-identifier hs-var">canonicalizePath</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO String) -&gt; IO String -&gt; IO String
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">IO String
</span><span class="hs-identifier hs-var">getExecutablePath</span></span><span>
</span><span id="line-283"></span><span>  </span><span id="local-6989586621679317411"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679317411"><span class="hs-identifier hs-var">envUI</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO String
</span><span class="hs-identifier hs-var">canonicalizePath</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO String) -&gt; String -&gt; IO String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Maybe String -&gt; String
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShowS
</span><span class="hs-identifier hs-var">FilePath.takeDirectory</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679317413"><span class="hs-identifier hs-var">exePath</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ui&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CodebaseServerOpts -&gt; Maybe String
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3AcodebaseUIPath%3ACodebaseServerOpts"><span class="hs-identifier hs-var hs-var">codebaseUIPath</span></a></span><span> </span><span class="annot"><span class="annottext">CodebaseServerOpts
</span><a href="#local-6989586621679317417"><span class="hs-identifier hs-var">opts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-284"></span><span>  </span><span id="local-6989586621679317408"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679317408"><span class="hs-identifier hs-var">token</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CodebaseServerOpts -&gt; Maybe String
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3Atoken%3ACodebaseServerOpts"><span class="hs-identifier hs-var hs-var">token</span></a></span><span> </span><span class="annot"><span class="annottext">CodebaseServerOpts
</span><a href="#local-6989586621679317417"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-285"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679317407"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679317407"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; IO ByteString
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; IO ByteString) -&gt; ByteString -&gt; IO ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ByteString
</span><span class="hs-identifier hs-var">C8.pack</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679317407"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-286"></span><span>    </span><span class="annot"><span class="annottext">Maybe String
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO ByteString
</span><a href="Unison.Server.CodebaseServer.html#genToken"><span class="hs-identifier hs-var">genToken</span></a></span><span>
</span><span id="line-287"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679317405"><span class="annot"><span class="annottext">baseUrl :: Port -&gt; BaseUrl
</span><a href="#local-6989586621679317405"><span class="hs-identifier hs-var hs-var">baseUrl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; ByteString -&gt; Port -&gt; BaseUrl
</span><a href="Unison.Server.CodebaseServer.html#BaseUrl"><span class="hs-identifier hs-var">BaseUrl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Maybe String -&gt; String
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;http://127.0.0.1&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CodebaseServerOpts -&gt; Maybe String
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3Ahost%3ACodebaseServerOpts"><span class="hs-identifier hs-var hs-var">host</span></a></span><span> </span><span class="annot"><span class="annottext">CodebaseServerOpts
</span><a href="#local-6989586621679317417"><span class="hs-identifier hs-var">opts</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679317408"><span class="hs-identifier hs-var">token</span></a></span><span>
</span><span id="line-288"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679317404"><span class="annot"><span class="annottext">settings :: Settings
</span><a href="#local-6989586621679317404"><span class="hs-identifier hs-var hs-var">settings</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-289"></span><span>        </span><span class="annot"><span class="annottext">Settings
</span><span class="hs-identifier hs-var">defaultSettings</span></span><span>
</span><span id="line-290"></span><span>          </span><span class="annot"><span class="annottext">Settings -&gt; (Settings -&gt; Settings) -&gt; Settings
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(Settings -&gt; Settings)
-&gt; (Port -&gt; Settings -&gt; Settings)
-&gt; Maybe Port
-&gt; Settings
-&gt; Settings
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Settings -&gt; Settings
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">Port -&gt; Settings -&gt; Settings
</span><span class="hs-identifier hs-var">setPort</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CodebaseServerOpts -&gt; Maybe Port
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3Aport%3ACodebaseServerOpts"><span class="hs-identifier hs-var hs-var">port</span></a></span><span> </span><span class="annot"><span class="annottext">CodebaseServerOpts
</span><a href="#local-6989586621679317417"><span class="hs-identifier hs-var">opts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-291"></span><span>          </span><span class="annot"><span class="annottext">Settings -&gt; (Settings -&gt; Settings) -&gt; Settings
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(Settings -&gt; Settings)
-&gt; (String -&gt; Settings -&gt; Settings)
-&gt; Maybe String
-&gt; Settings
-&gt; Settings
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Settings -&gt; Settings
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HostPreference -&gt; Settings -&gt; Settings
</span><span class="hs-identifier hs-var">setHost</span></span><span> </span><span class="annot"><span class="annottext">(HostPreference -&gt; Settings -&gt; Settings)
-&gt; (String -&gt; HostPreference) -&gt; String -&gt; Settings -&gt; Settings
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; HostPreference
forall a. IsString a =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">fromString</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CodebaseServerOpts -&gt; Maybe String
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3Ahost%3ACodebaseServerOpts"><span class="hs-identifier hs-var hs-var">host</span></a></span><span> </span><span class="annot"><span class="annottext">CodebaseServerOpts
</span><a href="#local-6989586621679317417"><span class="hs-identifier hs-var">opts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-292"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679317401"><span class="annot"><span class="annottext">a :: Application
</span><a href="#local-6989586621679317401"><span class="hs-identifier hs-var hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BackendEnv
-&gt; Runtime Symbol
-&gt; Codebase IO Symbol Ann
-&gt; String
-&gt; ByteString
-&gt; Maybe String
-&gt; Application
</span><a href="Unison.Server.CodebaseServer.html#app"><span class="hs-identifier hs-var">app</span></a></span><span> </span><span class="annot"><span class="annottext">BackendEnv
</span><a href="#local-6989586621679317418"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679317416"><span class="hs-identifier hs-var">rt</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679317415"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679317411"><span class="hs-identifier hs-var">envUI</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679317408"><span class="hs-identifier hs-var">token</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CodebaseServerOpts -&gt; Maybe String
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3AallowCorsHost%3ACodebaseServerOpts"><span class="hs-identifier hs-var hs-var">allowCorsHost</span></a></span><span> </span><span class="annot"><span class="annottext">CodebaseServerOpts
</span><a href="#local-6989586621679317417"><span class="hs-identifier hs-var">opts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-293"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CodebaseServerOpts -&gt; Maybe Port
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3Aport%3ACodebaseServerOpts"><span class="hs-identifier hs-var hs-var">port</span></a></span><span> </span><span class="annot"><span class="annottext">CodebaseServerOpts
</span><a href="#local-6989586621679317417"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-294"></span><span>    </span><span class="annot"><span class="annottext">Maybe Port
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Settings -&gt; IO Application -&gt; (Port -&gt; IO a) -&gt; IO a
forall a. Settings -&gt; IO Application -&gt; (Port -&gt; IO a) -&gt; IO a
</span><span class="hs-identifier hs-var">withApplicationSettings</span></span><span> </span><span class="annot"><span class="annottext">Settings
</span><a href="#local-6989586621679317404"><span class="hs-identifier hs-var">settings</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Application -&gt; IO Application
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Application
</span><a href="#local-6989586621679317401"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BaseUrl -&gt; IO a
</span><a href="#local-6989586621679317414"><span class="hs-identifier hs-var">onStart</span></a></span><span> </span><span class="annot"><span class="annottext">(BaseUrl -&gt; IO a) -&gt; (Port -&gt; BaseUrl) -&gt; Port -&gt; IO a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Port -&gt; BaseUrl
</span><a href="#local-6989586621679317405"><span class="hs-identifier hs-var">baseUrl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-295"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679317400"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679317400"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-296"></span><span>      </span><span id="local-6989586621679317399"><span class="annot"><span class="annottext">Waiter ()
</span><a href="#local-6989586621679317399"><span class="hs-identifier hs-var">started</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Waiter ())
forall a. IO (Waiter a)
</span><a href="Unison.Server.CodebaseServer.html#mkWaiter"><span class="hs-identifier hs-var">mkWaiter</span></a></span><span>
</span><span id="line-297"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679317398"><span class="annot"><span class="annottext">settings' :: Settings
</span><a href="#local-6989586621679317398"><span class="hs-identifier hs-var hs-var">settings'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; Settings -&gt; Settings
</span><span class="hs-identifier hs-var">setBeforeMainLoop</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Waiter () -&gt; () -&gt; IO ()
forall a. Waiter a -&gt; a -&gt; IO ()
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3Anotify%3AWaiter"><span class="hs-identifier hs-var hs-var">notify</span></a></span><span> </span><span class="annot"><span class="annottext">Waiter ()
</span><a href="#local-6989586621679317399"><span class="hs-identifier hs-var">started</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Settings
</span><a href="#local-6989586621679317404"><span class="hs-identifier hs-var">settings</span></a></span><span>
</span><span id="line-298"></span><span>      </span><span id="local-6989586621679317397"><span class="annot"><span class="annottext">Either () a
</span><a href="#local-6989586621679317397"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-299"></span><span>        </span><span class="annot"><span class="annottext">IO () -&gt; IO a -&gt; IO (Either () a)
forall a b. IO a -&gt; IO b -&gt; IO (Either a b)
</span><span class="hs-identifier hs-var">race</span></span><span>
</span><span id="line-300"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Settings -&gt; Application -&gt; IO ()
</span><span class="hs-identifier hs-var">runSettings</span></span><span> </span><span class="annot"><span class="annottext">Settings
</span><a href="#local-6989586621679317398"><span class="hs-identifier hs-var">settings'</span></a></span><span> </span><span class="annot"><span class="annottext">Application
</span><a href="#local-6989586621679317401"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-301"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Waiter () -&gt; IO ()
forall a. Waiter a -&gt; IO a
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3AwaitFor%3AWaiter"><span class="hs-identifier hs-var hs-var">waitFor</span></a></span><span> </span><span class="annot"><span class="annottext">Waiter ()
</span><a href="#local-6989586621679317399"><span class="hs-identifier hs-var">started</span></a></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IO a -&gt; IO a
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f b
</span><span class="hs-operator hs-var">*&gt;</span></span><span> </span><span class="annot"><span class="annottext">BaseUrl -&gt; IO a
</span><a href="#local-6989586621679317414"><span class="hs-identifier hs-var">onStart</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Port -&gt; BaseUrl
</span><a href="#local-6989586621679317405"><span class="hs-identifier hs-var">baseUrl</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679317400"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-302"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either () a
</span><a href="#local-6989586621679317397"><span class="hs-identifier hs-var">result</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-303"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ErrorCall -&gt; IO a
forall e a. Exception e =&gt; e -&gt; IO a
</span><span class="hs-identifier hs-var">throwIO</span></span><span> </span><span class="annot"><span class="annottext">(ErrorCall -&gt; IO a) -&gt; ErrorCall -&gt; IO a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ErrorCall
</span><span class="hs-identifier hs-var">ErrorCall</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Server exited unexpectedly!&quot;</span></span><span>
</span><span id="line-304"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679317395"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679317395"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679317395"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-305"></span><span>
</span><span id="line-306"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#serveIndex"><span class="hs-identifier hs-type">serveIndex</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Handler</span></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#RawHtml"><span class="hs-identifier hs-type">RawHtml</span></a></span><span>
</span><span id="line-307"></span><span id="serveIndex"><span class="annot"><span class="annottext">serveIndex :: String -&gt; Handler RawHtml
</span><a href="Unison.Server.CodebaseServer.html#serveIndex"><span class="hs-identifier hs-var hs-var">serveIndex</span></a></span></span><span> </span><span id="local-6989586621679317393"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679317393"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-308"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679317392"><span class="annot"><span class="annottext">index :: String
</span><a href="#local-6989586621679317392"><span class="hs-identifier hs-var hs-var">index</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679317393"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;index.html&quot;</span></span><span>
</span><span id="line-309"></span><span>  </span><span id="local-6989586621679317391"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679317391"><span class="hs-identifier hs-var">exists</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Bool -&gt; Handler Bool
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO Bool -&gt; Handler Bool) -&gt; IO Bool -&gt; Handler Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; IO Bool
</span><span class="hs-identifier hs-var">doesFileExist</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679317392"><span class="hs-identifier hs-var">index</span></a></span><span>
</span><span id="line-310"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679317391"><span class="hs-identifier hs-var">exists</span></a></span><span>
</span><span id="line-311"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; RawHtml) -&gt; Handler ByteString -&gt; Handler RawHtml
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; RawHtml
</span><a href="Unison.Server.CodebaseServer.html#RawHtml"><span class="hs-identifier hs-var">RawHtml</span></a></span><span> </span><span class="annot"><span class="annottext">(Handler ByteString -&gt; Handler RawHtml)
-&gt; (String -&gt; Handler ByteString) -&gt; String -&gt; Handler RawHtml
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">IO ByteString -&gt; Handler ByteString
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO ByteString -&gt; Handler ByteString)
-&gt; (String -&gt; IO ByteString) -&gt; String -&gt; Handler ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; IO ByteString
</span><span class="hs-identifier hs-var">Lazy.readFile</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Handler RawHtml) -&gt; String -&gt; Handler RawHtml
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679317393"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;index.html&quot;</span></span><span>
</span><span id="line-312"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Handler RawHtml
forall a. Handler a
</span><a href="#local-6989586621679317388"><span class="hs-identifier hs-var">fail</span></a></span><span>
</span><span id="line-313"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-314"></span><span>    </span><span id="local-6989586621679317388"><span class="annot"><span class="annottext">fail :: Handler a
</span><a href="#local-6989586621679317388"><span class="hs-identifier hs-var hs-var">fail</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-315"></span><span>      </span><span class="annot"><span class="annottext">ServerError -&gt; Handler a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(ServerError -&gt; Handler a) -&gt; ServerError -&gt; Handler a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-316"></span><span>        </span><span class="annot"><span class="annottext">ServerError
</span><span class="hs-identifier hs-var">err404</span></span><span>
</span><span id="line-317"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">errBody :: ByteString
</span><span class="hs-identifier hs-var">errBody</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-318"></span><span>              </span><span class="annot"><span class="annottext">String -&gt; ByteString
</span><span class="hs-identifier hs-var">BLU.fromString</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ByteString) -&gt; String -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-319"></span><span>                </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;No codebase UI configured.&quot;</span></span><span>
</span><span id="line-320"></span><span>                  </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; Set the &quot;</span></span><span>
</span><span id="line-321"></span><span>                  </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="Unison.Server.CodebaseServer.html#ucmUIVar"><span class="hs-identifier hs-var">ucmUIVar</span></a></span><span>
</span><span id="line-322"></span><span>                  </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; environment variable to the directory where the UI is installed.&quot;</span></span><span>
</span><span id="line-323"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-324"></span><span>
</span><span id="line-325"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#serveUI"><span class="hs-identifier hs-type">serveUI</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Server</span></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#WebUI"><span class="hs-identifier hs-type">WebUI</span></a></span><span>
</span><span id="line-326"></span><span id="serveUI"><span class="annot"><span class="annottext">serveUI :: String -&gt; Server WebUI
</span><a href="Unison.Server.CodebaseServer.html#serveUI"><span class="hs-identifier hs-var hs-var">serveUI</span></a></span></span><span> </span><span id="local-6989586621679317385"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679317385"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Handler RawHtml
</span><a href="Unison.Server.CodebaseServer.html#serveIndex"><span class="hs-identifier hs-var">serveIndex</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679317385"><span class="hs-identifier hs-var">path</span></a></span><span>
</span><span id="line-327"></span><span>
</span><span id="line-328"></span><span class="hs-comment">-- Apply cors if there is allow-cors-host defined</span><span>
</span><span id="line-329"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#corsPolicy"><span class="hs-identifier hs-type">corsPolicy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Middleware</span></span><span>
</span><span id="line-330"></span><span id="corsPolicy"><span class="annot"><span class="annottext">corsPolicy :: Maybe String -&gt; Middleware
</span><a href="Unison.Server.CodebaseServer.html#corsPolicy"><span class="hs-identifier hs-var hs-var">corsPolicy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Middleware -&gt; (String -&gt; Middleware) -&gt; Maybe String -&gt; Middleware
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Middleware
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679317384"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679317384"><span class="hs-identifier hs-var">allowCorsHost</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-331"></span><span>  </span><span class="annot"><span class="annottext">(Request -&gt; Maybe CorsResourcePolicy) -&gt; Middleware
</span><span class="hs-identifier hs-var">cors</span></span><span> </span><span class="annot"><span class="annottext">((Request -&gt; Maybe CorsResourcePolicy) -&gt; Middleware)
-&gt; (Request -&gt; Maybe CorsResourcePolicy) -&gt; Middleware
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-332"></span><span>    </span><span class="annot"><span class="annottext">Maybe CorsResourcePolicy -&gt; Request -&gt; Maybe CorsResourcePolicy
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">(Maybe CorsResourcePolicy -&gt; Request -&gt; Maybe CorsResourcePolicy)
-&gt; Maybe CorsResourcePolicy -&gt; Request -&gt; Maybe CorsResourcePolicy
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-333"></span><span>      </span><span class="annot"><span class="annottext">CorsResourcePolicy -&gt; Maybe CorsResourcePolicy
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span>
</span><span id="line-334"></span><span>        </span><span class="annot"><span class="annottext">CorsResourcePolicy
</span><span class="hs-identifier hs-var">simpleCorsResourcePolicy</span></span><span>
</span><span id="line-335"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">corsMethods :: [ByteString]
</span><span class="hs-identifier hs-var">corsMethods</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;GET&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;OPTIONS&quot;</span></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-336"></span><span>            </span><span class="annot"><span class="annottext">corsOrigins :: Maybe ([ByteString], Bool)
</span><span class="hs-identifier hs-var">corsOrigins</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([ByteString], Bool) -&gt; Maybe ([ByteString], Bool)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="annottext">String -&gt; ByteString
</span><span class="hs-identifier hs-var">C8.pack</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679317384"><span class="hs-identifier hs-var">allowCorsHost</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span>
</span><span id="line-337"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-338"></span><span>
</span><span id="line-339"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#server"><span class="hs-identifier hs-type">server</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-340"></span><span>  </span><span class="annot"><a href="Unison.Server.Backend.html#BackendEnv"><span class="hs-identifier hs-type">BackendEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-341"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Rt.Runtime</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-342"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-343"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-344"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Strict.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-345"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Server</span></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#AppAPI"><span class="hs-identifier hs-type">AppAPI</span></a></span><span>
</span><span id="line-346"></span><span id="server"><span class="annot"><span class="annottext">server :: BackendEnv
-&gt; Runtime Symbol
-&gt; Codebase IO Symbol Ann
-&gt; String
-&gt; ByteString
-&gt; Server AppAPI
</span><a href="Unison.Server.CodebaseServer.html#server"><span class="hs-identifier hs-var hs-var">server</span></a></span></span><span> </span><span id="local-6989586621679317382"><span class="annot"><span class="annottext">BackendEnv
</span><a href="#local-6989586621679317382"><span class="hs-identifier hs-var">backendEnv</span></a></span></span><span> </span><span id="local-6989586621679317381"><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679317381"><span class="hs-identifier hs-var">rt</span></a></span></span><span> </span><span id="local-6989586621679317380"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679317380"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621679317379"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679317379"><span class="hs-identifier hs-var">uiPath</span></a></span></span><span> </span><span id="local-6989586621679317378"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679317378"><span class="hs-identifier hs-var">expectedToken</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-347"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; ServerT Raw Handler
forall (m :: * -&gt; *). String -&gt; ServerT Raw m
</span><span class="hs-identifier hs-var">serveDirectoryWebApp</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679317379"><span class="hs-identifier hs-var">uiPath</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;static&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-348"></span><span>    </span><span class="annot"><span class="annottext">Tagged Handler Application
-&gt; (Text
    -&gt; ([Text] -&gt; Handler RawHtml)
       :&lt;|&gt; (((Maybe ShortCausalHash
               -&gt; Maybe Path
               -&gt; Maybe Path
               -&gt; Handler
                    (Headers '[Header &quot;Cache-Control&quot; String] NamespaceListing))
              :&lt;|&gt; ((Path
                     -&gt; Maybe ShortCausalHash
                     -&gt; Maybe Width
                     -&gt; Handler
                          (Headers '[Header &quot;Cache-Control&quot; String] NamespaceDetails))
                    :&lt;|&gt; ((Maybe ShortCausalHash
                           -&gt; Maybe ProjectOwner
                           -&gt; Handler
                                (Headers '[Header &quot;Cache-Control&quot; String] [ProjectListing]))
                          :&lt;|&gt; ((Maybe ShortCausalHash
                                 -&gt; Maybe Path
                                 -&gt; [HashQualified Name]
                                 -&gt; Maybe Width
                                 -&gt; Maybe Suffixify
                                 -&gt; Handler
                                      (Headers
                                         '[Header &quot;Cache-Control&quot; String] DefinitionDisplayResults))
                                :&lt;|&gt; ((Maybe ShortCausalHash
                                       -&gt; Maybe Path
                                       -&gt; Maybe Port
                                       -&gt; Maybe Width
                                       -&gt; Maybe String
                                       -&gt; Handler
                                            (Headers
                                               '[Header &quot;Cache-Control&quot; String]
                                               [(Alignment, FoundResult)]))
                                      :&lt;|&gt; ((Referent' Reference
                                             -&gt; Maybe Name
                                             -&gt; Maybe ShortCausalHash
                                             -&gt; Maybe Path
                                             -&gt; Maybe Width
                                             -&gt; Handler
                                                  (Headers
                                                     '[Header &quot;Cache-Control&quot; String] TermSummary))
                                            :&lt;|&gt; (Reference
                                                  -&gt; Maybe Name
                                                  -&gt; Maybe ShortCausalHash
                                                  -&gt; Maybe Path
                                                  -&gt; Maybe Width
                                                  -&gt; Handler
                                                       (Headers
                                                          '[Header &quot;Cache-Control&quot; String]
                                                          TypeSummary))))))))
             :&lt;|&gt; (Handler OpenApi :&lt;|&gt; Tagged Handler Application)))
-&gt; Tagged Handler Application
   :&lt;|&gt; (Text
         -&gt; ([Text] -&gt; Handler RawHtml)
            :&lt;|&gt; (((Maybe ShortCausalHash
                    -&gt; Maybe Path
                    -&gt; Maybe Path
                    -&gt; Handler
                         (Headers '[Header &quot;Cache-Control&quot; String] NamespaceListing))
                   :&lt;|&gt; ((Path
                          -&gt; Maybe ShortCausalHash
                          -&gt; Maybe Width
                          -&gt; Handler
                               (Headers '[Header &quot;Cache-Control&quot; String] NamespaceDetails))
                         :&lt;|&gt; ((Maybe ShortCausalHash
                                -&gt; Maybe ProjectOwner
                                -&gt; Handler
                                     (Headers '[Header &quot;Cache-Control&quot; String] [ProjectListing]))
                               :&lt;|&gt; ((Maybe ShortCausalHash
                                      -&gt; Maybe Path
                                      -&gt; [HashQualified Name]
                                      -&gt; Maybe Width
                                      -&gt; Maybe Suffixify
                                      -&gt; Handler
                                           (Headers
                                              '[Header &quot;Cache-Control&quot; String]
                                              DefinitionDisplayResults))
                                     :&lt;|&gt; ((Maybe ShortCausalHash
                                            -&gt; Maybe Path
                                            -&gt; Maybe Port
                                            -&gt; Maybe Width
                                            -&gt; Maybe String
                                            -&gt; Handler
                                                 (Headers
                                                    '[Header &quot;Cache-Control&quot; String]
                                                    [(Alignment, FoundResult)]))
                                           :&lt;|&gt; ((Referent' Reference
                                                  -&gt; Maybe Name
                                                  -&gt; Maybe ShortCausalHash
                                                  -&gt; Maybe Path
                                                  -&gt; Maybe Width
                                                  -&gt; Handler
                                                       (Headers
                                                          '[Header &quot;Cache-Control&quot; String]
                                                          TermSummary))
                                                 :&lt;|&gt; (Reference
                                                       -&gt; Maybe Name
                                                       -&gt; Maybe ShortCausalHash
                                                       -&gt; Maybe Path
                                                       -&gt; Maybe Width
                                                       -&gt; Handler
                                                            (Headers
                                                               '[Header &quot;Cache-Control&quot; String]
                                                               TypeSummary))))))))
                  :&lt;|&gt; (Handler OpenApi :&lt;|&gt; Tagged Handler Application)))
forall a b. a -&gt; b -&gt; a :&lt;|&gt; b
</span><span class="hs-operator hs-var">:&lt;|&gt;</span></span><span> </span><span class="annot"><span class="annottext">Proxy ServerAPI
-&gt; ByteString
-&gt; ServerT ServerAPI Handler
-&gt; ServerT (Authed ServerAPI) Handler
forall api.
HasServer api '[] =&gt;
Proxy api
-&gt; ByteString
-&gt; ServerT api Handler
-&gt; ServerT (Authed api) Handler
</span><a href="Unison.Server.CodebaseServer.html#hoistWithAuth"><span class="hs-identifier hs-var">hoistWithAuth</span></a></span><span> </span><span class="annot"><span class="annottext">Proxy ServerAPI
</span><a href="Unison.Server.CodebaseServer.html#serverAPI"><span class="hs-identifier hs-var">serverAPI</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679317378"><span class="hs-identifier hs-var">expectedToken</span></a></span><span> </span><span class="annot"><span class="annottext">ServerT ServerAPI Handler
</span><a href="#local-6989586621679317375"><span class="hs-identifier hs-var">serveServer</span></a></span><span>
</span><span id="line-349"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-350"></span><span>    </span><span class="annot"><a href="#local-6989586621679317375"><span class="hs-identifier hs-type">serveServer</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Server</span></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#ServerAPI"><span class="hs-identifier hs-type">ServerAPI</span></a></span><span>
</span><span id="line-351"></span><span>    </span><span id="local-6989586621679317375"><span class="annot"><span class="annottext">serveServer :: ServerT ServerAPI Handler
</span><a href="#local-6989586621679317375"><span class="hs-identifier hs-var hs-var">serveServer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-352"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">String -&gt; Server WebUI
</span><a href="Unison.Server.CodebaseServer.html#serveUI"><span class="hs-identifier hs-var">serveUI</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679317379"><span class="hs-identifier hs-var">uiPath</span></a></span><span>
</span><span id="line-353"></span><span>          </span><span class="annot"><span class="annottext">([Text] -&gt; Handler RawHtml)
-&gt; (((Maybe ShortCausalHash
      -&gt; Maybe Path
      -&gt; Maybe Path
      -&gt; Handler
           (Headers '[Header &quot;Cache-Control&quot; String] NamespaceListing))
     :&lt;|&gt; ((Path
            -&gt; Maybe ShortCausalHash
            -&gt; Maybe Width
            -&gt; Handler
                 (Headers '[Header &quot;Cache-Control&quot; String] NamespaceDetails))
           :&lt;|&gt; ((Maybe ShortCausalHash
                  -&gt; Maybe ProjectOwner
                  -&gt; Handler
                       (Headers '[Header &quot;Cache-Control&quot; String] [ProjectListing]))
                 :&lt;|&gt; ((Maybe ShortCausalHash
                        -&gt; Maybe Path
                        -&gt; [HashQualified Name]
                        -&gt; Maybe Width
                        -&gt; Maybe Suffixify
                        -&gt; Handler
                             (Headers
                                '[Header &quot;Cache-Control&quot; String] DefinitionDisplayResults))
                       :&lt;|&gt; ((Maybe ShortCausalHash
                              -&gt; Maybe Path
                              -&gt; Maybe Port
                              -&gt; Maybe Width
                              -&gt; Maybe String
                              -&gt; Handler
                                   (Headers
                                      '[Header &quot;Cache-Control&quot; String] [(Alignment, FoundResult)]))
                             :&lt;|&gt; ((Referent' Reference
                                    -&gt; Maybe Name
                                    -&gt; Maybe ShortCausalHash
                                    -&gt; Maybe Path
                                    -&gt; Maybe Width
                                    -&gt; Handler
                                         (Headers '[Header &quot;Cache-Control&quot; String] TermSummary))
                                   :&lt;|&gt; (Reference
                                         -&gt; Maybe Name
                                         -&gt; Maybe ShortCausalHash
                                         -&gt; Maybe Path
                                         -&gt; Maybe Width
                                         -&gt; Handler
                                              (Headers
                                                 '[Header &quot;Cache-Control&quot; String]
                                                 TypeSummary))))))))
    :&lt;|&gt; (Handler OpenApi :&lt;|&gt; Tagged Handler Application))
-&gt; ([Text] -&gt; Handler RawHtml)
   :&lt;|&gt; (((Maybe ShortCausalHash
           -&gt; Maybe Path
           -&gt; Maybe Path
           -&gt; Handler
                (Headers '[Header &quot;Cache-Control&quot; String] NamespaceListing))
          :&lt;|&gt; ((Path
                 -&gt; Maybe ShortCausalHash
                 -&gt; Maybe Width
                 -&gt; Handler
                      (Headers '[Header &quot;Cache-Control&quot; String] NamespaceDetails))
                :&lt;|&gt; ((Maybe ShortCausalHash
                       -&gt; Maybe ProjectOwner
                       -&gt; Handler
                            (Headers '[Header &quot;Cache-Control&quot; String] [ProjectListing]))
                      :&lt;|&gt; ((Maybe ShortCausalHash
                             -&gt; Maybe Path
                             -&gt; [HashQualified Name]
                             -&gt; Maybe Width
                             -&gt; Maybe Suffixify
                             -&gt; Handler
                                  (Headers
                                     '[Header &quot;Cache-Control&quot; String] DefinitionDisplayResults))
                            :&lt;|&gt; ((Maybe ShortCausalHash
                                   -&gt; Maybe Path
                                   -&gt; Maybe Port
                                   -&gt; Maybe Width
                                   -&gt; Maybe String
                                   -&gt; Handler
                                        (Headers
                                           '[Header &quot;Cache-Control&quot; String]
                                           [(Alignment, FoundResult)]))
                                  :&lt;|&gt; ((Referent' Reference
                                         -&gt; Maybe Name
                                         -&gt; Maybe ShortCausalHash
                                         -&gt; Maybe Path
                                         -&gt; Maybe Width
                                         -&gt; Handler
                                              (Headers
                                                 '[Header &quot;Cache-Control&quot; String] TermSummary))
                                        :&lt;|&gt; (Reference
                                              -&gt; Maybe Name
                                              -&gt; Maybe ShortCausalHash
                                              -&gt; Maybe Path
                                              -&gt; Maybe Width
                                              -&gt; Handler
                                                   (Headers
                                                      '[Header &quot;Cache-Control&quot; String]
                                                      TypeSummary))))))))
         :&lt;|&gt; (Handler OpenApi :&lt;|&gt; Tagged Handler Application))
forall a b. a -&gt; b -&gt; a :&lt;|&gt; b
</span><span class="hs-operator hs-var">:&lt;|&gt;</span></span><span> </span><span class="annot"><span class="annottext">BackendEnv
-&gt; Runtime Symbol
-&gt; Codebase IO Symbol Ann
-&gt; Server UnisonAndDocsAPI
</span><a href="Unison.Server.CodebaseServer.html#serveUnisonAndDocs"><span class="hs-identifier hs-var">serveUnisonAndDocs</span></a></span><span> </span><span class="annot"><span class="annottext">BackendEnv
</span><a href="#local-6989586621679317382"><span class="hs-identifier hs-var">backendEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679317381"><span class="hs-identifier hs-var">rt</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679317380"><span class="hs-identifier hs-var">codebase</span></a></span><span>
</span><span id="line-354"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-355"></span><span>
</span><span id="line-356"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#serveUnisonAndDocs"><span class="hs-identifier hs-type">serveUnisonAndDocs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#BackendEnv"><span class="hs-identifier hs-type">BackendEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Rt.Runtime</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Server</span></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#UnisonAndDocsAPI"><span class="hs-identifier hs-type">UnisonAndDocsAPI</span></a></span><span>
</span><span id="line-357"></span><span id="serveUnisonAndDocs"><span class="annot"><span class="annottext">serveUnisonAndDocs :: BackendEnv
-&gt; Runtime Symbol
-&gt; Codebase IO Symbol Ann
-&gt; Server UnisonAndDocsAPI
</span><a href="Unison.Server.CodebaseServer.html#serveUnisonAndDocs"><span class="hs-identifier hs-var hs-var">serveUnisonAndDocs</span></a></span></span><span> </span><span id="local-6989586621679317373"><span class="annot"><span class="annottext">BackendEnv
</span><a href="#local-6989586621679317373"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621679317372"><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679317372"><span class="hs-identifier hs-var">rt</span></a></span></span><span> </span><span id="local-6989586621679317371"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679317371"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BackendEnv
-&gt; Codebase IO Symbol Ann -&gt; Runtime Symbol -&gt; Server UnisonAPI
</span><a href="Unison.Server.CodebaseServer.html#serveUnison"><span class="hs-identifier hs-var">serveUnison</span></a></span><span> </span><span class="annot"><span class="annottext">BackendEnv
</span><a href="#local-6989586621679317373"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679317371"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679317372"><span class="hs-identifier hs-var">rt</span></a></span><span> </span><span class="annot"><span class="annottext">((Maybe ShortCausalHash
  -&gt; Maybe Path
  -&gt; Maybe Path
  -&gt; Handler
       (Headers '[Header &quot;Cache-Control&quot; String] NamespaceListing))
 :&lt;|&gt; ((Path
        -&gt; Maybe ShortCausalHash
        -&gt; Maybe Width
        -&gt; Handler
             (Headers '[Header &quot;Cache-Control&quot; String] NamespaceDetails))
       :&lt;|&gt; ((Maybe ShortCausalHash
              -&gt; Maybe ProjectOwner
              -&gt; Handler
                   (Headers '[Header &quot;Cache-Control&quot; String] [ProjectListing]))
             :&lt;|&gt; ((Maybe ShortCausalHash
                    -&gt; Maybe Path
                    -&gt; [HashQualified Name]
                    -&gt; Maybe Width
                    -&gt; Maybe Suffixify
                    -&gt; Handler
                         (Headers
                            '[Header &quot;Cache-Control&quot; String] DefinitionDisplayResults))
                   :&lt;|&gt; ((Maybe ShortCausalHash
                          -&gt; Maybe Path
                          -&gt; Maybe Port
                          -&gt; Maybe Width
                          -&gt; Maybe String
                          -&gt; Handler
                               (Headers
                                  '[Header &quot;Cache-Control&quot; String] [(Alignment, FoundResult)]))
                         :&lt;|&gt; ((Referent' Reference
                                -&gt; Maybe Name
                                -&gt; Maybe ShortCausalHash
                                -&gt; Maybe Path
                                -&gt; Maybe Width
                                -&gt; Handler (Headers '[Header &quot;Cache-Control&quot; String] TermSummary))
                               :&lt;|&gt; (Reference
                                     -&gt; Maybe Name
                                     -&gt; Maybe ShortCausalHash
                                     -&gt; Maybe Path
                                     -&gt; Maybe Width
                                     -&gt; Handler
                                          (Headers
                                             '[Header &quot;Cache-Control&quot; String] TypeSummary))))))))
-&gt; (Handler OpenApi :&lt;|&gt; Tagged Handler Application)
-&gt; ((Maybe ShortCausalHash
     -&gt; Maybe Path
     -&gt; Maybe Path
     -&gt; Handler
          (Headers '[Header &quot;Cache-Control&quot; String] NamespaceListing))
    :&lt;|&gt; ((Path
           -&gt; Maybe ShortCausalHash
           -&gt; Maybe Width
           -&gt; Handler
                (Headers '[Header &quot;Cache-Control&quot; String] NamespaceDetails))
          :&lt;|&gt; ((Maybe ShortCausalHash
                 -&gt; Maybe ProjectOwner
                 -&gt; Handler
                      (Headers '[Header &quot;Cache-Control&quot; String] [ProjectListing]))
                :&lt;|&gt; ((Maybe ShortCausalHash
                       -&gt; Maybe Path
                       -&gt; [HashQualified Name]
                       -&gt; Maybe Width
                       -&gt; Maybe Suffixify
                       -&gt; Handler
                            (Headers
                               '[Header &quot;Cache-Control&quot; String] DefinitionDisplayResults))
                      :&lt;|&gt; ((Maybe ShortCausalHash
                             -&gt; Maybe Path
                             -&gt; Maybe Port
                             -&gt; Maybe Width
                             -&gt; Maybe String
                             -&gt; Handler
                                  (Headers
                                     '[Header &quot;Cache-Control&quot; String] [(Alignment, FoundResult)]))
                            :&lt;|&gt; ((Referent' Reference
                                   -&gt; Maybe Name
                                   -&gt; Maybe ShortCausalHash
                                   -&gt; Maybe Path
                                   -&gt; Maybe Width
                                   -&gt; Handler
                                        (Headers '[Header &quot;Cache-Control&quot; String] TermSummary))
                                  :&lt;|&gt; (Reference
                                        -&gt; Maybe Name
                                        -&gt; Maybe ShortCausalHash
                                        -&gt; Maybe Path
                                        -&gt; Maybe Width
                                        -&gt; Handler
                                             (Headers
                                                '[Header &quot;Cache-Control&quot; String] TypeSummary))))))))
   :&lt;|&gt; (Handler OpenApi :&lt;|&gt; Tagged Handler Application)
forall a b. a -&gt; b -&gt; a :&lt;|&gt; b
</span><span class="hs-operator hs-var">:&lt;|&gt;</span></span><span> </span><span class="annot"><span class="annottext">Handler OpenApi
</span><a href="Unison.Server.CodebaseServer.html#serveOpenAPI"><span class="hs-identifier hs-var">serveOpenAPI</span></a></span><span> </span><span class="annot"><span class="annottext">Handler OpenApi
-&gt; Tagged Handler Application
-&gt; Handler OpenApi :&lt;|&gt; Tagged Handler Application
forall a b. a -&gt; b -&gt; a :&lt;|&gt; b
</span><span class="hs-operator hs-var">:&lt;|&gt;</span></span><span> </span><span class="annot"><span class="annottext">Application -&gt; Tagged Handler Application
forall k (s :: k) b. b -&gt; Tagged s b
</span><span class="hs-identifier hs-var">Tagged</span></span><span> </span><span class="annot"><span class="annottext">Application
</span><a href="Unison.Server.CodebaseServer.html#serveDocs"><span class="hs-identifier hs-var">serveDocs</span></a></span><span>
</span><span id="line-358"></span><span>
</span><span id="line-359"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#serveDocs"><span class="hs-identifier hs-type">serveDocs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Application</span></span><span>
</span><span id="line-360"></span><span id="serveDocs"><span class="annot"><span class="annottext">serveDocs :: Application
</span><a href="Unison.Server.CodebaseServer.html#serveDocs"><span class="hs-identifier hs-var hs-var">serveDocs</span></a></span></span><span> </span><span class="annot"><span class="annottext">Request
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679317367"><span class="annot"><span class="annottext">Response -&gt; IO ResponseReceived
</span><a href="#local-6989586621679317367"><span class="hs-identifier hs-var">respond</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Response -&gt; IO ResponseReceived
</span><a href="#local-6989586621679317367"><span class="hs-identifier hs-var">respond</span></a></span><span> </span><span class="annot"><span class="annottext">(Response -&gt; IO ResponseReceived)
-&gt; Response -&gt; IO ResponseReceived
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Status -&gt; ResponseHeaders -&gt; ByteString -&gt; Response
</span><span class="hs-identifier hs-var">responseLBS</span></span><span> </span><span class="annot"><span class="annottext">Status
</span><span class="hs-identifier hs-var">ok200</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">(HeaderName, ByteString)
</span><a href="#local-6989586621679317366"><span class="hs-identifier hs-var">plain</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="Unison.Server.CodebaseServer.html#docsBS"><span class="hs-identifier hs-var">docsBS</span></a></span><span>
</span><span id="line-361"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-362"></span><span>    </span><span class="annot"><a href="#local-6989586621679317366"><span class="hs-identifier hs-type">plain</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HeaderName</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span class="hs-special">)</span><span>
</span><span id="line-363"></span><span>    </span><span id="local-6989586621679317366"><span class="annot"><span class="annottext">plain :: (HeaderName, ByteString)
</span><a href="#local-6989586621679317366"><span class="hs-identifier hs-var hs-var">plain</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HeaderName
</span><span class="hs-string">&quot;Content-Type&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;text/plain&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-364"></span><span>
</span><span id="line-365"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#serveOpenAPI"><span class="hs-identifier hs-type">serveOpenAPI</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Handler</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">OpenApi</span></span><span>
</span><span id="line-366"></span><span id="serveOpenAPI"><span class="annot"><span class="annottext">serveOpenAPI :: Handler OpenApi
</span><a href="Unison.Server.CodebaseServer.html#serveOpenAPI"><span class="hs-identifier hs-var hs-var">serveOpenAPI</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OpenApi -&gt; Handler OpenApi
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">OpenApi
</span><a href="Unison.Server.CodebaseServer.html#openAPI"><span class="hs-identifier hs-var">openAPI</span></a></span><span>
</span><span id="line-367"></span><span>
</span><span id="line-368"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#hoistWithAuth"><span class="hs-identifier hs-type">hoistWithAuth</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679317630"><span class="annot"><a href="#local-6989586621679317630"><span class="hs-identifier hs-type">api</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HasServer</span></span><span> </span><span class="annot"><a href="#local-6989586621679317630"><span class="hs-identifier hs-type">api</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="#local-6989586621679317630"><span class="hs-identifier hs-type">api</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ServerT</span></span><span> </span><span class="annot"><a href="#local-6989586621679317630"><span class="hs-identifier hs-type">api</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Handler</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ServerT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.CodebaseServer.html#Authed"><span class="hs-identifier hs-type">Authed</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679317630"><span class="hs-identifier hs-type">api</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Handler</span></span><span>
</span><span id="line-369"></span><span id="hoistWithAuth"><span class="annot"><span class="annottext">hoistWithAuth :: Proxy api
-&gt; ByteString
-&gt; ServerT api Handler
-&gt; ServerT (Authed api) Handler
</span><a href="Unison.Server.CodebaseServer.html#hoistWithAuth"><span class="hs-identifier hs-var hs-var">hoistWithAuth</span></a></span></span><span> </span><span id="local-6989586621679317365"><span class="annot"><span class="annottext">Proxy api
</span><a href="#local-6989586621679317365"><span class="hs-identifier hs-var">api</span></a></span></span><span> </span><span id="local-6989586621679317364"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679317364"><span class="hs-identifier hs-var">expectedToken</span></a></span></span><span> </span><span id="local-6989586621679317363"><span class="annot"><span class="annottext">ServerT api Handler
</span><a href="#local-6989586621679317363"><span class="hs-identifier hs-var">server</span></a></span></span><span> </span><span id="local-6989586621679317362"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679317362"><span class="hs-identifier hs-var">token</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Proxy api
-&gt; (forall x. Handler x -&gt; Handler x)
-&gt; ServerT api Handler
-&gt; ServerT api Handler
forall api (m :: * -&gt; *) (n :: * -&gt; *).
HasServer api '[] =&gt;
Proxy api
-&gt; (forall x. m x -&gt; n x) -&gt; ServerT api m -&gt; ServerT api n
</span><span class="hs-identifier hs-var">hoistServer</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679317630"><span class="hs-identifier hs-type">api</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">Handler</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">Handler</span></span><span> </span><span class="annot"><span class="annottext">Proxy api
</span><a href="#local-6989586621679317365"><span class="hs-identifier hs-var">api</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679317361"><span class="annot"><span class="annottext">Handler x
</span><a href="#local-6989586621679317361"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Text -&gt; Handler ()
</span><a href="Unison.Server.CodebaseServer.html#handleAuth"><span class="hs-identifier hs-var">handleAuth</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679317364"><span class="hs-identifier hs-var">expectedToken</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679317362"><span class="hs-identifier hs-var">token</span></a></span><span> </span><span class="annot"><span class="annottext">Handler () -&gt; Handler x -&gt; Handler x
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f b
</span><span class="hs-operator hs-var">*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Handler x
</span><a href="#local-6989586621679317361"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ServerT api Handler
</span><a href="#local-6989586621679317363"><span class="hs-identifier hs-var">server</span></a></span><span>
</span><span id="line-370"></span><span>
</span><span id="line-371"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#serveUnison"><span class="hs-identifier hs-type">serveUnison</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-372"></span><span>  </span><span class="annot"><a href="Unison.Server.Backend.html#BackendEnv"><span class="hs-identifier hs-type">BackendEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-373"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-374"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Rt.Runtime</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-375"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Server</span></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#UnisonAPI"><span class="hs-identifier hs-type">UnisonAPI</span></a></span><span>
</span><span id="line-376"></span><span id="serveUnison"><span class="annot"><span class="annottext">serveUnison :: BackendEnv
-&gt; Codebase IO Symbol Ann -&gt; Runtime Symbol -&gt; Server UnisonAPI
</span><a href="Unison.Server.CodebaseServer.html#serveUnison"><span class="hs-identifier hs-var hs-var">serveUnison</span></a></span></span><span> </span><span id="local-6989586621679317360"><span class="annot"><span class="annottext">BackendEnv
</span><a href="#local-6989586621679317360"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621679317359"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679317359"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621679317358"><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679317358"><span class="hs-identifier hs-var">rt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-377"></span><span>  </span><span class="annot"><span class="annottext">Proxy UnisonAPI
-&gt; (forall x. Backend IO x -&gt; Handler x)
-&gt; ServerT UnisonAPI (Backend IO)
-&gt; Server UnisonAPI
forall api (m :: * -&gt; *) (n :: * -&gt; *).
HasServer api '[] =&gt;
Proxy api
-&gt; (forall x. m x -&gt; n x) -&gt; ServerT api m -&gt; ServerT api n
</span><span class="hs-identifier hs-var">hoistServer</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy UnisonAPI
forall k (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Unison.Server.CodebaseServer.html#UnisonAPI"><span class="hs-identifier hs-type">UnisonAPI</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BackendEnv -&gt; Backend IO x -&gt; Handler x
forall a. BackendEnv -&gt; Backend IO a -&gt; Handler a
</span><a href="Unison.Server.CodebaseServer.html#backendHandler"><span class="hs-identifier hs-var">backendHandler</span></a></span><span> </span><span class="annot"><span class="annottext">BackendEnv
</span><a href="#local-6989586621679317360"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ServerT UnisonAPI (Backend IO) -&gt; Server UnisonAPI)
-&gt; ServerT UnisonAPI (Backend IO) -&gt; Server UnisonAPI
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-378"></span><span>    </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679317356"><span class="annot"><span class="annottext">Maybe ShortCausalHash
</span><a href="#local-6989586621679317356"><span class="hs-identifier hs-var">root</span></a></span></span><span> </span><span id="local-6989586621679317355"><span class="annot"><span class="annottext">Maybe Path
</span><a href="#local-6989586621679317355"><span class="hs-identifier hs-var">rel</span></a></span></span><span> </span><span id="local-6989586621679317354"><span class="annot"><span class="annottext">Maybe Path
</span><a href="#local-6989586621679317354"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NamespaceListing
-&gt; Headers '[Header &quot;Cache-Control&quot; String] NamespaceListing
forall v. v -&gt; APIHeaders v
</span><a href="Unison.Server.Types.html#setCacheControl"><span class="hs-identifier hs-var">setCacheControl</span></a></span><span> </span><span class="annot"><span class="annottext">(NamespaceListing
 -&gt; Headers '[Header &quot;Cache-Control&quot; String] NamespaceListing)
-&gt; Backend IO NamespaceListing
-&gt; Backend
     IO (Headers '[Header &quot;Cache-Control&quot; String] NamespaceListing)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; Maybe (Either ShortCausalHash CausalHash)
-&gt; Maybe Path
-&gt; Maybe Path
-&gt; Backend IO NamespaceListing
</span><a href="Unison.Server.Endpoints.NamespaceListing.html#serve"><span class="hs-identifier hs-var">NamespaceListing.serve</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679317359"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShortCausalHash -&gt; Either ShortCausalHash CausalHash
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(ShortCausalHash -&gt; Either ShortCausalHash CausalHash)
-&gt; Maybe ShortCausalHash
-&gt; Maybe (Either ShortCausalHash CausalHash)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe ShortCausalHash
</span><a href="#local-6989586621679317356"><span class="hs-identifier hs-var">root</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Path
</span><a href="#local-6989586621679317355"><span class="hs-identifier hs-var">rel</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Path
</span><a href="#local-6989586621679317354"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-379"></span><span>      </span><span class="annot"><span class="annottext">(Maybe ShortCausalHash
 -&gt; Maybe Path
 -&gt; Maybe Path
 -&gt; Backend
      IO (Headers '[Header &quot;Cache-Control&quot; String] NamespaceListing))
-&gt; ((Path
     -&gt; Maybe ShortCausalHash
     -&gt; Maybe Width
     -&gt; Backend
          IO (Headers '[Header &quot;Cache-Control&quot; String] NamespaceDetails))
    :&lt;|&gt; ((Maybe ShortCausalHash
           -&gt; Maybe ProjectOwner
           -&gt; Backend
                IO (Headers '[Header &quot;Cache-Control&quot; String] [ProjectListing]))
          :&lt;|&gt; ((Maybe ShortCausalHash
                 -&gt; Maybe Path
                 -&gt; [HashQualified Name]
                 -&gt; Maybe Width
                 -&gt; Maybe Suffixify
                 -&gt; Backend
                      IO
                      (Headers
                         '[Header &quot;Cache-Control&quot; String] DefinitionDisplayResults))
                :&lt;|&gt; ((Maybe ShortCausalHash
                       -&gt; Maybe Path
                       -&gt; Maybe Port
                       -&gt; Maybe Width
                       -&gt; Maybe String
                       -&gt; Backend
                            IO
                            (Headers
                               '[Header &quot;Cache-Control&quot; String] [(Alignment, FoundResult)]))
                      :&lt;|&gt; ((Referent' Reference
                             -&gt; Maybe Name
                             -&gt; Maybe ShortCausalHash
                             -&gt; Maybe Path
                             -&gt; Maybe Width
                             -&gt; Backend
                                  IO (Headers '[Header &quot;Cache-Control&quot; String] TermSummary))
                            :&lt;|&gt; (Reference
                                  -&gt; Maybe Name
                                  -&gt; Maybe ShortCausalHash
                                  -&gt; Maybe Path
                                  -&gt; Maybe Width
                                  -&gt; Backend
                                       IO
                                       (Headers '[Header &quot;Cache-Control&quot; String] TypeSummary)))))))
-&gt; (Maybe ShortCausalHash
    -&gt; Maybe Path
    -&gt; Maybe Path
    -&gt; Backend
         IO (Headers '[Header &quot;Cache-Control&quot; String] NamespaceListing))
   :&lt;|&gt; ((Path
          -&gt; Maybe ShortCausalHash
          -&gt; Maybe Width
          -&gt; Backend
               IO (Headers '[Header &quot;Cache-Control&quot; String] NamespaceDetails))
         :&lt;|&gt; ((Maybe ShortCausalHash
                -&gt; Maybe ProjectOwner
                -&gt; Backend
                     IO (Headers '[Header &quot;Cache-Control&quot; String] [ProjectListing]))
               :&lt;|&gt; ((Maybe ShortCausalHash
                      -&gt; Maybe Path
                      -&gt; [HashQualified Name]
                      -&gt; Maybe Width
                      -&gt; Maybe Suffixify
                      -&gt; Backend
                           IO
                           (Headers
                              '[Header &quot;Cache-Control&quot; String] DefinitionDisplayResults))
                     :&lt;|&gt; ((Maybe ShortCausalHash
                            -&gt; Maybe Path
                            -&gt; Maybe Port
                            -&gt; Maybe Width
                            -&gt; Maybe String
                            -&gt; Backend
                                 IO
                                 (Headers
                                    '[Header &quot;Cache-Control&quot; String] [(Alignment, FoundResult)]))
                           :&lt;|&gt; ((Referent' Reference
                                  -&gt; Maybe Name
                                  -&gt; Maybe ShortCausalHash
                                  -&gt; Maybe Path
                                  -&gt; Maybe Width
                                  -&gt; Backend
                                       IO (Headers '[Header &quot;Cache-Control&quot; String] TermSummary))
                                 :&lt;|&gt; (Reference
                                       -&gt; Maybe Name
                                       -&gt; Maybe ShortCausalHash
                                       -&gt; Maybe Path
                                       -&gt; Maybe Width
                                       -&gt; Backend
                                            IO
                                            (Headers
                                               '[Header &quot;Cache-Control&quot; String] TypeSummary)))))))
forall a b. a -&gt; b -&gt; a :&lt;|&gt; b
</span><span class="hs-operator hs-var">:&lt;|&gt;</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679317352"><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679317352"><span class="hs-identifier hs-var">namespaceName</span></a></span></span><span> </span><span id="local-6989586621679317351"><span class="annot"><span class="annottext">Maybe ShortCausalHash
</span><a href="#local-6989586621679317351"><span class="hs-identifier hs-var">mayRoot</span></a></span></span><span> </span><span id="local-6989586621679317350"><span class="annot"><span class="annottext">Maybe Width
</span><a href="#local-6989586621679317350"><span class="hs-identifier hs-var">renderWidth</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NamespaceDetails
-&gt; Headers '[Header &quot;Cache-Control&quot; String] NamespaceDetails
forall v. v -&gt; APIHeaders v
</span><a href="Unison.Server.Types.html#setCacheControl"><span class="hs-identifier hs-var">setCacheControl</span></a></span><span> </span><span class="annot"><span class="annottext">(NamespaceDetails
 -&gt; Headers '[Header &quot;Cache-Control&quot; String] NamespaceDetails)
-&gt; Backend IO NamespaceDetails
-&gt; Backend
     IO (Headers '[Header &quot;Cache-Control&quot; String] NamespaceDetails)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Runtime Symbol
-&gt; Codebase IO Symbol Ann
-&gt; Path
-&gt; Maybe (Either ShortCausalHash CausalHash)
-&gt; Maybe Width
-&gt; Backend IO NamespaceDetails
</span><a href="Unison.Server.Endpoints.NamespaceDetails.html#namespaceDetails"><span class="hs-identifier hs-var">NamespaceDetails.namespaceDetails</span></a></span><span> </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679317358"><span class="hs-identifier hs-var">rt</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679317359"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679317352"><span class="hs-identifier hs-var">namespaceName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShortCausalHash -&gt; Either ShortCausalHash CausalHash
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(ShortCausalHash -&gt; Either ShortCausalHash CausalHash)
-&gt; Maybe ShortCausalHash
-&gt; Maybe (Either ShortCausalHash CausalHash)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe ShortCausalHash
</span><a href="#local-6989586621679317351"><span class="hs-identifier hs-var">mayRoot</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Width
</span><a href="#local-6989586621679317350"><span class="hs-identifier hs-var">renderWidth</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-380"></span><span>      </span><span class="annot"><span class="annottext">(Path
 -&gt; Maybe ShortCausalHash
 -&gt; Maybe Width
 -&gt; Backend
      IO (Headers '[Header &quot;Cache-Control&quot; String] NamespaceDetails))
-&gt; ((Maybe ShortCausalHash
     -&gt; Maybe ProjectOwner
     -&gt; Backend
          IO (Headers '[Header &quot;Cache-Control&quot; String] [ProjectListing]))
    :&lt;|&gt; ((Maybe ShortCausalHash
           -&gt; Maybe Path
           -&gt; [HashQualified Name]
           -&gt; Maybe Width
           -&gt; Maybe Suffixify
           -&gt; Backend
                IO
                (Headers
                   '[Header &quot;Cache-Control&quot; String] DefinitionDisplayResults))
          :&lt;|&gt; ((Maybe ShortCausalHash
                 -&gt; Maybe Path
                 -&gt; Maybe Port
                 -&gt; Maybe Width
                 -&gt; Maybe String
                 -&gt; Backend
                      IO
                      (Headers
                         '[Header &quot;Cache-Control&quot; String] [(Alignment, FoundResult)]))
                :&lt;|&gt; ((Referent' Reference
                       -&gt; Maybe Name
                       -&gt; Maybe ShortCausalHash
                       -&gt; Maybe Path
                       -&gt; Maybe Width
                       -&gt; Backend
                            IO (Headers '[Header &quot;Cache-Control&quot; String] TermSummary))
                      :&lt;|&gt; (Reference
                            -&gt; Maybe Name
                            -&gt; Maybe ShortCausalHash
                            -&gt; Maybe Path
                            -&gt; Maybe Width
                            -&gt; Backend
                                 IO (Headers '[Header &quot;Cache-Control&quot; String] TypeSummary))))))
-&gt; (Path
    -&gt; Maybe ShortCausalHash
    -&gt; Maybe Width
    -&gt; Backend
         IO (Headers '[Header &quot;Cache-Control&quot; String] NamespaceDetails))
   :&lt;|&gt; ((Maybe ShortCausalHash
          -&gt; Maybe ProjectOwner
          -&gt; Backend
               IO (Headers '[Header &quot;Cache-Control&quot; String] [ProjectListing]))
         :&lt;|&gt; ((Maybe ShortCausalHash
                -&gt; Maybe Path
                -&gt; [HashQualified Name]
                -&gt; Maybe Width
                -&gt; Maybe Suffixify
                -&gt; Backend
                     IO
                     (Headers
                        '[Header &quot;Cache-Control&quot; String] DefinitionDisplayResults))
               :&lt;|&gt; ((Maybe ShortCausalHash
                      -&gt; Maybe Path
                      -&gt; Maybe Port
                      -&gt; Maybe Width
                      -&gt; Maybe String
                      -&gt; Backend
                           IO
                           (Headers
                              '[Header &quot;Cache-Control&quot; String] [(Alignment, FoundResult)]))
                     :&lt;|&gt; ((Referent' Reference
                            -&gt; Maybe Name
                            -&gt; Maybe ShortCausalHash
                            -&gt; Maybe Path
                            -&gt; Maybe Width
                            -&gt; Backend
                                 IO (Headers '[Header &quot;Cache-Control&quot; String] TermSummary))
                           :&lt;|&gt; (Reference
                                 -&gt; Maybe Name
                                 -&gt; Maybe ShortCausalHash
                                 -&gt; Maybe Path
                                 -&gt; Maybe Width
                                 -&gt; Backend
                                      IO (Headers '[Header &quot;Cache-Control&quot; String] TypeSummary))))))
forall a b. a -&gt; b -&gt; a :&lt;|&gt; b
</span><span class="hs-operator hs-var">:&lt;|&gt;</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679317348"><span class="annot"><span class="annottext">Maybe ShortCausalHash
</span><a href="#local-6989586621679317348"><span class="hs-identifier hs-var">mayRoot</span></a></span></span><span> </span><span id="local-6989586621679317347"><span class="annot"><span class="annottext">Maybe ProjectOwner
</span><a href="#local-6989586621679317347"><span class="hs-identifier hs-var">mayOwner</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[ProjectListing]
-&gt; Headers '[Header &quot;Cache-Control&quot; String] [ProjectListing]
forall v. v -&gt; APIHeaders v
</span><a href="Unison.Server.Types.html#setCacheControl"><span class="hs-identifier hs-var">setCacheControl</span></a></span><span> </span><span class="annot"><span class="annottext">([ProjectListing]
 -&gt; Headers '[Header &quot;Cache-Control&quot; String] [ProjectListing])
-&gt; Backend IO [ProjectListing]
-&gt; Backend
     IO (Headers '[Header &quot;Cache-Control&quot; String] [ProjectListing])
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; Maybe (Either ShortCausalHash CausalHash)
-&gt; Maybe ProjectOwner
-&gt; Backend IO [ProjectListing]
forall (m :: * -&gt; *).
MonadIO m =&gt;
Codebase m Symbol Ann
-&gt; Maybe (Either ShortCausalHash CausalHash)
-&gt; Maybe ProjectOwner
-&gt; Backend m [ProjectListing]
</span><a href="Unison.Server.Endpoints.Projects.html#serve"><span class="hs-identifier hs-var">Projects.serve</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679317359"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShortCausalHash -&gt; Either ShortCausalHash CausalHash
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(ShortCausalHash -&gt; Either ShortCausalHash CausalHash)
-&gt; Maybe ShortCausalHash
-&gt; Maybe (Either ShortCausalHash CausalHash)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe ShortCausalHash
</span><a href="#local-6989586621679317348"><span class="hs-identifier hs-var">mayRoot</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe ProjectOwner
</span><a href="#local-6989586621679317347"><span class="hs-identifier hs-var">mayOwner</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-381"></span><span>      </span><span class="annot"><span class="annottext">(Maybe ShortCausalHash
 -&gt; Maybe ProjectOwner
 -&gt; Backend
      IO (Headers '[Header &quot;Cache-Control&quot; String] [ProjectListing]))
-&gt; ((Maybe ShortCausalHash
     -&gt; Maybe Path
     -&gt; [HashQualified Name]
     -&gt; Maybe Width
     -&gt; Maybe Suffixify
     -&gt; Backend
          IO
          (Headers
             '[Header &quot;Cache-Control&quot; String] DefinitionDisplayResults))
    :&lt;|&gt; ((Maybe ShortCausalHash
           -&gt; Maybe Path
           -&gt; Maybe Port
           -&gt; Maybe Width
           -&gt; Maybe String
           -&gt; Backend
                IO
                (Headers
                   '[Header &quot;Cache-Control&quot; String] [(Alignment, FoundResult)]))
          :&lt;|&gt; ((Referent' Reference
                 -&gt; Maybe Name
                 -&gt; Maybe ShortCausalHash
                 -&gt; Maybe Path
                 -&gt; Maybe Width
                 -&gt; Backend
                      IO (Headers '[Header &quot;Cache-Control&quot; String] TermSummary))
                :&lt;|&gt; (Reference
                      -&gt; Maybe Name
                      -&gt; Maybe ShortCausalHash
                      -&gt; Maybe Path
                      -&gt; Maybe Width
                      -&gt; Backend
                           IO (Headers '[Header &quot;Cache-Control&quot; String] TypeSummary)))))
-&gt; (Maybe ShortCausalHash
    -&gt; Maybe ProjectOwner
    -&gt; Backend
         IO (Headers '[Header &quot;Cache-Control&quot; String] [ProjectListing]))
   :&lt;|&gt; ((Maybe ShortCausalHash
          -&gt; Maybe Path
          -&gt; [HashQualified Name]
          -&gt; Maybe Width
          -&gt; Maybe Suffixify
          -&gt; Backend
               IO
               (Headers
                  '[Header &quot;Cache-Control&quot; String] DefinitionDisplayResults))
         :&lt;|&gt; ((Maybe ShortCausalHash
                -&gt; Maybe Path
                -&gt; Maybe Port
                -&gt; Maybe Width
                -&gt; Maybe String
                -&gt; Backend
                     IO
                     (Headers
                        '[Header &quot;Cache-Control&quot; String] [(Alignment, FoundResult)]))
               :&lt;|&gt; ((Referent' Reference
                      -&gt; Maybe Name
                      -&gt; Maybe ShortCausalHash
                      -&gt; Maybe Path
                      -&gt; Maybe Width
                      -&gt; Backend
                           IO (Headers '[Header &quot;Cache-Control&quot; String] TermSummary))
                     :&lt;|&gt; (Reference
                           -&gt; Maybe Name
                           -&gt; Maybe ShortCausalHash
                           -&gt; Maybe Path
                           -&gt; Maybe Width
                           -&gt; Backend
                                IO (Headers '[Header &quot;Cache-Control&quot; String] TypeSummary)))))
forall a b. a -&gt; b -&gt; a :&lt;|&gt; b
</span><span class="hs-operator hs-var">:&lt;|&gt;</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679317345"><span class="annot"><span class="annottext">Maybe ShortCausalHash
</span><a href="#local-6989586621679317345"><span class="hs-identifier hs-var">mayRoot</span></a></span></span><span> </span><span id="local-6989586621679317344"><span class="annot"><span class="annottext">Maybe Path
</span><a href="#local-6989586621679317344"><span class="hs-identifier hs-var">relativePath</span></a></span></span><span> </span><span id="local-6989586621679317343"><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679317343"><span class="hs-identifier hs-var">rawHqns</span></a></span></span><span> </span><span id="local-6989586621679317342"><span class="annot"><span class="annottext">Maybe Width
</span><a href="#local-6989586621679317342"><span class="hs-identifier hs-var">renderWidth</span></a></span></span><span> </span><span id="local-6989586621679317341"><span class="annot"><span class="annottext">Maybe Suffixify
</span><a href="#local-6989586621679317341"><span class="hs-identifier hs-var">suff</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DefinitionDisplayResults
-&gt; Headers
     '[Header &quot;Cache-Control&quot; String] DefinitionDisplayResults
forall v. v -&gt; APIHeaders v
</span><a href="Unison.Server.Types.html#setCacheControl"><span class="hs-identifier hs-var">setCacheControl</span></a></span><span> </span><span class="annot"><span class="annottext">(DefinitionDisplayResults
 -&gt; Headers
      '[Header &quot;Cache-Control&quot; String] DefinitionDisplayResults)
-&gt; Backend IO DefinitionDisplayResults
-&gt; Backend
     IO
     (Headers '[Header &quot;Cache-Control&quot; String] DefinitionDisplayResults)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Runtime Symbol
-&gt; Codebase IO Symbol Ann
-&gt; Maybe (Either ShortCausalHash CausalHash)
-&gt; Maybe Path
-&gt; [HashQualified Name]
-&gt; Maybe Width
-&gt; Maybe Suffixify
-&gt; Backend IO DefinitionDisplayResults
</span><a href="Unison.Server.Endpoints.GetDefinitions.html#serveDefinitions"><span class="hs-identifier hs-var">serveDefinitions</span></a></span><span> </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679317358"><span class="hs-identifier hs-var">rt</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679317359"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShortCausalHash -&gt; Either ShortCausalHash CausalHash
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(ShortCausalHash -&gt; Either ShortCausalHash CausalHash)
-&gt; Maybe ShortCausalHash
-&gt; Maybe (Either ShortCausalHash CausalHash)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe ShortCausalHash
</span><a href="#local-6989586621679317345"><span class="hs-identifier hs-var">mayRoot</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Path
</span><a href="#local-6989586621679317344"><span class="hs-identifier hs-var">relativePath</span></a></span><span> </span><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679317343"><span class="hs-identifier hs-var">rawHqns</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Width
</span><a href="#local-6989586621679317342"><span class="hs-identifier hs-var">renderWidth</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Suffixify
</span><a href="#local-6989586621679317341"><span class="hs-identifier hs-var">suff</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-382"></span><span>      </span><span class="annot"><span class="annottext">(Maybe ShortCausalHash
 -&gt; Maybe Path
 -&gt; [HashQualified Name]
 -&gt; Maybe Width
 -&gt; Maybe Suffixify
 -&gt; Backend
      IO
      (Headers
         '[Header &quot;Cache-Control&quot; String] DefinitionDisplayResults))
-&gt; ((Maybe ShortCausalHash
     -&gt; Maybe Path
     -&gt; Maybe Port
     -&gt; Maybe Width
     -&gt; Maybe String
     -&gt; Backend
          IO
          (Headers
             '[Header &quot;Cache-Control&quot; String] [(Alignment, FoundResult)]))
    :&lt;|&gt; ((Referent' Reference
           -&gt; Maybe Name
           -&gt; Maybe ShortCausalHash
           -&gt; Maybe Path
           -&gt; Maybe Width
           -&gt; Backend
                IO (Headers '[Header &quot;Cache-Control&quot; String] TermSummary))
          :&lt;|&gt; (Reference
                -&gt; Maybe Name
                -&gt; Maybe ShortCausalHash
                -&gt; Maybe Path
                -&gt; Maybe Width
                -&gt; Backend
                     IO (Headers '[Header &quot;Cache-Control&quot; String] TypeSummary))))
-&gt; (Maybe ShortCausalHash
    -&gt; Maybe Path
    -&gt; [HashQualified Name]
    -&gt; Maybe Width
    -&gt; Maybe Suffixify
    -&gt; Backend
         IO
         (Headers
            '[Header &quot;Cache-Control&quot; String] DefinitionDisplayResults))
   :&lt;|&gt; ((Maybe ShortCausalHash
          -&gt; Maybe Path
          -&gt; Maybe Port
          -&gt; Maybe Width
          -&gt; Maybe String
          -&gt; Backend
               IO
               (Headers
                  '[Header &quot;Cache-Control&quot; String] [(Alignment, FoundResult)]))
         :&lt;|&gt; ((Referent' Reference
                -&gt; Maybe Name
                -&gt; Maybe ShortCausalHash
                -&gt; Maybe Path
                -&gt; Maybe Width
                -&gt; Backend
                     IO (Headers '[Header &quot;Cache-Control&quot; String] TermSummary))
               :&lt;|&gt; (Reference
                     -&gt; Maybe Name
                     -&gt; Maybe ShortCausalHash
                     -&gt; Maybe Path
                     -&gt; Maybe Width
                     -&gt; Backend
                          IO (Headers '[Header &quot;Cache-Control&quot; String] TypeSummary))))
forall a b. a -&gt; b -&gt; a :&lt;|&gt; b
</span><span class="hs-operator hs-var">:&lt;|&gt;</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679317340"><span class="annot"><span class="annottext">Maybe ShortCausalHash
</span><a href="#local-6989586621679317340"><span class="hs-identifier hs-var">mayRoot</span></a></span></span><span> </span><span id="local-6989586621679317339"><span class="annot"><span class="annottext">Maybe Path
</span><a href="#local-6989586621679317339"><span class="hs-identifier hs-var">relativePath</span></a></span></span><span> </span><span id="local-6989586621679317338"><span class="annot"><span class="annottext">Maybe Port
</span><a href="#local-6989586621679317338"><span class="hs-identifier hs-var">limit</span></a></span></span><span> </span><span id="local-6989586621679317337"><span class="annot"><span class="annottext">Maybe Width
</span><a href="#local-6989586621679317337"><span class="hs-identifier hs-var">renderWidth</span></a></span></span><span> </span><span id="local-6989586621679317336"><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621679317336"><span class="hs-identifier hs-var">query</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[(Alignment, FoundResult)]
-&gt; Headers
     '[Header &quot;Cache-Control&quot; String] [(Alignment, FoundResult)]
forall v. v -&gt; APIHeaders v
</span><a href="Unison.Server.Types.html#setCacheControl"><span class="hs-identifier hs-var">setCacheControl</span></a></span><span> </span><span class="annot"><span class="annottext">([(Alignment, FoundResult)]
 -&gt; Headers
      '[Header &quot;Cache-Control&quot; String] [(Alignment, FoundResult)])
-&gt; Backend IO [(Alignment, FoundResult)]
-&gt; Backend
     IO
     (Headers
        '[Header &quot;Cache-Control&quot; String] [(Alignment, FoundResult)])
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; Maybe (Either ShortCausalHash CausalHash)
-&gt; Maybe Path
-&gt; Maybe Port
-&gt; Maybe Width
-&gt; Maybe String
-&gt; Backend IO [(Alignment, FoundResult)]
forall (m :: * -&gt; *).
MonadIO m =&gt;
Codebase m Symbol Ann
-&gt; Maybe (Either ShortCausalHash CausalHash)
-&gt; Maybe Path
-&gt; Maybe Port
-&gt; Maybe Width
-&gt; Maybe String
-&gt; Backend m [(Alignment, FoundResult)]
</span><a href="Unison.Server.Endpoints.FuzzyFind.html#serveFuzzyFind"><span class="hs-identifier hs-var">serveFuzzyFind</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679317359"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShortCausalHash -&gt; Either ShortCausalHash CausalHash
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(ShortCausalHash -&gt; Either ShortCausalHash CausalHash)
-&gt; Maybe ShortCausalHash
-&gt; Maybe (Either ShortCausalHash CausalHash)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe ShortCausalHash
</span><a href="#local-6989586621679317340"><span class="hs-identifier hs-var">mayRoot</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Path
</span><a href="#local-6989586621679317339"><span class="hs-identifier hs-var">relativePath</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Port
</span><a href="#local-6989586621679317338"><span class="hs-identifier hs-var">limit</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Width
</span><a href="#local-6989586621679317337"><span class="hs-identifier hs-var">renderWidth</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621679317336"><span class="hs-identifier hs-var">query</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-383"></span><span>      </span><span class="annot"><span class="annottext">(Maybe ShortCausalHash
 -&gt; Maybe Path
 -&gt; Maybe Port
 -&gt; Maybe Width
 -&gt; Maybe String
 -&gt; Backend
      IO
      (Headers
         '[Header &quot;Cache-Control&quot; String] [(Alignment, FoundResult)]))
-&gt; ((Referent' Reference
     -&gt; Maybe Name
     -&gt; Maybe ShortCausalHash
     -&gt; Maybe Path
     -&gt; Maybe Width
     -&gt; Backend
          IO (Headers '[Header &quot;Cache-Control&quot; String] TermSummary))
    :&lt;|&gt; (Reference
          -&gt; Maybe Name
          -&gt; Maybe ShortCausalHash
          -&gt; Maybe Path
          -&gt; Maybe Width
          -&gt; Backend
               IO (Headers '[Header &quot;Cache-Control&quot; String] TypeSummary)))
-&gt; (Maybe ShortCausalHash
    -&gt; Maybe Path
    -&gt; Maybe Port
    -&gt; Maybe Width
    -&gt; Maybe String
    -&gt; Backend
         IO
         (Headers
            '[Header &quot;Cache-Control&quot; String] [(Alignment, FoundResult)]))
   :&lt;|&gt; ((Referent' Reference
          -&gt; Maybe Name
          -&gt; Maybe ShortCausalHash
          -&gt; Maybe Path
          -&gt; Maybe Width
          -&gt; Backend
               IO (Headers '[Header &quot;Cache-Control&quot; String] TermSummary))
         :&lt;|&gt; (Reference
               -&gt; Maybe Name
               -&gt; Maybe ShortCausalHash
               -&gt; Maybe Path
               -&gt; Maybe Width
               -&gt; Backend
                    IO (Headers '[Header &quot;Cache-Control&quot; String] TypeSummary)))
forall a b. a -&gt; b -&gt; a :&lt;|&gt; b
</span><span class="hs-operator hs-var">:&lt;|&gt;</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679317335"><span class="annot"><span class="annottext">Referent' Reference
</span><a href="#local-6989586621679317335"><span class="hs-identifier hs-var">shortHash</span></a></span></span><span> </span><span id="local-6989586621679317334"><span class="annot"><span class="annottext">Maybe Name
</span><a href="#local-6989586621679317334"><span class="hs-identifier hs-var">mayName</span></a></span></span><span> </span><span id="local-6989586621679317333"><span class="annot"><span class="annottext">Maybe ShortCausalHash
</span><a href="#local-6989586621679317333"><span class="hs-identifier hs-var">mayRoot</span></a></span></span><span> </span><span id="local-6989586621679317332"><span class="annot"><span class="annottext">Maybe Path
</span><a href="#local-6989586621679317332"><span class="hs-identifier hs-var">relativeTo</span></a></span></span><span> </span><span id="local-6989586621679317331"><span class="annot"><span class="annottext">Maybe Width
</span><a href="#local-6989586621679317331"><span class="hs-identifier hs-var">renderWidth</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TermSummary -&gt; Headers '[Header &quot;Cache-Control&quot; String] TermSummary
forall v. v -&gt; APIHeaders v
</span><a href="Unison.Server.Types.html#setCacheControl"><span class="hs-identifier hs-var">setCacheControl</span></a></span><span> </span><span class="annot"><span class="annottext">(TermSummary
 -&gt; Headers '[Header &quot;Cache-Control&quot; String] TermSummary)
-&gt; Backend IO TermSummary
-&gt; Backend
     IO (Headers '[Header &quot;Cache-Control&quot; String] TermSummary)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; Referent' Reference
-&gt; Maybe Name
-&gt; Maybe (Either ShortCausalHash CausalHash)
-&gt; Maybe Path
-&gt; Maybe Width
-&gt; Backend IO TermSummary
</span><a href="Unison.Server.Endpoints.DefinitionSummary.html#serveTermSummary"><span class="hs-identifier hs-var">serveTermSummary</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679317359"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Referent' Reference
</span><a href="#local-6989586621679317335"><span class="hs-identifier hs-var">shortHash</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Name
</span><a href="#local-6989586621679317334"><span class="hs-identifier hs-var">mayName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShortCausalHash -&gt; Either ShortCausalHash CausalHash
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(ShortCausalHash -&gt; Either ShortCausalHash CausalHash)
-&gt; Maybe ShortCausalHash
-&gt; Maybe (Either ShortCausalHash CausalHash)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe ShortCausalHash
</span><a href="#local-6989586621679317333"><span class="hs-identifier hs-var">mayRoot</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Path
</span><a href="#local-6989586621679317332"><span class="hs-identifier hs-var">relativeTo</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Width
</span><a href="#local-6989586621679317331"><span class="hs-identifier hs-var">renderWidth</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-384"></span><span>      </span><span class="annot"><span class="annottext">(Referent' Reference
 -&gt; Maybe Name
 -&gt; Maybe ShortCausalHash
 -&gt; Maybe Path
 -&gt; Maybe Width
 -&gt; Backend
      IO (Headers '[Header &quot;Cache-Control&quot; String] TermSummary))
-&gt; (Reference
    -&gt; Maybe Name
    -&gt; Maybe ShortCausalHash
    -&gt; Maybe Path
    -&gt; Maybe Width
    -&gt; Backend
         IO (Headers '[Header &quot;Cache-Control&quot; String] TypeSummary))
-&gt; (Referent' Reference
    -&gt; Maybe Name
    -&gt; Maybe ShortCausalHash
    -&gt; Maybe Path
    -&gt; Maybe Width
    -&gt; Backend
         IO (Headers '[Header &quot;Cache-Control&quot; String] TermSummary))
   :&lt;|&gt; (Reference
         -&gt; Maybe Name
         -&gt; Maybe ShortCausalHash
         -&gt; Maybe Path
         -&gt; Maybe Width
         -&gt; Backend
              IO (Headers '[Header &quot;Cache-Control&quot; String] TypeSummary))
forall a b. a -&gt; b -&gt; a :&lt;|&gt; b
</span><span class="hs-operator hs-var">:&lt;|&gt;</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679317330"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679317330"><span class="hs-identifier hs-var">shortHash</span></a></span></span><span> </span><span id="local-6989586621679317329"><span class="annot"><span class="annottext">Maybe Name
</span><a href="#local-6989586621679317329"><span class="hs-identifier hs-var">mayName</span></a></span></span><span> </span><span id="local-6989586621679317328"><span class="annot"><span class="annottext">Maybe ShortCausalHash
</span><a href="#local-6989586621679317328"><span class="hs-identifier hs-var">mayRoot</span></a></span></span><span> </span><span id="local-6989586621679317327"><span class="annot"><span class="annottext">Maybe Path
</span><a href="#local-6989586621679317327"><span class="hs-identifier hs-var">relativeTo</span></a></span></span><span> </span><span id="local-6989586621679317326"><span class="annot"><span class="annottext">Maybe Width
</span><a href="#local-6989586621679317326"><span class="hs-identifier hs-var">renderWidth</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeSummary -&gt; Headers '[Header &quot;Cache-Control&quot; String] TypeSummary
forall v. v -&gt; APIHeaders v
</span><a href="Unison.Server.Types.html#setCacheControl"><span class="hs-identifier hs-var">setCacheControl</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeSummary
 -&gt; Headers '[Header &quot;Cache-Control&quot; String] TypeSummary)
-&gt; Backend IO TypeSummary
-&gt; Backend
     IO (Headers '[Header &quot;Cache-Control&quot; String] TypeSummary)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; Reference
-&gt; Maybe Name
-&gt; Maybe (Either ShortCausalHash CausalHash)
-&gt; Maybe Path
-&gt; Maybe Width
-&gt; Backend IO TypeSummary
</span><a href="Unison.Server.Endpoints.DefinitionSummary.html#serveTypeSummary"><span class="hs-identifier hs-var">serveTypeSummary</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679317359"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679317330"><span class="hs-identifier hs-var">shortHash</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Name
</span><a href="#local-6989586621679317329"><span class="hs-identifier hs-var">mayName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShortCausalHash -&gt; Either ShortCausalHash CausalHash
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(ShortCausalHash -&gt; Either ShortCausalHash CausalHash)
-&gt; Maybe ShortCausalHash
-&gt; Maybe (Either ShortCausalHash CausalHash)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe ShortCausalHash
</span><a href="#local-6989586621679317328"><span class="hs-identifier hs-var">mayRoot</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Path
</span><a href="#local-6989586621679317327"><span class="hs-identifier hs-var">relativeTo</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Width
</span><a href="#local-6989586621679317326"><span class="hs-identifier hs-var">renderWidth</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-385"></span><span>
</span><span id="line-386"></span><span id="local-6989586621679317613"><span class="annot"><a href="Unison.Server.CodebaseServer.html#backendHandler"><span class="hs-identifier hs-type">backendHandler</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#BackendEnv"><span class="hs-identifier hs-type">BackendEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679317613"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Handler</span></span><span> </span><span class="annot"><a href="#local-6989586621679317613"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-387"></span><span id="backendHandler"><span class="annot"><span class="annottext">backendHandler :: BackendEnv -&gt; Backend IO a -&gt; Handler a
</span><a href="Unison.Server.CodebaseServer.html#backendHandler"><span class="hs-identifier hs-var hs-var">backendHandler</span></a></span></span><span> </span><span id="local-6989586621679317325"><span class="annot"><span class="annottext">BackendEnv
</span><a href="#local-6989586621679317325"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621679317324"><span class="annot"><span class="annottext">Backend IO a
</span><a href="#local-6989586621679317324"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-388"></span><span>  </span><span class="annot"><span class="annottext">ExceptT ServerError IO a -&gt; Handler a
forall a. ExceptT ServerError IO a -&gt; Handler a
</span><span class="hs-identifier hs-var">Handler</span></span><span> </span><span class="annot"><span class="annottext">(ExceptT ServerError IO a -&gt; Handler a)
-&gt; ExceptT ServerError IO a -&gt; Handler a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(BackendError -&gt; ServerError)
-&gt; ExceptT BackendError IO a -&gt; ExceptT ServerError IO a
forall (m :: * -&gt; *) e e' a.
Functor m =&gt;
(e -&gt; e') -&gt; ExceptT e m a -&gt; ExceptT e' m a
</span><span class="hs-identifier hs-var">withExceptT</span></span><span> </span><span class="annot"><span class="annottext">BackendError -&gt; ServerError
</span><a href="Unison.Server.Errors.html#backendError"><span class="hs-identifier hs-var">backendError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ReaderT BackendEnv (ExceptT BackendError IO) a
-&gt; BackendEnv -&gt; ExceptT BackendError IO a
forall r (m :: * -&gt; *) a. ReaderT r m a -&gt; r -&gt; m a
</span><span class="hs-identifier hs-var hs-var">runReaderT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Backend IO a -&gt; ReaderT BackendEnv (ExceptT BackendError IO) a
forall (m :: * -&gt; *) a.
Backend m a -&gt; ReaderT BackendEnv (ExceptT BackendError m) a
</span><a href="Unison.Server.Backend.html#%24sel%3ArunBackend%3ABackend"><span class="hs-identifier hs-var hs-var">runBackend</span></a></span><span> </span><span class="annot"><span class="annottext">Backend IO a
</span><a href="#local-6989586621679317324"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">BackendEnv
</span><a href="#local-6989586621679317325"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-389"></span></pre></body></html>