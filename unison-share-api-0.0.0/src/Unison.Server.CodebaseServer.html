<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DataKinds #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE TypeOperators #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# OPTIONS_GHC -Wno-orphans #-}</span><span>
</span><span id="line-6"></span><span>
</span><span id="line-7"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Unison.Server.CodebaseServer</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-8"></span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Concurrent</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">newEmptyMVar</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">putMVar</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">readMVar</span></span><span class="hs-special">)</span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Concurrent.Async</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">race</span></span><span class="hs-special">)</span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Exception</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ErrorCall</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">throwIO</span></span><span class="hs-special">)</span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Lens</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(.~)</span></span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Reader</span></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Trans.Except</span></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Aeson</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Strict</span></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Char8</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">unpack</span></span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Char8</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">C8</span></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Lazy</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Lazy</span></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Lazy.UTF8</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BLU</span></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.NanoID</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">customNanoID</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">defaultAlphabet</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">unNanoID</span></span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.OpenApi</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Info</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">License</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">OpenApi</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">URL</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.OpenApi.Lens</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">OpenApi</span></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Proxy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Proxy</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Text</span></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text.Encoding</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Text</span></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Generics</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.HTTP.Media</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(//)</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(/:)</span></span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.HTTP.Types</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">HeaderName</span></span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.HTTP.Types.Status</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ok200</span></span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.URI.Encode</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">UriEncode</span></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.URI.Encode</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">URI</span></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.Wai</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Middleware</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">responseLBS</span></span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.Wai.Handler.Warp</span></span><span>
</span><span id="line-35"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">Port</span></span><span class="hs-special">,</span><span>
</span><span id="line-36"></span><span>    </span><span class="annot"><span class="hs-identifier">defaultSettings</span></span><span class="hs-special">,</span><span>
</span><span id="line-37"></span><span>    </span><span class="annot"><span class="hs-identifier">runSettings</span></span><span class="hs-special">,</span><span>
</span><span id="line-38"></span><span>    </span><span class="annot"><span class="hs-identifier">setBeforeMainLoop</span></span><span class="hs-special">,</span><span>
</span><span id="line-39"></span><span>    </span><span class="annot"><span class="hs-identifier">setHost</span></span><span class="hs-special">,</span><span>
</span><span id="line-40"></span><span>    </span><span class="annot"><span class="hs-identifier">setPort</span></span><span class="hs-special">,</span><span>
</span><span id="line-41"></span><span>    </span><span class="annot"><span class="hs-identifier">withApplicationSettings</span></span><span class="hs-special">,</span><span>
</span><span id="line-42"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.Wai.Middleware.Cors</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">cors</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">corsMethods</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">corsOrigins</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">simpleCorsResourcePolicy</span></span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Servant</span></span><span>
</span><span id="line-45"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">Handler</span></span><span class="hs-special">,</span><span>
</span><span id="line-46"></span><span>    </span><span class="annot"><span class="hs-identifier">HasServer</span></span><span class="hs-special">,</span><span>
</span><span id="line-47"></span><span>    </span><span class="annot"><span class="hs-identifier">MimeRender</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-48"></span><span>    </span><span class="annot"><span class="hs-identifier">ServerT</span></span><span class="hs-special">,</span><span>
</span><span id="line-49"></span><span>    </span><span class="annot"><span class="hs-identifier">serve</span></span><span class="hs-special">,</span><span>
</span><span id="line-50"></span><span>    </span><span class="annot"><span class="hs-identifier">throwError</span></span><span class="hs-special">,</span><span>
</span><span id="line-51"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Servant.API</span></span><span>
</span><span id="line-53"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">Accept</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-54"></span><span>    </span><span class="annot"><span class="hs-identifier">Capture</span></span><span class="hs-special">,</span><span>
</span><span id="line-55"></span><span>    </span><span class="annot"><span class="hs-identifier">CaptureAll</span></span><span class="hs-special">,</span><span>
</span><span id="line-56"></span><span>    </span><span class="annot"><span class="hs-identifier">Get</span></span><span class="hs-special">,</span><span>
</span><span id="line-57"></span><span>    </span><span class="annot"><span class="hs-identifier">JSON</span></span><span class="hs-special">,</span><span>
</span><span id="line-58"></span><span>    </span><span class="annot"><span class="hs-identifier">Raw</span></span><span class="hs-special">,</span><span>
</span><span id="line-59"></span><span>    </span><span class="annot"><span class="hs-operator">(:&gt;)</span></span><span class="hs-special">,</span><span>
</span><span id="line-60"></span><span>    </span><span class="hs-keyword">type</span><span> </span><span class="annot"><span class="hs-operator">(:&lt;|&gt;)</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-61"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Servant.Docs</span></span><span>
</span><span id="line-63"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">DocIntro</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">DocIntro</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-64"></span><span>    </span><span class="annot"><span class="hs-identifier">ToSample</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-65"></span><span>    </span><span class="annot"><span class="hs-identifier">docsWithIntros</span></span><span class="hs-special">,</span><span>
</span><span id="line-66"></span><span>    </span><span class="annot"><span class="hs-identifier">markdown</span></span><span class="hs-special">,</span><span>
</span><span id="line-67"></span><span>    </span><span class="annot"><span class="hs-identifier">singleSample</span></span><span class="hs-special">,</span><span>
</span><span id="line-68"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Servant.OpenApi</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">HasOpenApi</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">toOpenApi</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Servant.Server</span></span><span>
</span><span id="line-71"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">Application</span></span><span class="hs-special">,</span><span>
</span><span id="line-72"></span><span>    </span><span class="annot"><span class="hs-identifier">Handler</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Handler</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-73"></span><span>    </span><span class="annot"><span class="hs-identifier">Server</span></span><span class="hs-special">,</span><span>
</span><span id="line-74"></span><span>    </span><span class="annot"><span class="hs-identifier">ServerError</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-75"></span><span>    </span><span class="annot"><span class="hs-identifier">Tagged</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Tagged</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-76"></span><span>    </span><span class="annot"><span class="hs-identifier">err401</span></span><span class="hs-special">,</span><span>
</span><span id="line-77"></span><span>    </span><span class="annot"><span class="hs-identifier">err404</span></span><span class="hs-special">,</span><span>
</span><span id="line-78"></span><span>    </span><span class="annot"><span class="hs-identifier">hoistServer</span></span><span class="hs-special">,</span><span>
</span><span id="line-79"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Servant.Server.StaticFiles</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">serveDirectoryWebApp</span></span><span class="hs-special">)</span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Directory</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">canonicalizePath</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">doesFileExist</span></span><span class="hs-special">)</span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Environment</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">getExecutablePath</span></span><span class="hs-special">)</span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.FilePath</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(&lt;/&gt;)</span></span><span class="hs-special">)</span><span>
</span><span id="line-84"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.FilePath</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">FilePath</span></span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Random.MWC</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">createSystemRandom</span></span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Codebase</span></span><span class="hs-special">)</span><span>
</span><span id="line-87"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.Path</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Path</span></span><span>
</span><span id="line-88"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.Runtime</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Rt</span></span><span>
</span><span id="line-89"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.HashQualified</span></span><span>
</span><span id="line-90"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Name</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Name</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Name</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">segments</span></span><span class="hs-special">)</span><span>
</span><span id="line-91"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.NameSegment</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NameSegment</span></span><span>
</span><span id="line-92"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Parser.Ann</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Ann</span></span><span class="hs-special">)</span><span>
</span><span id="line-93"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Prelude</span></span><span>
</span><span id="line-94"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html"><span class="hs-identifier">Unison.Server.Backend</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.Backend.html#Backend"><span class="hs-identifier">Backend</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#BackendEnv"><span class="hs-identifier">BackendEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#%24sel%3ArunBackend%3ABackend"><span class="hs-identifier">runBackend</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-95"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Server.Errors.html"><span class="hs-identifier">Unison.Server.Errors</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.Errors.html#backendError"><span class="hs-identifier">backendError</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-96"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Server.Local.Endpoints.DefinitionSummary.html"><span class="hs-identifier">Unison.Server.Local.Endpoints.DefinitionSummary</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.Local.Endpoints.DefinitionSummary.html#TermSummaryAPI"><span class="hs-identifier">TermSummaryAPI</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Server.Local.Endpoints.DefinitionSummary.html#TypeSummaryAPI"><span class="hs-identifier">TypeSummaryAPI</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Server.Local.Endpoints.DefinitionSummary.html#serveTermSummary"><span class="hs-identifier">serveTermSummary</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Server.Local.Endpoints.DefinitionSummary.html#serveTypeSummary"><span class="hs-identifier">serveTypeSummary</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-97"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Server.Local.Endpoints.FuzzyFind.html"><span class="hs-identifier">Unison.Server.Local.Endpoints.FuzzyFind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.Local.Endpoints.FuzzyFind.html#FuzzyFindAPI"><span class="hs-identifier">FuzzyFindAPI</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Server.Local.Endpoints.FuzzyFind.html#serveFuzzyFind"><span class="hs-identifier">serveFuzzyFind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-98"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Server.Local.Endpoints.GetDefinitions.html"><span class="hs-identifier">Unison.Server.Local.Endpoints.GetDefinitions</span></a></span><span>
</span><span id="line-99"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Unison.Server.Local.Endpoints.GetDefinitions.html#DefinitionsAPI"><span class="hs-identifier">DefinitionsAPI</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-100"></span><span>    </span><span class="annot"><a href="Unison.Server.Local.Endpoints.GetDefinitions.html#serveDefinitions"><span class="hs-identifier">serveDefinitions</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-101"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-102"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Server.Local.Endpoints.NamespaceDetails.html"><span class="hs-identifier">Unison.Server.Local.Endpoints.NamespaceDetails</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NamespaceDetails</span></span><span>
</span><span id="line-103"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Server.Local.Endpoints.NamespaceListing.html"><span class="hs-identifier">Unison.Server.Local.Endpoints.NamespaceListing</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NamespaceListing</span></span><span>
</span><span id="line-104"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Server.Local.Endpoints.Projects.html"><span class="hs-identifier">Unison.Server.Local.Endpoints.Projects</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Projects</span></span><span>
</span><span id="line-105"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Server.Types.html"><span class="hs-identifier">Unison.Server.Types</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.Types.html#mungeString"><span class="hs-identifier">mungeString</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Server.Types.html#setCacheControl"><span class="hs-identifier">setCacheControl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-106"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.ShortHash</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">ShortHash</span></span><span>
</span><span id="line-107"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Symbol</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Symbol</span></span><span class="hs-special">)</span><span>
</span><span id="line-108"></span><span>
</span><span id="line-109"></span><span class="hs-comment">-- HTML content type</span><span>
</span><span id="line-110"></span><span class="hs-keyword">data</span><span> </span><span id="HTML"><span class="annot"><a href="Unison.Server.CodebaseServer.html#HTML"><span class="hs-identifier hs-var">HTML</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="HTML"><span class="annot"><a href="Unison.Server.CodebaseServer.html#HTML"><span class="hs-identifier hs-var">HTML</span></a></span></span><span>
</span><span id="line-111"></span><span>
</span><span id="line-112"></span><span class="hs-keyword">newtype</span><span> </span><span id="RawHtml"><span class="annot"><a href="Unison.Server.CodebaseServer.html#RawHtml"><span class="hs-identifier hs-var">RawHtml</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="RawHtml"><span class="annot"><a href="Unison.Server.CodebaseServer.html#RawHtml"><span class="hs-identifier hs-var">RawHtml</span></a></span></span><span> </span><span class="hs-special">{</span><span id="%24sel%3AunRaw%3ARawHtml"><span class="annot"><span class="annottext">RawHtml -&gt; ByteString
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3AunRaw%3ARawHtml"><span class="hs-identifier hs-var hs-var">unRaw</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Lazy.ByteString</span></span><span class="hs-special">}</span><span>
</span><span id="line-113"></span><span>
</span><span id="line-114"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679382960"><span class="annot"><span class="hs-identifier hs-type">Accept</span></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#HTML"><span class="hs-identifier hs-type">HTML</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-115"></span><span>  </span><span id="local-6989586621679382954"><span class="annot"><span class="annottext">contentType :: Proxy HTML -&gt; MediaType
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">contentType</span></span></span><span> </span><span class="annot"><span class="annottext">Proxy HTML
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Method
</span><span class="hs-string">&quot;text&quot;</span></span><span> </span><span class="annot"><span class="annottext">Method -&gt; Method -&gt; MediaType
</span><span class="hs-operator hs-var">//</span></span><span> </span><span class="annot"><span class="annottext">Method
</span><span class="hs-string">&quot;html&quot;</span></span><span> </span><span class="annot"><span class="annottext">MediaType -&gt; (Method, Method) -&gt; MediaType
</span><span class="hs-operator hs-var">/:</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Method
</span><span class="hs-string">&quot;charset&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Method
</span><span class="hs-string">&quot;utf-8&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-116"></span><span>
</span><span id="line-117"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MimeRender</span></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#HTML"><span class="hs-identifier hs-type">HTML</span></a></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#RawHtml"><span class="hs-identifier hs-type">RawHtml</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-118"></span><span>  </span><span id="local-6989586621679382948"><span class="annot"><span class="annottext">mimeRender :: Proxy HTML -&gt; RawHtml -&gt; ByteString
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">mimeRender</span></span></span><span> </span><span class="annot"><span class="annottext">Proxy HTML
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RawHtml -&gt; ByteString
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3AunRaw%3ARawHtml"><span class="hs-identifier hs-var">unRaw</span></a></span><span>
</span><span id="line-119"></span><span>
</span><span id="line-120"></span><span class="hs-keyword">type</span><span> </span><span id="OpenApiJSON"><span class="annot"><a href="Unison.Server.CodebaseServer.html#OpenApiJSON"><span class="hs-identifier hs-var">OpenApiJSON</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-string">&quot;openapi.json&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Get</span></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">JSON</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-identifier hs-type">OpenApi</span></span><span>
</span><span id="line-121"></span><span>
</span><span id="line-122"></span><span class="hs-keyword">type</span><span> </span><span id="UnisonAndDocsAPI"><span class="annot"><a href="Unison.Server.CodebaseServer.html#UnisonAndDocsAPI"><span class="hs-identifier hs-var">UnisonAndDocsAPI</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#UnisonAPI"><span class="hs-identifier hs-type">UnisonAPI</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&lt;|&gt;</span></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#OpenApiJSON"><span class="hs-identifier hs-type">OpenApiJSON</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&lt;|&gt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Raw</span></span><span>
</span><span id="line-123"></span><span>
</span><span id="line-124"></span><span class="hs-keyword">type</span><span> </span><span id="UnisonAPI"><span class="annot"><a href="Unison.Server.CodebaseServer.html#UnisonAPI"><span class="hs-identifier hs-var">UnisonAPI</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-125"></span><span>  </span><span class="annot"><a href="Unison.Server.Local.Endpoints.NamespaceListing.html#NamespaceListingAPI"><span class="hs-identifier hs-type">NamespaceListing.NamespaceListingAPI</span></a></span><span>
</span><span id="line-126"></span><span>    </span><span class="annot"><span class="hs-operator hs-type">:&lt;|&gt;</span></span><span> </span><span class="annot"><a href="Unison.Server.Local.Endpoints.NamespaceDetails.html#NamespaceDetailsAPI"><span class="hs-identifier hs-type">NamespaceDetails.NamespaceDetailsAPI</span></a></span><span>
</span><span id="line-127"></span><span>    </span><span class="annot"><span class="hs-operator hs-type">:&lt;|&gt;</span></span><span> </span><span class="annot"><a href="Unison.Server.Local.Endpoints.Projects.html#ProjectsAPI"><span class="hs-identifier hs-type">Projects.ProjectsAPI</span></a></span><span>
</span><span id="line-128"></span><span>    </span><span class="annot"><span class="hs-operator hs-type">:&lt;|&gt;</span></span><span> </span><span class="annot"><a href="Unison.Server.Local.Endpoints.GetDefinitions.html#DefinitionsAPI"><span class="hs-identifier hs-type">DefinitionsAPI</span></a></span><span>
</span><span id="line-129"></span><span>    </span><span class="annot"><span class="hs-operator hs-type">:&lt;|&gt;</span></span><span> </span><span class="annot"><a href="Unison.Server.Local.Endpoints.FuzzyFind.html#FuzzyFindAPI"><span class="hs-identifier hs-type">FuzzyFindAPI</span></a></span><span>
</span><span id="line-130"></span><span>    </span><span class="annot"><span class="hs-operator hs-type">:&lt;|&gt;</span></span><span> </span><span class="annot"><a href="Unison.Server.Local.Endpoints.DefinitionSummary.html#TermSummaryAPI"><span class="hs-identifier hs-type">TermSummaryAPI</span></a></span><span>
</span><span id="line-131"></span><span>    </span><span class="annot"><span class="hs-operator hs-type">:&lt;|&gt;</span></span><span> </span><span class="annot"><a href="Unison.Server.Local.Endpoints.DefinitionSummary.html#TypeSummaryAPI"><span class="hs-identifier hs-type">TypeSummaryAPI</span></a></span><span>
</span><span id="line-132"></span><span>
</span><span id="line-133"></span><span class="hs-keyword">type</span><span> </span><span id="WebUI"><span class="annot"><a href="Unison.Server.CodebaseServer.html#WebUI"><span class="hs-identifier hs-var">WebUI</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CaptureAll</span></span><span> </span><span class="annot"><span class="hs-string">&quot;route&quot;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Get</span></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><a href="Unison.Server.CodebaseServer.html#HTML"><span class="hs-identifier hs-type">HTML</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#RawHtml"><span class="hs-identifier hs-type">RawHtml</span></a></span><span>
</span><span id="line-134"></span><span>
</span><span id="line-135"></span><span class="hs-keyword">type</span><span> </span><span id="ServerAPI"><span class="annot"><a href="Unison.Server.CodebaseServer.html#ServerAPI"><span class="hs-identifier hs-var">ServerAPI</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;ui&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#WebUI"><span class="hs-identifier hs-type">WebUI</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">:&lt;|&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;api&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#UnisonAndDocsAPI"><span class="hs-identifier hs-type">UnisonAndDocsAPI</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-136"></span><span>
</span><span id="line-137"></span><span class="hs-keyword">type</span><span> </span><span id="StaticAPI"><span class="annot"><a href="Unison.Server.CodebaseServer.html#StaticAPI"><span class="hs-identifier hs-var">StaticAPI</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-string">&quot;static&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Raw</span></span><span>
</span><span id="line-138"></span><span>
</span><span id="line-139"></span><span class="hs-keyword">type</span><span> </span><span id="Authed"><span class="annot"><a href="Unison.Server.CodebaseServer.html#Authed"><span class="hs-identifier hs-var">Authed</span></a></span></span><span> </span><span id="local-6989586621679382944"><span class="annot"><a href="#local-6989586621679382944"><span class="hs-identifier hs-type">api</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Capture</span></span><span> </span><span class="annot"><span class="hs-string">&quot;token&quot;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621679382944"><span class="hs-identifier hs-type">api</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-140"></span><span>
</span><span id="line-141"></span><span class="hs-keyword">type</span><span> </span><span id="AppAPI"><span class="annot"><a href="Unison.Server.CodebaseServer.html#AppAPI"><span class="hs-identifier hs-var">AppAPI</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#StaticAPI"><span class="hs-identifier hs-type">StaticAPI</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&lt;|&gt;</span></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#Authed"><span class="hs-identifier hs-type">Authed</span></a></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#ServerAPI"><span class="hs-identifier hs-type">ServerAPI</span></a></span><span>
</span><span id="line-142"></span><span>
</span><span id="line-143"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ToSample</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-144"></span><span>  </span><span id="local-6989586621679382941"><span class="annot"><span class="annottext">toSamples :: Proxy Char -&gt; [(Text, Char)]
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">toSamples</span></span></span><span> </span><span class="annot"><span class="annottext">Proxy Char
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [(Text, a)]
</span><span class="hs-identifier hs-var">singleSample</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'x'</span></span><span>
</span><span id="line-145"></span><span>
</span><span id="line-146"></span><span class="hs-comment">-- BaseUrl and helpers</span><span>
</span><span id="line-147"></span><span>
</span><span id="line-148"></span><span class="hs-keyword">data</span><span> </span><span id="BaseUrl"><span class="annot"><a href="Unison.Server.CodebaseServer.html#BaseUrl"><span class="hs-identifier hs-var">BaseUrl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="BaseUrl"><span class="annot"><a href="Unison.Server.CodebaseServer.html#BaseUrl"><span class="hs-identifier hs-var">BaseUrl</span></a></span></span><span>
</span><span id="line-149"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3AurlHost%3ABaseUrl"><span class="annot"><span class="annottext">BaseUrl -&gt; String
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3AurlHost%3ABaseUrl"><span class="hs-identifier hs-var hs-var">urlHost</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">,</span><span>
</span><span id="line-150"></span><span>    </span><span id="%24sel%3AurlToken%3ABaseUrl"><span class="annot"><span class="annottext">BaseUrl -&gt; Method
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3AurlToken%3ABaseUrl"><span class="hs-identifier hs-var hs-var">urlToken</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Strict.ByteString</span></span><span class="hs-special">,</span><span>
</span><span id="line-151"></span><span>    </span><span id="%24sel%3AurlPort%3ABaseUrl"><span class="annot"><span class="annottext">BaseUrl -&gt; Int
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3AurlPort%3ABaseUrl"><span class="hs-identifier hs-var hs-var">urlPort</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Port</span></span><span>
</span><span id="line-152"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-153"></span><span>
</span><span id="line-154"></span><span class="hs-keyword">data</span><span> </span><span id="DefinitionReference"><span class="annot"><a href="Unison.Server.CodebaseServer.html#DefinitionReference"><span class="hs-identifier hs-var">DefinitionReference</span></a></span></span><span>
</span><span id="line-155"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="TermReference"><span class="annot"><a href="Unison.Server.CodebaseServer.html#TermReference"><span class="hs-identifier hs-var">TermReference</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HashQualified</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- /terms/...</span><span>
</span><span id="line-156"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="TypeReference"><span class="annot"><a href="Unison.Server.CodebaseServer.html#TypeReference"><span class="hs-identifier hs-var">TypeReference</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HashQualified</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- /types/...</span><span>
</span><span id="line-157"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="AbilityConstructorReference"><span class="annot"><a href="Unison.Server.CodebaseServer.html#AbilityConstructorReference"><span class="hs-identifier hs-var">AbilityConstructorReference</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HashQualified</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- /ability-constructors/...</span><span>
</span><span id="line-158"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="DataConstructorReference"><span class="annot"><a href="Unison.Server.CodebaseServer.html#DataConstructorReference"><span class="hs-identifier hs-var">DataConstructorReference</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HashQualified</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- /data-constructors/...</span><span>
</span><span id="line-159"></span><span>
</span><span id="line-160"></span><span class="hs-keyword">data</span><span> </span><span id="Service"><span class="annot"><a href="Unison.Server.CodebaseServer.html#Service"><span class="hs-identifier hs-var">Service</span></a></span></span><span>
</span><span id="line-161"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="UI"><span class="annot"><a href="Unison.Server.CodebaseServer.html#UI"><span class="hs-identifier hs-var">UI</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Path.Absolute</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#DefinitionReference"><span class="hs-identifier hs-type">DefinitionReference</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-162"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="Api"><span class="annot"><a href="Unison.Server.CodebaseServer.html#Api"><span class="hs-identifier hs-var">Api</span></a></span></span><span>
</span><span id="line-163"></span><span>
</span><span id="line-164"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679382924"><span id="local-6989586621679382927"><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#BaseUrl"><span class="hs-identifier hs-type">BaseUrl</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-165"></span><span>  </span><span id="local-6989586621679382914"><span class="annot"><span class="annottext">show :: BaseUrl -&gt; String
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">show</span></span></span><span> </span><span id="local-6989586621679382912"><span class="annot"><span class="annottext">BaseUrl
</span><a href="#local-6989586621679382912"><span class="hs-identifier hs-var">url</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BaseUrl -&gt; String
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3AurlHost%3ABaseUrl"><span class="hs-identifier hs-var">urlHost</span></a></span><span> </span><span class="annot"><span class="annottext">BaseUrl
</span><a href="#local-6989586621679382912"><span class="hs-identifier hs-var">url</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;:&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BaseUrl -&gt; Int
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3AurlPort%3ABaseUrl"><span class="hs-identifier hs-var">urlPort</span></a></span><span> </span><span class="annot"><span class="annottext">BaseUrl
</span><a href="#local-6989586621679382912"><span class="hs-identifier hs-var">url</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;/&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShowS
</span><span class="hs-identifier hs-var">URI.encode</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Method -&gt; String
</span><span class="hs-identifier hs-var">unpack</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">BaseUrl -&gt; Method
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3AurlToken%3ABaseUrl"><span class="hs-identifier hs-var">urlToken</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BaseUrl
</span><a href="#local-6989586621679382912"><span class="hs-identifier hs-var">url</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-166"></span><span>
</span><span id="line-167"></span><span class="hs-comment">-- | Create a Service URL, either for the UI or the API</span><span>
</span><span id="line-168"></span><span class="hs-comment">--</span><span>
</span><span id="line-169"></span><span class="hs-comment">-- Examples:</span><span>
</span><span id="line-170"></span><span class="hs-comment">--</span><span>
</span><span id="line-171"></span><span class="hs-comment">-- &gt;&gt;&gt; urlFor Api (BaseUrl{ urlHost = &quot;https://localhost&quot;, urlToken = &quot;asdf&quot;, urlPort = 1234 })</span><span>
</span><span id="line-172"></span><span class="hs-comment">-- &quot;https://localhost:1234/asdf/api&quot;</span><span>
</span><span id="line-173"></span><span class="hs-comment">--</span><span>
</span><span id="line-174"></span><span class="hs-comment">-- &gt;&gt;&gt; import qualified Unison.Syntax.Name as Name</span><span>
</span><span id="line-175"></span><span class="hs-comment">-- &gt;&gt;&gt; let service = UI (Path.absoluteEmpty) (Just (TermReference (NameOnly (Name.unsafeFromText &quot;base.data.List.map&quot;))))</span><span>
</span><span id="line-176"></span><span class="hs-comment">-- &gt;&gt;&gt; let baseUrl = (BaseUrl{ urlHost = &quot;https://localhost&quot;, urlToken = &quot;asdf&quot;, urlPort = 1234 })</span><span>
</span><span id="line-177"></span><span class="hs-comment">-- &gt;&gt;&gt; urlFor service baseUrl</span><span>
</span><span id="line-178"></span><span class="hs-comment">-- &quot;https://localhost:1234/asdf/ui/latest/;/terms/base/data/List/map&quot;</span><span>
</span><span id="line-179"></span><span class="hs-comment">--</span><span>
</span><span id="line-180"></span><span class="hs-comment">-- &gt;&gt;&gt; import qualified Unison.Syntax.Name as Name</span><span>
</span><span id="line-181"></span><span class="hs-comment">-- &gt;&gt;&gt; let service = UI (Path.Absolute (Path.fromText &quot;base.data&quot;)) (Just (TermReference (NameOnly (Name.unsafeFromText &quot;List.map&quot;))))</span><span>
</span><span id="line-182"></span><span class="hs-comment">-- &gt;&gt;&gt; let baseUrl = (BaseUrl{ urlHost = &quot;https://localhost&quot;, urlToken = &quot;asdf&quot;, urlPort = 1234 })</span><span>
</span><span id="line-183"></span><span class="hs-comment">-- &gt;&gt;&gt; urlFor service baseUrl</span><span>
</span><span id="line-184"></span><span class="hs-comment">-- &quot;https://localhost:1234/asdf/ui/latest/namespaces/base/data/;/terms/List/map&quot;</span><span>
</span><span id="line-185"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#urlFor"><span class="hs-identifier hs-type">urlFor</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#Service"><span class="hs-identifier hs-type">Service</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#BaseUrl"><span class="hs-identifier hs-type">BaseUrl</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-186"></span><span id="urlFor"><span class="annot"><span class="annottext">urlFor :: Service -&gt; BaseUrl -&gt; String
</span><a href="Unison.Server.CodebaseServer.html#urlFor"><span class="hs-identifier hs-var hs-var">urlFor</span></a></span></span><span> </span><span id="local-6989586621679382908"><span class="annot"><span class="annottext">Service
</span><a href="#local-6989586621679382908"><span class="hs-identifier hs-var">service</span></a></span></span><span> </span><span id="local-6989586621679382907"><span class="annot"><span class="annottext">BaseUrl
</span><a href="#local-6989586621679382907"><span class="hs-identifier hs-var">baseUrl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-187"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Service
</span><a href="#local-6989586621679382908"><span class="hs-identifier hs-var">service</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-188"></span><span>    </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#UI"><span class="hs-identifier hs-type">UI</span></a></span><span> </span><span id="local-6989586621679382906"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679382906"><span class="hs-identifier hs-var">ns</span></a></span></span><span> </span><span id="local-6989586621679382905"><span class="annot"><span class="annottext">Maybe DefinitionReference
</span><a href="#local-6989586621679382905"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-189"></span><span>      </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">BaseUrl
</span><a href="#local-6989586621679382907"><span class="hs-identifier hs-var">baseUrl</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;/ui&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">Text.unpack</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Absolute -&gt; Maybe DefinitionReference -&gt; Text
</span><a href="#local-6989586621679382903"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679382906"><span class="hs-identifier hs-var">ns</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe DefinitionReference
</span><a href="#local-6989586621679382905"><span class="hs-identifier hs-var">def</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-190"></span><span>    </span><span class="annot"><span class="annottext">Service
</span><a href="Unison.Server.CodebaseServer.html#Api"><span class="hs-identifier hs-var">Api</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">BaseUrl
</span><a href="#local-6989586621679382907"><span class="hs-identifier hs-var">baseUrl</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;/api&quot;</span></span><span>
</span><span id="line-191"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-192"></span><span>    </span><span class="annot"><a href="#local-6989586621679382903"><span class="hs-identifier hs-type">path</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Path.Absolute</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#DefinitionReference"><span class="hs-identifier hs-type">DefinitionReference</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-193"></span><span>    </span><span id="local-6989586621679382903"><span class="annot"><span class="annottext">path :: Absolute -&gt; Maybe DefinitionReference -&gt; Text
</span><a href="#local-6989586621679382903"><span class="hs-identifier hs-var hs-var">path</span></a></span></span><span> </span><span id="local-6989586621679382902"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679382902"><span class="hs-identifier hs-var">ns</span></a></span></span><span> </span><span id="local-6989586621679382901"><span class="annot"><span class="annottext">Maybe DefinitionReference
</span><a href="#local-6989586621679382901"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-194"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679382900"><span class="annot"><span class="annottext">nsPath :: Text
</span><a href="#local-6989586621679382900"><span class="hs-identifier hs-var hs-var">nsPath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Absolute -&gt; Text
</span><a href="#local-6989586621679382899"><span class="hs-identifier hs-var">namespacePath</span></a></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679382902"><span class="hs-identifier hs-var">ns</span></a></span><span>
</span><span id="line-195"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe DefinitionReference -&gt; Maybe Text
</span><a href="#local-6989586621679382898"><span class="hs-identifier hs-var">definitionPath</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe DefinitionReference
</span><a href="#local-6989586621679382901"><span class="hs-identifier hs-var">def</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-196"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679382897"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679382897"><span class="hs-identifier hs-var">defPath</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;/latest&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679382900"><span class="hs-identifier hs-var">nsPath</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;/;&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679382897"><span class="hs-identifier hs-var">defPath</span></a></span><span>
</span><span id="line-197"></span><span>            </span><span class="annot"><span class="annottext">Maybe Text
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;/latest&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679382900"><span class="hs-identifier hs-var">nsPath</span></a></span><span>
</span><span id="line-198"></span><span>
</span><span id="line-199"></span><span>    </span><span class="annot"><a href="#local-6989586621679382899"><span class="hs-identifier hs-type">namespacePath</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Path.Absolute</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-200"></span><span>    </span><span id="local-6989586621679382899"><span class="annot"><span class="annottext">namespacePath :: Absolute -&gt; Text
</span><a href="#local-6989586621679382899"><span class="hs-identifier hs-var hs-var">namespacePath</span></a></span></span><span> </span><span id="local-6989586621679382896"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679382896"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-201"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679382896"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><span class="hs-identifier hs-var">Path.absoluteEmpty</span></span><span>
</span><span id="line-202"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-203"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;/namespaces/&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><a href="#local-6989586621679382894"><span class="hs-identifier hs-var">toUrlPath</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NameSegment -&gt; Text
</span><span class="hs-identifier hs-var">NameSegment.toText</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Path -&gt; [NameSegment]
</span><span class="hs-identifier hs-var">Path.toList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Absolute -&gt; Path
</span><span class="hs-identifier hs-var">Path.unabsolute</span></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679382896"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-204"></span><span>
</span><span id="line-205"></span><span>    </span><span class="annot"><a href="#local-6989586621679382898"><span class="hs-identifier hs-type">definitionPath</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#DefinitionReference"><span class="hs-identifier hs-type">DefinitionReference</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-206"></span><span>    </span><span id="local-6989586621679382898"><span class="annot"><span class="annottext">definitionPath :: Maybe DefinitionReference -&gt; Maybe Text
</span><a href="#local-6989586621679382898"><span class="hs-identifier hs-var hs-var">definitionPath</span></a></span></span><span> </span><span id="local-6989586621679382889"><span class="annot"><span class="annottext">Maybe DefinitionReference
</span><a href="#local-6989586621679382889"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-207"></span><span>      </span><span class="annot"><span class="annottext">DefinitionReference -&gt; Text
</span><a href="#local-6989586621679382888"><span class="hs-identifier hs-var">toDefinitionPath</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe DefinitionReference
</span><a href="#local-6989586621679382889"><span class="hs-identifier hs-var">def</span></a></span><span>
</span><span id="line-208"></span><span>
</span><span id="line-209"></span><span>    </span><span class="annot"><a href="#local-6989586621679382894"><span class="hs-identifier hs-type">toUrlPath</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-210"></span><span>    </span><span id="local-6989586621679382894"><span class="annot"><span class="annottext">toUrlPath :: [Text] -&gt; Text
</span><a href="#local-6989586621679382894"><span class="hs-identifier hs-var hs-var">toUrlPath</span></a></span></span><span> </span><span id="local-6989586621679382887"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679382887"><span class="hs-identifier hs-var">parts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-211"></span><span>      </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679382887"><span class="hs-identifier hs-var">parts</span></a></span><span>
</span><span id="line-212"></span><span>        </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">UriEncode.encodeText</span></span><span>
</span><span id="line-213"></span><span>        </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Text] -&gt; Text
</span><span class="hs-identifier hs-var">Text.intercalate</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;/&quot;</span></span><span>
</span><span id="line-214"></span><span>
</span><span id="line-215"></span><span>    </span><span class="annot"><a href="#local-6989586621679382883"><span class="hs-identifier hs-type">refToUrlText</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HashQualified</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-216"></span><span>    </span><span id="local-6989586621679382883"><span class="annot"><span class="annottext">refToUrlText :: HashQualified Name -&gt; Text
</span><a href="#local-6989586621679382883"><span class="hs-identifier hs-var hs-var">refToUrlText</span></a></span></span><span> </span><span id="local-6989586621679382882"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679382882"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-217"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679382882"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-218"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">NameOnly</span></span><span> </span><span id="local-6989586621679382880"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679382880"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-219"></span><span>          </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679382880"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; NonEmpty NameSegment
</span><span class="hs-identifier hs-var">Name.segments</span></span><span> </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">NameSegment -&gt; Text
</span><span class="hs-identifier hs-var">NameSegment.toText</span></span><span> </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><a href="#local-6989586621679382894"><span class="hs-identifier hs-var">toUrlPath</span></a></span><span>
</span><span id="line-220"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">HashOnly</span></span><span> </span><span id="local-6989586621679382877"><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679382877"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-221"></span><span>          </span><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679382877"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">ShortHash -&gt; Text
</span><span class="hs-identifier hs-var">ShortHash.toText</span></span><span> </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">UriEncode.encodeText</span></span><span>
</span><span id="line-222"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">HashQualified</span></span><span> </span><span id="local-6989586621679382874"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679382874"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><span class="annottext">ShortHash
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-223"></span><span>          </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679382874"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; NonEmpty NameSegment
</span><span class="hs-identifier hs-var">Name.segments</span></span><span> </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">NameSegment -&gt; Text
</span><span class="hs-identifier hs-var">NameSegment.toText</span></span><span> </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><a href="#local-6989586621679382894"><span class="hs-identifier hs-var">toUrlPath</span></a></span><span>
</span><span id="line-224"></span><span>
</span><span id="line-225"></span><span>    </span><span class="annot"><a href="#local-6989586621679382888"><span class="hs-identifier hs-type">toDefinitionPath</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#DefinitionReference"><span class="hs-identifier hs-type">DefinitionReference</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-226"></span><span>    </span><span id="local-6989586621679382888"><span class="annot"><span class="annottext">toDefinitionPath :: DefinitionReference -&gt; Text
</span><a href="#local-6989586621679382888"><span class="hs-identifier hs-var hs-var">toDefinitionPath</span></a></span></span><span> </span><span id="local-6989586621679382873"><span class="annot"><span class="annottext">DefinitionReference
</span><a href="#local-6989586621679382873"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-227"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DefinitionReference
</span><a href="#local-6989586621679382873"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-228"></span><span>        </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#TermReference"><span class="hs-identifier hs-type">TermReference</span></a></span><span> </span><span id="local-6989586621679382872"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679382872"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-229"></span><span>          </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;/terms/&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; Text
</span><a href="#local-6989586621679382883"><span class="hs-identifier hs-var">refToUrlText</span></a></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679382872"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-230"></span><span>        </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#TypeReference"><span class="hs-identifier hs-type">TypeReference</span></a></span><span> </span><span id="local-6989586621679382871"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679382871"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-231"></span><span>          </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;/types/&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; Text
</span><a href="#local-6989586621679382883"><span class="hs-identifier hs-var">refToUrlText</span></a></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679382871"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-232"></span><span>        </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#AbilityConstructorReference"><span class="hs-identifier hs-type">AbilityConstructorReference</span></a></span><span> </span><span id="local-6989586621679382870"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679382870"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-233"></span><span>          </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;/ability-constructors/&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; Text
</span><a href="#local-6989586621679382883"><span class="hs-identifier hs-var">refToUrlText</span></a></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679382870"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-234"></span><span>        </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#DataConstructorReference"><span class="hs-identifier hs-type">DataConstructorReference</span></a></span><span> </span><span id="local-6989586621679382869"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679382869"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-235"></span><span>          </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;/data-constructors/&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; Text
</span><a href="#local-6989586621679382883"><span class="hs-identifier hs-var">refToUrlText</span></a></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679382869"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-236"></span><span>
</span><span id="line-237"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#handleAuth"><span class="hs-identifier hs-type">handleAuth</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Strict.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Handler</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-238"></span><span id="handleAuth"><span class="annot"><span class="annottext">handleAuth :: Method -&gt; Text -&gt; Handler ()
</span><a href="Unison.Server.CodebaseServer.html#handleAuth"><span class="hs-identifier hs-var hs-var">handleAuth</span></a></span></span><span> </span><span id="local-6989586621679382867"><span class="annot"><span class="annottext">Method
</span><a href="#local-6989586621679382867"><span class="hs-identifier hs-var">expectedToken</span></a></span></span><span> </span><span id="local-6989586621679382866"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679382866"><span class="hs-identifier hs-var">gotToken</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-239"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Method -&gt; Text
</span><span class="hs-identifier hs-var">Text.decodeUtf8</span></span><span> </span><span class="annot"><span class="annottext">Method
</span><a href="#local-6989586621679382867"><span class="hs-identifier hs-var">expectedToken</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679382866"><span class="hs-identifier hs-var">gotToken</span></a></span><span>
</span><span id="line-240"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-241"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall {m :: * -&gt; *} {a}.
MonadError ServerError m =&gt;
ByteString -&gt; m a
</span><a href="#local-6989586621679382864"><span class="hs-identifier hs-var">throw401</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;Authentication token missing or incorrect.&quot;</span></span><span>
</span><span id="line-242"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-243"></span><span>    </span><span id="local-6989586621679382864"><span class="annot"><span class="annottext">throw401 :: ByteString -&gt; m a
</span><a href="#local-6989586621679382864"><span class="hs-identifier hs-var hs-var">throw401</span></a></span></span><span> </span><span id="local-6989586621679382861"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679382861"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><span class="hs-identifier hs-var">err401</span></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">errBody :: ByteString
</span><span class="hs-identifier hs-var">errBody</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679382861"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-244"></span><span>
</span><span id="line-245"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#openAPI"><span class="hs-identifier hs-type">openAPI</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">OpenApi</span></span><span>
</span><span id="line-246"></span><span id="openAPI"><span class="annot"><span class="annottext">openAPI :: OpenApi
</span><a href="Unison.Server.CodebaseServer.html#openAPI"><span class="hs-identifier hs-var hs-var">openAPI</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall {k} (api :: k). HasOpenApi api =&gt; Proxy api -&gt; OpenApi
</span><span class="hs-identifier hs-var">toOpenApi</span></span><span> </span><span class="annot"><span class="annottext">Proxy UnisonAPI
</span><a href="Unison.Server.CodebaseServer.html#api"><span class="hs-identifier hs-var">api</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">forall s a. HasInfo s a =&gt; Lens' s a
</span><span class="hs-identifier hs-var">OpenApi.info</span></span><span> </span><span class="annot"><span class="annottext">forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">Info
</span><a href="Unison.Server.CodebaseServer.html#infoObject"><span class="hs-identifier hs-var">infoObject</span></a></span><span>
</span><span id="line-247"></span><span>
</span><span id="line-248"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#infoObject"><span class="hs-identifier hs-type">infoObject</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Info</span></span><span>
</span><span id="line-249"></span><span id="infoObject"><span class="annot"><span class="annottext">infoObject :: Info
</span><a href="Unison.Server.CodebaseServer.html#infoObject"><span class="hs-identifier hs-var hs-var">infoObject</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-250"></span><span>  </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-251"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_infoTitle :: Text
</span><span class="hs-identifier hs-var">_infoTitle</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Unison Codebase Manager API&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-252"></span><span>      </span><span class="annot"><span class="annottext">_infoDescription :: Maybe Text
</span><span class="hs-identifier hs-var">_infoDescription</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-253"></span><span>        </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Provides operations for querying and manipulating a Unison codebase.&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-254"></span><span>      </span><span class="annot"><span class="annottext">_infoLicense :: Maybe License
</span><span class="hs-identifier hs-var">_infoLicense</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-255"></span><span>        </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Maybe URL -&gt; License
</span><span class="hs-identifier hs-var">License</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;MIT&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-256"></span><span>          </span><span class="annot"><span class="annottext">Text -&gt; URL
</span><span class="hs-identifier hs-var">URL</span></span><span>
</span><span id="line-257"></span><span>            </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;https://github.com/unisonweb/unison/blob/trunk/LICENSE&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-258"></span><span>      </span><span class="annot"><span class="annottext">_infoVersion :: Text
</span><span class="hs-identifier hs-var">_infoVersion</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;1.0&quot;</span></span><span>
</span><span id="line-259"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-260"></span><span>
</span><span id="line-261"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#docsBS"><span class="hs-identifier hs-type">docsBS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Lazy.ByteString</span></span><span>
</span><span id="line-262"></span><span id="docsBS"><span class="annot"><span class="annottext">docsBS :: ByteString
</span><a href="Unison.Server.CodebaseServer.html#docsBS"><span class="hs-identifier hs-var hs-var">docsBS</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; ByteString
</span><a href="Unison.Server.Types.html#mungeString"><span class="hs-identifier hs-var">mungeString</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">API -&gt; String
</span><span class="hs-identifier hs-var">markdown</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall {k} (api :: k).
HasDocs api =&gt;
[DocIntro] -&gt; Proxy api -&gt; API
</span><span class="hs-identifier hs-var">docsWithIntros</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">DocIntro
</span><a href="#local-6989586621679382848"><span class="hs-identifier hs-var">intro</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Proxy UnisonAPI
</span><a href="Unison.Server.CodebaseServer.html#api"><span class="hs-identifier hs-var">api</span></a></span><span>
</span><span id="line-263"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-264"></span><span>    </span><span id="local-6989586621679382848"><span class="annot"><span class="annottext">intro :: DocIntro
</span><a href="#local-6989586621679382848"><span class="hs-identifier hs-var hs-var">intro</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-265"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; DocIntro
</span><span class="hs-identifier hs-var">DocIntro</span></span><span>
</span><span id="line-266"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">Text.unpack</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Info -&gt; Text
</span><span class="hs-identifier hs-var">_infoTitle</span></span><span> </span><span class="annot"><span class="annottext">Info
</span><a href="Unison.Server.CodebaseServer.html#infoObject"><span class="hs-identifier hs-var">infoObject</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-267"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">Text.unpack</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Info -&gt; Maybe Text
</span><span class="hs-identifier hs-var">_infoDescription</span></span><span> </span><span class="annot"><span class="annottext">Info
</span><a href="Unison.Server.CodebaseServer.html#infoObject"><span class="hs-identifier hs-var">infoObject</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-268"></span><span>
</span><span id="line-269"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#unisonAndDocsAPI"><span class="hs-identifier hs-type">unisonAndDocsAPI</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#UnisonAndDocsAPI"><span class="hs-identifier hs-type">UnisonAndDocsAPI</span></a></span><span>
</span><span id="line-270"></span><span id="unisonAndDocsAPI"><span class="annot"><span class="annottext">unisonAndDocsAPI :: Proxy UnisonAndDocsAPI
</span><a href="Unison.Server.CodebaseServer.html#unisonAndDocsAPI"><span class="hs-identifier hs-var hs-var">unisonAndDocsAPI</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall {k} (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span>
</span><span id="line-271"></span><span>
</span><span id="line-272"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#api"><span class="hs-identifier hs-type">api</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#UnisonAPI"><span class="hs-identifier hs-type">UnisonAPI</span></a></span><span>
</span><span id="line-273"></span><span id="api"><span class="annot"><span class="annottext">api :: Proxy UnisonAPI
</span><a href="Unison.Server.CodebaseServer.html#api"><span class="hs-identifier hs-var hs-var">api</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall {k} (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span>
</span><span id="line-274"></span><span>
</span><span id="line-275"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#serverAPI"><span class="hs-identifier hs-type">serverAPI</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#ServerAPI"><span class="hs-identifier hs-type">ServerAPI</span></a></span><span>
</span><span id="line-276"></span><span id="serverAPI"><span class="annot"><span class="annottext">serverAPI :: Proxy ServerAPI
</span><a href="Unison.Server.CodebaseServer.html#serverAPI"><span class="hs-identifier hs-var hs-var">serverAPI</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall {k} (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span>
</span><span id="line-277"></span><span>
</span><span id="line-278"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#appAPI"><span class="hs-identifier hs-type">appAPI</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#AppAPI"><span class="hs-identifier hs-type">AppAPI</span></a></span><span>
</span><span id="line-279"></span><span id="appAPI"><span class="annot"><span class="annottext">appAPI :: Proxy AppAPI
</span><a href="Unison.Server.CodebaseServer.html#appAPI"><span class="hs-identifier hs-var hs-var">appAPI</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall {k} (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span>
</span><span id="line-280"></span><span>
</span><span id="line-281"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#app"><span class="hs-identifier hs-type">app</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-282"></span><span>  </span><span class="annot"><a href="Unison.Server.Backend.html#BackendEnv"><span class="hs-identifier hs-type">BackendEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-283"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Rt.Runtime</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-284"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-285"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-286"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Strict.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-287"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-288"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Application</span></span><span>
</span><span id="line-289"></span><span id="app"><span class="annot"><span class="annottext">app :: BackendEnv
-&gt; Runtime Symbol
-&gt; Codebase IO Symbol Ann
-&gt; String
-&gt; Method
-&gt; Maybe String
-&gt; Application
</span><a href="Unison.Server.CodebaseServer.html#app"><span class="hs-identifier hs-var hs-var">app</span></a></span></span><span> </span><span id="local-6989586621679382838"><span class="annot"><span class="annottext">BackendEnv
</span><a href="#local-6989586621679382838"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621679382837"><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679382837"><span class="hs-identifier hs-var">rt</span></a></span></span><span> </span><span id="local-6989586621679382836"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679382836"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621679382835"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679382835"><span class="hs-identifier hs-var">uiPath</span></a></span></span><span> </span><span id="local-6989586621679382834"><span class="annot"><span class="annottext">Method
</span><a href="#local-6989586621679382834"><span class="hs-identifier hs-var">expectedToken</span></a></span></span><span> </span><span id="local-6989586621679382833"><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621679382833"><span class="hs-identifier hs-var">allowCorsHost</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-290"></span><span>  </span><span class="annot"><span class="annottext">Maybe String -&gt; Middleware
</span><a href="Unison.Server.CodebaseServer.html#corsPolicy"><span class="hs-identifier hs-var">corsPolicy</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621679382833"><span class="hs-identifier hs-var">allowCorsHost</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall api.
HasServer api '[] =&gt;
Proxy api -&gt; Server api -&gt; Application
</span><span class="hs-identifier hs-var">serve</span></span><span> </span><span class="annot"><span class="annottext">Proxy AppAPI
</span><a href="Unison.Server.CodebaseServer.html#appAPI"><span class="hs-identifier hs-var">appAPI</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BackendEnv
-&gt; Runtime Symbol
-&gt; Codebase IO Symbol Ann
-&gt; String
-&gt; Method
-&gt; Server AppAPI
</span><a href="Unison.Server.CodebaseServer.html#server"><span class="hs-identifier hs-var">server</span></a></span><span> </span><span class="annot"><span class="annottext">BackendEnv
</span><a href="#local-6989586621679382838"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679382837"><span class="hs-identifier hs-var">rt</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679382836"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679382835"><span class="hs-identifier hs-var">uiPath</span></a></span><span> </span><span class="annot"><span class="annottext">Method
</span><a href="#local-6989586621679382834"><span class="hs-identifier hs-var">expectedToken</span></a></span><span>
</span><span id="line-291"></span><span>
</span><span id="line-292"></span><span class="hs-comment">-- | The Token is used to help prevent multiple users on a machine gain access to</span><span>
</span><span id="line-293"></span><span class="hs-comment">-- each others codebases.</span><span>
</span><span id="line-294"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#genToken"><span class="hs-identifier hs-type">genToken</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Strict.ByteString</span></span><span>
</span><span id="line-295"></span><span id="genToken"><span class="annot"><span class="annottext">genToken :: IO Method
</span><a href="Unison.Server.CodebaseServer.html#genToken"><span class="hs-identifier hs-var hs-var">genToken</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-296"></span><span>  </span><span id="local-6989586621679382829"><span class="annot"><span class="annottext">Gen RealWorld
</span><a href="#local-6989586621679382829"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO GenIO
</span><span class="hs-identifier hs-var">createSystemRandom</span></span><span>
</span><span id="line-297"></span><span>  </span><span id="local-6989586621679382828"><span class="annot"><span class="annottext">NanoID
</span><a href="#local-6989586621679382828"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Alphabet -&gt; Length -&gt; GenIO -&gt; IO NanoID
</span><span class="hs-identifier hs-var">customNanoID</span></span><span> </span><span class="annot"><span class="annottext">Alphabet
</span><span class="hs-identifier hs-var">defaultAlphabet</span></span><span> </span><span class="annot"><span class="annottext">Length
</span><span class="hs-number">16</span></span><span> </span><span class="annot"><span class="annottext">Gen RealWorld
</span><a href="#local-6989586621679382829"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-298"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NanoID -&gt; Method
</span><span class="hs-identifier hs-var">unNanoID</span></span><span> </span><span class="annot"><span class="annottext">NanoID
</span><a href="#local-6989586621679382828"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-299"></span><span>
</span><span id="line-300"></span><span class="hs-keyword">data</span><span> </span><span id="Waiter"><span class="annot"><a href="Unison.Server.CodebaseServer.html#Waiter"><span class="hs-identifier hs-var">Waiter</span></a></span></span><span> </span><span id="local-6989586621679383799"><span class="annot"><a href="#local-6989586621679383799"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Waiter"><span class="annot"><a href="Unison.Server.CodebaseServer.html#Waiter"><span class="hs-identifier hs-var">Waiter</span></a></span></span><span>
</span><span id="line-301"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3Anotify%3AWaiter"><span class="annot"><span class="annottext">forall a. Waiter a -&gt; a -&gt; IO ()
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3Anotify%3AWaiter"><span class="hs-identifier hs-var hs-var">notify</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679383799"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-302"></span><span>    </span><span id="%24sel%3AwaitFor%3AWaiter"><span class="annot"><span class="annottext">forall a. Waiter a -&gt; IO a
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3AwaitFor%3AWaiter"><span class="hs-identifier hs-var hs-var">waitFor</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679383799"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-303"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-304"></span><span>
</span><span id="line-305"></span><span id="local-6989586621679383795"><span class="annot"><a href="Unison.Server.CodebaseServer.html#mkWaiter"><span class="hs-identifier hs-type">mkWaiter</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.CodebaseServer.html#Waiter"><span class="hs-identifier hs-type">Waiter</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679383795"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-306"></span><span id="mkWaiter"><span class="annot"><span class="annottext">mkWaiter :: forall a. IO (Waiter a)
</span><a href="Unison.Server.CodebaseServer.html#mkWaiter"><span class="hs-identifier hs-var hs-var">mkWaiter</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-307"></span><span>  </span><span id="local-6989586621679382821"><span class="annot"><span class="annottext">MVar a
</span><a href="#local-6989586621679382821"><span class="hs-identifier hs-var">mvar</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. IO (MVar a)
</span><span class="hs-identifier hs-var">newEmptyMVar</span></span><span>
</span><span id="line-308"></span><span>  </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span>
</span><span id="line-309"></span><span>    </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#Waiter"><span class="hs-identifier hs-type">Waiter</span></a></span><span>
</span><span id="line-310"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:notify:Waiter :: a -&gt; IO ()
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3Anotify%3AWaiter"><span class="hs-identifier hs-var">notify</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. MVar a -&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">putMVar</span></span><span> </span><span class="annot"><span class="annottext">MVar a
</span><a href="#local-6989586621679382821"><span class="hs-identifier hs-var">mvar</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-311"></span><span>        </span><span class="annot"><span class="annottext">$sel:waitFor:Waiter :: IO a
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3AwaitFor%3AWaiter"><span class="hs-identifier hs-var">waitFor</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. MVar a -&gt; IO a
</span><span class="hs-identifier hs-var">readMVar</span></span><span> </span><span class="annot"><span class="annottext">MVar a
</span><a href="#local-6989586621679382821"><span class="hs-identifier hs-var">mvar</span></a></span><span>
</span><span id="line-312"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-313"></span><span>
</span><span id="line-314"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#ucmUIVar"><span class="hs-identifier hs-type">ucmUIVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-315"></span><span id="ucmUIVar"><span class="annot"><span class="annottext">ucmUIVar :: String
</span><a href="Unison.Server.CodebaseServer.html#ucmUIVar"><span class="hs-identifier hs-var hs-var">ucmUIVar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;UCM_WEB_UI&quot;</span></span><span>
</span><span id="line-316"></span><span>
</span><span id="line-317"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#ucmPortVar"><span class="hs-identifier hs-type">ucmPortVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-318"></span><span id="ucmPortVar"><span class="annot"><span class="annottext">ucmPortVar :: String
</span><a href="Unison.Server.CodebaseServer.html#ucmPortVar"><span class="hs-identifier hs-var hs-var">ucmPortVar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;UCM_PORT&quot;</span></span><span>
</span><span id="line-319"></span><span>
</span><span id="line-320"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#ucmHostVar"><span class="hs-identifier hs-type">ucmHostVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-321"></span><span id="ucmHostVar"><span class="annot"><span class="annottext">ucmHostVar :: String
</span><a href="Unison.Server.CodebaseServer.html#ucmHostVar"><span class="hs-identifier hs-var hs-var">ucmHostVar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;UCM_HOST&quot;</span></span><span>
</span><span id="line-322"></span><span>
</span><span id="line-323"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#ucmAllowCorsHost"><span class="hs-identifier hs-type">ucmAllowCorsHost</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-324"></span><span id="ucmAllowCorsHost"><span class="annot"><span class="annottext">ucmAllowCorsHost :: String
</span><a href="Unison.Server.CodebaseServer.html#ucmAllowCorsHost"><span class="hs-identifier hs-var hs-var">ucmAllowCorsHost</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;UCM_ALLOW_CORS_HOST&quot;</span></span><span>
</span><span id="line-325"></span><span>
</span><span id="line-326"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#ucmTokenVar"><span class="hs-identifier hs-type">ucmTokenVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-327"></span><span id="ucmTokenVar"><span class="annot"><span class="annottext">ucmTokenVar :: String
</span><a href="Unison.Server.CodebaseServer.html#ucmTokenVar"><span class="hs-identifier hs-var hs-var">ucmTokenVar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;UCM_TOKEN&quot;</span></span><span>
</span><span id="line-328"></span><span>
</span><span id="line-329"></span><span class="hs-keyword">data</span><span> </span><span id="CodebaseServerOpts"><span class="annot"><a href="Unison.Server.CodebaseServer.html#CodebaseServerOpts"><span class="hs-identifier hs-var">CodebaseServerOpts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="CodebaseServerOpts"><span class="annot"><a href="Unison.Server.CodebaseServer.html#CodebaseServerOpts"><span class="hs-identifier hs-var">CodebaseServerOpts</span></a></span></span><span>
</span><span id="line-330"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3Atoken%3ACodebaseServerOpts"><span class="annot"><span class="annottext">CodebaseServerOpts -&gt; Maybe String
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3Atoken%3ACodebaseServerOpts"><span class="hs-identifier hs-var hs-var">token</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">,</span><span>
</span><span id="line-331"></span><span>    </span><span id="%24sel%3Ahost%3ACodebaseServerOpts"><span class="annot"><span class="annottext">CodebaseServerOpts -&gt; Maybe String
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3Ahost%3ACodebaseServerOpts"><span class="hs-identifier hs-var hs-var">host</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">,</span><span>
</span><span id="line-332"></span><span>    </span><span id="%24sel%3Aport%3ACodebaseServerOpts"><span class="annot"><span class="annottext">CodebaseServerOpts -&gt; Maybe Int
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3Aport%3ACodebaseServerOpts"><span class="hs-identifier hs-var hs-var">port</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span>
</span><span id="line-333"></span><span>    </span><span id="%24sel%3AallowCorsHost%3ACodebaseServerOpts"><span class="annot"><span class="annottext">CodebaseServerOpts -&gt; Maybe String
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3AallowCorsHost%3ACodebaseServerOpts"><span class="hs-identifier hs-var hs-var">allowCorsHost</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">,</span><span>
</span><span id="line-334"></span><span>    </span><span id="%24sel%3AcodebaseUIPath%3ACodebaseServerOpts"><span class="annot"><span class="annottext">CodebaseServerOpts -&gt; Maybe String
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3AcodebaseUIPath%3ACodebaseServerOpts"><span class="hs-identifier hs-var hs-var">codebaseUIPath</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span>
</span><span id="line-335"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-336"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679382794"><span id="local-6989586621679382796"><span id="local-6989586621679382808"><span class="annot"><span class="annottext">Int -&gt; CodebaseServerOpts -&gt; ShowS
[CodebaseServerOpts] -&gt; ShowS
CodebaseServerOpts -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [CodebaseServerOpts] -&gt; ShowS
$cshowList :: [CodebaseServerOpts] -&gt; ShowS
show :: CodebaseServerOpts -&gt; String
$cshow :: CodebaseServerOpts -&gt; String
showsPrec :: Int -&gt; CodebaseServerOpts -&gt; ShowS
$cshowsPrec :: Int -&gt; CodebaseServerOpts -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679382779"><span id="local-6989586621679382789"><span class="annot"><span class="annottext">CodebaseServerOpts -&gt; CodebaseServerOpts -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: CodebaseServerOpts -&gt; CodebaseServerOpts -&gt; Bool
$c/= :: CodebaseServerOpts -&gt; CodebaseServerOpts -&gt; Bool
== :: CodebaseServerOpts -&gt; CodebaseServerOpts -&gt; Bool
$c== :: CodebaseServerOpts -&gt; CodebaseServerOpts -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-337"></span><span>
</span><span id="line-338"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#defaultCodebaseServerOpts"><span class="hs-identifier hs-type">defaultCodebaseServerOpts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#CodebaseServerOpts"><span class="hs-identifier hs-type">CodebaseServerOpts</span></a></span><span>
</span><span id="line-339"></span><span id="defaultCodebaseServerOpts"><span class="annot"><span class="annottext">defaultCodebaseServerOpts :: CodebaseServerOpts
</span><a href="Unison.Server.CodebaseServer.html#defaultCodebaseServerOpts"><span class="hs-identifier hs-var hs-var">defaultCodebaseServerOpts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-340"></span><span>  </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#CodebaseServerOpts"><span class="hs-identifier hs-type">CodebaseServerOpts</span></a></span><span>
</span><span id="line-341"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:token:CodebaseServerOpts :: Maybe String
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3Atoken%3ACodebaseServerOpts"><span class="hs-identifier hs-var">token</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span>
</span><span id="line-342"></span><span>      </span><span class="annot"><span class="annottext">$sel:host:CodebaseServerOpts :: Maybe String
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3Ahost%3ACodebaseServerOpts"><span class="hs-identifier hs-var">host</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span>
</span><span id="line-343"></span><span>      </span><span class="annot"><span class="annottext">$sel:port:CodebaseServerOpts :: Maybe Int
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3Aport%3ACodebaseServerOpts"><span class="hs-identifier hs-var">port</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span>
</span><span id="line-344"></span><span>      </span><span class="annot"><span class="annottext">$sel:allowCorsHost:CodebaseServerOpts :: Maybe String
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3AallowCorsHost%3ACodebaseServerOpts"><span class="hs-identifier hs-var">allowCorsHost</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span>
</span><span id="line-345"></span><span>      </span><span class="annot"><span class="annottext">$sel:codebaseUIPath:CodebaseServerOpts :: Maybe String
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3AcodebaseUIPath%3ACodebaseServerOpts"><span class="hs-identifier hs-var">codebaseUIPath</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-346"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-347"></span><span>
</span><span id="line-348"></span><span class="hs-comment">-- The auth token required for accessing the server is passed to the function k</span><span>
</span><span id="line-349"></span><span id="local-6989586621679383783"><span class="annot"><a href="Unison.Server.CodebaseServer.html#startServer"><span class="hs-identifier hs-type">startServer</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-350"></span><span>  </span><span class="annot"><a href="Unison.Server.Backend.html#BackendEnv"><span class="hs-identifier hs-type">BackendEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-351"></span><span>  </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#CodebaseServerOpts"><span class="hs-identifier hs-type">CodebaseServerOpts</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-352"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Rt.Runtime</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-353"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-354"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.CodebaseServer.html#BaseUrl"><span class="hs-identifier hs-type">BaseUrl</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679383783"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-355"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679383783"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-356"></span><span id="startServer"><span class="annot"><span class="annottext">startServer :: forall a.
BackendEnv
-&gt; CodebaseServerOpts
-&gt; Runtime Symbol
-&gt; Codebase IO Symbol Ann
-&gt; (BaseUrl -&gt; IO a)
-&gt; IO a
</span><a href="Unison.Server.CodebaseServer.html#startServer"><span class="hs-identifier hs-var hs-var">startServer</span></a></span></span><span> </span><span id="local-6989586621679382756"><span class="annot"><span class="annottext">BackendEnv
</span><a href="#local-6989586621679382756"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621679382755"><span class="annot"><span class="annottext">CodebaseServerOpts
</span><a href="#local-6989586621679382755"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span id="local-6989586621679382754"><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679382754"><span class="hs-identifier hs-var">rt</span></a></span></span><span> </span><span id="local-6989586621679382753"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679382753"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621679382752"><span class="annot"><span class="annottext">BaseUrl -&gt; IO a
</span><a href="#local-6989586621679382752"><span class="hs-identifier hs-var">onStart</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-357"></span><span>  </span><span class="hs-comment">-- the `canonicalizePath` resolves symlinks</span><span>
</span><span id="line-358"></span><span>  </span><span id="local-6989586621679382751"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679382751"><span class="hs-identifier hs-var">exePath</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO String
</span><span class="hs-identifier hs-var">canonicalizePath</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">IO String
</span><span class="hs-identifier hs-var">getExecutablePath</span></span><span>
</span><span id="line-359"></span><span>  </span><span id="local-6989586621679382749"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679382749"><span class="hs-identifier hs-var">envUI</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO String
</span><span class="hs-identifier hs-var">canonicalizePath</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShowS
</span><span class="hs-identifier hs-var">FilePath.takeDirectory</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679382751"><span class="hs-identifier hs-var">exePath</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ui&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CodebaseServerOpts -&gt; Maybe String
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3AcodebaseUIPath%3ACodebaseServerOpts"><span class="hs-identifier hs-var">codebaseUIPath</span></a></span><span> </span><span class="annot"><span class="annottext">CodebaseServerOpts
</span><a href="#local-6989586621679382755"><span class="hs-identifier hs-var">opts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-360"></span><span>  </span><span id="local-6989586621679382746"><span class="annot"><span class="annottext">Method
</span><a href="#local-6989586621679382746"><span class="hs-identifier hs-var">token</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CodebaseServerOpts -&gt; Maybe String
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3Atoken%3ACodebaseServerOpts"><span class="hs-identifier hs-var">token</span></a></span><span> </span><span class="annot"><span class="annottext">CodebaseServerOpts
</span><a href="#local-6989586621679382755"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-361"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679382745"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679382745"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Method
</span><span class="hs-identifier hs-var">C8.pack</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679382745"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-362"></span><span>    </span><span class="annot"><span class="annottext">Maybe String
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO Method
</span><a href="Unison.Server.CodebaseServer.html#genToken"><span class="hs-identifier hs-var">genToken</span></a></span><span>
</span><span id="line-363"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679382743"><span class="annot"><span class="annottext">baseUrl :: Int -&gt; BaseUrl
</span><a href="#local-6989586621679382743"><span class="hs-identifier hs-var hs-var">baseUrl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Method -&gt; Int -&gt; BaseUrl
</span><a href="Unison.Server.CodebaseServer.html#BaseUrl"><span class="hs-identifier hs-var">BaseUrl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;http://127.0.0.1&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CodebaseServerOpts -&gt; Maybe String
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3Ahost%3ACodebaseServerOpts"><span class="hs-identifier hs-var">host</span></a></span><span> </span><span class="annot"><span class="annottext">CodebaseServerOpts
</span><a href="#local-6989586621679382755"><span class="hs-identifier hs-var">opts</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Method
</span><a href="#local-6989586621679382746"><span class="hs-identifier hs-var">token</span></a></span><span>
</span><span id="line-364"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679382742"><span class="annot"><span class="annottext">settings :: Settings
</span><a href="#local-6989586621679382742"><span class="hs-identifier hs-var hs-var">settings</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-365"></span><span>        </span><span class="annot"><span class="annottext">Settings
</span><span class="hs-identifier hs-var">defaultSettings</span></span><span>
</span><span id="line-366"></span><span>          </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Settings -&gt; Settings
</span><span class="hs-identifier hs-var">setPort</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CodebaseServerOpts -&gt; Maybe Int
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3Aport%3ACodebaseServerOpts"><span class="hs-identifier hs-var">port</span></a></span><span> </span><span class="annot"><span class="annottext">CodebaseServerOpts
</span><a href="#local-6989586621679382755"><span class="hs-identifier hs-var">opts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-367"></span><span>          </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HostPreference -&gt; Settings -&gt; Settings
</span><span class="hs-identifier hs-var">setHost</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a. IsString a =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">fromString</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CodebaseServerOpts -&gt; Maybe String
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3Ahost%3ACodebaseServerOpts"><span class="hs-identifier hs-var">host</span></a></span><span> </span><span class="annot"><span class="annottext">CodebaseServerOpts
</span><a href="#local-6989586621679382755"><span class="hs-identifier hs-var">opts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-368"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679382739"><span class="annot"><span class="annottext">a :: Application
</span><a href="#local-6989586621679382739"><span class="hs-identifier hs-var hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BackendEnv
-&gt; Runtime Symbol
-&gt; Codebase IO Symbol Ann
-&gt; String
-&gt; Method
-&gt; Maybe String
-&gt; Application
</span><a href="Unison.Server.CodebaseServer.html#app"><span class="hs-identifier hs-var">app</span></a></span><span> </span><span class="annot"><span class="annottext">BackendEnv
</span><a href="#local-6989586621679382756"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679382754"><span class="hs-identifier hs-var">rt</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679382753"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679382749"><span class="hs-identifier hs-var">envUI</span></a></span><span> </span><span class="annot"><span class="annottext">Method
</span><a href="#local-6989586621679382746"><span class="hs-identifier hs-var">token</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CodebaseServerOpts -&gt; Maybe String
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3AallowCorsHost%3ACodebaseServerOpts"><span class="hs-identifier hs-var">allowCorsHost</span></a></span><span> </span><span class="annot"><span class="annottext">CodebaseServerOpts
</span><a href="#local-6989586621679382755"><span class="hs-identifier hs-var">opts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-369"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CodebaseServerOpts -&gt; Maybe Int
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3Aport%3ACodebaseServerOpts"><span class="hs-identifier hs-var">port</span></a></span><span> </span><span class="annot"><span class="annottext">CodebaseServerOpts
</span><a href="#local-6989586621679382755"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-370"></span><span>    </span><span class="annot"><span class="annottext">Maybe Int
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. Settings -&gt; IO Application -&gt; (Int -&gt; IO a) -&gt; IO a
</span><span class="hs-identifier hs-var">withApplicationSettings</span></span><span> </span><span class="annot"><span class="annottext">Settings
</span><a href="#local-6989586621679382742"><span class="hs-identifier hs-var">settings</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Application
</span><a href="#local-6989586621679382739"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BaseUrl -&gt; IO a
</span><a href="#local-6989586621679382752"><span class="hs-identifier hs-var">onStart</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; BaseUrl
</span><a href="#local-6989586621679382743"><span class="hs-identifier hs-var">baseUrl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-371"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679382738"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679382738"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-372"></span><span>      </span><span id="local-6989586621679382737"><span class="annot"><span class="annottext">Waiter ()
</span><a href="#local-6989586621679382737"><span class="hs-identifier hs-var">started</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. IO (Waiter a)
</span><a href="Unison.Server.CodebaseServer.html#mkWaiter"><span class="hs-identifier hs-var">mkWaiter</span></a></span><span>
</span><span id="line-373"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679382736"><span class="annot"><span class="annottext">settings' :: Settings
</span><a href="#local-6989586621679382736"><span class="hs-identifier hs-var hs-var">settings'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; Settings -&gt; Settings
</span><span class="hs-identifier hs-var">setBeforeMainLoop</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Waiter a -&gt; a -&gt; IO ()
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3Anotify%3AWaiter"><span class="hs-identifier hs-var">notify</span></a></span><span> </span><span class="annot"><span class="annottext">Waiter ()
</span><a href="#local-6989586621679382737"><span class="hs-identifier hs-var">started</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Settings
</span><a href="#local-6989586621679382742"><span class="hs-identifier hs-var">settings</span></a></span><span>
</span><span id="line-374"></span><span>      </span><span id="local-6989586621679382735"><span class="annot"><span class="annottext">Either () a
</span><a href="#local-6989586621679382735"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-375"></span><span>        </span><span class="annot"><span class="annottext">forall a b. IO a -&gt; IO b -&gt; IO (Either a b)
</span><span class="hs-identifier hs-var">race</span></span><span>
</span><span id="line-376"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Settings -&gt; Application -&gt; IO ()
</span><span class="hs-identifier hs-var">runSettings</span></span><span> </span><span class="annot"><span class="annottext">Settings
</span><a href="#local-6989586621679382736"><span class="hs-identifier hs-var">settings'</span></a></span><span> </span><span class="annot"><span class="annottext">Application
</span><a href="#local-6989586621679382739"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-377"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Waiter a -&gt; IO a
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3AwaitFor%3AWaiter"><span class="hs-identifier hs-var">waitFor</span></a></span><span> </span><span class="annot"><span class="annottext">Waiter ()
</span><a href="#local-6989586621679382737"><span class="hs-identifier hs-var">started</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f b
</span><span class="hs-operator hs-var">*&gt;</span></span><span> </span><span class="annot"><span class="annottext">BaseUrl -&gt; IO a
</span><a href="#local-6989586621679382752"><span class="hs-identifier hs-var">onStart</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; BaseUrl
</span><a href="#local-6989586621679382743"><span class="hs-identifier hs-var">baseUrl</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679382738"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-378"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either () a
</span><a href="#local-6989586621679382735"><span class="hs-identifier hs-var">result</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-379"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall e a. Exception e =&gt; e -&gt; IO a
</span><span class="hs-identifier hs-var">throwIO</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ErrorCall
</span><span class="hs-identifier hs-var">ErrorCall</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Server exited unexpectedly!&quot;</span></span><span>
</span><span id="line-380"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679382733"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679382733"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679382733"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-381"></span><span>
</span><span id="line-382"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#serveIndex"><span class="hs-identifier hs-type">serveIndex</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Handler</span></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#RawHtml"><span class="hs-identifier hs-type">RawHtml</span></a></span><span>
</span><span id="line-383"></span><span id="serveIndex"><span class="annot"><span class="annottext">serveIndex :: String -&gt; Handler RawHtml
</span><a href="Unison.Server.CodebaseServer.html#serveIndex"><span class="hs-identifier hs-var hs-var">serveIndex</span></a></span></span><span> </span><span id="local-6989586621679382731"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679382731"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-384"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679382730"><span class="annot"><span class="annottext">index :: String
</span><a href="#local-6989586621679382730"><span class="hs-identifier hs-var hs-var">index</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679382731"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;index.html&quot;</span></span><span>
</span><span id="line-385"></span><span>  </span><span id="local-6989586621679382729"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679382729"><span class="hs-identifier hs-var">exists</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; IO Bool
</span><span class="hs-identifier hs-var">doesFileExist</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679382730"><span class="hs-identifier hs-var">index</span></a></span><span>
</span><span id="line-386"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679382729"><span class="hs-identifier hs-var">exists</span></a></span><span>
</span><span id="line-387"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; RawHtml
</span><a href="Unison.Server.CodebaseServer.html#RawHtml"><span class="hs-identifier hs-var">RawHtml</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; IO ByteString
</span><span class="hs-identifier hs-var">Lazy.readFile</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679382731"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;index.html&quot;</span></span><span>
</span><span id="line-388"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall {a}. Handler a
</span><a href="#local-6989586621679382726"><span class="hs-identifier hs-var">fail</span></a></span><span>
</span><span id="line-389"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-390"></span><span>    </span><span id="local-6989586621679382726"><span class="annot"><span class="annottext">fail :: Handler a
</span><a href="#local-6989586621679382726"><span class="hs-identifier hs-var hs-var">fail</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-391"></span><span>      </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-392"></span><span>        </span><span class="annot"><span class="annottext">ServerError
</span><span class="hs-identifier hs-var">err404</span></span><span>
</span><span id="line-393"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">errBody :: ByteString
</span><span class="hs-identifier hs-var">errBody</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-394"></span><span>              </span><span class="annot"><span class="annottext">String -&gt; ByteString
</span><span class="hs-identifier hs-var">BLU.fromString</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-395"></span><span>                </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;No codebase UI configured.&quot;</span></span><span>
</span><span id="line-396"></span><span>                  </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; Set the &quot;</span></span><span>
</span><span id="line-397"></span><span>                  </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="Unison.Server.CodebaseServer.html#ucmUIVar"><span class="hs-identifier hs-var">ucmUIVar</span></a></span><span>
</span><span id="line-398"></span><span>                  </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; environment variable to the directory where the UI is installed.&quot;</span></span><span>
</span><span id="line-399"></span><span>                  </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; If you're running a dev build of ucm, run `./dev-ui-install.sh`.&quot;</span></span><span>
</span><span id="line-400"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-401"></span><span>
</span><span id="line-402"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#serveUI"><span class="hs-identifier hs-type">serveUI</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Server</span></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#WebUI"><span class="hs-identifier hs-type">WebUI</span></a></span><span>
</span><span id="line-403"></span><span id="serveUI"><span class="annot"><span class="annottext">serveUI :: String -&gt; Server WebUI
</span><a href="Unison.Server.CodebaseServer.html#serveUI"><span class="hs-identifier hs-var hs-var">serveUI</span></a></span></span><span> </span><span id="local-6989586621679382713"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679382713"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Handler RawHtml
</span><a href="Unison.Server.CodebaseServer.html#serveIndex"><span class="hs-identifier hs-var">serveIndex</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679382713"><span class="hs-identifier hs-var">path</span></a></span><span>
</span><span id="line-404"></span><span>
</span><span id="line-405"></span><span class="hs-comment">-- Apply cors if there is allow-cors-host defined</span><span>
</span><span id="line-406"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#corsPolicy"><span class="hs-identifier hs-type">corsPolicy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Middleware</span></span><span>
</span><span id="line-407"></span><span id="corsPolicy"><span class="annot"><span class="annottext">corsPolicy :: Maybe String -&gt; Middleware
</span><a href="Unison.Server.CodebaseServer.html#corsPolicy"><span class="hs-identifier hs-var hs-var">corsPolicy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679382712"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679382712"><span class="hs-identifier hs-var">allowCorsHost</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-408"></span><span>  </span><span class="annot"><span class="annottext">(Request -&gt; Maybe CorsResourcePolicy) -&gt; Middleware
</span><span class="hs-identifier hs-var">cors</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-409"></span><span>    </span><span class="annot"><span class="annottext">forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-410"></span><span>      </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span>
</span><span id="line-411"></span><span>        </span><span class="annot"><span class="annottext">CorsResourcePolicy
</span><span class="hs-identifier hs-var">simpleCorsResourcePolicy</span></span><span>
</span><span id="line-412"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">corsMethods :: [Method]
</span><span class="hs-identifier hs-var">corsMethods</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Method
</span><span class="hs-string">&quot;GET&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Method
</span><span class="hs-string">&quot;OPTIONS&quot;</span></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-413"></span><span>            </span><span class="annot"><span class="annottext">corsOrigins :: Maybe ([Method], Bool)
</span><span class="hs-identifier hs-var">corsOrigins</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="annottext">String -&gt; Method
</span><span class="hs-identifier hs-var">C8.pack</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679382712"><span class="hs-identifier hs-var">allowCorsHost</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span>
</span><span id="line-414"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-415"></span><span>
</span><span id="line-416"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#server"><span class="hs-identifier hs-type">server</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-417"></span><span>  </span><span class="annot"><a href="Unison.Server.Backend.html#BackendEnv"><span class="hs-identifier hs-type">BackendEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-418"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Rt.Runtime</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-419"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-420"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-421"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Strict.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-422"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Server</span></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#AppAPI"><span class="hs-identifier hs-type">AppAPI</span></a></span><span>
</span><span id="line-423"></span><span id="server"><span class="annot"><span class="annottext">server :: BackendEnv
-&gt; Runtime Symbol
-&gt; Codebase IO Symbol Ann
-&gt; String
-&gt; Method
-&gt; Server AppAPI
</span><a href="Unison.Server.CodebaseServer.html#server"><span class="hs-identifier hs-var hs-var">server</span></a></span></span><span> </span><span id="local-6989586621679382710"><span class="annot"><span class="annottext">BackendEnv
</span><a href="#local-6989586621679382710"><span class="hs-identifier hs-var">backendEnv</span></a></span></span><span> </span><span id="local-6989586621679382709"><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679382709"><span class="hs-identifier hs-var">rt</span></a></span></span><span> </span><span id="local-6989586621679382708"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679382708"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621679382707"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679382707"><span class="hs-identifier hs-var">uiPath</span></a></span></span><span> </span><span id="local-6989586621679382706"><span class="annot"><span class="annottext">Method
</span><a href="#local-6989586621679382706"><span class="hs-identifier hs-var">expectedToken</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-424"></span><span>  </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). String -&gt; ServerT Raw m
</span><span class="hs-identifier hs-var">serveDirectoryWebApp</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679382707"><span class="hs-identifier hs-var">uiPath</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;static&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-425"></span><span>    </span><span class="annot"><span class="annottext">forall a b. a -&gt; b -&gt; a :&lt;|&gt; b
</span><span class="hs-operator hs-var">:&lt;|&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall api.
HasServer api '[] =&gt;
Proxy api
-&gt; Method -&gt; ServerT api Handler -&gt; ServerT (Authed api) Handler
</span><a href="Unison.Server.CodebaseServer.html#hoistWithAuth"><span class="hs-identifier hs-var">hoistWithAuth</span></a></span><span> </span><span class="annot"><span class="annottext">Proxy ServerAPI
</span><a href="Unison.Server.CodebaseServer.html#serverAPI"><span class="hs-identifier hs-var">serverAPI</span></a></span><span> </span><span class="annot"><span class="annottext">Method
</span><a href="#local-6989586621679382706"><span class="hs-identifier hs-var">expectedToken</span></a></span><span> </span><span class="annot"><span class="annottext">Server ServerAPI
</span><a href="#local-6989586621679382703"><span class="hs-identifier hs-var">serveServer</span></a></span><span>
</span><span id="line-426"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-427"></span><span>    </span><span class="annot"><a href="#local-6989586621679382703"><span class="hs-identifier hs-type">serveServer</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Server</span></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#ServerAPI"><span class="hs-identifier hs-type">ServerAPI</span></a></span><span>
</span><span id="line-428"></span><span>    </span><span id="local-6989586621679382703"><span class="annot"><span class="annottext">serveServer :: Server ServerAPI
</span><a href="#local-6989586621679382703"><span class="hs-identifier hs-var hs-var">serveServer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-429"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; Server WebUI
</span><a href="Unison.Server.CodebaseServer.html#serveUI"><span class="hs-identifier hs-var">serveUI</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679382707"><span class="hs-identifier hs-var">uiPath</span></a></span><span>
</span><span id="line-430"></span><span>        </span><span class="annot"><span class="annottext">forall a b. a -&gt; b -&gt; a :&lt;|&gt; b
</span><span class="hs-operator hs-var">:&lt;|&gt;</span></span><span> </span><span class="annot"><span class="annottext">BackendEnv
-&gt; Runtime Symbol
-&gt; Codebase IO Symbol Ann
-&gt; Server UnisonAndDocsAPI
</span><a href="Unison.Server.CodebaseServer.html#serveUnisonAndDocs"><span class="hs-identifier hs-var">serveUnisonAndDocs</span></a></span><span> </span><span class="annot"><span class="annottext">BackendEnv
</span><a href="#local-6989586621679382710"><span class="hs-identifier hs-var">backendEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679382709"><span class="hs-identifier hs-var">rt</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679382708"><span class="hs-identifier hs-var">codebase</span></a></span><span>
</span><span id="line-431"></span><span>
</span><span id="line-432"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#serveUnisonAndDocs"><span class="hs-identifier hs-type">serveUnisonAndDocs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#BackendEnv"><span class="hs-identifier hs-type">BackendEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Rt.Runtime</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Server</span></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#UnisonAndDocsAPI"><span class="hs-identifier hs-type">UnisonAndDocsAPI</span></a></span><span>
</span><span id="line-433"></span><span id="serveUnisonAndDocs"><span class="annot"><span class="annottext">serveUnisonAndDocs :: BackendEnv
-&gt; Runtime Symbol
-&gt; Codebase IO Symbol Ann
-&gt; Server UnisonAndDocsAPI
</span><a href="Unison.Server.CodebaseServer.html#serveUnisonAndDocs"><span class="hs-identifier hs-var hs-var">serveUnisonAndDocs</span></a></span></span><span> </span><span id="local-6989586621679382701"><span class="annot"><span class="annottext">BackendEnv
</span><a href="#local-6989586621679382701"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621679382700"><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679382700"><span class="hs-identifier hs-var">rt</span></a></span></span><span> </span><span id="local-6989586621679382699"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679382699"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BackendEnv
-&gt; Codebase IO Symbol Ann -&gt; Runtime Symbol -&gt; Server UnisonAPI
</span><a href="Unison.Server.CodebaseServer.html#serveUnison"><span class="hs-identifier hs-var">serveUnison</span></a></span><span> </span><span class="annot"><span class="annottext">BackendEnv
</span><a href="#local-6989586621679382701"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679382699"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679382700"><span class="hs-identifier hs-var">rt</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. a -&gt; b -&gt; a :&lt;|&gt; b
</span><span class="hs-operator hs-var">:&lt;|&gt;</span></span><span> </span><span class="annot"><span class="annottext">Handler OpenApi
</span><a href="Unison.Server.CodebaseServer.html#serveOpenAPI"><span class="hs-identifier hs-var">serveOpenAPI</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. a -&gt; b -&gt; a :&lt;|&gt; b
</span><span class="hs-operator hs-var">:&lt;|&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall {k} (s :: k) b. b -&gt; Tagged s b
</span><span class="hs-identifier hs-var">Tagged</span></span><span> </span><span class="annot"><span class="annottext">Application
</span><a href="Unison.Server.CodebaseServer.html#serveDocs"><span class="hs-identifier hs-var">serveDocs</span></a></span><span>
</span><span id="line-434"></span><span>
</span><span id="line-435"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#serveDocs"><span class="hs-identifier hs-type">serveDocs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Application</span></span><span>
</span><span id="line-436"></span><span id="serveDocs"><span class="annot"><span class="annottext">serveDocs :: Application
</span><a href="Unison.Server.CodebaseServer.html#serveDocs"><span class="hs-identifier hs-var hs-var">serveDocs</span></a></span></span><span> </span><span class="annot"><span class="annottext">Request
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679382695"><span class="annot"><span class="annottext">Response -&gt; IO ResponseReceived
</span><a href="#local-6989586621679382695"><span class="hs-identifier hs-var">respond</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Response -&gt; IO ResponseReceived
</span><a href="#local-6989586621679382695"><span class="hs-identifier hs-var">respond</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Status -&gt; ResponseHeaders -&gt; ByteString -&gt; Response
</span><span class="hs-identifier hs-var">responseLBS</span></span><span> </span><span class="annot"><span class="annottext">Status
</span><span class="hs-identifier hs-var">ok200</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">(HeaderName, Method)
</span><a href="#local-6989586621679382694"><span class="hs-identifier hs-var">plain</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="Unison.Server.CodebaseServer.html#docsBS"><span class="hs-identifier hs-var">docsBS</span></a></span><span>
</span><span id="line-437"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-438"></span><span>    </span><span class="annot"><a href="#local-6989586621679382694"><span class="hs-identifier hs-type">plain</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HeaderName</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span class="hs-special">)</span><span>
</span><span id="line-439"></span><span>    </span><span id="local-6989586621679382694"><span class="annot"><span class="annottext">plain :: (HeaderName, Method)
</span><a href="#local-6989586621679382694"><span class="hs-identifier hs-var hs-var">plain</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HeaderName
</span><span class="hs-string">&quot;Content-Type&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Method
</span><span class="hs-string">&quot;text/plain&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-440"></span><span>
</span><span id="line-441"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#serveOpenAPI"><span class="hs-identifier hs-type">serveOpenAPI</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Handler</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">OpenApi</span></span><span>
</span><span id="line-442"></span><span id="serveOpenAPI"><span class="annot"><span class="annottext">serveOpenAPI :: Handler OpenApi
</span><a href="Unison.Server.CodebaseServer.html#serveOpenAPI"><span class="hs-identifier hs-var hs-var">serveOpenAPI</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">OpenApi
</span><a href="Unison.Server.CodebaseServer.html#openAPI"><span class="hs-identifier hs-var">openAPI</span></a></span><span>
</span><span id="line-443"></span><span>
</span><span id="line-444"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#hoistWithAuth"><span class="hs-identifier hs-type">hoistWithAuth</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679383750"><span class="annot"><a href="#local-6989586621679383750"><span class="hs-identifier hs-type">api</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HasServer</span></span><span> </span><span class="annot"><a href="#local-6989586621679383750"><span class="hs-identifier hs-type">api</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="#local-6989586621679383750"><span class="hs-identifier hs-type">api</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ServerT</span></span><span> </span><span class="annot"><a href="#local-6989586621679383750"><span class="hs-identifier hs-type">api</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Handler</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ServerT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.CodebaseServer.html#Authed"><span class="hs-identifier hs-type">Authed</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679383750"><span class="hs-identifier hs-type">api</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Handler</span></span><span>
</span><span id="line-445"></span><span id="hoistWithAuth"><span class="annot"><span class="annottext">hoistWithAuth :: forall api.
HasServer api '[] =&gt;
Proxy api
-&gt; Method -&gt; ServerT api Handler -&gt; ServerT (Authed api) Handler
</span><a href="Unison.Server.CodebaseServer.html#hoistWithAuth"><span class="hs-identifier hs-var hs-var">hoistWithAuth</span></a></span></span><span> </span><span id="local-6989586621679382691"><span class="annot"><span class="annottext">Proxy api
</span><a href="#local-6989586621679382691"><span class="hs-identifier hs-var">api</span></a></span></span><span> </span><span id="local-6989586621679382690"><span class="annot"><span class="annottext">Method
</span><a href="#local-6989586621679382690"><span class="hs-identifier hs-var">expectedToken</span></a></span></span><span> </span><span id="local-6989586621679382689"><span class="annot"><span class="annottext">ServerT api Handler
</span><a href="#local-6989586621679382689"><span class="hs-identifier hs-var">server</span></a></span></span><span> </span><span id="local-6989586621679382688"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679382688"><span class="hs-identifier hs-var">token</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall api (m :: * -&gt; *) (n :: * -&gt; *).
HasServer api '[] =&gt;
Proxy api
-&gt; (forall x. m x -&gt; n x) -&gt; ServerT api m -&gt; ServerT api n
</span><span class="hs-identifier hs-var">hoistServer</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679383750"><span class="hs-identifier hs-type">api</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">Handler</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">Handler</span></span><span> </span><span class="annot"><span class="annottext">Proxy api
</span><a href="#local-6989586621679382691"><span class="hs-identifier hs-var">api</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679382686"><span class="annot"><span class="annottext">Handler x
</span><a href="#local-6989586621679382686"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Method -&gt; Text -&gt; Handler ()
</span><a href="Unison.Server.CodebaseServer.html#handleAuth"><span class="hs-identifier hs-var">handleAuth</span></a></span><span> </span><span class="annot"><span class="annottext">Method
</span><a href="#local-6989586621679382690"><span class="hs-identifier hs-var">expectedToken</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679382688"><span class="hs-identifier hs-var">token</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f b
</span><span class="hs-operator hs-var">*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Handler x
</span><a href="#local-6989586621679382686"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ServerT api Handler
</span><a href="#local-6989586621679382689"><span class="hs-identifier hs-var">server</span></a></span><span>
</span><span id="line-446"></span><span>
</span><span id="line-447"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#serveUnison"><span class="hs-identifier hs-type">serveUnison</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-448"></span><span>  </span><span class="annot"><a href="Unison.Server.Backend.html#BackendEnv"><span class="hs-identifier hs-type">BackendEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-449"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-450"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Rt.Runtime</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-451"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Server</span></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#UnisonAPI"><span class="hs-identifier hs-type">UnisonAPI</span></a></span><span>
</span><span id="line-452"></span><span id="serveUnison"><span class="annot"><span class="annottext">serveUnison :: BackendEnv
-&gt; Codebase IO Symbol Ann -&gt; Runtime Symbol -&gt; Server UnisonAPI
</span><a href="Unison.Server.CodebaseServer.html#serveUnison"><span class="hs-identifier hs-var hs-var">serveUnison</span></a></span></span><span> </span><span id="local-6989586621679382685"><span class="annot"><span class="annottext">BackendEnv
</span><a href="#local-6989586621679382685"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621679382684"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679382684"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621679382683"><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679382683"><span class="hs-identifier hs-var">rt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-453"></span><span>  </span><span class="annot"><span class="annottext">forall api (m :: * -&gt; *) (n :: * -&gt; *).
HasServer api '[] =&gt;
Proxy api
-&gt; (forall x. m x -&gt; n x) -&gt; ServerT api m -&gt; ServerT api n
</span><span class="hs-identifier hs-var">hoistServer</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {k} (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Unison.Server.CodebaseServer.html#UnisonAPI"><span class="hs-identifier hs-type">UnisonAPI</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. BackendEnv -&gt; Backend IO a -&gt; Handler a
</span><a href="Unison.Server.CodebaseServer.html#backendHandler"><span class="hs-identifier hs-var">backendHandler</span></a></span><span> </span><span class="annot"><span class="annottext">BackendEnv
</span><a href="#local-6989586621679382685"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-454"></span><span>    </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679382681"><span class="annot"><span class="annottext">Maybe ShortCausalHash
</span><a href="#local-6989586621679382681"><span class="hs-identifier hs-var">root</span></a></span></span><span> </span><span id="local-6989586621679382680"><span class="annot"><span class="annottext">Maybe Path
</span><a href="#local-6989586621679382680"><span class="hs-identifier hs-var">rel</span></a></span></span><span> </span><span id="local-6989586621679382679"><span class="annot"><span class="annottext">Maybe Path
</span><a href="#local-6989586621679382679"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall v. v -&gt; APIHeaders v
</span><a href="Unison.Server.Types.html#setCacheControl"><span class="hs-identifier hs-var">setCacheControl</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; Maybe (Either ShortCausalHash CausalHash)
-&gt; Maybe Path
-&gt; Maybe Path
-&gt; Backend IO NamespaceListing
</span><a href="Unison.Server.Local.Endpoints.NamespaceListing.html#serve"><span class="hs-identifier hs-var">NamespaceListing.serve</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679382684"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe ShortCausalHash
</span><a href="#local-6989586621679382681"><span class="hs-identifier hs-var">root</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Path
</span><a href="#local-6989586621679382680"><span class="hs-identifier hs-var">rel</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Path
</span><a href="#local-6989586621679382679"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-455"></span><span>      </span><span class="annot"><span class="annottext">forall a b. a -&gt; b -&gt; a :&lt;|&gt; b
</span><span class="hs-operator hs-var">:&lt;|&gt;</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679382677"><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679382677"><span class="hs-identifier hs-var">namespaceName</span></a></span></span><span> </span><span id="local-6989586621679382676"><span class="annot"><span class="annottext">Maybe ShortCausalHash
</span><a href="#local-6989586621679382676"><span class="hs-identifier hs-var">mayRoot</span></a></span></span><span> </span><span id="local-6989586621679382675"><span class="annot"><span class="annottext">Maybe Width
</span><a href="#local-6989586621679382675"><span class="hs-identifier hs-var">renderWidth</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall v. v -&gt; APIHeaders v
</span><a href="Unison.Server.Types.html#setCacheControl"><span class="hs-identifier hs-var">setCacheControl</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Runtime Symbol
-&gt; Codebase IO Symbol Ann
-&gt; Path
-&gt; Maybe (Either ShortCausalHash CausalHash)
-&gt; Maybe Width
-&gt; Backend IO NamespaceDetails
</span><a href="Unison.Server.Local.Endpoints.NamespaceDetails.html#namespaceDetails"><span class="hs-identifier hs-var">NamespaceDetails.namespaceDetails</span></a></span><span> </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679382683"><span class="hs-identifier hs-var">rt</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679382684"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679382677"><span class="hs-identifier hs-var">namespaceName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe ShortCausalHash
</span><a href="#local-6989586621679382676"><span class="hs-identifier hs-var">mayRoot</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Width
</span><a href="#local-6989586621679382675"><span class="hs-identifier hs-var">renderWidth</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-456"></span><span>      </span><span class="annot"><span class="annottext">forall a b. a -&gt; b -&gt; a :&lt;|&gt; b
</span><span class="hs-operator hs-var">:&lt;|&gt;</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679382673"><span class="annot"><span class="annottext">Maybe ShortCausalHash
</span><a href="#local-6989586621679382673"><span class="hs-identifier hs-var">mayRoot</span></a></span></span><span> </span><span id="local-6989586621679382672"><span class="annot"><span class="annottext">Maybe ProjectOwner
</span><a href="#local-6989586621679382672"><span class="hs-identifier hs-var">mayOwner</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall v. v -&gt; APIHeaders v
</span><a href="Unison.Server.Types.html#setCacheControl"><span class="hs-identifier hs-var">setCacheControl</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
MonadIO m =&gt;
Codebase m Symbol Ann
-&gt; Maybe (Either ShortCausalHash CausalHash)
-&gt; Maybe ProjectOwner
-&gt; Backend m [ProjectListing]
</span><a href="Unison.Server.Local.Endpoints.Projects.html#serve"><span class="hs-identifier hs-var">Projects.serve</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679382684"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe ShortCausalHash
</span><a href="#local-6989586621679382673"><span class="hs-identifier hs-var">mayRoot</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe ProjectOwner
</span><a href="#local-6989586621679382672"><span class="hs-identifier hs-var">mayOwner</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-457"></span><span>      </span><span class="annot"><span class="annottext">forall a b. a -&gt; b -&gt; a :&lt;|&gt; b
</span><span class="hs-operator hs-var">:&lt;|&gt;</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679382670"><span class="annot"><span class="annottext">Maybe ShortCausalHash
</span><a href="#local-6989586621679382670"><span class="hs-identifier hs-var">mayRoot</span></a></span></span><span> </span><span id="local-6989586621679382669"><span class="annot"><span class="annottext">Maybe Path
</span><a href="#local-6989586621679382669"><span class="hs-identifier hs-var">relativePath</span></a></span></span><span> </span><span id="local-6989586621679382668"><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679382668"><span class="hs-identifier hs-var">rawHqns</span></a></span></span><span> </span><span id="local-6989586621679382667"><span class="annot"><span class="annottext">Maybe Width
</span><a href="#local-6989586621679382667"><span class="hs-identifier hs-var">renderWidth</span></a></span></span><span> </span><span id="local-6989586621679382666"><span class="annot"><span class="annottext">Maybe Suffixify
</span><a href="#local-6989586621679382666"><span class="hs-identifier hs-var">suff</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall v. v -&gt; APIHeaders v
</span><a href="Unison.Server.Types.html#setCacheControl"><span class="hs-identifier hs-var">setCacheControl</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Runtime Symbol
-&gt; Codebase IO Symbol Ann
-&gt; Maybe (Either ShortCausalHash CausalHash)
-&gt; Maybe Path
-&gt; [HashQualified Name]
-&gt; Maybe Width
-&gt; Maybe Suffixify
-&gt; Backend IO DefinitionDisplayResults
</span><a href="Unison.Server.Local.Endpoints.GetDefinitions.html#serveDefinitions"><span class="hs-identifier hs-var">serveDefinitions</span></a></span><span> </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679382683"><span class="hs-identifier hs-var">rt</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679382684"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe ShortCausalHash
</span><a href="#local-6989586621679382670"><span class="hs-identifier hs-var">mayRoot</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Path
</span><a href="#local-6989586621679382669"><span class="hs-identifier hs-var">relativePath</span></a></span><span> </span><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679382668"><span class="hs-identifier hs-var">rawHqns</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Width
</span><a href="#local-6989586621679382667"><span class="hs-identifier hs-var">renderWidth</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Suffixify
</span><a href="#local-6989586621679382666"><span class="hs-identifier hs-var">suff</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-458"></span><span>      </span><span class="annot"><span class="annottext">forall a b. a -&gt; b -&gt; a :&lt;|&gt; b
</span><span class="hs-operator hs-var">:&lt;|&gt;</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679382665"><span class="annot"><span class="annottext">Maybe ShortCausalHash
</span><a href="#local-6989586621679382665"><span class="hs-identifier hs-var">mayRoot</span></a></span></span><span> </span><span id="local-6989586621679382664"><span class="annot"><span class="annottext">Maybe Path
</span><a href="#local-6989586621679382664"><span class="hs-identifier hs-var">relativePath</span></a></span></span><span> </span><span id="local-6989586621679382663"><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621679382663"><span class="hs-identifier hs-var">limit</span></a></span></span><span> </span><span id="local-6989586621679382662"><span class="annot"><span class="annottext">Maybe Width
</span><a href="#local-6989586621679382662"><span class="hs-identifier hs-var">renderWidth</span></a></span></span><span> </span><span id="local-6989586621679382661"><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621679382661"><span class="hs-identifier hs-var">query</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall v. v -&gt; APIHeaders v
</span><a href="Unison.Server.Types.html#setCacheControl"><span class="hs-identifier hs-var">setCacheControl</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
MonadIO m =&gt;
Codebase m Symbol Ann
-&gt; Maybe (Either ShortCausalHash CausalHash)
-&gt; Maybe Path
-&gt; Maybe Int
-&gt; Maybe Width
-&gt; Maybe String
-&gt; Backend m [(Alignment, FoundResult)]
</span><a href="Unison.Server.Local.Endpoints.FuzzyFind.html#serveFuzzyFind"><span class="hs-identifier hs-var">serveFuzzyFind</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679382684"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe ShortCausalHash
</span><a href="#local-6989586621679382665"><span class="hs-identifier hs-var">mayRoot</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Path
</span><a href="#local-6989586621679382664"><span class="hs-identifier hs-var">relativePath</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621679382663"><span class="hs-identifier hs-var">limit</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Width
</span><a href="#local-6989586621679382662"><span class="hs-identifier hs-var">renderWidth</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621679382661"><span class="hs-identifier hs-var">query</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-459"></span><span>      </span><span class="annot"><span class="annottext">forall a b. a -&gt; b -&gt; a :&lt;|&gt; b
</span><span class="hs-operator hs-var">:&lt;|&gt;</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679382660"><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679382660"><span class="hs-identifier hs-var">shortHash</span></a></span></span><span> </span><span id="local-6989586621679382659"><span class="annot"><span class="annottext">Maybe Name
</span><a href="#local-6989586621679382659"><span class="hs-identifier hs-var">mayName</span></a></span></span><span> </span><span id="local-6989586621679382658"><span class="annot"><span class="annottext">Maybe ShortCausalHash
</span><a href="#local-6989586621679382658"><span class="hs-identifier hs-var">mayRoot</span></a></span></span><span> </span><span id="local-6989586621679382657"><span class="annot"><span class="annottext">Maybe Path
</span><a href="#local-6989586621679382657"><span class="hs-identifier hs-var">relativeTo</span></a></span></span><span> </span><span id="local-6989586621679382656"><span class="annot"><span class="annottext">Maybe Width
</span><a href="#local-6989586621679382656"><span class="hs-identifier hs-var">renderWidth</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall v. v -&gt; APIHeaders v
</span><a href="Unison.Server.Types.html#setCacheControl"><span class="hs-identifier hs-var">setCacheControl</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; Referent
-&gt; Maybe Name
-&gt; Maybe (Either ShortCausalHash CausalHash)
-&gt; Maybe Path
-&gt; Maybe Width
-&gt; Backend IO TermSummary
</span><a href="Unison.Server.Local.Endpoints.DefinitionSummary.html#serveTermSummary"><span class="hs-identifier hs-var">serveTermSummary</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679382684"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679382660"><span class="hs-identifier hs-var">shortHash</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Name
</span><a href="#local-6989586621679382659"><span class="hs-identifier hs-var">mayName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe ShortCausalHash
</span><a href="#local-6989586621679382658"><span class="hs-identifier hs-var">mayRoot</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Path
</span><a href="#local-6989586621679382657"><span class="hs-identifier hs-var">relativeTo</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Width
</span><a href="#local-6989586621679382656"><span class="hs-identifier hs-var">renderWidth</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-460"></span><span>      </span><span class="annot"><span class="annottext">forall a b. a -&gt; b -&gt; a :&lt;|&gt; b
</span><span class="hs-operator hs-var">:&lt;|&gt;</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679382655"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679382655"><span class="hs-identifier hs-var">shortHash</span></a></span></span><span> </span><span id="local-6989586621679382654"><span class="annot"><span class="annottext">Maybe Name
</span><a href="#local-6989586621679382654"><span class="hs-identifier hs-var">mayName</span></a></span></span><span> </span><span id="local-6989586621679382653"><span class="annot"><span class="annottext">Maybe ShortCausalHash
</span><a href="#local-6989586621679382653"><span class="hs-identifier hs-var">mayRoot</span></a></span></span><span> </span><span id="local-6989586621679382652"><span class="annot"><span class="annottext">Maybe Path
</span><a href="#local-6989586621679382652"><span class="hs-identifier hs-var">relativeTo</span></a></span></span><span> </span><span id="local-6989586621679382651"><span class="annot"><span class="annottext">Maybe Width
</span><a href="#local-6989586621679382651"><span class="hs-identifier hs-var">renderWidth</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall v. v -&gt; APIHeaders v
</span><a href="Unison.Server.Types.html#setCacheControl"><span class="hs-identifier hs-var">setCacheControl</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; Reference
-&gt; Maybe Name
-&gt; Maybe (Either ShortCausalHash CausalHash)
-&gt; Maybe Path
-&gt; Maybe Width
-&gt; Backend IO TypeSummary
</span><a href="Unison.Server.Local.Endpoints.DefinitionSummary.html#serveTypeSummary"><span class="hs-identifier hs-var">serveTypeSummary</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679382684"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679382655"><span class="hs-identifier hs-var">shortHash</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Name
</span><a href="#local-6989586621679382654"><span class="hs-identifier hs-var">mayName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe ShortCausalHash
</span><a href="#local-6989586621679382653"><span class="hs-identifier hs-var">mayRoot</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Path
</span><a href="#local-6989586621679382652"><span class="hs-identifier hs-var">relativeTo</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Width
</span><a href="#local-6989586621679382651"><span class="hs-identifier hs-var">renderWidth</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-461"></span><span>
</span><span id="line-462"></span><span id="local-6989586621679383735"><span class="annot"><a href="Unison.Server.CodebaseServer.html#backendHandler"><span class="hs-identifier hs-type">backendHandler</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#BackendEnv"><span class="hs-identifier hs-type">BackendEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679383735"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Handler</span></span><span> </span><span class="annot"><a href="#local-6989586621679383735"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-463"></span><span id="backendHandler"><span class="annot"><span class="annottext">backendHandler :: forall a. BackendEnv -&gt; Backend IO a -&gt; Handler a
</span><a href="Unison.Server.CodebaseServer.html#backendHandler"><span class="hs-identifier hs-var hs-var">backendHandler</span></a></span></span><span> </span><span id="local-6989586621679382649"><span class="annot"><span class="annottext">BackendEnv
</span><a href="#local-6989586621679382649"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621679382648"><span class="annot"><span class="annottext">Backend IO a
</span><a href="#local-6989586621679382648"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-464"></span><span>  </span><span class="annot"><span class="annottext">forall a. ExceptT ServerError IO a -&gt; Handler a
</span><span class="hs-identifier hs-var">Handler</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) e e' a.
Functor m =&gt;
(e -&gt; e') -&gt; ExceptT e m a -&gt; ExceptT e' m a
</span><span class="hs-identifier hs-var">withExceptT</span></span><span> </span><span class="annot"><span class="annottext">BackendError -&gt; ServerError
</span><a href="Unison.Server.Errors.html#backendError"><span class="hs-identifier hs-var">backendError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall r (m :: * -&gt; *) a. ReaderT r m a -&gt; r -&gt; m a
</span><span class="hs-identifier hs-var">runReaderT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
Backend m a -&gt; ReaderT BackendEnv (ExceptT BackendError m) a
</span><a href="Unison.Server.Backend.html#%24sel%3ArunBackend%3ABackend"><span class="hs-identifier hs-var">runBackend</span></a></span><span> </span><span class="annot"><span class="annottext">Backend IO a
</span><a href="#local-6989586621679382648"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">BackendEnv
</span><a href="#local-6989586621679382649"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-465"></span></pre></body></html>