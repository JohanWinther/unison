<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE OverloadedLists #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE PatternSynonyms #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE TemplateHaskell #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE ViewPatterns #-}</span><span>
</span><span id="line-5"></span><span>
</span><span id="line-6"></span><span class="hs-comment">-- | This module is the primary interface to the Unison typechecker</span><span>
</span><span id="line-7"></span><span class="hs-comment">-- module Unison.Typechecker (admissibleTypeAt, check, check', checkAdmissible', equals, locals, subtype, isSubtype, synthesize, synthesize', typeAt, wellTyped) where</span><span>
</span><span id="line-8"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Unison.Typechecker</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-9"></span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Lens</span></span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Fail</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">fail</span></span><span class="hs-special">)</span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.State</span></span><span>
</span><span id="line-13"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">State</span></span><span class="hs-special">,</span><span>
</span><span id="line-14"></span><span>    </span><span class="annot"><span class="hs-identifier">StateT</span></span><span class="hs-special">,</span><span>
</span><span id="line-15"></span><span>    </span><span class="annot"><span class="hs-identifier">execState</span></span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>    </span><span class="annot"><span class="hs-identifier">get</span></span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>    </span><span class="annot"><span class="hs-identifier">modify</span></span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Writer</span></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Sequence.NonEmpty</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NESeq</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">toSeq</span></span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Text</span></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.ABT</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">ABT</span></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Blank</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">B</span></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Name</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Name</span></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Prelude</span></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Referent</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Referent</span></span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Result.html"><span class="hs-identifier">Unison.Result</span></a></span><span>
</span><span id="line-29"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Unison.Result.html#Result"><span class="hs-identifier">Result</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-30"></span><span>    </span><span class="annot"><a href="Unison.Result.html#ResultT"><span class="hs-identifier">ResultT</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-31"></span><span>    </span><span class="annot"><a href="Unison.Result.html#runResultT"><span class="hs-identifier">runResultT</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-32"></span><span>    </span><span class="hs-keyword">pattern</span><span> </span><span class="annot"><a href="Unison.Result.html#Result"><span class="hs-identifier">Result</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-33"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Unison.Result.html"><span class="hs-identifier">Unison.Result</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Result</span></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Syntax.Name</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Name</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">toText</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">unsafeFromText</span></span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Term</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Term</span></span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Term</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Term</span></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Type</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Type</span></span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Unison.Typechecker.Context.html"><span class="hs-identifier">Unison.Typechecker.Context</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Context</span></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Unison.Typechecker.TypeLookup.html"><span class="hs-identifier">Unison.Typechecker.TypeLookup</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TL</span></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Unison.Typechecker.TypeVar.html"><span class="hs-identifier">Unison.Typechecker.TypeVar</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TypeVar</span></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.List</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">uniqueBy</span></span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Var</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Var</span></span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Var</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Var</span></span><span>
</span><span id="line-45"></span><span>
</span><span id="line-46"></span><span class="hs-keyword">type</span><span> </span><span id="Name"><span class="annot"><a href="Unison.Typechecker.html#Name"><span class="hs-identifier hs-var">Name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-47"></span><span>
</span><span id="line-48"></span><span class="hs-keyword">data</span><span> </span><span id="Notes"><span class="annot"><a href="Unison.Typechecker.html#Notes"><span class="hs-identifier hs-var">Notes</span></a></span></span><span> </span><span id="local-6989586621680776746"><span class="annot"><a href="#local-6989586621680776746"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span id="local-6989586621680776745"><span class="annot"><a href="#local-6989586621680776745"><span class="hs-identifier hs-type">loc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Notes"><span class="annot"><a href="Unison.Typechecker.html#Notes"><span class="hs-identifier hs-var">Notes</span></a></span></span><span>
</span><span id="line-49"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3Abugs%3ANotes"><span class="annot"><span class="annottext">Notes v loc -&gt; Seq (CompilerBug v loc)
</span><a href="Unison.Typechecker.html#%24sel%3Abugs%3ANotes"><span class="hs-identifier hs-var hs-var">bugs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Seq</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Typechecker.Context.html#CompilerBug"><span class="hs-identifier hs-type">Context.CompilerBug</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776746"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776745"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-50"></span><span>    </span><span id="%24sel%3Aerrors%3ANotes"><span class="annot"><span class="annottext">Notes v loc -&gt; Seq (ErrorNote v loc)
</span><a href="Unison.Typechecker.html#%24sel%3Aerrors%3ANotes"><span class="hs-identifier hs-var hs-var">errors</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Seq</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Typechecker.Context.html#ErrorNote"><span class="hs-identifier hs-type">Context.ErrorNote</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776746"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776745"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-51"></span><span>    </span><span id="%24sel%3Ainfos%3ANotes"><span class="annot"><span class="annottext">Notes v loc -&gt; Seq (InfoNote v loc)
</span><a href="Unison.Typechecker.html#%24sel%3Ainfos%3ANotes"><span class="hs-identifier hs-var hs-var">infos</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Seq</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Typechecker.Context.html#InfoNote"><span class="hs-identifier hs-type">Context.InfoNote</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776746"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776745"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-53"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680776424"><span id="local-6989586621680776426"><span id="local-6989586621680776428"><span class="annot"><span class="annottext">Int -&gt; Notes v loc -&gt; ShowS
[Notes v loc] -&gt; ShowS
Notes v loc -&gt; String
(Int -&gt; Notes v loc -&gt; ShowS)
-&gt; (Notes v loc -&gt; String)
-&gt; ([Notes v loc] -&gt; ShowS)
-&gt; Show (Notes v loc)
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
forall v loc.
(Var v, Show loc, Ord loc) =&gt;
Int -&gt; Notes v loc -&gt; ShowS
forall v loc. (Var v, Show loc, Ord loc) =&gt; [Notes v loc] -&gt; ShowS
forall v loc. (Var v, Show loc, Ord loc) =&gt; Notes v loc -&gt; String
showList :: [Notes v loc] -&gt; ShowS
$cshowList :: forall v loc. (Var v, Show loc, Ord loc) =&gt; [Notes v loc] -&gt; ShowS
show :: Notes v loc -&gt; String
$cshow :: forall v loc. (Var v, Show loc, Ord loc) =&gt; Notes v loc -&gt; String
showsPrec :: Int -&gt; Notes v loc -&gt; ShowS
$cshowsPrec :: forall v loc.
(Var v, Show loc, Ord loc) =&gt;
Int -&gt; Notes v loc -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span>
</span><span id="line-55"></span><span id="local-6989586621680776421"><span id="local-6989586621680776422"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680776416"><span id="local-6989586621680776418"><span class="annot"><span class="hs-identifier hs-type">Semigroup</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Typechecker.html#Notes"><span class="hs-identifier hs-type">Notes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776422"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776421"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-56"></span><span>  </span><span class="annot"><a href="Unison.Typechecker.html#Notes"><span class="hs-identifier hs-type">Notes</span></a></span><span> </span><span id="local-6989586621680776414"><span class="annot"><span class="annottext">Seq (CompilerBug v loc)
</span><a href="#local-6989586621680776414"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span id="local-6989586621680776413"><span class="annot"><span class="annottext">Seq (ErrorNote v loc)
</span><a href="#local-6989586621680776413"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span id="local-6989586621680776412"><span class="annot"><span class="annottext">Seq (InfoNote v loc)
</span><a href="#local-6989586621680776412"><span class="hs-identifier hs-var">is</span></a></span></span><span> </span><span id="local-6989586621680776411"><span class="annot"><span class="annottext">&lt;&gt; :: Notes v loc -&gt; Notes v loc -&gt; Notes v loc
</span><span class="hs-operator hs-var hs-var hs-var hs-var">&lt;&gt;</span></span></span><span> </span><span class="annot"><a href="Unison.Typechecker.html#Notes"><span class="hs-identifier hs-type">Notes</span></a></span><span> </span><span id="local-6989586621680776410"><span class="annot"><span class="annottext">Seq (CompilerBug v loc)
</span><a href="#local-6989586621680776410"><span class="hs-identifier hs-var">bs'</span></a></span></span><span> </span><span id="local-6989586621680776409"><span class="annot"><span class="annottext">Seq (ErrorNote v loc)
</span><a href="#local-6989586621680776409"><span class="hs-identifier hs-var">es'</span></a></span></span><span> </span><span id="local-6989586621680776408"><span class="annot"><span class="annottext">Seq (InfoNote v loc)
</span><a href="#local-6989586621680776408"><span class="hs-identifier hs-var">is'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Seq (CompilerBug v loc)
-&gt; Seq (ErrorNote v loc) -&gt; Seq (InfoNote v loc) -&gt; Notes v loc
forall v loc.
Seq (CompilerBug v loc)
-&gt; Seq (ErrorNote v loc) -&gt; Seq (InfoNote v loc) -&gt; Notes v loc
</span><a href="Unison.Typechecker.html#Notes"><span class="hs-identifier hs-var">Notes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Seq (CompilerBug v loc)
</span><a href="#local-6989586621680776414"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="annot"><span class="annottext">Seq (CompilerBug v loc)
-&gt; Seq (CompilerBug v loc) -&gt; Seq (CompilerBug v loc)
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Seq (CompilerBug v loc)
</span><a href="#local-6989586621680776410"><span class="hs-identifier hs-var">bs'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Seq (ErrorNote v loc)
</span><a href="#local-6989586621680776413"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">Seq (ErrorNote v loc)
-&gt; Seq (ErrorNote v loc) -&gt; Seq (ErrorNote v loc)
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Seq (ErrorNote v loc)
</span><a href="#local-6989586621680776409"><span class="hs-identifier hs-var">es'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Seq (InfoNote v loc)
</span><a href="#local-6989586621680776412"><span class="hs-identifier hs-var">is</span></a></span><span> </span><span class="annot"><span class="annottext">Seq (InfoNote v loc)
-&gt; Seq (InfoNote v loc) -&gt; Seq (InfoNote v loc)
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Seq (InfoNote v loc)
</span><a href="#local-6989586621680776408"><span class="hs-identifier hs-var">is'</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-57"></span><span>
</span><span id="line-58"></span><span id="local-6989586621680776406"><span id="local-6989586621680776407"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680776400"><span id="local-6989586621680776402"><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Typechecker.html#Notes"><span class="hs-identifier hs-type">Notes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776407"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776406"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-59"></span><span>  </span><span id="local-6989586621680776398"><span class="annot"><span class="annottext">mempty :: Notes v loc
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">mempty</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Seq (CompilerBug v loc)
-&gt; Seq (ErrorNote v loc) -&gt; Seq (InfoNote v loc) -&gt; Notes v loc
forall v loc.
Seq (CompilerBug v loc)
-&gt; Seq (ErrorNote v loc) -&gt; Seq (InfoNote v loc) -&gt; Notes v loc
</span><a href="Unison.Typechecker.html#Notes"><span class="hs-identifier hs-var">Notes</span></a></span><span> </span><span class="annot"><span class="annottext">Seq (CompilerBug v loc)
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">Seq (ErrorNote v loc)
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">Seq (InfoNote v loc)
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span></span></span><span>
</span><span id="line-60"></span><span>
</span><span id="line-61"></span><span id="local-6989586621680776689"><span id="local-6989586621680776690"><span id="local-6989586621680776691"><span class="annot"><a href="Unison.Typechecker.html#convertResult"><span class="hs-identifier hs-type">convertResult</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Typechecker.Context.html#Result"><span class="hs-identifier hs-type">Context.Result</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776691"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776690"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776689"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Result.html#Result"><span class="hs-identifier hs-type">Result</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Typechecker.html#Notes"><span class="hs-identifier hs-type">Notes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776691"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776690"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680776689"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-62"></span><span id="convertResult"><span class="annot"><span class="annottext">convertResult :: Result v loc a -&gt; Result (Notes v loc) a
</span><a href="Unison.Typechecker.html#convertResult"><span class="hs-identifier hs-var hs-var">convertResult</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-63"></span><span>  </span><span class="annot"><a href="Unison.Typechecker.Context.html#Success"><span class="hs-identifier hs-type">Context.Success</span></a></span><span> </span><span id="local-6989586621680776395"><span class="annot"><span class="annottext">Seq (InfoNote v loc)
</span><a href="#local-6989586621680776395"><span class="hs-identifier hs-var">is</span></a></span></span><span> </span><span id="local-6989586621680776394"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680776394"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Notes v loc -&gt; Maybe a -&gt; Result (Notes v loc) a
forall w a. w -&gt; Maybe a -&gt; MaybeT (WriterT w Identity) a
</span><a href="Unison.Result.html#Result"><span class="hs-identifier hs-var">Result</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Seq (CompilerBug v loc)
-&gt; Seq (ErrorNote v loc) -&gt; Seq (InfoNote v loc) -&gt; Notes v loc
forall v loc.
Seq (CompilerBug v loc)
-&gt; Seq (ErrorNote v loc) -&gt; Seq (InfoNote v loc) -&gt; Notes v loc
</span><a href="Unison.Typechecker.html#Notes"><span class="hs-identifier hs-var">Notes</span></a></span><span> </span><span class="annot"><span class="annottext">Seq (CompilerBug v loc)
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">Seq (ErrorNote v loc)
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">Seq (InfoNote v loc)
</span><a href="#local-6989586621680776395"><span class="hs-identifier hs-var">is</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Maybe a
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680776394"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span>  </span><span class="annot"><a href="Unison.Typechecker.Context.html#TypeError"><span class="hs-identifier hs-type">Context.TypeError</span></a></span><span> </span><span id="local-6989586621680776392"><span class="annot"><span class="annottext">NESeq (ErrorNote v loc)
</span><a href="#local-6989586621680776392"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span id="local-6989586621680776391"><span class="annot"><span class="annottext">Seq (InfoNote v loc)
</span><a href="#local-6989586621680776391"><span class="hs-identifier hs-var">is</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Notes v loc -&gt; Maybe a -&gt; Result (Notes v loc) a
forall w a. w -&gt; Maybe a -&gt; MaybeT (WriterT w Identity) a
</span><a href="Unison.Result.html#Result"><span class="hs-identifier hs-var">Result</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Seq (CompilerBug v loc)
-&gt; Seq (ErrorNote v loc) -&gt; Seq (InfoNote v loc) -&gt; Notes v loc
forall v loc.
Seq (CompilerBug v loc)
-&gt; Seq (ErrorNote v loc) -&gt; Seq (InfoNote v loc) -&gt; Notes v loc
</span><a href="Unison.Typechecker.html#Notes"><span class="hs-identifier hs-var">Notes</span></a></span><span> </span><span class="annot"><span class="annottext">Seq (CompilerBug v loc)
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NESeq (ErrorNote v loc) -&gt; Seq (ErrorNote v loc)
forall a. NESeq a -&gt; Seq a
</span><span class="hs-identifier hs-var">NESeq.toSeq</span></span><span> </span><span class="annot"><span class="annottext">NESeq (ErrorNote v loc)
</span><a href="#local-6989586621680776392"><span class="hs-identifier hs-var">es</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Seq (InfoNote v loc)
</span><a href="#local-6989586621680776391"><span class="hs-identifier hs-var">is</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-65"></span><span>  </span><span class="annot"><a href="Unison.Typechecker.Context.html#CompilerBug"><span class="hs-identifier hs-type">Context.CompilerBug</span></a></span><span> </span><span id="local-6989586621680776389"><span class="annot"><span class="annottext">CompilerBug v loc
</span><a href="#local-6989586621680776389"><span class="hs-identifier hs-var">bug</span></a></span></span><span> </span><span id="local-6989586621680776388"><span class="annot"><span class="annottext">Seq (ErrorNote v loc)
</span><a href="#local-6989586621680776388"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span id="local-6989586621680776387"><span class="annot"><span class="annottext">Seq (InfoNote v loc)
</span><a href="#local-6989586621680776387"><span class="hs-identifier hs-var">is</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Notes v loc -&gt; Maybe a -&gt; Result (Notes v loc) a
forall w a. w -&gt; Maybe a -&gt; MaybeT (WriterT w Identity) a
</span><a href="Unison.Result.html#Result"><span class="hs-identifier hs-var">Result</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Seq (CompilerBug v loc)
-&gt; Seq (ErrorNote v loc) -&gt; Seq (InfoNote v loc) -&gt; Notes v loc
forall v loc.
Seq (CompilerBug v loc)
-&gt; Seq (ErrorNote v loc) -&gt; Seq (InfoNote v loc) -&gt; Notes v loc
</span><a href="Unison.Typechecker.html#Notes"><span class="hs-identifier hs-var">Notes</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Item (Seq (CompilerBug v loc))
CompilerBug v loc
</span><a href="#local-6989586621680776389"><span class="hs-identifier hs-var">bug</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Seq (ErrorNote v loc)
</span><a href="#local-6989586621680776388"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">Seq (InfoNote v loc)
</span><a href="#local-6989586621680776387"><span class="hs-identifier hs-var">is</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-66"></span><span>
</span><span id="line-67"></span><span class="hs-keyword">data</span><span> </span><span id="NamedReference"><span class="annot"><a href="Unison.Typechecker.html#NamedReference"><span class="hs-identifier hs-var">NamedReference</span></a></span></span><span> </span><span id="local-6989586621680776521"><span class="annot"><a href="#local-6989586621680776521"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span id="local-6989586621680776520"><span class="annot"><a href="#local-6989586621680776520"><span class="hs-identifier hs-type">loc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="NamedReference"><span class="annot"><a href="Unison.Typechecker.html#NamedReference"><span class="hs-identifier hs-var">NamedReference</span></a></span></span><span>
</span><span id="line-68"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3Afqn%3ANamedReference"><span class="annot"><span class="annottext">NamedReference v loc -&gt; Name
</span><a href="Unison.Typechecker.html#%24sel%3Afqn%3ANamedReference"><span class="hs-identifier hs-var hs-var">fqn</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Typechecker.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-69"></span><span>    </span><span id="%24sel%3AfqnType%3ANamedReference"><span class="annot"><span class="annottext">NamedReference v loc -&gt; Type v loc
</span><a href="Unison.Typechecker.html#%24sel%3AfqnType%3ANamedReference"><span class="hs-identifier hs-var hs-var">fqnType</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><a href="#local-6989586621680776521"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776520"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-70"></span><span>    </span><span id="%24sel%3Areplacement%3ANamedReference"><span class="annot"><span class="annottext">NamedReference v loc -&gt; Either v Referent
</span><a href="Unison.Typechecker.html#%24sel%3Areplacement%3ANamedReference"><span class="hs-identifier hs-var hs-var">replacement</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="#local-6989586621680776521"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span>
</span><span id="line-71"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-72"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680776377"><span id="local-6989586621680776379"><span id="local-6989586621680776381"><span class="annot"><span class="annottext">Int -&gt; NamedReference v loc -&gt; ShowS
[NamedReference v loc] -&gt; ShowS
NamedReference v loc -&gt; String
(Int -&gt; NamedReference v loc -&gt; ShowS)
-&gt; (NamedReference v loc -&gt; String)
-&gt; ([NamedReference v loc] -&gt; ShowS)
-&gt; Show (NamedReference v loc)
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
forall v loc. Show v =&gt; Int -&gt; NamedReference v loc -&gt; ShowS
forall v loc. Show v =&gt; [NamedReference v loc] -&gt; ShowS
forall v loc. Show v =&gt; NamedReference v loc -&gt; String
showList :: [NamedReference v loc] -&gt; ShowS
$cshowList :: forall v loc. Show v =&gt; [NamedReference v loc] -&gt; ShowS
show :: NamedReference v loc -&gt; String
$cshow :: forall v loc. Show v =&gt; NamedReference v loc -&gt; String
showsPrec :: Int -&gt; NamedReference v loc -&gt; ShowS
$cshowsPrec :: forall v loc. Show v =&gt; Int -&gt; NamedReference v loc -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-73"></span><span>
</span><span id="line-74"></span><span class="hs-keyword">data</span><span> </span><span id="Env"><span class="annot"><a href="Unison.Typechecker.html#Env"><span class="hs-identifier hs-var">Env</span></a></span></span><span> </span><span id="local-6989586621680776670"><span class="annot"><a href="#local-6989586621680776670"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span id="local-6989586621680776669"><span class="annot"><a href="#local-6989586621680776669"><span class="hs-identifier hs-type">loc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Env"><span class="annot"><a href="Unison.Typechecker.html#Env"><span class="hs-identifier hs-var">Env</span></a></span></span><span>
</span><span id="line-75"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3A_ambientAbilities%3AEnv"><span class="annot"><span class="annottext">Env v loc -&gt; [Type v loc]
</span><a href="Unison.Typechecker.html#%24sel%3A_ambientAbilities%3AEnv"><span class="hs-identifier hs-var hs-var">_ambientAbilities</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><a href="#local-6989586621680776670"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776669"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-76"></span><span>    </span><span id="%24sel%3A_typeLookup%3AEnv"><span class="annot"><span class="annottext">Env v loc -&gt; TypeLookup v loc
</span><a href="Unison.Typechecker.html#%24sel%3A_typeLookup%3AEnv"><span class="hs-identifier hs-var hs-var">_typeLookup</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Typechecker.TypeLookup.html#TypeLookup"><span class="hs-identifier hs-type">TL.TypeLookup</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776670"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776669"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-77"></span><span>    </span><span class="hs-comment">-- TDNR environment - maps short names like `+` to fully-qualified</span><span>
</span><span id="line-78"></span><span>    </span><span class="hs-comment">-- lists of named references whose full name matches the short name</span><span>
</span><span id="line-79"></span><span>    </span><span class="hs-comment">-- Example: `+` maps to [Nat.+, Float.+, Int.+]</span><span>
</span><span id="line-80"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-81"></span><span>    </span><span class="hs-comment">-- This mapping is populated before typechecking with as few entries</span><span>
</span><span id="line-82"></span><span>    </span><span class="hs-comment">-- as are needed to help resolve variables needing TDNR in the file.</span><span>
</span><span id="line-83"></span><span>    </span><span id="%24sel%3A_termsByShortname%3AEnv"><span class="annot"><span class="annottext">Env v loc -&gt; Map Name [NamedReference v loc]
</span><a href="Unison.Typechecker.html#%24sel%3A_termsByShortname%3AEnv"><span class="hs-identifier hs-var hs-var">_termsByShortname</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="Unison.Typechecker.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Unison.Typechecker.html#NamedReference"><span class="hs-identifier hs-type">NamedReference</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776670"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776669"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-84"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-85"></span><span>
</span><span id="line-86"></span><span id="typeLookup"><span id="termsByShortname"><span id="ambientAbilities"><span id="local-6989586621680776669"><span id="local-6989586621680776670"><span class="hs-identifier">makeLenses</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Env</span></span></span></span></span></span><span>
</span><span id="line-87"></span><span>
</span><span id="line-88"></span><span class="hs-comment">-- | Infer the type of a 'Unison.Term', using</span><span>
</span><span id="line-89"></span><span class="hs-comment">-- a function to resolve the type of @Ref@ constructors</span><span>
</span><span id="line-90"></span><span class="hs-comment">-- contained in that term.</span><span>
</span><span id="line-91"></span><span id="local-6989586621680776593"><span id="local-6989586621680776594"><span id="local-6989586621680776595"><span class="annot"><a href="Unison.Typechecker.html#synthesize"><span class="hs-identifier hs-type">synthesize</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-92"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621680776595"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Var</span></span><span> </span><span class="annot"><a href="#local-6989586621680776594"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680776593"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-93"></span><span>  </span><span class="annot"><a href="Unison.Typechecker.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776594"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776593"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-94"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Term</span></span><span> </span><span class="annot"><a href="#local-6989586621680776594"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776593"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-95"></span><span>  </span><span class="annot"><a href="Unison.Result.html#ResultT"><span class="hs-identifier hs-type">ResultT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Typechecker.html#Notes"><span class="hs-identifier hs-type">Notes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776594"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776593"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680776595"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><a href="#local-6989586621680776594"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776593"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-96"></span><span id="synthesize"><span class="annot"><span class="annottext">synthesize :: Env v loc -&gt; Term v loc -&gt; ResultT (Notes v loc) f (Type v loc)
</span><a href="Unison.Typechecker.html#synthesize"><span class="hs-identifier hs-var hs-var">synthesize</span></a></span></span><span> </span><span id="local-6989586621680776368"><span class="annot"><span class="annottext">Env v loc
</span><a href="#local-6989586621680776368"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621680776367"><span class="annot"><span class="annottext">Term v loc
</span><a href="#local-6989586621680776367"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-97"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680776366"><span class="annot"><span class="annottext">result :: Result (Notes v loc) (Type v loc)
</span><a href="#local-6989586621680776366"><span class="hs-identifier hs-var hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-98"></span><span>        </span><span class="annot"><span class="annottext">Result v loc (Type v loc) -&gt; Result (Notes v loc) (Type v loc)
forall v loc a. Result v loc a -&gt; Result (Notes v loc) a
</span><a href="Unison.Typechecker.html#convertResult"><span class="hs-identifier hs-var">convertResult</span></a></span><span> </span><span class="annot"><span class="annottext">(Result v loc (Type v loc) -&gt; Result (Notes v loc) (Type v loc))
-&gt; Result v loc (Type v loc) -&gt; Result (Notes v loc) (Type v loc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-99"></span><span>          </span><span class="annot"><span class="annottext">[Type v loc]
-&gt; TypeLookup v loc -&gt; Term v loc -&gt; Result v loc (Type v loc)
forall v loc.
(Var v, Ord loc) =&gt;
[Type v loc]
-&gt; TypeLookup v loc -&gt; Term v loc -&gt; Result v loc (Type v loc)
</span><a href="Unison.Typechecker.Context.html#synthesizeClosed"><span class="hs-identifier hs-var">Context.synthesizeClosed</span></a></span><span>
</span><span id="line-100"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type v loc -&gt; Type v loc
forall v a b. Ord v =&gt; Type v a -&gt; Type (TypeVar b v) a
</span><a href="Unison.Typechecker.TypeVar.html#liftType"><span class="hs-identifier hs-var">TypeVar.liftType</span></a></span><span> </span><span class="annot"><span class="annottext">(Type v loc -&gt; Type v loc) -&gt; [Type v loc] -&gt; [Type v loc]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Getting [Type v loc] (Env v loc) [Type v loc]
-&gt; Env v loc -&gt; [Type v loc]
forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="annot"><span class="annottext">Getting [Type v loc] (Env v loc) [Type v loc]
forall v loc. Lens' (Env v loc) [Type v loc]
</span><a href="Unison.Typechecker.html#ambientAbilities"><span class="hs-identifier hs-var">ambientAbilities</span></a></span><span> </span><span class="annot"><span class="annottext">Env v loc
</span><a href="#local-6989586621680776368"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-101"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Getting (TypeLookup v loc) (Env v loc) (TypeLookup v loc)
-&gt; Env v loc -&gt; TypeLookup v loc
forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="annot"><span class="annottext">Getting (TypeLookup v loc) (Env v loc) (TypeLookup v loc)
forall v loc. Lens' (Env v loc) (TypeLookup v loc)
</span><a href="Unison.Typechecker.html#typeLookup"><span class="hs-identifier hs-var">typeLookup</span></a></span><span> </span><span class="annot"><span class="annottext">Env v loc
</span><a href="#local-6989586621680776368"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-102"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term v loc -&gt; Term v loc
forall v a b. Ord v =&gt; Term v a -&gt; Term' (TypeVar b v) v a
</span><a href="Unison.Typechecker.TypeVar.html#liftTerm"><span class="hs-identifier hs-var">TypeVar.liftTerm</span></a></span><span> </span><span class="annot"><span class="annottext">Term v loc
</span><a href="#local-6989586621680776367"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-103"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(forall a. Identity a -&gt; f a)
-&gt; ResultT (Notes v loc) Identity (Type v loc)
-&gt; ResultT (Notes v loc) f (Type v loc)
forall (f :: * -&gt; *) notes (g :: * -&gt; *) b.
(Monad f, Monoid notes) =&gt;
(forall a. f a -&gt; g a) -&gt; ResultT notes f b -&gt; ResultT notes g b
</span><a href="Unison.Result.html#hoist"><span class="hs-identifier hs-var">Result.hoist</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; f a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(a -&gt; f a) -&gt; (Identity a -&gt; a) -&gt; Identity a -&gt; f a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Identity a -&gt; a
forall a. Identity a -&gt; a
</span><span class="hs-identifier hs-var hs-var">runIdentity</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ResultT (Notes v loc) Identity (Type v loc)
 -&gt; ResultT (Notes v loc) f (Type v loc))
-&gt; ResultT (Notes v loc) Identity (Type v loc)
-&gt; ResultT (Notes v loc) f (Type v loc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Type v loc -&gt; Type v loc)
-&gt; Result (Notes v loc) (Type v loc)
-&gt; ResultT (Notes v loc) Identity (Type v loc)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Type v loc -&gt; Type v loc
forall v b a. Ord v =&gt; Type (TypeVar b v) a -&gt; Type v a
</span><a href="Unison.Typechecker.TypeVar.html#lowerType"><span class="hs-identifier hs-var">TypeVar.lowerType</span></a></span><span> </span><span class="annot"><span class="annottext">Result (Notes v loc) (Type v loc)
</span><a href="#local-6989586621680776366"><span class="hs-identifier hs-var">result</span></a></span><span>
</span><span id="line-104"></span><span>
</span><span id="line-105"></span><span id="local-6989586621680776622"><span id="local-6989586621680776623"><span class="annot"><a href="Unison.Typechecker.html#isSubtype"><span class="hs-identifier hs-type">isSubtype</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Var</span></span><span> </span><span class="annot"><a href="#local-6989586621680776623"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><a href="#local-6989586621680776623"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776622"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><a href="#local-6989586621680776623"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776622"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span></span><span>
</span><span id="line-106"></span><span id="isSubtype"><span class="annot"><span class="annottext">isSubtype :: Type v loc -&gt; Type v loc -&gt; Bool
</span><a href="Unison.Typechecker.html#isSubtype"><span class="hs-identifier hs-var hs-var">isSubtype</span></a></span></span><span> </span><span id="local-6989586621680776355"><span class="annot"><span class="annottext">Type v loc
</span><a href="#local-6989586621680776355"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span id="local-6989586621680776354"><span class="annot"><span class="annottext">Type v loc
</span><a href="#local-6989586621680776354"><span class="hs-identifier hs-var">t2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-107"></span><span>  </span><span class="annot"><span class="annottext">Either (CompilerBug v ()) Bool -&gt; Bool
forall v a. Var v =&gt; Either (CompilerBug v ()) a -&gt; a
</span><a href="Unison.Typechecker.html#handleCompilerBug"><span class="hs-identifier hs-var">handleCompilerBug</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type v () -&gt; Type v () -&gt; Either (CompilerBug v ()) Bool
forall v loc.
(Var v, Ord loc) =&gt;
Type v loc -&gt; Type v loc -&gt; Either (CompilerBug v loc) Bool
</span><a href="Unison.Typechecker.Context.html#isSubtype"><span class="hs-identifier hs-var">Context.isSubtype</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type v () -&gt; Type v ()
forall a b. Type v a -&gt; Type (TypeVar b v) a
</span><a href="#local-6989586621680776351"><span class="hs-identifier hs-var">tvar</span></a></span><span> </span><span class="annot"><span class="annottext">(Type v () -&gt; Type v ()) -&gt; Type v () -&gt; Type v ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Type v loc -&gt; Type v ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">Type v loc
</span><a href="#local-6989586621680776355"><span class="hs-identifier hs-var">t1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type v () -&gt; Type v ()
forall a b. Type v a -&gt; Type (TypeVar b v) a
</span><a href="#local-6989586621680776351"><span class="hs-identifier hs-var">tvar</span></a></span><span> </span><span class="annot"><span class="annottext">(Type v () -&gt; Type v ()) -&gt; Type v () -&gt; Type v ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Type v loc -&gt; Type v ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">Type v loc
</span><a href="#local-6989586621680776354"><span class="hs-identifier hs-var">t2</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-108"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-109"></span><span>    </span><span id="local-6989586621680776351"><span class="annot"><span class="annottext">tvar :: Type v a -&gt; Type (TypeVar b v) a
</span><a href="#local-6989586621680776351"><span class="hs-identifier hs-var hs-var">tvar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type v a -&gt; Type (TypeVar b v) a
forall v a b. Ord v =&gt; Type v a -&gt; Type (TypeVar b v) a
</span><a href="Unison.Typechecker.TypeVar.html#liftType"><span class="hs-identifier hs-var">TypeVar.liftType</span></a></span><span>
</span><span id="line-110"></span><span>
</span><span id="line-111"></span><span id="local-6989586621680776642"><span id="local-6989586621680776643"><span class="annot"><a href="Unison.Typechecker.html#handleCompilerBug"><span class="hs-identifier hs-type">handleCompilerBug</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Var</span></span><span> </span><span class="annot"><a href="#local-6989586621680776643"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Typechecker.Context.html#CompilerBug"><span class="hs-identifier hs-type">Context.CompilerBug</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776643"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680776642"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680776642"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-112"></span><span id="handleCompilerBug"><span class="annot"><span class="annottext">handleCompilerBug :: Either (CompilerBug v ()) a -&gt; a
</span><a href="Unison.Typechecker.html#handleCompilerBug"><span class="hs-identifier hs-var hs-var">handleCompilerBug</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-113"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621680776349"><span class="annot"><span class="annottext">CompilerBug v ()
</span><a href="#local-6989586621680776349"><span class="hs-identifier hs-var">bug</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; a
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; a) -&gt; String -&gt; a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;compiler bug encountered: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">CompilerBug v () -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">CompilerBug v ()
</span><a href="#local-6989586621680776349"><span class="hs-identifier hs-var">bug</span></a></span><span>
</span><span id="line-114"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621680776346"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680776346"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680776346"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-115"></span><span>
</span><span id="line-116"></span><span class="hs-comment">-- | Similar to 'isSubtype' but treats @t2@ as a scheme where the</span><span>
</span><span id="line-117"></span><span class="hs-comment">-- outermost variables are existential rather than universal.</span><span>
</span><span id="line-118"></span><span class="hs-comment">--</span><span>
</span><span id="line-119"></span><span class="hs-comment">-- For example:</span><span>
</span><span id="line-120"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-121"></span><span class="hs-comment">-- let</span><span>
</span><span id="line-122"></span><span class="hs-comment">--   lhs = Unison.Type.ref () (Unison.Builtin.Decls.unitRef)</span><span>
</span><span id="line-123"></span><span class="hs-comment">--   rhs = Unison.Type.forall () (Unison.Var.named &quot;x&quot;) (Unison.Type.var () (Unison.Var.named &quot;x&quot;))</span><span>
</span><span id="line-124"></span><span class="hs-comment">-- in fitsScheme @Symbol lhs rhs</span><span>
</span><span id="line-125"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-126"></span><span class="hs-comment">-- is @True@ although the lhs is not a subtype of the rhs.</span><span>
</span><span id="line-127"></span><span class="hs-comment">--</span><span>
</span><span id="line-128"></span><span class="hs-comment">-- 'fitsScheme' is used to check that runnable types are a subtype of</span><span>
</span><span id="line-129"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-130"></span><span class="hs-comment">-- exists x. '{IO, Exception} x</span><span>
</span><span id="line-131"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-132"></span><span id="local-6989586621680776344"><span id="local-6989586621680776345"><span class="annot"><a href="Unison.Typechecker.html#fitsScheme"><span class="hs-identifier hs-type">fitsScheme</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Var</span></span><span> </span><span class="annot"><a href="#local-6989586621680776345"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><a href="#local-6989586621680776345"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776344"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><a href="#local-6989586621680776345"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776344"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span></span><span>
</span><span id="line-133"></span><span id="fitsScheme"><span class="annot"><span class="annottext">fitsScheme :: Type v loc -&gt; Type v loc -&gt; Bool
</span><a href="Unison.Typechecker.html#fitsScheme"><span class="hs-identifier hs-var hs-var">fitsScheme</span></a></span></span><span> </span><span id="local-6989586621680776342"><span class="annot"><span class="annottext">Type v loc
</span><a href="#local-6989586621680776342"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span id="local-6989586621680776341"><span class="annot"><span class="annottext">Type v loc
</span><a href="#local-6989586621680776341"><span class="hs-identifier hs-var">t2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Either (CompilerBug v ()) Bool -&gt; Bool
forall v a. Var v =&gt; Either (CompilerBug v ()) a -&gt; a
</span><a href="Unison.Typechecker.html#handleCompilerBug"><span class="hs-identifier hs-var">handleCompilerBug</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type v () -&gt; Type v () -&gt; Either (CompilerBug v ()) Bool
forall v loc.
(Var v, Ord loc) =&gt;
Type v loc -&gt; Type v loc -&gt; Either (CompilerBug v loc) Bool
</span><a href="Unison.Typechecker.Context.html#fitsScheme"><span class="hs-identifier hs-var">Context.fitsScheme</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type v () -&gt; Type v ()
forall a b. Type v a -&gt; Type (TypeVar b v) a
</span><a href="#local-6989586621680776339"><span class="hs-identifier hs-var">tvar</span></a></span><span> </span><span class="annot"><span class="annottext">(Type v () -&gt; Type v ()) -&gt; Type v () -&gt; Type v ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Type v loc -&gt; Type v ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">Type v loc
</span><a href="#local-6989586621680776342"><span class="hs-identifier hs-var">t1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type v () -&gt; Type v ()
forall a b. Type v a -&gt; Type (TypeVar b v) a
</span><a href="#local-6989586621680776339"><span class="hs-identifier hs-var">tvar</span></a></span><span> </span><span class="annot"><span class="annottext">(Type v () -&gt; Type v ()) -&gt; Type v () -&gt; Type v ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Type v loc -&gt; Type v ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">Type v loc
</span><a href="#local-6989586621680776341"><span class="hs-identifier hs-var">t2</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-134"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-135"></span><span>    </span><span id="local-6989586621680776339"><span class="annot"><span class="annottext">tvar :: Type v a -&gt; Type (TypeVar b v) a
</span><a href="#local-6989586621680776339"><span class="hs-identifier hs-var hs-var">tvar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type v a -&gt; Type (TypeVar b v) a
forall v a b. Ord v =&gt; Type v a -&gt; Type (TypeVar b v) a
</span><a href="Unison.Typechecker.TypeVar.html#liftType"><span class="hs-identifier hs-var">TypeVar.liftType</span></a></span><span>
</span><span id="line-136"></span><span>
</span><span id="line-137"></span><span id="local-6989586621680776337"><span id="local-6989586621680776338"><span class="annot"><a href="Unison.Typechecker.html#isEqual"><span class="hs-identifier hs-type">isEqual</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Var</span></span><span> </span><span class="annot"><a href="#local-6989586621680776338"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><a href="#local-6989586621680776338"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776337"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><a href="#local-6989586621680776338"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776337"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span></span><span>
</span><span id="line-138"></span><span id="isEqual"><span class="annot"><span class="annottext">isEqual :: Type v loc -&gt; Type v loc -&gt; Bool
</span><a href="Unison.Typechecker.html#isEqual"><span class="hs-identifier hs-var hs-var">isEqual</span></a></span></span><span> </span><span id="local-6989586621680776335"><span class="annot"><span class="annottext">Type v loc
</span><a href="#local-6989586621680776335"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span id="local-6989586621680776334"><span class="annot"><span class="annottext">Type v loc
</span><a href="#local-6989586621680776334"><span class="hs-identifier hs-var">t2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type v loc -&gt; Type v loc -&gt; Bool
forall v loc. Var v =&gt; Type v loc -&gt; Type v loc -&gt; Bool
</span><a href="Unison.Typechecker.html#isSubtype"><span class="hs-identifier hs-var">isSubtype</span></a></span><span> </span><span class="annot"><span class="annottext">Type v loc
</span><a href="#local-6989586621680776335"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="annot"><span class="annottext">Type v loc
</span><a href="#local-6989586621680776334"><span class="hs-identifier hs-var">t2</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Type v loc -&gt; Type v loc -&gt; Bool
forall v loc. Var v =&gt; Type v loc -&gt; Type v loc -&gt; Bool
</span><a href="Unison.Typechecker.html#isSubtype"><span class="hs-identifier hs-var">isSubtype</span></a></span><span> </span><span class="annot"><span class="annottext">Type v loc
</span><a href="#local-6989586621680776334"><span class="hs-identifier hs-var">t2</span></a></span><span> </span><span class="annot"><span class="annottext">Type v loc
</span><a href="#local-6989586621680776335"><span class="hs-identifier hs-var">t1</span></a></span><span>
</span><span id="line-139"></span><span>
</span><span id="line-140"></span><span class="hs-keyword">type</span><span> </span><span id="TDNR"><span class="annot"><a href="Unison.Typechecker.html#TDNR"><span class="hs-identifier hs-var">TDNR</span></a></span></span><span> </span><span id="local-6989586621680776332"><span class="annot"><a href="#local-6989586621680776332"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span id="local-6989586621680776331"><span class="annot"><a href="#local-6989586621680776331"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span id="local-6989586621680776330"><span class="annot"><a href="#local-6989586621680776330"><span class="hs-identifier hs-type">loc</span></a></span></span><span> </span><span id="local-6989586621680776329"><span class="annot"><a href="#local-6989586621680776329"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-141"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">StateT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Term</span></span><span> </span><span class="annot"><a href="#local-6989586621680776331"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776330"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Result.html#ResultT"><span class="hs-identifier hs-type">ResultT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Typechecker.html#Notes"><span class="hs-identifier hs-type">Notes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776331"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776330"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680776332"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680776329"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-142"></span><span>
</span><span id="line-143"></span><span class="hs-keyword">data</span><span> </span><span id="Resolution"><span class="annot"><a href="Unison.Typechecker.html#Resolution"><span class="hs-identifier hs-var">Resolution</span></a></span></span><span> </span><span id="local-6989586621680776540"><span class="annot"><a href="#local-6989586621680776540"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span id="local-6989586621680776539"><span class="annot"><a href="#local-6989586621680776539"><span class="hs-identifier hs-type">loc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Resolution"><span class="annot"><a href="Unison.Typechecker.html#Resolution"><span class="hs-identifier hs-var">Resolution</span></a></span></span><span>
</span><span id="line-144"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3AresolvedName%3AResolution"><span class="annot"><span class="annottext">Resolution v loc -&gt; Name
</span><a href="Unison.Typechecker.html#%24sel%3AresolvedName%3AResolution"><span class="hs-identifier hs-var hs-var">resolvedName</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">,</span><span>
</span><span id="line-145"></span><span>    </span><span id="%24sel%3AinferredType%3AResolution"><span class="annot"><span class="annottext">Resolution v loc -&gt; Type v loc
</span><a href="Unison.Typechecker.html#%24sel%3AinferredType%3AResolution"><span class="hs-identifier hs-var hs-var">inferredType</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Typechecker.Context.html#Type"><span class="hs-identifier hs-type">Context.Type</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776540"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776539"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-146"></span><span>    </span><span id="%24sel%3AresolvedLoc%3AResolution"><span class="annot"><span class="annottext">Resolution v loc -&gt; loc
</span><a href="Unison.Typechecker.html#%24sel%3AresolvedLoc%3AResolution"><span class="hs-identifier hs-var hs-var">resolvedLoc</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621680776539"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-147"></span><span>    </span><span id="%24sel%3Asuggestions%3AResolution"><span class="annot"><span class="annottext">Resolution v loc -&gt; [Suggestion v loc]
</span><a href="Unison.Typechecker.html#%24sel%3Asuggestions%3AResolution"><span class="hs-identifier hs-var hs-var">suggestions</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Unison.Typechecker.Context.html#Suggestion"><span class="hs-identifier hs-type">Context.Suggestion</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776540"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776539"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-148"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-149"></span><span>
</span><span id="line-150"></span><span class="hs-comment">-- | Infer the type of a 'Unison.Term', using type-directed name resolution</span><span>
</span><span id="line-151"></span><span class="hs-comment">-- to attempt to resolve unknown symbols.</span><span>
</span><span id="line-152"></span><span id="local-6989586621680776536"><span id="local-6989586621680776537"><span id="local-6989586621680776538"><span class="annot"><a href="Unison.Typechecker.html#synthesizeAndResolve"><span class="hs-identifier hs-type">synthesizeAndResolve</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-153"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621680776538"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Var</span></span><span> </span><span class="annot"><a href="#local-6989586621680776537"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="#local-6989586621680776536"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680776536"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Unison.Typechecker.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776537"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776536"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Typechecker.html#TDNR"><span class="hs-identifier hs-type">TDNR</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776538"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776537"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776536"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><a href="#local-6989586621680776537"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776536"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-154"></span><span id="synthesizeAndResolve"><span class="annot"><span class="annottext">synthesizeAndResolve :: Env v loc -&gt; TDNR f v loc (Type v loc)
</span><a href="Unison.Typechecker.html#synthesizeAndResolve"><span class="hs-identifier hs-var hs-var">synthesizeAndResolve</span></a></span></span><span> </span><span id="local-6989586621680776322"><span class="annot"><span class="annottext">Env v loc
</span><a href="#local-6989586621680776322"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-155"></span><span>  </span><span id="local-6989586621680776321"><span class="annot"><span class="annottext">Term v loc
</span><a href="#local-6989586621680776321"><span class="hs-identifier hs-var">tm</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT (Term v loc) (ResultT (Notes v loc) f) (Term v loc)
forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">get</span></span><span>
</span><span id="line-156"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621680776320"><span class="annot"><span class="annottext">Type v loc
</span><a href="#local-6989586621680776320"><span class="hs-identifier hs-var">tp</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680776319"><span class="annot"><span class="annottext">Notes v loc
</span><a href="#local-6989586621680776319"><span class="hs-identifier hs-var">notes</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TDNR f v loc (Type v loc)
-&gt; StateT
     (Term v loc) (ResultT (Notes v loc) f) (Type v loc, Notes v loc)
forall w (m :: * -&gt; *) a. MonadWriter w m =&gt; m a -&gt; m (a, w)
</span><span class="hs-identifier hs-var">listen</span></span><span> </span><span class="annot"><span class="annottext">(TDNR f v loc (Type v loc)
 -&gt; StateT
      (Term v loc) (ResultT (Notes v loc) f) (Type v loc, Notes v loc))
-&gt; (MaybeT (WriterT (Notes v loc) f) (Type v loc)
    -&gt; TDNR f v loc (Type v loc))
-&gt; MaybeT (WriterT (Notes v loc) f) (Type v loc)
-&gt; StateT
     (Term v loc) (ResultT (Notes v loc) f) (Type v loc, Notes v loc)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">MaybeT (WriterT (Notes v loc) f) (Type v loc)
-&gt; TDNR f v loc (Type v loc)
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(MaybeT (WriterT (Notes v loc) f) (Type v loc)
 -&gt; StateT
      (Term v loc) (ResultT (Notes v loc) f) (Type v loc, Notes v loc))
-&gt; MaybeT (WriterT (Notes v loc) f) (Type v loc)
-&gt; StateT
     (Term v loc) (ResultT (Notes v loc) f) (Type v loc, Notes v loc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Env v loc
-&gt; Term v loc -&gt; MaybeT (WriterT (Notes v loc) f) (Type v loc)
forall (f :: * -&gt; *) v loc.
(Monad f, Var v, Ord loc) =&gt;
Env v loc -&gt; Term v loc -&gt; ResultT (Notes v loc) f (Type v loc)
</span><a href="Unison.Typechecker.html#synthesize"><span class="hs-identifier hs-var">synthesize</span></a></span><span> </span><span class="annot"><span class="annottext">Env v loc
</span><a href="#local-6989586621680776322"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Term v loc
</span><a href="#local-6989586621680776321"><span class="hs-identifier hs-var">tm</span></a></span><span>
</span><span id="line-157"></span><span>  </span><span class="annot"><span class="annottext">Notes v loc -&gt; Type v loc -&gt; Env v loc -&gt; TDNR f v loc (Type v loc)
forall v loc (f :: * -&gt; *).
(Monad f, Var v, Ord loc, Monoid loc) =&gt;
Notes v loc -&gt; Type v loc -&gt; Env v loc -&gt; TDNR f v loc (Type v loc)
</span><a href="Unison.Typechecker.html#typeDirectedNameResolution"><span class="hs-identifier hs-var">typeDirectedNameResolution</span></a></span><span> </span><span class="annot"><span class="annottext">Notes v loc
</span><a href="#local-6989586621680776319"><span class="hs-identifier hs-var">notes</span></a></span><span> </span><span class="annot"><span class="annottext">Type v loc
</span><a href="#local-6989586621680776320"><span class="hs-identifier hs-var">tp</span></a></span><span> </span><span class="annot"><span class="annottext">Env v loc
</span><a href="#local-6989586621680776322"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-158"></span><span>
</span><span id="line-159"></span><span id="local-6989586621680776459"><span id="local-6989586621680776460"><span class="annot"><a href="Unison.Typechecker.html#compilerBug"><span class="hs-identifier hs-type">compilerBug</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Typechecker.Context.html#CompilerBug"><span class="hs-identifier hs-type">Context.CompilerBug</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776460"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776459"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Result.html#Result"><span class="hs-identifier hs-type">Result</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Typechecker.html#Notes"><span class="hs-identifier hs-type">Notes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776460"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776459"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-160"></span><span id="compilerBug"><span class="annot"><span class="annottext">compilerBug :: CompilerBug v loc -&gt; Result (Notes v loc) ()
</span><a href="Unison.Typechecker.html#compilerBug"><span class="hs-identifier hs-var hs-var">compilerBug</span></a></span></span><span> </span><span id="local-6989586621680776314"><span class="annot"><span class="annottext">CompilerBug v loc
</span><a href="#local-6989586621680776314"><span class="hs-identifier hs-var">bug</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-161"></span><span>  </span><span class="annot"><span class="annottext">Notes v loc -&gt; Result (Notes v loc) ()
forall w (m :: * -&gt; *). MonadWriter w m =&gt; w -&gt; m ()
</span><span class="hs-identifier hs-var">tell</span></span><span> </span><span class="annot"><span class="annottext">(Notes v loc -&gt; Result (Notes v loc) ())
-&gt; Notes v loc -&gt; Result (Notes v loc) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Seq (CompilerBug v loc)
-&gt; Seq (ErrorNote v loc) -&gt; Seq (InfoNote v loc) -&gt; Notes v loc
forall v loc.
Seq (CompilerBug v loc)
-&gt; Seq (ErrorNote v loc) -&gt; Seq (InfoNote v loc) -&gt; Notes v loc
</span><a href="Unison.Typechecker.html#Notes"><span class="hs-identifier hs-var">Notes</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Item (Seq (CompilerBug v loc))
CompilerBug v loc
</span><a href="#local-6989586621680776314"><span class="hs-identifier hs-var">bug</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Seq (ErrorNote v loc)
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">Seq (InfoNote v loc)
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-162"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; Result (Notes v loc) ()
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><span class="hs-identifier hs-var">Control.Monad.Fail.fail</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-163"></span><span>
</span><span id="line-164"></span><span id="local-6989586621680776516"><span id="local-6989586621680776517"><span class="annot"><a href="Unison.Typechecker.html#typeError"><span class="hs-identifier hs-type">typeError</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Typechecker.Context.html#ErrorNote"><span class="hs-identifier hs-type">Context.ErrorNote</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776517"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776516"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Result.html#Result"><span class="hs-identifier hs-type">Result</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Typechecker.html#Notes"><span class="hs-identifier hs-type">Notes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776517"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776516"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-165"></span><span id="typeError"><span class="annot"><span class="annottext">typeError :: ErrorNote v loc -&gt; Result (Notes v loc) ()
</span><a href="Unison.Typechecker.html#typeError"><span class="hs-identifier hs-var hs-var">typeError</span></a></span></span><span> </span><span id="local-6989586621680776311"><span class="annot"><span class="annottext">ErrorNote v loc
</span><a href="#local-6989586621680776311"><span class="hs-identifier hs-var">note</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-166"></span><span>  </span><span class="annot"><span class="annottext">Notes v loc -&gt; Result (Notes v loc) ()
forall w (m :: * -&gt; *). MonadWriter w m =&gt; w -&gt; m ()
</span><span class="hs-identifier hs-var">tell</span></span><span> </span><span class="annot"><span class="annottext">(Notes v loc -&gt; Result (Notes v loc) ())
-&gt; Notes v loc -&gt; Result (Notes v loc) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Seq (CompilerBug v loc)
-&gt; Seq (ErrorNote v loc) -&gt; Seq (InfoNote v loc) -&gt; Notes v loc
forall v loc.
Seq (CompilerBug v loc)
-&gt; Seq (ErrorNote v loc) -&gt; Seq (InfoNote v loc) -&gt; Notes v loc
</span><a href="Unison.Typechecker.html#Notes"><span class="hs-identifier hs-var">Notes</span></a></span><span> </span><span class="annot"><span class="annottext">Seq (CompilerBug v loc)
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Item (Seq (ErrorNote v loc))
ErrorNote v loc
</span><a href="#local-6989586621680776311"><span class="hs-identifier hs-var">note</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Seq (InfoNote v loc)
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-167"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; Result (Notes v loc) ()
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><span class="hs-identifier hs-var">Control.Monad.Fail.fail</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-168"></span><span>
</span><span id="line-169"></span><span id="local-6989586621680776503"><span id="local-6989586621680776504"><span id="local-6989586621680776505"><span class="annot"><a href="Unison.Typechecker.html#btw"><span class="hs-identifier hs-type">btw</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621680776505"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Unison.Typechecker.Context.html#InfoNote"><span class="hs-identifier hs-type">Context.InfoNote</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776504"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776503"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Result.html#ResultT"><span class="hs-identifier hs-type">ResultT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Typechecker.html#Notes"><span class="hs-identifier hs-type">Notes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776504"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776503"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680776505"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-170"></span><span id="btw"><span class="annot"><span class="annottext">btw :: InfoNote v loc -&gt; ResultT (Notes v loc) f ()
</span><a href="Unison.Typechecker.html#btw"><span class="hs-identifier hs-var hs-var">btw</span></a></span></span><span> </span><span id="local-6989586621680776309"><span class="annot"><span class="annottext">InfoNote v loc
</span><a href="#local-6989586621680776309"><span class="hs-identifier hs-var">note</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Notes v loc -&gt; ResultT (Notes v loc) f ()
forall w (m :: * -&gt; *). MonadWriter w m =&gt; w -&gt; m ()
</span><span class="hs-identifier hs-var">tell</span></span><span> </span><span class="annot"><span class="annottext">(Notes v loc -&gt; ResultT (Notes v loc) f ())
-&gt; Notes v loc -&gt; ResultT (Notes v loc) f ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Seq (CompilerBug v loc)
-&gt; Seq (ErrorNote v loc) -&gt; Seq (InfoNote v loc) -&gt; Notes v loc
forall v loc.
Seq (CompilerBug v loc)
-&gt; Seq (ErrorNote v loc) -&gt; Seq (InfoNote v loc) -&gt; Notes v loc
</span><a href="Unison.Typechecker.html#Notes"><span class="hs-identifier hs-var">Notes</span></a></span><span> </span><span class="annot"><span class="annottext">Seq (CompilerBug v loc)
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">Seq (ErrorNote v loc)
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Item (Seq (InfoNote v loc))
InfoNote v loc
</span><a href="#local-6989586621680776309"><span class="hs-identifier hs-var">note</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-171"></span><span>
</span><span id="line-172"></span><span id="local-6989586621680776555"><span id="local-6989586621680776556"><span id="local-6989586621680776557"><span id="local-6989586621680776558"><span class="annot"><a href="Unison.Typechecker.html#liftResult"><span class="hs-identifier hs-type">liftResult</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621680776558"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Unison.Result.html#Result"><span class="hs-identifier hs-type">Result</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Typechecker.html#Notes"><span class="hs-identifier hs-type">Notes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776557"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776556"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680776555"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Typechecker.html#TDNR"><span class="hs-identifier hs-type">TDNR</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776558"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776557"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776556"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776555"><span class="hs-identifier hs-type">a</span></a></span></span></span></span></span><span>
</span><span id="line-173"></span><span id="liftResult"><span class="annot"><span class="annottext">liftResult :: Result (Notes v loc) a -&gt; TDNR f v loc a
</span><a href="Unison.Typechecker.html#liftResult"><span class="hs-identifier hs-var hs-var">liftResult</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MaybeT (WriterT (Notes v loc) f) a -&gt; TDNR f v loc a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(MaybeT (WriterT (Notes v loc) f) a -&gt; TDNR f v loc a)
-&gt; (Result (Notes v loc) a -&gt; MaybeT (WriterT (Notes v loc) f) a)
-&gt; Result (Notes v loc) a
-&gt; TDNR f v loc a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">WriterT (Notes v loc) f (Maybe a)
-&gt; MaybeT (WriterT (Notes v loc) f) a
forall (m :: * -&gt; *) a. m (Maybe a) -&gt; MaybeT m a
</span><span class="hs-identifier hs-var">MaybeT</span></span><span> </span><span class="annot"><span class="annottext">(WriterT (Notes v loc) f (Maybe a)
 -&gt; MaybeT (WriterT (Notes v loc) f) a)
-&gt; (Result (Notes v loc) a -&gt; WriterT (Notes v loc) f (Maybe a))
-&gt; Result (Notes v loc) a
-&gt; MaybeT (WriterT (Notes v loc) f) a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">f (Maybe a, Notes v loc) -&gt; WriterT (Notes v loc) f (Maybe a)
forall w (m :: * -&gt; *) a. m (a, w) -&gt; WriterT w m a
</span><span class="hs-identifier hs-var">WriterT</span></span><span> </span><span class="annot"><span class="annottext">(f (Maybe a, Notes v loc) -&gt; WriterT (Notes v loc) f (Maybe a))
-&gt; (Result (Notes v loc) a -&gt; f (Maybe a, Notes v loc))
-&gt; Result (Notes v loc) a
-&gt; WriterT (Notes v loc) f (Maybe a)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Maybe a, Notes v loc) -&gt; f (Maybe a, Notes v loc)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">((Maybe a, Notes v loc) -&gt; f (Maybe a, Notes v loc))
-&gt; (Result (Notes v loc) a -&gt; (Maybe a, Notes v loc))
-&gt; Result (Notes v loc) a
-&gt; f (Maybe a, Notes v loc)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Identity (Maybe a, Notes v loc) -&gt; (Maybe a, Notes v loc)
forall a. Identity a -&gt; a
</span><span class="hs-identifier hs-var hs-var">runIdentity</span></span><span> </span><span class="annot"><span class="annottext">(Identity (Maybe a, Notes v loc) -&gt; (Maybe a, Notes v loc))
-&gt; (Result (Notes v loc) a -&gt; Identity (Maybe a, Notes v loc))
-&gt; Result (Notes v loc) a
-&gt; (Maybe a, Notes v loc)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Result (Notes v loc) a -&gt; Identity (Maybe a, Notes v loc)
forall notes (f :: * -&gt; *) a.
ResultT notes f a -&gt; f (Maybe a, notes)
</span><a href="Unison.Result.html#runResultT"><span class="hs-identifier hs-var">runResultT</span></a></span><span>
</span><span id="line-174"></span><span>
</span><span id="line-175"></span><span class="hs-comment">-- Resolve &quot;solved blanks&quot;. If a solved blank's type and name matches the type</span><span>
</span><span id="line-176"></span><span class="hs-comment">-- and unqualified name of a symbol that isn't imported, provide a note</span><span>
</span><span id="line-177"></span><span class="hs-comment">-- suggesting the import. If the blank is ambiguous and only one typechecks, use</span><span>
</span><span id="line-178"></span><span class="hs-comment">-- that one.  Otherwise, provide an unknown symbol error to the user.</span><span>
</span><span id="line-179"></span><span class="hs-comment">-- The cases we consider are:</span><span>
</span><span id="line-180"></span><span class="hs-comment">-- 1. There exist names that match and their types match too. Tell the user</span><span>
</span><span id="line-181"></span><span class="hs-comment">--    the fully qualified names of these terms, and their types.</span><span>
</span><span id="line-182"></span><span class="hs-comment">-- 2. There's more than one name that matches,</span><span>
</span><span id="line-183"></span><span class="hs-comment">--    but only one that typechecks. Substitute that one into the code.</span><span>
</span><span id="line-184"></span><span class="hs-comment">-- 3. No match at all. Throw an unresolved symbol at the user.</span><span>
</span><span id="line-185"></span><span class="annot"><a href="Unison.Typechecker.html#typeDirectedNameResolution"><span class="hs-identifier hs-type">typeDirectedNameResolution</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-186"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680776591"><span class="annot"><a href="#local-6989586621680776591"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span id="local-6989586621680776590"><span class="annot"><a href="#local-6989586621680776590"><span class="hs-identifier hs-type">loc</span></a></span></span><span> </span><span id="local-6989586621680776592"><span class="annot"><a href="#local-6989586621680776592"><span class="hs-identifier hs-type">f</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-187"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621680776592"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Var</span></span><span> </span><span class="annot"><a href="#local-6989586621680776591"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680776590"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="#local-6989586621680776590"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-188"></span><span>  </span><span class="annot"><a href="Unison.Typechecker.html#Notes"><span class="hs-identifier hs-type">Notes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776591"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776590"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-189"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><a href="#local-6989586621680776591"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776590"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-190"></span><span>  </span><span class="annot"><a href="Unison.Typechecker.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776591"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776590"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-191"></span><span>  </span><span class="annot"><a href="Unison.Typechecker.html#TDNR"><span class="hs-identifier hs-type">TDNR</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776592"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776591"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776590"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><a href="#local-6989586621680776591"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776590"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-192"></span><span id="typeDirectedNameResolution"><span class="annot"><span class="annottext">typeDirectedNameResolution :: Notes v loc -&gt; Type v loc -&gt; Env v loc -&gt; TDNR f v loc (Type v loc)
</span><a href="Unison.Typechecker.html#typeDirectedNameResolution"><span class="hs-identifier hs-var hs-var">typeDirectedNameResolution</span></a></span></span><span> </span><span id="local-6989586621680776305"><span class="annot"><span class="annottext">Notes v loc
</span><a href="#local-6989586621680776305"><span class="hs-identifier hs-var">oldNotes</span></a></span></span><span> </span><span id="local-6989586621680776304"><span class="annot"><span class="annottext">Type v loc
</span><a href="#local-6989586621680776304"><span class="hs-identifier hs-var">oldType</span></a></span></span><span> </span><span id="local-6989586621680776303"><span class="annot"><span class="annottext">Env v loc
</span><a href="#local-6989586621680776303"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-193"></span><span>  </span><span class="hs-comment">-- Add typed components (local definitions) to the TDNR environment.</span><span>
</span><span id="line-194"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680776302"><span class="annot"><span class="annottext">tdnrEnv :: Env v loc
</span><a href="#local-6989586621680776302"><span class="hs-identifier hs-var hs-var">tdnrEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">State (Env v loc) () -&gt; Env v loc -&gt; Env v loc
forall s a. State s a -&gt; s -&gt; s
</span><span class="hs-identifier hs-var">execState</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(InfoNote v loc -&gt; State (Env v loc) ())
-&gt; Seq (InfoNote v loc) -&gt; State (Env v loc) ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f ()
</span><span class="hs-identifier hs-var">traverse_</span></span><span> </span><span class="annot"><span class="annottext">InfoNote v loc -&gt; State (Env v loc) ()
</span><a href="#local-6989586621680776300"><span class="hs-identifier hs-var">addTypedComponent</span></a></span><span> </span><span class="annot"><span class="annottext">(Seq (InfoNote v loc) -&gt; State (Env v loc) ())
-&gt; Seq (InfoNote v loc) -&gt; State (Env v loc) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Notes v loc -&gt; Seq (InfoNote v loc)
forall v loc. Notes v loc -&gt; Seq (InfoNote v loc)
</span><a href="Unison.Typechecker.html#%24sel%3Ainfos%3ANotes"><span class="hs-identifier hs-var hs-var">infos</span></a></span><span> </span><span class="annot"><span class="annottext">Notes v loc
</span><a href="#local-6989586621680776305"><span class="hs-identifier hs-var">oldNotes</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Env v loc
</span><a href="#local-6989586621680776303"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-195"></span><span>  </span><span class="hs-comment">-- Resolve blanks in the notes and generate some resolutions</span><span>
</span><span id="line-196"></span><span>  </span><span id="local-6989586621680776299"><span class="annot"><span class="annottext">[Maybe (Resolution v loc)]
</span><a href="#local-6989586621680776299"><span class="hs-identifier hs-var">resolutions</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-197"></span><span>    </span><span class="annot"><span class="annottext">Result (Notes v loc) [Maybe (Resolution v loc)]
-&gt; TDNR f v loc [Maybe (Resolution v loc)]
forall (f :: * -&gt; *) v loc a.
Monad f =&gt;
Result (Notes v loc) a -&gt; TDNR f v loc a
</span><a href="Unison.Typechecker.html#liftResult"><span class="hs-identifier hs-var">liftResult</span></a></span><span> </span><span class="annot"><span class="annottext">(Result (Notes v loc) [Maybe (Resolution v loc)]
 -&gt; TDNR f v loc [Maybe (Resolution v loc)])
-&gt; (Seq (InfoNote v loc)
    -&gt; Result (Notes v loc) [Maybe (Resolution v loc)])
-&gt; Seq (InfoNote v loc)
-&gt; TDNR f v loc [Maybe (Resolution v loc)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(InfoNote v loc
 -&gt; MaybeT
      (WriterT (Notes v loc) Identity) (Maybe (Resolution v loc)))
-&gt; [InfoNote v loc]
-&gt; Result (Notes v loc) [Maybe (Resolution v loc)]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Env v loc
-&gt; InfoNote v loc
-&gt; MaybeT
     (WriterT (Notes v loc) Identity) (Maybe (Resolution v loc))
</span><a href="#local-6989586621680776297"><span class="hs-identifier hs-var">resolveNote</span></a></span><span> </span><span class="annot"><span class="annottext">Env v loc
</span><a href="#local-6989586621680776302"><span class="hs-identifier hs-var">tdnrEnv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([InfoNote v loc]
 -&gt; Result (Notes v loc) [Maybe (Resolution v loc)])
-&gt; (Seq (InfoNote v loc) -&gt; [InfoNote v loc])
-&gt; Seq (InfoNote v loc)
-&gt; Result (Notes v loc) [Maybe (Resolution v loc)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Seq (InfoNote v loc) -&gt; [InfoNote v loc]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">(Seq (InfoNote v loc) -&gt; TDNR f v loc [Maybe (Resolution v loc)])
-&gt; Seq (InfoNote v loc) -&gt; TDNR f v loc [Maybe (Resolution v loc)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-198"></span><span>      </span><span class="annot"><span class="annottext">Notes v loc -&gt; Seq (InfoNote v loc)
forall v loc. Notes v loc -&gt; Seq (InfoNote v loc)
</span><a href="Unison.Typechecker.html#%24sel%3Ainfos%3ANotes"><span class="hs-identifier hs-var hs-var">infos</span></a></span><span>
</span><span id="line-199"></span><span>        </span><span class="annot"><span class="annottext">Notes v loc
</span><a href="#local-6989586621680776305"><span class="hs-identifier hs-var">oldNotes</span></a></span><span>
</span><span id="line-200"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[Maybe (Resolution v loc)] -&gt; [Resolution v loc]
forall a. [Maybe a] -&gt; [a]
</span><span class="hs-identifier hs-var">catMaybes</span></span><span> </span><span class="annot"><span class="annottext">[Maybe (Resolution v loc)]
</span><a href="#local-6989586621680776299"><span class="hs-identifier hs-var">resolutions</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-201"></span><span>    </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type v loc -&gt; TDNR f v loc (Type v loc)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Type v loc
</span><a href="#local-6989586621680776304"><span class="hs-identifier hs-var">oldType</span></a></span><span>
</span><span id="line-202"></span><span>    </span><span id="local-6989586621680776294"><span class="annot"><span class="annottext">[Resolution v loc]
</span><a href="#local-6989586621680776294"><span class="hs-identifier hs-var">rs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-203"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680776293"><span class="annot"><span class="annottext">goAgain :: Bool
</span><a href="#local-6989586621680776293"><span class="hs-identifier hs-var hs-var">goAgain</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-204"></span><span>            </span><span class="annot"><span class="annottext">(Resolution v loc -&gt; Bool) -&gt; [Resolution v loc] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Bool)
-&gt; (Resolution v loc -&gt; Int) -&gt; Resolution v loc -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Suggestion v loc] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">([Suggestion v loc] -&gt; Int)
-&gt; (Resolution v loc -&gt; [Suggestion v loc])
-&gt; Resolution v loc
-&gt; Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Suggestion v loc] -&gt; [Suggestion v loc]
</span><a href="#local-6989586621680776290"><span class="hs-identifier hs-var">dedupe</span></a></span><span> </span><span class="annot"><span class="annottext">([Suggestion v loc] -&gt; [Suggestion v loc])
-&gt; (Resolution v loc -&gt; [Suggestion v loc])
-&gt; Resolution v loc
-&gt; [Suggestion v loc]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Suggestion v loc -&gt; Bool)
-&gt; [Suggestion v loc] -&gt; [Suggestion v loc]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="annot"><span class="annottext">Suggestion v loc -&gt; Bool
forall v loc. Suggestion v loc -&gt; Bool
</span><a href="Unison.Typechecker.Context.html#isExact"><span class="hs-identifier hs-var">Context.isExact</span></a></span><span> </span><span class="annot"><span class="annottext">([Suggestion v loc] -&gt; [Suggestion v loc])
-&gt; (Resolution v loc -&gt; [Suggestion v loc])
-&gt; Resolution v loc
-&gt; [Suggestion v loc]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Resolution v loc -&gt; [Suggestion v loc]
forall v loc. Resolution v loc -&gt; [Suggestion v loc]
</span><a href="Unison.Typechecker.html#%24sel%3Asuggestions%3AResolution"><span class="hs-identifier hs-var hs-var">suggestions</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Resolution v loc]
</span><a href="#local-6989586621680776294"><span class="hs-identifier hs-var">rs</span></a></span><span>
</span><span id="line-205"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680776293"><span class="hs-identifier hs-var">goAgain</span></a></span><span>
</span><span id="line-206"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-207"></span><span>              </span><span class="annot"><span class="annottext">(Resolution v loc
 -&gt; StateT (Term v loc) (ResultT (Notes v loc) f) ())
-&gt; [Resolution v loc]
-&gt; StateT (Term v loc) (ResultT (Notes v loc) f) ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f ()
</span><span class="hs-identifier hs-var">traverse_</span></span><span> </span><span class="annot"><span class="annottext">Resolution v loc
-&gt; StateT (Term v loc) (ResultT (Notes v loc) f) ()
</span><a href="#local-6989586621680776288"><span class="hs-identifier hs-var">substSuggestion</span></a></span><span> </span><span class="annot"><span class="annottext">[Resolution v loc]
</span><a href="#local-6989586621680776294"><span class="hs-identifier hs-var">rs</span></a></span><span>
</span><span id="line-208"></span><span>              </span><span class="annot"><span class="annottext">Env v loc -&gt; TDNR f v loc (Type v loc)
forall (f :: * -&gt; *) v loc.
(Monad f, Var v, Monoid loc, Ord loc) =&gt;
Env v loc -&gt; TDNR f v loc (Type v loc)
</span><a href="Unison.Typechecker.html#synthesizeAndResolve"><span class="hs-identifier hs-var">synthesizeAndResolve</span></a></span><span> </span><span class="annot"><span class="annottext">Env v loc
</span><a href="#local-6989586621680776302"><span class="hs-identifier hs-var">tdnrEnv</span></a></span><span>
</span><span id="line-209"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-210"></span><span>              </span><span class="hs-comment">-- The type hasn't changed</span><span>
</span><span id="line-211"></span><span>              </span><span class="annot"><span class="annottext">Result (Notes v loc) ()
-&gt; StateT (Term v loc) (ResultT (Notes v loc) f) ()
forall (f :: * -&gt; *) v loc a.
Monad f =&gt;
Result (Notes v loc) a -&gt; TDNR f v loc a
</span><a href="Unison.Typechecker.html#liftResult"><span class="hs-identifier hs-var">liftResult</span></a></span><span> </span><span class="annot"><span class="annottext">(Result (Notes v loc) ()
 -&gt; StateT (Term v loc) (ResultT (Notes v loc) f) ())
-&gt; Result (Notes v loc) ()
-&gt; StateT (Term v loc) (ResultT (Notes v loc) f) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Resolution v loc] -&gt; Result (Notes v loc) ()
</span><a href="#local-6989586621680776287"><span class="hs-identifier hs-var">suggest</span></a></span><span> </span><span class="annot"><span class="annottext">[Resolution v loc]
</span><a href="#local-6989586621680776294"><span class="hs-identifier hs-var">rs</span></a></span><span>
</span><span id="line-212"></span><span>              </span><span class="hs-identifier">pure</span><span> </span><span class="annot"><span class="annottext">Type v loc
</span><a href="#local-6989586621680776304"><span class="hs-identifier hs-var">oldType</span></a></span><span>
</span><span id="line-213"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-214"></span><span>    </span><span class="annot"><a href="#local-6989586621680776300"><span class="hs-identifier hs-type">addTypedComponent</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Typechecker.Context.html#InfoNote"><span class="hs-identifier hs-type">Context.InfoNote</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776591"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776590"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">State</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Typechecker.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776591"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776590"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-215"></span><span>    </span><span id="local-6989586621680776300"><span class="annot"><span class="annottext">addTypedComponent :: InfoNote v loc -&gt; State (Env v loc) ()
</span><a href="#local-6989586621680776300"><span class="hs-identifier hs-var hs-var">addTypedComponent</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Typechecker.Context.html#TopLevelComponent"><span class="hs-identifier hs-type">Context.TopLevelComponent</span></a></span><span> </span><span id="local-6989586621680776285"><span class="annot"><span class="annottext">[(v, Type v loc, Bool)]
</span><a href="#local-6989586621680776285"><span class="hs-identifier hs-var">vtts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-216"></span><span>      </span><span class="annot"><span class="annottext">[(v, Type v loc, Bool)]
-&gt; ((v, Type v loc, Bool) -&gt; State (Env v loc) ())
-&gt; State (Env v loc) ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f ()
</span><span class="hs-identifier hs-var">for_</span></span><span> </span><span class="annot"><span class="annottext">[(v, Type v loc, Bool)]
</span><a href="#local-6989586621680776285"><span class="hs-identifier hs-var">vtts</span></a></span><span> </span><span class="annot"><span class="annottext">(((v, Type v loc, Bool) -&gt; State (Env v loc) ())
 -&gt; State (Env v loc) ())
-&gt; ((v, Type v loc, Bool) -&gt; State (Env v loc) ())
-&gt; State (Env v loc) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680776283"><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621680776283"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680776282"><span class="annot"><span class="annottext">Type v loc
</span><a href="#local-6989586621680776282"><span class="hs-identifier hs-var">typ</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-217"></span><span>        </span><span class="annot"><span class="annottext">[Name] -&gt; (Name -&gt; State (Env v loc) ()) -&gt; State (Env v loc) ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f ()
</span><span class="hs-identifier hs-var">for_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; [Name]
</span><span class="hs-identifier hs-var">Name.suffixes</span></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; [Name]) -&gt; (v -&gt; Name) -&gt; v -&gt; [Name]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; Name -&gt; Name
Name -&gt; Name
</span><span class="hs-identifier hs-var">Name.unsafeFromText</span></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Name) -&gt; (v -&gt; Name) -&gt; v -&gt; Name
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">v -&gt; Name
forall v. Var v =&gt; v -&gt; Name
</span><span class="hs-identifier hs-var">Var.name</span></span><span> </span><span class="annot"><span class="annottext">(v -&gt; [Name]) -&gt; v -&gt; [Name]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">v -&gt; v
forall v. Var v =&gt; v -&gt; v
</span><span class="hs-identifier hs-var">Var.reset</span></span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621680776283"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Name -&gt; State (Env v loc) ()) -&gt; State (Env v loc) ())
-&gt; (Name -&gt; State (Env v loc) ()) -&gt; State (Env v loc) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680776278"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680776278"><span class="hs-identifier hs-var">suffix</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-218"></span><span>          </span><span class="annot"><span class="annottext">(Map Name [NamedReference v loc]
 -&gt; Identity (Map Name [NamedReference v loc]))
-&gt; Env v loc -&gt; Identity (Env v loc)
forall v loc. Lens' (Env v loc) (Map Name [NamedReference v loc])
</span><a href="Unison.Typechecker.html#termsByShortname"><span class="hs-identifier hs-var">termsByShortname</span></a></span><span>
</span><span id="line-219"></span><span>            </span><span class="annot"><span class="annottext">((Map Name [NamedReference v loc]
  -&gt; Identity (Map Name [NamedReference v loc]))
 -&gt; Env v loc -&gt; Identity (Env v loc))
-&gt; (Map Name [NamedReference v loc]
    -&gt; Map Name [NamedReference v loc])
-&gt; State (Env v loc) ()
forall s (m :: * -&gt; *) a b.
MonadState s m =&gt;
ASetter s s a b -&gt; (a -&gt; b) -&gt; m ()
</span><span class="hs-operator hs-var">%=</span></span><span> </span><span class="annot"><span class="annottext">([NamedReference v loc]
 -&gt; [NamedReference v loc] -&gt; [NamedReference v loc])
-&gt; Name
-&gt; [NamedReference v loc]
-&gt; Map Name [NamedReference v loc]
-&gt; Map Name [NamedReference v loc]
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.insertWith</span></span><span>
</span><span id="line-220"></span><span>              </span><span class="annot"><span class="annottext">[NamedReference v loc]
-&gt; [NamedReference v loc] -&gt; [NamedReference v loc]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(&lt;&gt;)</span></span><span>
</span><span id="line-221"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Name
</span><span class="hs-identifier hs-var">Name.toText</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680776278"><span class="hs-identifier hs-var">suffix</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-222"></span><span>              </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name -&gt; Type v loc -&gt; Either v Referent -&gt; NamedReference v loc
forall v loc.
Name -&gt; Type v loc -&gt; Either v Referent -&gt; NamedReference v loc
</span><a href="Unison.Typechecker.html#NamedReference"><span class="hs-identifier hs-var">NamedReference</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">v -&gt; Name
forall v. Var v =&gt; v -&gt; Name
</span><span class="hs-identifier hs-var">Var.name</span></span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621680776283"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type v loc
</span><a href="#local-6989586621680776282"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">v -&gt; Either v Referent
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621680776283"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-223"></span><span>    </span><span class="annot"><a href="#local-6989586621680776300"><span class="hs-identifier hs-var">addTypedComponent</span></a></span><span> </span><span class="annot"><span class="annottext">InfoNote v loc
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; State (Env v loc) ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-224"></span><span>
</span><span id="line-225"></span><span>    </span><span class="annot"><a href="#local-6989586621680776287"><span class="hs-identifier hs-type">suggest</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Unison.Typechecker.html#Resolution"><span class="hs-identifier hs-type">Resolution</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776591"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776590"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Result.html#Result"><span class="hs-identifier hs-type">Result</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Typechecker.html#Notes"><span class="hs-identifier hs-type">Notes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776591"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776590"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-226"></span><span>    </span><span id="local-6989586621680776287"><span class="annot"><span class="annottext">suggest :: [Resolution v loc] -&gt; Result (Notes v loc) ()
</span><a href="#local-6989586621680776287"><span class="hs-identifier hs-var hs-var">suggest</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-227"></span><span>      </span><span class="annot"><span class="annottext">(Resolution v loc -&gt; Result (Notes v loc) ())
-&gt; [Resolution v loc] -&gt; Result (Notes v loc) ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f ()
</span><span class="hs-identifier hs-var">traverse_</span></span><span>
</span><span id="line-228"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Unison.Typechecker.html#Resolution"><span class="hs-identifier hs-type">Resolution</span></a></span><span> </span><span id="local-6989586621680776275"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680776275"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621680776274"><span class="annot"><span class="annottext">Type v loc
</span><a href="#local-6989586621680776274"><span class="hs-identifier hs-var">inferredType</span></a></span></span><span> </span><span id="local-6989586621680776273"><span class="annot"><span class="annottext">loc
</span><a href="#local-6989586621680776273"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621680776272"><span class="annot"><span class="annottext">[Suggestion v loc]
</span><a href="#local-6989586621680776272"><span class="hs-identifier hs-var">suggestions</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-229"></span><span>            </span><span class="annot"><span class="annottext">ErrorNote v loc -&gt; Result (Notes v loc) ()
forall v loc. ErrorNote v loc -&gt; Result (Notes v loc) ()
</span><a href="Unison.Typechecker.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrorNote v loc -&gt; Result (Notes v loc) ())
-&gt; ErrorNote v loc -&gt; Result (Notes v loc) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-230"></span><span>              </span><span class="annot"><span class="annottext">Cause v loc -&gt; Seq (PathElement v loc) -&gt; ErrorNote v loc
forall v loc.
Cause v loc -&gt; Seq (PathElement v loc) -&gt; ErrorNote v loc
</span><a href="Unison.Typechecker.Context.html#ErrorNote"><span class="hs-identifier hs-var">Context.ErrorNote</span></a></span><span>
</span><span id="line-231"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">loc -&gt; v -&gt; [Suggestion v loc] -&gt; Type v loc -&gt; Cause v loc
forall v loc.
loc -&gt; v -&gt; [Suggestion v loc] -&gt; Type v loc -&gt; Cause v loc
</span><a href="Unison.Typechecker.Context.html#UnknownTerm"><span class="hs-identifier hs-var">Context.UnknownTerm</span></a></span><span> </span><span class="annot"><span class="annottext">loc
</span><a href="#local-6989586621680776273"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; v
forall v. Var v =&gt; Name -&gt; v
</span><span class="hs-identifier hs-var">Var.named</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680776275"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Suggestion v loc] -&gt; [Suggestion v loc]
</span><a href="#local-6989586621680776290"><span class="hs-identifier hs-var">dedupe</span></a></span><span> </span><span class="annot"><span class="annottext">[Suggestion v loc]
</span><a href="#local-6989586621680776272"><span class="hs-identifier hs-var">suggestions</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type v loc
</span><a href="#local-6989586621680776274"><span class="hs-identifier hs-var">inferredType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-232"></span><span>                </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-233"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-234"></span><span>    </span><span id="local-6989586621680776268"><span class="annot"><span class="annottext">guard :: Bool -&gt; a -&gt; Maybe a
</span><a href="#local-6989586621680776268"><span class="hs-identifier hs-var hs-var">guard</span></a></span></span><span> </span><span id="local-6989586621680776267"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680776267"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621680776266"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680776266"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680776267"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">a -&gt; Maybe a
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680776266"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-235"></span><span>
</span><span id="line-236"></span><span>    </span><span class="annot"><a href="#local-6989586621680776288"><span class="hs-identifier hs-type">substSuggestion</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Typechecker.html#Resolution"><span class="hs-identifier hs-type">Resolution</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776591"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776590"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Typechecker.html#TDNR"><span class="hs-identifier hs-type">TDNR</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776592"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776591"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776590"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-237"></span><span>    </span><span id="local-6989586621680776288"><span class="annot"><span class="annottext">substSuggestion :: Resolution v loc
-&gt; StateT (Term v loc) (ResultT (Notes v loc) f) ()
</span><a href="#local-6989586621680776288"><span class="hs-identifier hs-var hs-var">substSuggestion</span></a></span></span><span>
</span><span id="line-238"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Unison.Typechecker.html#Resolution"><span class="hs-identifier hs-type">Resolution</span></a></span><span>
</span><span id="line-239"></span><span>          </span><span id="local-6989586621680776265"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680776265"><span class="hs-identifier hs-var">name</span></a></span></span><span>
</span><span id="line-240"></span><span>          </span><span class="annot"><span class="annottext">Type v loc
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-241"></span><span>          </span><span id="local-6989586621680776264"><span class="annot"><span class="annottext">loc
</span><a href="#local-6989586621680776264"><span class="hs-identifier hs-var">loc</span></a></span></span><span>
</span><span id="line-242"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">(Suggestion v loc -&gt; Bool)
-&gt; [Suggestion v loc] -&gt; [Suggestion v loc]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="annot"><span class="annottext">Suggestion v loc -&gt; Bool
forall v loc. Suggestion v loc -&gt; Bool
</span><a href="Unison.Typechecker.Context.html#isExact"><span class="hs-identifier hs-var">Context.isExact</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-243"></span><span>              </span><span class="hs-special">[</span><span class="annot"><a href="Unison.Typechecker.Context.html#Suggestion"><span class="hs-identifier hs-type">Context.Suggestion</span></a></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680776262"><span class="annot"><a href="#local-6989586621680776262"><span class="hs-identifier hs-var">replacement</span></a></span></span><span> </span><span class="annot"><a href="Unison.Typechecker.Context.html#Exact"><span class="hs-identifier hs-type">Context.Exact</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-244"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-245"></span><span>        </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-246"></span><span>        </span><span class="hs-keyword">do</span><span>
</span><span id="line-247"></span><span>          </span><span class="annot"><span class="annottext">(Term v loc -&gt; Term v loc)
-&gt; StateT (Term v loc) (ResultT (Notes v loc) f) ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; loc -&gt; Term v loc -&gt; Term v loc -&gt; Term v loc
</span><a href="#local-6989586621680776260"><span class="hs-identifier hs-var">substBlank</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; String
</span><span class="hs-identifier hs-var">Text.unpack</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680776265"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">loc
</span><a href="#local-6989586621680776264"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Term v loc
</span><a href="#local-6989586621680776258"><span class="hs-identifier hs-var">solved</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-248"></span><span>          </span><span class="annot"><span class="annottext">MaybeT (WriterT (Notes v loc) f) ()
-&gt; StateT (Term v loc) (ResultT (Notes v loc) f) ()
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(MaybeT (WriterT (Notes v loc) f) ()
 -&gt; StateT (Term v loc) (ResultT (Notes v loc) f) ())
-&gt; (InfoNote v loc -&gt; MaybeT (WriterT (Notes v loc) f) ())
-&gt; InfoNote v loc
-&gt; StateT (Term v loc) (ResultT (Notes v loc) f) ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">InfoNote v loc -&gt; MaybeT (WriterT (Notes v loc) f) ()
forall (f :: * -&gt; *) v loc.
Monad f =&gt;
InfoNote v loc -&gt; ResultT (Notes v loc) f ()
</span><a href="Unison.Typechecker.html#btw"><span class="hs-identifier hs-var">btw</span></a></span><span> </span><span class="annot"><span class="annottext">(InfoNote v loc
 -&gt; StateT (Term v loc) (ResultT (Notes v loc) f) ())
-&gt; InfoNote v loc
-&gt; StateT (Term v loc) (ResultT (Notes v loc) f) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">v -&gt; loc -&gt; Term v loc -&gt; InfoNote v loc
forall v loc. v -&gt; loc -&gt; Term v loc -&gt; InfoNote v loc
</span><a href="Unison.Typechecker.Context.html#Decision"><span class="hs-identifier hs-var">Context.Decision</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; v
forall v. Var v =&gt; Name -&gt; v
</span><span class="hs-identifier hs-var">Var.named</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680776265"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">loc
</span><a href="#local-6989586621680776264"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Term v loc
</span><a href="#local-6989586621680776258"><span class="hs-identifier hs-var">solved</span></a></span><span>
</span><span id="line-249"></span><span>        </span><span class="hs-keyword">where</span><span>
</span><span id="line-250"></span><span>          </span><span id="local-6989586621680776258"><span class="annot"><span class="annottext">solved :: Term v loc
</span><a href="#local-6989586621680776258"><span class="hs-identifier hs-var hs-var">solved</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(v -&gt; Term v loc)
-&gt; (Referent -&gt; Term v loc) -&gt; Either v Referent -&gt; Term v loc
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">loc -&gt; v -&gt; Term v loc
forall a v vt at ap. a -&gt; v -&gt; Term2 vt at ap v a
</span><span class="hs-identifier hs-var">Term.var</span></span><span> </span><span class="annot"><span class="annottext">loc
</span><a href="#local-6989586621680776264"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">loc -&gt; Referent -&gt; Term v loc
forall v a vt at ap. Ord v =&gt; a -&gt; Referent -&gt; Term2 vt at ap v a
</span><span class="hs-identifier hs-var">Term.fromReferent</span></span><span> </span><span class="annot"><span class="annottext">loc
</span><a href="#local-6989586621680776264"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Either v Referent
</span><a href="#local-6989586621680776262"><span class="hs-identifier hs-var">replacement</span></a></span><span>
</span><span id="line-251"></span><span>    </span><span class="annot"><a href="#local-6989586621680776288"><span class="hs-identifier hs-var">substSuggestion</span></a></span><span> </span><span class="annot"><span class="annottext">Resolution v loc
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; StateT (Term v loc) (ResultT (Notes v loc) f) ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-252"></span><span>
</span><span id="line-253"></span><span>    </span><span class="hs-comment">-- Resolve a `Blank` to a term</span><span>
</span><span id="line-254"></span><span>    </span><span class="annot"><a href="#local-6989586621680776260"><span class="hs-identifier hs-type">substBlank</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680776590"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Term</span></span><span> </span><span class="annot"><a href="#local-6989586621680776591"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776590"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Term</span></span><span> </span><span class="annot"><a href="#local-6989586621680776591"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776590"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Term</span></span><span> </span><span class="annot"><a href="#local-6989586621680776591"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776590"><span class="hs-identifier hs-type">loc</span></a></span><span>
</span><span id="line-255"></span><span>    </span><span id="local-6989586621680776260"><span class="annot"><span class="annottext">substBlank :: String -&gt; loc -&gt; Term v loc -&gt; Term v loc -&gt; Term v loc
</span><a href="#local-6989586621680776260"><span class="hs-identifier hs-var hs-var">substBlank</span></a></span></span><span> </span><span id="local-6989586621680776253"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680776253"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621680776252"><span class="annot"><span class="annottext">loc
</span><a href="#local-6989586621680776252"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621680776251"><span class="annot"><span class="annottext">Term v loc
</span><a href="#local-6989586621680776251"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Term v loc -&gt; Maybe (Term v loc)) -&gt; Term v loc -&gt; Term v loc
forall (f :: * -&gt; *) v a.
(Traversable f, Ord v) =&gt;
(Term f v a -&gt; Maybe (Term f v a)) -&gt; Term f v a -&gt; Term f v a
</span><span class="hs-identifier hs-var">ABT.visitPure</span></span><span> </span><span class="annot"><span class="annottext">Term v loc -&gt; Maybe (Term v loc)
</span><a href="#local-6989586621680776249"><span class="hs-identifier hs-var">go</span></a></span><span>
</span><span id="line-256"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-257"></span><span>        </span><span id="local-6989586621680776249"><span class="annot"><span class="annottext">go :: Term v loc -&gt; Maybe (Term v loc)
</span><a href="#local-6989586621680776249"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621680776248"><span class="annot"><span class="annottext">Term v loc
</span><a href="#local-6989586621680776248"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Term v loc -&gt; Maybe (Term v loc)
forall a. Bool -&gt; a -&gt; Maybe a
</span><a href="#local-6989586621680776268"><span class="hs-identifier hs-var">guard</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term v loc -&gt; loc
forall (f :: * -&gt; *) v a. Term f v a -&gt; a
</span><span class="hs-identifier hs-var hs-var">ABT.annotation</span></span><span> </span><span class="annot"><span class="annottext">Term v loc
</span><a href="#local-6989586621680776248"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">loc -&gt; loc -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">loc
</span><a href="#local-6989586621680776252"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Term v loc -&gt; Maybe (Term v loc))
-&gt; Term v loc -&gt; Maybe (Term v loc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Term v loc -&gt; Maybe (Term v loc)) -&gt; Term v loc -&gt; Term v loc
forall (f :: * -&gt; *) v a.
(Traversable f, Ord v) =&gt;
(Term f v a -&gt; Maybe (Term f v a)) -&gt; Term f v a -&gt; Term f v a
</span><span class="hs-identifier hs-var">ABT.visitPure</span></span><span> </span><span class="annot"><span class="annottext">Term v loc -&gt; Maybe (Term v loc)
</span><a href="#local-6989586621680776246"><span class="hs-identifier hs-var">resolve</span></a></span><span> </span><span class="annot"><span class="annottext">Term v loc
</span><a href="#local-6989586621680776248"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-258"></span><span>        </span><span id="local-6989586621680776246"><span class="annot"><span class="annottext">resolve :: Term v loc -&gt; Maybe (Term v loc)
</span><a href="#local-6989586621680776246"><span class="hs-identifier hs-var hs-var">resolve</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Term.Blank'</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">B.Recorded</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">B.Resolve</span></span><span> </span><span id="local-6989586621680776242"><span class="annot"><span class="annottext">loc
</span><a href="#local-6989586621680776242"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621680776241"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680776241"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-259"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680776241"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680776253"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-260"></span><span>              </span><span class="annot"><span class="annottext">Term v loc -&gt; Maybe (Term v loc)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">loc -&gt; loc -&gt; loc
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">loc
</span><a href="#local-6989586621680776242"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(loc -&gt; loc) -&gt; Term v loc -&gt; Term v loc
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Term v loc
</span><a href="#local-6989586621680776251"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-261"></span><span>        </span><span class="annot"><a href="#local-6989586621680776246"><span class="hs-identifier hs-var">resolve</span></a></span><span> </span><span class="annot"><span class="annottext">Term v loc
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Term v loc)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-262"></span><span>
</span><span id="line-263"></span><span>    </span><span class="hs-comment">--  Returns Nothing for irrelevant notes</span><span>
</span><span id="line-264"></span><span>    </span><span class="annot"><a href="#local-6989586621680776297"><span class="hs-identifier hs-type">resolveNote</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-265"></span><span>      </span><span class="annot"><a href="Unison.Typechecker.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776591"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776590"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-266"></span><span>      </span><span class="annot"><a href="Unison.Typechecker.Context.html#InfoNote"><span class="hs-identifier hs-type">Context.InfoNote</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776591"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776590"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-267"></span><span>      </span><span class="annot"><a href="Unison.Result.html#Result"><span class="hs-identifier hs-type">Result</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Typechecker.html#Notes"><span class="hs-identifier hs-type">Notes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776591"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776590"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Typechecker.html#Resolution"><span class="hs-identifier hs-type">Resolution</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776591"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776590"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-268"></span><span>    </span><span id="local-6989586621680776297"><span class="annot"><span class="annottext">resolveNote :: Env v loc
-&gt; InfoNote v loc
-&gt; MaybeT
     (WriterT (Notes v loc) Identity) (Maybe (Resolution v loc))
</span><a href="#local-6989586621680776297"><span class="hs-identifier hs-var hs-var">resolveNote</span></a></span></span><span> </span><span id="local-6989586621680776239"><span class="annot"><span class="annottext">Env v loc
</span><a href="#local-6989586621680776239"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Typechecker.Context.html#SolvedBlank"><span class="hs-identifier hs-type">Context.SolvedBlank</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">B.Resolve</span></span><span> </span><span id="local-6989586621680776237"><span class="annot"><span class="annottext">loc
</span><a href="#local-6989586621680776237"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621680776236"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680776236"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">v
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680776235"><span class="annot"><span class="annottext">Type v loc
</span><a href="#local-6989586621680776235"><span class="hs-identifier hs-var">it</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-269"></span><span>      </span><span class="annot"><span class="annottext">([[Suggestion v loc]] -&gt; Maybe (Resolution v loc))
-&gt; MaybeT (WriterT (Notes v loc) Identity) [[Suggestion v loc]]
-&gt; MaybeT
     (WriterT (Notes v loc) Identity) (Maybe (Resolution v loc))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Resolution v loc -&gt; Maybe (Resolution v loc)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Resolution v loc -&gt; Maybe (Resolution v loc))
-&gt; ([[Suggestion v loc]] -&gt; Resolution v loc)
-&gt; [[Suggestion v loc]]
-&gt; Maybe (Resolution v loc)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Type v loc -&gt; loc -&gt; [Suggestion v loc] -&gt; Resolution v loc
forall v loc.
Name -&gt; Type v loc -&gt; loc -&gt; [Suggestion v loc] -&gt; Resolution v loc
</span><a href="Unison.Typechecker.html#Resolution"><span class="hs-identifier hs-var">Resolution</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Name
</span><span class="hs-identifier hs-var">Text.pack</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680776236"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type v loc
</span><a href="#local-6989586621680776235"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">loc
</span><a href="#local-6989586621680776237"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">([Suggestion v loc] -&gt; Resolution v loc)
-&gt; ([[Suggestion v loc]] -&gt; [Suggestion v loc])
-&gt; [[Suggestion v loc]]
-&gt; Resolution v loc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Suggestion v loc] -&gt; [Suggestion v loc]
</span><a href="#local-6989586621680776290"><span class="hs-identifier hs-var">dedupe</span></a></span><span> </span><span class="annot"><span class="annottext">([Suggestion v loc] -&gt; [Suggestion v loc])
-&gt; ([[Suggestion v loc]] -&gt; [Suggestion v loc])
-&gt; [[Suggestion v loc]]
-&gt; [Suggestion v loc]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[[Suggestion v loc]] -&gt; [Suggestion v loc]
forall (m :: * -&gt; *) a. Monad m =&gt; m (m a) -&gt; m a
</span><span class="hs-identifier hs-var">join</span></span><span class="hs-special">)</span><span>
</span><span id="line-270"></span><span>        </span><span class="annot"><span class="annottext">(MaybeT (WriterT (Notes v loc) Identity) [[Suggestion v loc]]
 -&gt; MaybeT
      (WriterT (Notes v loc) Identity) (Maybe (Resolution v loc)))
-&gt; (Map Name [NamedReference v loc]
    -&gt; MaybeT (WriterT (Notes v loc) Identity) [[Suggestion v loc]])
-&gt; Map Name [NamedReference v loc]
-&gt; MaybeT
     (WriterT (Notes v loc) Identity) (Maybe (Resolution v loc))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(NamedReference v loc
 -&gt; MaybeT (WriterT (Notes v loc) Identity) [Suggestion v loc])
-&gt; [NamedReference v loc]
-&gt; MaybeT (WriterT (Notes v loc) Identity) [[Suggestion v loc]]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type v loc
-&gt; NamedReference v loc
-&gt; MaybeT (WriterT (Notes v loc) Identity) [Suggestion v loc]
</span><a href="#local-6989586621680776233"><span class="hs-identifier hs-var">resolve</span></a></span><span> </span><span class="annot"><span class="annottext">Type v loc
</span><a href="#local-6989586621680776235"><span class="hs-identifier hs-var">it</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-271"></span><span>        </span><span class="annot"><span class="annottext">([NamedReference v loc]
 -&gt; MaybeT (WriterT (Notes v loc) Identity) [[Suggestion v loc]])
-&gt; (Map Name [NamedReference v loc] -&gt; [NamedReference v loc])
-&gt; Map Name [NamedReference v loc]
-&gt; MaybeT (WriterT (Notes v loc) Identity) [[Suggestion v loc]]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[[NamedReference v loc]] -&gt; [NamedReference v loc]
forall (m :: * -&gt; *) a. Monad m =&gt; m (m a) -&gt; m a
</span><span class="hs-identifier hs-var">join</span></span><span>
</span><span id="line-272"></span><span>        </span><span class="annot"><span class="annottext">([[NamedReference v loc]] -&gt; [NamedReference v loc])
-&gt; (Map Name [NamedReference v loc] -&gt; [[NamedReference v loc]])
-&gt; Map Name [NamedReference v loc]
-&gt; [NamedReference v loc]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Maybe [NamedReference v loc] -&gt; [[NamedReference v loc]]
forall a. Maybe a -&gt; [a]
</span><span class="hs-identifier hs-var">maybeToList</span></span><span>
</span><span id="line-273"></span><span>        </span><span class="annot"><span class="annottext">(Maybe [NamedReference v loc] -&gt; [[NamedReference v loc]])
-&gt; (Map Name [NamedReference v loc]
    -&gt; Maybe [NamedReference v loc])
-&gt; Map Name [NamedReference v loc]
-&gt; [[NamedReference v loc]]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Name
-&gt; Map Name [NamedReference v loc] -&gt; Maybe [NamedReference v loc]
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Name
</span><span class="hs-identifier hs-var">Text.pack</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680776236"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-274"></span><span>        </span><span class="annot"><span class="annottext">(Map Name [NamedReference v loc]
 -&gt; MaybeT
      (WriterT (Notes v loc) Identity) (Maybe (Resolution v loc)))
-&gt; Map Name [NamedReference v loc]
-&gt; MaybeT
     (WriterT (Notes v loc) Identity) (Maybe (Resolution v loc))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Getting
  (Map Name [NamedReference v loc])
  (Env v loc)
  (Map Name [NamedReference v loc])
-&gt; Env v loc -&gt; Map Name [NamedReference v loc]
forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="annot"><span class="annottext">Getting
  (Map Name [NamedReference v loc])
  (Env v loc)
  (Map Name [NamedReference v loc])
forall v loc. Lens' (Env v loc) (Map Name [NamedReference v loc])
</span><a href="Unison.Typechecker.html#termsByShortname"><span class="hs-identifier hs-var">termsByShortname</span></a></span><span> </span><span class="annot"><span class="annottext">Env v loc
</span><a href="#local-6989586621680776239"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-275"></span><span>    </span><span class="annot"><a href="#local-6989586621680776297"><span class="hs-identifier hs-var">resolveNote</span></a></span><span> </span><span class="annot"><span class="annottext">Env v loc
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680776230"><span class="annot"><span class="annottext">InfoNote v loc
</span><a href="#local-6989586621680776230"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InfoNote v loc -&gt; Result (Notes v loc) ()
forall (f :: * -&gt; *) v loc.
Monad f =&gt;
InfoNote v loc -&gt; ResultT (Notes v loc) f ()
</span><a href="Unison.Typechecker.html#btw"><span class="hs-identifier hs-var">btw</span></a></span><span> </span><span class="annot"><span class="annottext">InfoNote v loc
</span><a href="#local-6989586621680776230"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Result (Notes v loc) ()
-&gt; MaybeT
     (WriterT (Notes v loc) Identity) (Maybe (Resolution v loc))
-&gt; MaybeT
     (WriterT (Notes v loc) Identity) (Maybe (Resolution v loc))
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Resolution v loc)
-&gt; MaybeT
     (WriterT (Notes v loc) Identity) (Maybe (Resolution v loc))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Resolution v loc)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-276"></span><span>    </span><span class="annot"><a href="#local-6989586621680776290"><span class="hs-identifier hs-type">dedupe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Unison.Typechecker.Context.html#Suggestion"><span class="hs-identifier hs-type">Context.Suggestion</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776591"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776590"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Unison.Typechecker.Context.html#Suggestion"><span class="hs-identifier hs-type">Context.Suggestion</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776591"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776590"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-277"></span><span>    </span><span id="local-6989586621680776290"><span class="annot"><span class="annottext">dedupe :: [Suggestion v loc] -&gt; [Suggestion v loc]
</span><a href="#local-6989586621680776290"><span class="hs-identifier hs-var hs-var">dedupe</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Suggestion v loc -&gt; Either v Referent)
-&gt; [Suggestion v loc] -&gt; [Suggestion v loc]
forall (f :: * -&gt; *) b a.
(Foldable f, Ord b) =&gt;
(a -&gt; b) -&gt; f a -&gt; [a]
</span><span class="hs-identifier hs-var">uniqueBy</span></span><span> </span><span class="annot"><span class="annottext">Suggestion v loc -&gt; Either v Referent
forall v loc. Suggestion v loc -&gt; Either v Referent
</span><a href="Unison.Typechecker.Context.html#%24sel%3AsuggestionReplacement%3ASuggestion"><span class="hs-identifier hs-var hs-var">Context.suggestionReplacement</span></a></span><span>
</span><span id="line-278"></span><span>    </span><span class="annot"><a href="#local-6989586621680776233"><span class="hs-identifier hs-type">resolve</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-279"></span><span>      </span><span class="annot"><a href="Unison.Typechecker.Context.html#Type"><span class="hs-identifier hs-type">Context.Type</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776591"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776590"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-280"></span><span>      </span><span class="annot"><a href="Unison.Typechecker.html#NamedReference"><span class="hs-identifier hs-type">NamedReference</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776591"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776590"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-281"></span><span>      </span><span class="annot"><a href="Unison.Result.html#Result"><span class="hs-identifier hs-type">Result</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Typechecker.html#Notes"><span class="hs-identifier hs-type">Notes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776591"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776590"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Unison.Typechecker.Context.html#Suggestion"><span class="hs-identifier hs-type">Context.Suggestion</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776591"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776590"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-282"></span><span>    </span><span id="local-6989586621680776233"><span class="annot"><span class="annottext">resolve :: Type v loc
-&gt; NamedReference v loc
-&gt; MaybeT (WriterT (Notes v loc) Identity) [Suggestion v loc]
</span><a href="#local-6989586621680776233"><span class="hs-identifier hs-var hs-var">resolve</span></a></span></span><span> </span><span id="local-6989586621680776228"><span class="annot"><span class="annottext">Type v loc
</span><a href="#local-6989586621680776228"><span class="hs-identifier hs-var">inferredType</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Typechecker.html#NamedReference"><span class="hs-identifier hs-type">NamedReference</span></a></span><span> </span><span id="local-6989586621680776227"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680776227"><span class="hs-identifier hs-var">fqn</span></a></span></span><span> </span><span id="local-6989586621680776226"><span class="annot"><span class="annottext">Type v loc
</span><a href="#local-6989586621680776226"><span class="hs-identifier hs-var">foundType</span></a></span></span><span> </span><span id="local-6989586621680776225"><span class="annot"><span class="annottext">Either v Referent
</span><a href="#local-6989586621680776225"><span class="hs-identifier hs-var">replace</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-283"></span><span>      </span><span class="hs-comment">-- We found a name that matches. See if the type matches too.</span><span>
</span><span id="line-284"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Type v loc -&gt; Type v loc -&gt; Either (CompilerBug v loc) Bool
forall v loc.
(Var v, Ord loc) =&gt;
Type v loc -&gt; Type v loc -&gt; Either (CompilerBug v loc) Bool
</span><a href="Unison.Typechecker.Context.html#isSubtype"><span class="hs-identifier hs-var">Context.isSubtype</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type v loc -&gt; Type v loc
forall v a b. Ord v =&gt; Type v a -&gt; Type (TypeVar b v) a
</span><a href="Unison.Typechecker.TypeVar.html#liftType"><span class="hs-identifier hs-var">TypeVar.liftType</span></a></span><span> </span><span class="annot"><span class="annottext">Type v loc
</span><a href="#local-6989586621680776226"><span class="hs-identifier hs-var">foundType</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type v loc -&gt; Type v loc
forall v loc. (Var v, Ord loc) =&gt; Type v loc -&gt; Type v loc
</span><a href="Unison.Typechecker.Context.html#relax"><span class="hs-identifier hs-var">Context.relax</span></a></span><span> </span><span class="annot"><span class="annottext">Type v loc
</span><a href="#local-6989586621680776228"><span class="hs-identifier hs-var">inferredType</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-285"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621680776223"><span class="annot"><span class="annottext">CompilerBug v loc
</span><a href="#local-6989586621680776223"><span class="hs-identifier hs-var">bug</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Suggestion v loc] -&gt; () -&gt; [Suggestion v loc]
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(() -&gt; [Suggestion v loc])
-&gt; Result (Notes v loc) ()
-&gt; MaybeT (WriterT (Notes v loc) Identity) [Suggestion v loc]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">CompilerBug v loc -&gt; Result (Notes v loc) ()
forall v loc. CompilerBug v loc -&gt; Result (Notes v loc) ()
</span><a href="Unison.Typechecker.html#compilerBug"><span class="hs-identifier hs-var">compilerBug</span></a></span><span> </span><span class="annot"><span class="annottext">CompilerBug v loc
</span><a href="#local-6989586621680776223"><span class="hs-identifier hs-var">bug</span></a></span><span>
</span><span id="line-286"></span><span>        </span><span class="hs-comment">-- Suggest the import if the type matches.</span><span>
</span><span id="line-287"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621680776222"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680776222"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-288"></span><span>          </span><span class="annot"><span class="annottext">[Suggestion v loc]
-&gt; MaybeT (WriterT (Notes v loc) Identity) [Suggestion v loc]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-289"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Name
-&gt; Type v loc
-&gt; Either v Referent
-&gt; SuggestionMatch
-&gt; Suggestion v loc
forall v loc.
Name
-&gt; Type v loc
-&gt; Either v Referent
-&gt; SuggestionMatch
-&gt; Suggestion v loc
</span><a href="Unison.Typechecker.Context.html#Suggestion"><span class="hs-identifier hs-var">Context.Suggestion</span></a></span><span>
</span><span id="line-290"></span><span>                </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680776227"><span class="hs-identifier hs-var">fqn</span></a></span><span>
</span><span id="line-291"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type v loc -&gt; Type v loc
forall v a b. Ord v =&gt; Type v a -&gt; Type (TypeVar b v) a
</span><a href="Unison.Typechecker.TypeVar.html#liftType"><span class="hs-identifier hs-var">TypeVar.liftType</span></a></span><span> </span><span class="annot"><span class="annottext">Type v loc
</span><a href="#local-6989586621680776226"><span class="hs-identifier hs-var">foundType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-292"></span><span>                </span><span class="annot"><span class="annottext">Either v Referent
</span><a href="#local-6989586621680776225"><span class="hs-identifier hs-var">replace</span></a></span><span>
</span><span id="line-293"></span><span>                </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680776222"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">SuggestionMatch
</span><a href="Unison.Typechecker.Context.html#Exact"><span class="hs-identifier hs-var">Context.Exact</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">SuggestionMatch
</span><a href="Unison.Typechecker.Context.html#WrongType"><span class="hs-identifier hs-var">Context.WrongType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-294"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-295"></span><span>
</span><span id="line-296"></span><span class="hs-comment">-- | Check whether a term matches a type, using a</span><span>
</span><span id="line-297"></span><span class="hs-comment">-- function to resolve the type of @Ref@ constructors</span><span>
</span><span id="line-298"></span><span class="hs-comment">-- contained in the term. Returns @typ@ if successful,</span><span>
</span><span id="line-299"></span><span class="hs-comment">-- and a note about typechecking failure otherwise.</span><span>
</span><span id="line-300"></span><span id="local-6989586621680776218"><span id="local-6989586621680776219"><span id="local-6989586621680776220"><span class="annot"><a href="Unison.Typechecker.html#check"><span class="hs-identifier hs-type">check</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-301"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621680776220"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Var</span></span><span> </span><span class="annot"><a href="#local-6989586621680776219"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680776218"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-302"></span><span>  </span><span class="annot"><a href="Unison.Typechecker.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776219"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776218"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-303"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Term</span></span><span> </span><span class="annot"><a href="#local-6989586621680776219"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776218"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-304"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><a href="#local-6989586621680776219"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776218"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-305"></span><span>  </span><span class="annot"><a href="Unison.Result.html#ResultT"><span class="hs-identifier hs-type">ResultT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Typechecker.html#Notes"><span class="hs-identifier hs-type">Notes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776219"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776218"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680776220"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><a href="#local-6989586621680776219"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776218"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-306"></span><span id="check"><span class="annot"><span class="annottext">check :: Env v loc
-&gt; Term v loc -&gt; Type v loc -&gt; ResultT (Notes v loc) f (Type v loc)
</span><a href="Unison.Typechecker.html#check"><span class="hs-identifier hs-var hs-var">check</span></a></span></span><span> </span><span id="local-6989586621680776216"><span class="annot"><span class="annottext">Env v loc
</span><a href="#local-6989586621680776216"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621680776215"><span class="annot"><span class="annottext">Term v loc
</span><a href="#local-6989586621680776215"><span class="hs-identifier hs-var">term</span></a></span></span><span> </span><span id="local-6989586621680776214"><span class="annot"><span class="annottext">Type v loc
</span><a href="#local-6989586621680776214"><span class="hs-identifier hs-var">typ</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Env v loc -&gt; Term v loc -&gt; ResultT (Notes v loc) f (Type v loc)
forall (f :: * -&gt; *) v loc.
(Monad f, Var v, Ord loc) =&gt;
Env v loc -&gt; Term v loc -&gt; ResultT (Notes v loc) f (Type v loc)
</span><a href="Unison.Typechecker.html#synthesize"><span class="hs-identifier hs-var">synthesize</span></a></span><span> </span><span class="annot"><span class="annottext">Env v loc
</span><a href="#local-6989586621680776216"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">loc -&gt; Term v loc -&gt; Type v loc -&gt; Term v loc
forall v a vt at ap.
Ord v =&gt;
a -&gt; Term2 vt at ap v a -&gt; Type vt at -&gt; Term2 vt at ap v a
</span><span class="hs-identifier hs-var">Term.ann</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term v loc -&gt; loc
forall (f :: * -&gt; *) v a. Term f v a -&gt; a
</span><span class="hs-identifier hs-var hs-var">ABT.annotation</span></span><span> </span><span class="annot"><span class="annottext">Term v loc
</span><a href="#local-6989586621680776215"><span class="hs-identifier hs-var">term</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term v loc
</span><a href="#local-6989586621680776215"><span class="hs-identifier hs-var">term</span></a></span><span> </span><span class="annot"><span class="annottext">Type v loc
</span><a href="#local-6989586621680776214"><span class="hs-identifier hs-var">typ</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-307"></span><span>
</span><span id="line-308"></span><span class="hs-comment">-- | `checkAdmissible' e t` tests that `(f : t -&gt; r) e` is well-typed.</span><span>
</span><span id="line-309"></span><span class="hs-comment">-- If `t` has quantifiers, these are moved outside, so if `t : forall a . a`,</span><span>
</span><span id="line-310"></span><span class="hs-comment">-- this will check that `(f : forall a . a -&gt; a) e` is well typed.</span><span>
</span><span id="line-311"></span><span class="hs-comment">-- checkAdmissible' :: Var v =&gt; Term v -&gt; Type v -&gt; Either Note (Type v)</span><span>
</span><span id="line-312"></span><span class="hs-comment">-- checkAdmissible' term typ =</span><span>
</span><span id="line-313"></span><span class="hs-comment">--   synthesize' (Term.blank() `Term.ann_` tweak typ `Term.app_` term)</span><span>
</span><span id="line-314"></span><span class="hs-comment">--   where</span><span>
</span><span id="line-315"></span><span class="hs-comment">--     tweak (Type.ForallNamed' v body) = Type.forall() v (tweak body)</span><span>
</span><span id="line-316"></span><span class="hs-comment">--     tweak t = Type.arrow() t t</span><span>
</span><span id="line-317"></span><span class="hs-comment">-- | Returns `True` if the expression is well-typed, `False` otherwise</span><span>
</span><span id="line-318"></span><span id="local-6989586621680776210"><span id="local-6989586621680776211"><span id="local-6989586621680776212"><span class="annot"><a href="Unison.Typechecker.html#wellTyped"><span class="hs-identifier hs-type">wellTyped</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621680776212"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Var</span></span><span> </span><span class="annot"><a href="#local-6989586621680776211"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680776210"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Unison.Typechecker.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776211"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776210"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Term</span></span><span> </span><span class="annot"><a href="#local-6989586621680776211"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680776210"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680776212"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span></span></span><span>
</span><span id="line-319"></span><span id="wellTyped"><span class="annot"><span class="annottext">wellTyped :: Env v loc -&gt; Term v loc -&gt; f Bool
</span><a href="Unison.Typechecker.html#wellTyped"><span class="hs-identifier hs-var hs-var">wellTyped</span></a></span></span><span> </span><span id="local-6989586621680776208"><span class="annot"><span class="annottext">Env v loc
</span><a href="#local-6989586621680776208"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621680776207"><span class="annot"><span class="annottext">Term v loc
</span><a href="#local-6989586621680776207"><span class="hs-identifier hs-var">term</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Maybe (Type v loc), Notes v loc) -&gt; Bool
forall a b. (Maybe a, b) -&gt; Bool
</span><a href="#local-6989586621680776206"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">((Maybe (Type v loc), Notes v loc) -&gt; Bool)
-&gt; f (Maybe (Type v loc), Notes v loc) -&gt; f Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">ResultT (Notes v loc) f (Type v loc)
-&gt; f (Maybe (Type v loc), Notes v loc)
forall notes (f :: * -&gt; *) a.
ResultT notes f a -&gt; f (Maybe a, notes)
</span><a href="Unison.Result.html#runResultT"><span class="hs-identifier hs-var">runResultT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Env v loc -&gt; Term v loc -&gt; ResultT (Notes v loc) f (Type v loc)
forall (f :: * -&gt; *) v loc.
(Monad f, Var v, Ord loc) =&gt;
Env v loc -&gt; Term v loc -&gt; ResultT (Notes v loc) f (Type v loc)
</span><a href="Unison.Typechecker.html#synthesize"><span class="hs-identifier hs-var">synthesize</span></a></span><span> </span><span class="annot"><span class="annottext">Env v loc
</span><a href="#local-6989586621680776208"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Term v loc
</span><a href="#local-6989586621680776207"><span class="hs-identifier hs-var">term</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-320"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-321"></span><span>    </span><span id="local-6989586621680776206"><span class="annot"><span class="annottext">go :: (Maybe a, b) -&gt; Bool
</span><a href="#local-6989586621680776206"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680776205"><span class="annot"><span class="annottext">Maybe a
</span><a href="#local-6989586621680776205"><span class="hs-identifier hs-var">may</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe a -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="annot"><span class="annottext">Maybe a
</span><a href="#local-6989586621680776205"><span class="hs-identifier hs-var">may</span></a></span><span>
</span><span id="line-322"></span><span>
</span><span id="line-323"></span><span class="hs-comment">-- | @subtype a b@ is @Right b@ iff @f x@ is well-typed given</span><span>
</span><span id="line-324"></span><span class="hs-comment">-- @x : a@ and @f : b -&gt; t@. That is, if a value of type `a`</span><span>
</span><span id="line-325"></span><span class="hs-comment">-- can be passed to a function expecting a `b`, then `subtype a b`</span><span>
</span><span id="line-326"></span><span class="hs-comment">-- returns `Right b`. This function returns @Left note@ with information</span><span>
</span><span id="line-327"></span><span class="hs-comment">-- about the reason for subtyping failure otherwise.</span><span>
</span><span id="line-328"></span><span class="hs-comment">--</span><span>
</span><span id="line-329"></span><span class="hs-comment">-- Example: @subtype (forall a. a -&gt; a) (Int -&gt; Int)@ returns @Right (Int -&gt; Int)@.</span><span>
</span><span id="line-330"></span><span class="hs-comment">-- subtype :: Var v =&gt; Type v -&gt; Type v -&gt; Either Note (Type v)</span><span>
</span><span id="line-331"></span><span class="hs-comment">-- subtype t1 t2 = error &quot;todo&quot;</span><span>
</span><span id="line-332"></span><span class="hs-comment">-- let (t1', t2') = (ABT.vmap TypeVar.Universal t1, ABT.vmap TypeVar.Universal t2)</span><span>
</span><span id="line-333"></span><span class="hs-comment">-- in case Context.runM (Context.subtype t1' t2')</span><span>
</span><span id="line-334"></span><span class="hs-comment">--                      (Context.MEnv Context.env0 [] Map.empty True) of</span><span>
</span><span id="line-335"></span><span class="hs-comment">--   Left e -&gt; Left e</span><span>
</span><span id="line-336"></span><span class="hs-comment">--   Right _ -&gt; Right t2</span><span>
</span><span id="line-337"></span><span>
</span><span id="line-338"></span><span class="hs-comment">-- | Returns true if @subtype t1 t2@ returns @Right@, false otherwise</span><span>
</span><span id="line-339"></span><span class="hs-comment">-- isSubtype :: Var v =&gt; Type v -&gt; Type v -&gt; Bool</span><span>
</span><span id="line-340"></span><span class="hs-comment">-- isSubtype t1 t2 = case subtype t1 t2 of</span><span>
</span><span id="line-341"></span><span class="hs-comment">--   Left _ -&gt; False</span><span>
</span><span id="line-342"></span><span class="hs-comment">--   Right _ -&gt; True</span><span>
</span><span id="line-343"></span><span>
</span><span id="line-344"></span><span class="hs-comment">-- | Returns true if the two type are equal, up to alpha equivalence and</span><span>
</span><span id="line-345"></span><span class="hs-comment">-- order of quantifier introduction. Note that alpha equivalence considers:</span><span>
</span><span id="line-346"></span><span class="hs-comment">-- `forall b a . a -&gt; b -&gt; a` and</span><span>
</span><span id="line-347"></span><span class="hs-comment">-- `forall a b . a -&gt; b -&gt; a` to be different types</span><span>
</span><span id="line-348"></span><span class="hs-comment">-- equals :: Var v =&gt; Type v -&gt; Type v -&gt; Bool</span><span>
</span><span id="line-349"></span><span class="hs-comment">-- equals t1 t2 = isSubtype t1 t2 &amp;&amp; isSubtype t2 t1</span><span>
</span><span id="line-350"></span></pre></body></html>